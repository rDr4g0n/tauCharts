/*
taucharts@2.0.0-beta.35 (2018-01-11)
Copyright 2018 Targetprocess, Inc.
Licensed under Apache License 2.0
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3-selection"),require("d3-array"),require("d3-scale"),require("d3-transition"),require("d3-format"),require("d3-time-format"),require("d3-axis"),require("d3-brush"),require("d3-geo"),require("d3-request"),require("topojson-client"),require("d3-quadtree"),require("d3-color"),require("d3-shape"),require("d3-time")):"function"==typeof define&&define.amd?define(["d3-selection","d3-array","d3-scale","d3-transition","d3-format","d3-time-format","d3-axis","d3-brush","d3-geo","d3-request","topojson-client","d3-quadtree","d3-color","d3-shape","d3-time"],e):t.Taucharts=e(t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.topojson,t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,n,i,r,a,o,s,u,l,c,d,h,f,p){"use strict";var g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};function m(t,e){function n(){this.constructor=t}g(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var y=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},v={},x={};function _(t){var e=x[t];return e||(e=function(){for(var e,n,i=this,r=0,a=[];i=i.handler;){if("function"==typeof(n=i.callbacks[t])){if(!e)for(e=[this],r=0;r<arguments.length;r++)e.push(arguments[r]);a.unshift({fn:n,context:i.context,args:e})}if("function"==typeof(n=i.callbacks["*"])){if(!e)for(e=[this],r=0;r<arguments.length;r++)e.push(arguments[r]);a.unshift({fn:n,context:i.context,args:[{sender:this,type:t,args:e}]})}}a.forEach(function(t){return t.fn.apply(t.context,t.args)})},x[t]=e),e}var b=function(){function t(){this.handler=null,this.emit_destroy=_("destroy")}return t.prototype.addHandler=function(t,e){e=e||this,this.handler={callbacks:t,context:e,handler:this.handler}},t.prototype.on=function(t,e,n){var i={};return i[t]=e,this.addHandler(i,n),i},t.prototype.fire=function(t,e){_.call(this,t).call(this,e)},t.prototype.removeHandler=function(t,e){var n,i=this;for(e=e||this;n=i,i=i.handler;)if(i.callbacks===t&&i.context===e)return i.callbacks=v,void(n.handler=i.handler)},t.prototype.destroy=function(){this.emit_destroy(),this.handler=null},t}(),w=(y({},t),function(e){function n(t){var n=e.call(this)||this;return n.screenModel=null,n._elementNameSpace=t.namespace||"default",n._elementScalesHub={},n}return m(n,e),n.prototype.regScale=function(t,e){return this._elementScalesHub[t]=e,this},n.prototype.getScale=function(t){return this._elementScalesHub[t]||null},n.prototype.fireNameSpaceEvent=function(t,e){var n=this._elementNameSpace;this.fire(t+"."+n,e)},n.prototype.subscribe=function(e,n,i){void 0===n&&(n=function(t){return t}),void 0===i&&(i=function(t){return t});var r=this,a={};[{event:"mouseover",limit:0},{event:"mouseout",limit:0},{event:"click",limit:0},{event:"mousemove",limit:"requestAnimationFrame"}].forEach(function(o){var s=o.event,u=o.limit;e.on(s,zt(a,s,function(e){var a={data:n.call(this,e),event:i.call(this,t.event,e)};r.fire(s,a),r.fireNameSpaceEvent(s,a)},u))})},n.prototype.allocateRect=function(){return{left:0,top:0,width:0,height:0}},n.prototype.defineGrammarModel=function(t){return{}},n.prototype.getGrammarRules=function(){return[]},n.prototype.getAdjustScalesRules=function(){return[]},n.prototype.createScreenModel=function(t){return null},n.prototype.getClosestElement=function(t,e){return null},n.prototype.addInteraction=function(){},n.prototype.draw=function(){this.config.options.container=this.config.options.slot(this.config.uid),this.drawFrames(this.config.frames)},n.prototype.data=function(){return this.config.frames.reduce(function(t,e){return t.concat(e.part())},[])},n.prototype.node=function(){return this},n}(b)),S={day:{cast:function(t){var e=new Date(t);return new Date(e.setHours(0,0,0,0))},next:function(t){var e=new Date(t),n=new Date(e.setDate(e.getDate()+1));return this.cast(n)}},week:{cast:function(t){var e=new Date(t);return e=new Date(e.setHours(0,0,0,0)),new Date(e.setDate(e.getDate()-e.getDay()))},next:function(t){var e=new Date(t),n=new Date(e.setDate(e.getDate()+7));return this.cast(n)}},month:{cast:function(t){var e=new Date(t);return e=new Date(e.setHours(0,0,0,0)),e=new Date(e.setDate(1))},next:function(t){var e=new Date(t),n=new Date(e.setMonth(e.getMonth()+1));return this.cast(n)}},quarter:{cast:function(t){var e=new Date(t);e=new Date(e.setHours(0,0,0,0));var n=(e=new Date(e.setDate(1))).getMonth(),i=n-n%3;return new Date(e.setMonth(i))},next:function(t){var e=new Date(t),n=new Date(e.setMonth(e.getMonth()+3));return this.cast(n)}},year:{cast:function(t){var e=new Date(t);return e=new Date(e.setHours(0,0,0,0)),e=new Date(e.setDate(1)),e=new Date(e.setMonth(0))},next:function(t){var e=new Date(t),n=new Date(e.setFullYear(e.getFullYear()+1));return this.cast(n)}}},T={day:{cast:function(t){var e=new Date(t);return new Date(e.setUTCHours(0,0,0,0))},next:function(t){var e=new Date(t),n=new Date(e.setUTCDate(e.getUTCDate()+1));return this.cast(n)}},week:{cast:function(t){var e=new Date(t);return e=new Date(e.setUTCHours(0,0,0,0)),new Date(e.setUTCDate(e.getUTCDate()-e.getUTCDay()))},next:function(t){var e=new Date(t),n=new Date(e.setUTCDate(e.getUTCDate()+7));return this.cast(n)}},month:{cast:function(t){var e=new Date(t);return e=new Date(e.setUTCHours(0,0,0,0)),e=new Date(e.setUTCDate(1))},next:function(t){var e=new Date(t),n=new Date(e.setUTCMonth(e.getUTCMonth()+1));return this.cast(n)}},quarter:{cast:function(t){var e=new Date(t);e=new Date(e.setUTCHours(0,0,0,0));var n=(e=new Date(e.setUTCDate(1))).getUTCMonth(),i=n-n%3;return new Date(e.setUTCMonth(i))},next:function(t){var e=new Date(t),n=new Date(e.setUTCMonth(e.getUTCMonth()+3));return this.cast(n)}},year:{cast:function(t){var e=new Date(t);return e=new Date(e.setUTCHours(0,0,0,0)),e=new Date(e.setUTCDate(1)),e=new Date(e.setUTCMonth(0))},next:function(t){var e=new Date(t),n=new Date(e.setUTCFullYear(e.getUTCFullYear()+1));return this.cast(n)}}},E={add:function(t,e,n){return((void 0===n?{utc:!1}:n).utc?T:S)[t.toLowerCase()]=e,this},get:function(t,e){return((void 0===e?{utc:!1}:e).utc?T:S)[(t||"").toLowerCase()]||null},generate:function(t,e,n,i){var r=(void 0===i?{utc:!1}:i).utc,a=[],o=E.get(n,{utc:r});if(o){var s=o.cast(new Date(e)),u=o.cast(new Date(t));for(a.push(u);(u=o.next(new Date(u)))<=s;)a.push(u)}return a}},M=function(t){function e(e,n,i){var r=t.call(this)||this;return r.name="TauChartError",r.message=e,r.errorCode=n,r.errorArgs=i,r}return m(e,t),e}(Error),k={STACKED_FIELD_NOT_NUMBER:"STACKED_FIELD_NOT_NUMBER",NO_DATA:"NO_DATA",NOT_SUPPORTED_TYPE_CHART:"NOT_SUPPORTED_TYPE_CHART",UNKNOWN_UNIT_TYPE:"UNKNOWN_UNIT_TYPE",INVALID_LOG_DOMAIN:"INVALID_LOG_DOMAIN"},A={},C={get:function(t){return A[t]},reg:function(t,e){return A[t]=e,this}},O="taucharts_synthetic_record";function L(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return 2===e.length?e[0]*(1-t)+e[1]*t:3===e.length?e[0]*(1-t)*(1-t)+2*e[1]*(1-t)*t+e[2]*t*t:e[0]*(1-t)*(1-t)*(1-t)+3*e[1]*(1-t)*(1-t)*t+3*e[2]*(1-t)*t*t+e[3]*t*t*t}function N(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=e.map(function(t){return t.x}),r=e.map(function(t){return t.y});return{x:L.apply(void 0,[t].concat(i)),y:L.apply(void 0,[t].concat(r))}}function F(t,e,n,i,r){var a=N(t,e,n),o=N(t,e,n,i),s=N(t,n,i,r),u=N(t,i,r);return[e,a,o,N(t,o,s),s,u,r]}function R(t,e,n){var i;return void 0===n&&(n="polyline"),function(r){return 0===r?t:1===r?e:(i||(i=("cubic"===n?function(t,e){for(var n=2;n<t.length-1;n+=3)t[n-1].isCubicControl=!0,t[n].isCubicControl=!0;for(n=2;n<e.length-1;n+=3)e[n-1].isCubicControl=!0,e[n].isCubicControl=!0;var i,r;for(t=t.filter(function(t){return!t.isInterpolated}),n=t.length-2;n>=0;n--)r=t[n+1],(i=t[n]).isCubicControl||r.isCubicControl||(t.splice(n+1,0,N(1/3,r,i),N(2/3,r,i)),t[n+1].isCubicControl=!0,t[n+2].isCubicControl=!0);var a=t.filter(function(t,e){return e%3==0}),o=e.filter(function(t,e){return e%3==0}),s=a.map(function(t){return t.id}),u=o.map(function(t){return t.id}),l=s.reduce(function(e,n){return e[n]=t.findIndex(function(t){return t.id===n}),e},{}),c=u.reduce(function(t,n){return t[n]=e.findIndex(function(t){return t.id===n}),t},{}),d=s.filter(function(t){return u.indexOf(t)>=0}),h=a.filter(function(t){return!t.positionIsBeingChanged}),f=o.filter(function(t){return!t.positionIsBeingChanged}),p=G(h,f),g=G(f,h),m=[];d.forEach(function(n,i){var r,a,o,s=l[n],u=c[n];if(0===i&&(s>0||u>0)&&m.push(D({polylineFrom:t.slice(0,s+1),polylineTo:e.slice(0,u+1),toOppositeScale:0===u?p:g,isCubic:!0})),i>0){var h=l[d[i-1]],f=c[d[i-1]];s-h>3||u-f>3?m.push(j({polylineFrom:t.slice(h,s+1),polylineTo:e.slice(f,u+1),isCubic:!0})):m.push((r={polylineFrom:t.slice(h,s+1),polylineTo:e.slice(f,u+1)},a=r.polylineFrom,o=r.polylineTo,function(t){return q(a.slice(1,3),o.slice(1,3),t)}))}m.push(I({pointFrom:t[s],pointTo:e[u]})),i===d.length-1&&(t.length-s-1>0||e.length-u-1>0)&&m.push(D({polylineFrom:t.slice(s),polylineTo:e.slice(u),toOppositeScale:e.length-u==1?p:g,isCubic:!0}))}),0===m.length&&(e.length>0&&0===d.length||t.length>0&&0===d.length)&&m.push(z({polylineFrom:t.slice(0),polylineTo:e.slice(0),isCubic:!0}));return function(t){var e=[];return m.forEach(function(n){var i=n(t);P(e,i)}),e}}:function(t,e){var n=(t=t.filter(function(t){return!t.isInterpolated})).map(function(t){return t.id}),i=e.map(function(t){return t.id}),r=n.filter(function(t){return i.indexOf(t)>=0}),a=t.filter(function(t){return!t.positionIsBeingChanged}),o=e.filter(function(t){return!t.positionIsBeingChanged}),s=G(a,o),u=G(o,a),l=[];r.forEach(function(a,o){var c=n.indexOf(a),d=i.indexOf(a);if(0===o&&(c>0||d>0)&&l.push(D({isCubic:!1,polylineFrom:t.slice(0,c+1),polylineTo:e.slice(0,d+1),toOppositeScale:0===d?s:u})),o>0){var h=n.indexOf(r[o-1]),f=i.indexOf(r[o-1]);(c-h>1||d-f>1)&&l.push(j({isCubic:!1,polylineFrom:t.slice(h,c+1),polylineTo:e.slice(f,d+1)}))}l.push(I({pointFrom:t[c],pointTo:e[d]})),o===r.length-1&&(t.length-c-1>0||e.length-d-1>0)&&l.push(D({isCubic:!1,polylineFrom:t.slice(c),polylineTo:e.slice(d),toOppositeScale:e.length-d==1?s:u}))}),0===l.length&&(e.length>0&&0===r.length||t.length>0&&0===r.length)&&l.push(z({isCubic:!1,polylineFrom:t.slice(0),polylineTo:e.slice(0)}));return function(t){var e=[];return l.forEach(function(n){var i=n(t);P(e,i)}),e}})(t,e)),i(r))}}function D(t){var e=t.polylineFrom,n=t.polylineTo,i=t.isCubic,r=t.toOppositeScale,a=e.length>n.length?e:n,o=1===n.length,s=e[0].id!==n[0].id,u=Boolean(s!==o);return function(t){var e=(i?W:U)({t:t,polyline:a,decreasing:o,rightToLeft:u});o===u?e.shift():e.pop();var n=q(e.map(r),e,o?1-t:t);return n.forEach(function(t){return t.positionIsBeingChanged=!0}),n}}function j(t){var e=t.polylineFrom,n=t.polylineTo,i=t.isCubic,r=e.length,a=n.length;if(a!==r){var o=a<r,s=o?e:n,u=(i?function(t){var e=t.smallerPolyline,n=t.biggerPolyline,i=t.decreasing,r=(e.length-1)/3,a=(n.length-1)/3,o=Math.floor(a/r)+1,s=a%r,u=Wt(r).map(function(t){return o+Number(t<s)}),l=[e[0]],c=3;return u.forEach(function(t){if(t>2){var r=function(t,e){for(var n,i,r=[e[0]],a=0;a<t.length;a++)n=0===a?t[0]:t[a]/(1-t[a-1]),i=Y(n,e),P(r,i.slice(1,4)),e=i.slice(3);return P(r,e.slice(1)),r}(Wt(1,t-1).map(function(e){return e/(t-1)}),e.slice(c-3,c+1));Wt(t-2).forEach(function(t){return r[3*(t+1)].id=n[l.length-1+3*t].id}),i&&r.forEach(function(t,e){e>0&&e<r.length-1&&(t.isInterpolated=!0)}),P(l,r.slice(1))}else{var a=Object.assign({},e[c-2]),o=Object.assign({},e[c-1]),s=Object.assign({},e[c]);i||(s.id=n[l.length+2].id),l.push(a,o,s)}c+=3}),l}:function(t){var e=t.smallerPolyline,n=t.biggerPolyline,i=t.decreasing,r=e.length-1,a=n.length-1,o=Math.floor(a/r)+1,s=a%r,u=Wt(r).map(function(t){return o+Number(t<s)}),l=[e[0]],c=1;return u.forEach(function(t){Wt(1,t).forEach(function(r){var a;r===t-1?(a=Object.assign({},e[c]),i||(a.id=n[l.length].id)):((a=B(e[c-1],e[c],r/(t-1))).id=n[l.length].id,i&&(a.isInterpolated=!0)),l.push(a)}),c++}),l})({smallerPolyline:o?n:e,biggerPolyline:s,decreasing:o}),l=s.slice(1,s.length-1),c=u.slice(1,u.length-1);return function(t){var e=q(c,l,o?1-t:t);return e.forEach(function(t){return t.positionIsBeingChanged=!0}),e}}var d=e.slice(1,e.length-1),h=n.slice(1,n.length-1);return function(t){var e=q(d,h,t);return e.forEach(function(t){return t.positionIsBeingChanged=!0}),e}}function I(t){var e=t.pointFrom,n=t.pointTo;return function(t){return[B(e,n,t)]}}function z(t){var e=t.polylineFrom,n=t.polylineTo,i=t.isCubic,r=0===n.length,a=r,o=r?e:n;return function(t){var e=(i?W:U)({t:t,polyline:o,decreasing:r,rightToLeft:a});return e.forEach(function(t,e){e>0&&(t.positionIsBeingChanged=!0)}),e}}function P(t,e){return Array.prototype.push.apply(t,e)}function H(t,e,n){return void 0===e?t:"number"==typeof e?t+n*(e-t):e}function B(t,e,n){if(t===e)return e;var i={};return Object.keys(t).forEach(function(r){return i[r]=H(t[r],e[r],n)}),void 0!==e.id&&(i.id=e.id),i}function q(t,e,n){return t.map(function(t,i){return B(t,e[i],n)})}function U(t){var e=t.t,n=t.polyline,i=t.decreasing,r=t.rightToLeft,a=Boolean(i)!==Boolean(r),o=function(t,e){var n=0;if(t>0){for(var i,r,a,o,s=[0],u=0,l=1;l<e.length;l++)a=e[l-1].x,o=e[l-1].y,i=e[l].x,r=e[l].y,u+=Math.sqrt((i-a)*(i-a)+(r-o)*(r-o)),s.push(u);var c=t*u;for(l=1;l<s.length;l++)if(c<=s[l]){n=Math.min(1,(l-1+(c-s[l-1])/(s[l]-s[l-1]))/(e.length-1));break}}var d=Math.floor((e.length-1)*n)+1,h=e.length-d,f=d,p=e.slice(0,d);if(n<1){var g=n*(e.length-1)%1,m=B(e[d-1],e[d],g);P(p,Wt(h).map(function(t){return Object.assign({},m,{id:e[f+t].id,isInterpolated:!0})}))}return p}(i?1-e:e,a?n.slice(0).reverse():n);return a&&o.reverse(),o}function W(t){var e=t.t,n=t.polyline,i=t.decreasing,r=t.rightToLeft,a=Boolean(i)!==Boolean(r),o=function(t,e){var n=(e.length-1)/3+1,i=0;if(t>0){for(var r,a,o,s,u,l,c,d,h=[0],f=0,p=1;p<n;p++)o=e[3*p-3].x,s=e[3*p-3].y,u=e[3*p-2].x,l=e[3*p-2].y,c=e[3*p-1].x,d=e[3*p-1].y,r=e[3*p].x,a=e[3*p].y,f+=(X(o,s,u,l)+X(u,l,c,d)+X(c,d,r,a)+X(r,a,o,s))/2,h.push(f);var g=t*f;for(p=1;p<h.length;p++)if(g<=h[p]){i=Math.min(1,(p-1+(g-h[p-1])/(h[p]-h[p-1]))/(n-1));break}}var m=Math.floor((n-1)*i)+1,y=n-m,v=3*m,x=e.slice(0,3*(m-1)+1);if(i<1){var _=Y(i*(n-1)%1,e.slice(3*(m-1),3*m+1)).slice(1,4);_.forEach(function(t){return t.isInterpolated=!0}),_[2].id=e[v].id,P(x,_),Wt(1,y).forEach(function(t){P(x,[{x:_[2].x,y:_[2].y,isCubicControl:!0,isInterpolated:!0},{x:_[2].x,y:_[2].y,isCubicControl:!0,isInterpolated:!0},Object.assign({},_[2],{id:e[v+3*t].id,isInterpolated:!0})])})}return x}(i?1-e:e,a?n.slice(0).reverse():n);return a&&o.reverse(),o}function G(t,e){var n,i,r,a,o=[],s=[],u=0,l=t.length,c=e.length;for(n=0;n<l;n++)for(r=t[n],i=u;i<c;i++)if(a=e[i],r.id===a.id){u=i+1,o.push(r),s.push(a);break}if(o.length<1||s.length<1)return function(t){return t};var d=Object.keys(o[0]).filter(function(t){return"number"==typeof o[0][t]}).filter(function(t){return"id"!==t}),h={},f=function(t,e,n,i){return function(r){return i+(r-e)*(i-n)/(e-t)}};return d.forEach(function(t){for(var e,n,i,r,a=o[0][t],u=s[0][t],l=o.length-1;l>0;l--)if((e=o[l][t])!==a)return n=s[l][t],void(h[t]=f(a,e,u,n));h[t]=(i=a,r=u,function(t){return t-i+r})}),function(t){var e=Object.assign({},t);return d.forEach(function(n){e[n]=h[n](t[n])}),e}}function X(t,e,n,i){return Math.sqrt((n-t)*(n-t)+(i-e)*(i-e))}function Y(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],o=F(t,n,i,r,a);return[o[1],o[2],o[4],o[5]].forEach(function(t){return t.isCubicControl=!0}),Object.keys(a).forEach(function(e){"x"!==e&&"y"!==e&&"id"!==e&&(o[3][e]=H(n[e],a[e],t))}),o}function V(t,e){if(t.length<2)return t.slice(0);if(2===t.length)return[t[0],{x:K(t[0].x,t[1].x,1/3),y:K(t[0].y,t[1].y,1/3)},{x:K(t[0].x,t[1].x,2/3),y:K(t[0].y,t[1].y,2/3)},t[1]];for(var n,i,r,a,o,s,u,l,c,d,h,f,p,g,m=new Array(3*(t.length-1)+1),y=0;y<t.length;y++)m[3*y]=t[y],y>0&&(m[3*y-2]=N(1/3,t[y-1],t[y]),m[3*y-1]=N(2/3,t[y-1],t[y]));for(var v=m.slice(0),x=0;x<3;x++){for(y=6;y<v.length;y+=3)n=v[y-5],i=v[y-3],r=v[y-1],(i.x-n.x)*(r.x-i.x)*1e12<1?(a=K(n.x,i.x,.5),s=K(i.x,r.x,.5),o=K(n.y,i.y,.5),u=K(i.y,r.y,.5)):(d=(i.x-n.x)/(r.x-n.x),l=(i.x-n.x*(1-d)*(1-d)-r.x*d*d)/(2*(1-d)*d),c=(i.y-n.y*(1-d)*(1-d)-r.y*d*d)/(2*(1-d)*d),a=K(n.x,l,d),s=K(l,r.x,d),o=K(n.y,c,d),u=K(c,r.y,d),e&&(f=i.x-a,p=s-i.x,h=(u-i.y)/p,(i.y-n.y)*(r.y-i.y)<=0?h=0:(i.y>n.y==u>r.y&&(p=K(p*(g=(r.y-i.y)/(u-i.y)),p,1/(1+Math.abs(g))),h=(r.y-i.y)/p),i.y>n.y==o<n.y&&(f=K(f*(g=(i.y-n.y)/(i.y-o)),f,1/(1+Math.abs(g))),h=(i.y-n.y)/f)),a=i.x-f,s=i.x+p,o=i.y-h*f,u=i.y+h*p)),m[y-4]={x:a,y:o},m[y-2]={x:s,y:u};m[1]={x:K(m[0].x,m[3].x,1/3),y:K(m[0].y,K(m[3].y,m[2].y,1.5),2/3)};var _=m.length-1;m[_-1]={x:K(m[_].x,m[_-3].x,1/3),y:K(m[_].y,K(m[_-3].y,m[_-2].y,1.5),2/3)},v=m.slice(0)}return v}function K(t,e,n){return t+n*(e-t)}C.reg("identity",function(){return{}}).reg("flip",function(t){var e=t.scaleY,n=t.scaleX,i=n.domain(),r=n.discrete?i[0]:Math.max(0,Math.min.apply(Math,i)),a=n.value(r)+-.5*n.stepSize(r);return{flip:!0,scaleX:e,scaleY:n,xi:function(t){return e.value(t[e.dim])},yi:function(t){return n.value(t[n.dim])},y0:function(){return a}}}).reg("positioningByColor",function(t){return(t.scaleX.discrete?function(t){var e=t.data().reduce(function(e,n){var i=n[t.scaleX.dim],r=n[t.scaleColor.dim];return i in e||(e[i]=[]),e[i].indexOf(r)<0&&e[i].push(r),e},{}),n=t.scaleX,i=t.scaleColor,r=i.discrete?i.domain():i.originalSeries().sort(function(t,e){return t-e}),a=r.length||1,o=r.reduce(function(t,e,n){return t[e]=n,t},{});return Object.keys(e).forEach(function(t){return e[t].sort(function(t,e){return o[t]-o[e]})}),{xi:function(i){var r,o=i[t.scaleX.dim],s=e[o]||[i[t.scaleColor.dim]],u=s.length,l=s.indexOf(i[t.scaleColor.dim]),c=(r=i,n.stepSize(r[n.dim])*(a/(1+a)))/(a+1);return t.xi(i)-(u+1)*c/2+(1+l)*c}}}:function(){return{}})(t)}).reg("groupOrderByAvg",function(t){var e=t.data().reduce(function(e,n){var i=t.group(n);return e[i]=e[i]||[],e[i].push(n),e},{}),n=Object.keys(e).map(function(n){return[n,(i=e[n],i.map(t.yi).reduce(function(t,e){return t+e},0)/i.length)];var i}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]});return{order:function(t){var e=n.indexOf(t);return e<0?Number.MAX_VALUE:e}}}).reg("stack",function(t){var e=t.data(),n=t.scaleX,i=t.scaleY;if(i.discrete||i.domain().some(function(t){return"number"!=typeof t}))throw new M("Stacked field ["+i.dim+"] should be a number",k.STACKED_FIELD_NOT_NUMBER,{field:i.dim});var r=function(t){return function(e){var r=e[n.dim],a=e[i.dim],o=a>=0?t.positive:t.negative,s=o[r]||0,u=s+a;return o[r]=u,{nextStack:u,prevStack:s}}},a=r({positive:{},negative:{}}),o=r({positive:{},negative:{}}),s=function(e){return Qt(e,t.id)},u=Number.MAX_VALUE,l=Number.MIN_VALUE,c=function(t){return u=t<u?t:u,l=t>l?t:l,i.value(t)},d=s(function(t){return c(a(t).nextStack)}),h=s(function(t){return c(o(t).prevStack)}),f=function(e){return t.group(e)+"/"+(e[i.dim]>=0?1:-1)},p=Yt(e,f),g=Object.keys(p).sort(t.flip?function(e,n){return t.order(e)-t.order(n)}:function(e,n){return t.order(n)-t.order(e)}).reduce(function(t,e){return t.concat(p[e])},[]);return g.forEach(function(t){d(t),h(t)}),i.fixup(function(t){var e={};return(!t.hasOwnProperty("max")||t.max<l)&&(e.max=l),(!t.hasOwnProperty("min")||t.min>u)&&(e.min=u),e}),{group:f,data:function(){return g},yi:d,y0:h}}).reg("size_distribute_evenly",function(t,e){var n=e.minLimit,i=e.maxLimit,r=e.defMin,a=e.defMax,o=t.data(),s=function(t,e){return t-e},u=t.scaleX.discrete?t.scaleX.stepSize()/2:Number.MAX_VALUE,l=o.map(function(e){return t.xi(e)}).sort(s),c=l[0],d=l.slice(1).map(function(t){var e=t-c;return c=t,e}).filter(function(t){return t>0}).sort(s).concat(Number.MAX_VALUE)[0],h=Math.min(d,u),f="number"==typeof n?n:r,p={minSize:f,maxSize:"number"==typeof i?i:Math.max(f,Math.min(a,h))};return t.scaleSize.fixup(function(t){var e={};return t.fixed?t.maxSize>p.maxSize&&(e.maxSize=p.maxSize):(e.fixed=!0,e.minSize=p.minSize,e.maxSize=p.maxSize),e}),{}}).reg("adjustStaticSizeScale",function(t,e){var n=e.minLimit,i=e.maxLimit,r=e.defMin,a=e.defMax,o={minSize:"number"==typeof n?n:r,maxSize:"number"==typeof i?i:a};return t.scaleSize.fixup(function(t){var e={};return t.fixed||(e.fixed=!0,e.minSize=o.minSize,e.maxSize=o.maxSize),e}),{}}).reg("adjustSigmaSizeScale",function(t,e){var n,i,r,a,o=e.minLimit,s=e.maxLimit,u=e.defMin,l=e.defMax,c=function(t,e){return t-e},d=t.data().map(function(e){return t.xi(e)}).sort(c),h=d[0],f=d.slice(1).map(function(t){var e=t-h;return h=t,e}).filter(function(t){return t>0}).sort(c).concat(Number.MAX_VALUE)[0],p=t.scaleX.discrete?t.scaleX.stepSize()/2:Number.MAX_VALUE,g=Math.min(f,p),m="number"==typeof o?o:u,y="number"==typeof s?s:l,v={minSize:m,maxSize:Math.max(m,Math.min(y,(n=g,i=(m+y)/2,r=y,a=m,Math.round(i+(r-i)/(1+Math.exp(-(n-a)/.5))))))};return t.scaleSize.fixup(function(t){var e={};return t.fixed?t.maxSize>v.maxSize&&(e.maxSize=v.maxSize):(e.fixed=!0,e.minSize=v.minSize,e.maxSize=v.maxSize),e}),{}}).reg("avoidScalesOverflow",function(t,e){var n,i,r=e.sizeDirection,a=function(t,e){return!t||t.discrete||"logarithmic"===t.scaleType||r.indexOf(e)<0},o=a(t.scaleX,"x"),s=a(t.scaleY,"y");if(o&&s)return{};t.scaleSize.fixup(function(t){return n=t.minSize,i=t.maxSize,t});var u=t.data().reduce(function(e,r){var a,u,l=t.size(r),c=(l>=n?l:n+l*(i-n))/2;return o||(a=t.xi(r),e.left=Math.min(e.left,a-c),e.right=Math.max(e.right,a+c)),s||(u=t.yi(r),e.top=Math.min(e.top,u-c),e.bottom=Math.max(e.bottom,u+c)),e},{top:Number.MAX_VALUE,right:-Number.MAX_VALUE,bottom:-Number.MAX_VALUE,left:Number.MAX_VALUE}),l=function(e,n,i,r){var a=e.domain(),o=Math.abs(e.value(a[1])-e.value(a[0])),s=(a[1]-a[0])/o;if(0===o)return 1;var u=Math.max(0,-n),l=Math.max(0,i-o),c=t.flip?l:u,d=t.flip?u:l,h=Number(a[0])-(r?d:c)*s,f=Number(a[1])+(r?c:d)*s;return e.fixup(function(t){var e={};if(t.fixedBorders){var r=t.fixedBorders.slice(),a=r[0],o=r[1];(a>n||o<i)&&(e.min=Math.min(t.min,h),e.max=Math.max(t.max,f),a=Math.min(n,a),o=Math.max(i,o)),e.fixedBorders=[a,o]}else e.fixed=!0,e.min=h,e.max=f,e.nice=!1,e.fixedBorders=[n,i];return e}),o/(c+o+d)},c=o?1:l(t.scaleX,u.left,u.right,!1),d=s?1:l(t.scaleY,u.top,u.bottom,!0),h=Math.min(n*c,n*d),f=Math.min(i*c,i*d);return t.scaleSize.fixup(function(){return{minSize:h,maxSize:f}}),{}}).reg("fillGaps",function(t,e){var n,i,r,a,o,s,u,l=e.isStack,c=e.xPeriod,d=e.utc,h=Yt(t.data(),t.group),f=Object.keys(h).sort(function(e,n){return t.order(e)-t.order(n)}).reduce(function(t,e){return t.concat([h[e]])},[]),p=t.scaleX.dim,g=t.scaleY.dim,m=t.scaleColor.dim,y=t.scaleSplit.dim,v=function(t){return t[g]>=0?1:-1},x=function(e,n,i){var r=Yt(n,function(t){return t[p]}),a=n[0];return e.reduce(function(e,n){return e.concat(r[n]||(s=a,u=i,c=[o=n,t.id(s),u].join(" "),(l={})[p]=o,l[g]=1e-10*u,l[y]=s[y],l[m]=s[m],l[O]=!0,l[O+"id"]=c,l));var o,s,u,l,c},[])},_=function(t,e){return t-e},b=function(){return Xt(f.reduce(function(t,e){return t.concat(e.map(function(t){return t[p]}))},[])).sort(_)},w=c?(n=b(),i=Math.max.apply(Math,n.map(function(t){return Number(t)})),r=t.scaleX.domain(),a=E.generate(r[0],r[1],c,{utc:d}).filter(function(t){return t>=r[0]&&t<=r[1]}),o=0,s=[],u=E.get(c,{utc:d}),a.forEach(function(t){var e=Number(t);if(!(e>=i)){for(var r=o;r<n.length;r++)if(Number(u.cast(n[r]))===e)return void o++;s.push(t)}}),n.concat(s).sort(_)):b(),S=f.map(function(e){return e.sort(function(e,n){return t.xi(e)-t.xi(n)})}).reduce(l?function(t,e){var n=Yt(e,function(t){return String(v(t))});return Object.keys(n).reduce(function(t,e){return t.concat(x(w,n[e],e))},t)}:function(t,e){Yt(e,function(t){return String(v(t))});var n=Math.max.apply(Math,e.map(function(t){return t[p]}));return t.concat(x(w.filter(function(t){return t<=n}),e,0))},[]);return{data:function(){return S},id:function(e){return e[O]?e[O+"id"]:t.id(e)}}});var J={linear:function(t){return t},step:function(t){for(var e,n,i,r,a=[],o=void 0!==t[0].id,s=void 0!==t[0].size,u=1;u<t.length;u++)e=t[u-1],n=t[u],i={x:(e.x+n.x)/2,y:e.y},r={x:(e.x+n.x)/2,y:n.y},o&&(i.id=e.id+"-"+n.id+"-1",r.id=e.id+"-"+n.id+"-2"),s&&(i.size=e.size,r.size=n.size),1===u&&a.push(e),a.push(i,r,n);return a},"step-before":function(t){for(var e,n,i,r=[],a=void 0!==t[0].id,o=void 0!==t[0].size,s=1;s<t.length;s++)e=t[s-1],n=t[s],i={x:e.x,y:n.y},a&&(i.id=e.id+"-"+n.id),o&&(i.size=n.size),1===s&&r.push(e),r.push(i,n);return r},"step-after":function(t){for(var e,n,i,r=[],a=void 0!==t[0].id,o=void 0!==t[0].size,s=1;s<t.length;s++)e=t[s-1],i={x:(n=t[s]).x,y:e.y},a&&(i.id=e.id+"-"+n.id),o&&(i.size=e.size),1===s&&r.push(e),r.push(i,n);return r}},$={smooth:function(t){return V(t,!1)},"smooth-keep-extremum":function(t){return V(t,!0)}};function Q(t){return J[t]||$[t]}function Z(t){return void 0!==$[t]?"cubic":"polyline"}var tt=y({},t,i),et=function(){return Qt(function(t){return t.node().getComputedTextLength()},function(t){return t.node().textContent.length})},nt=function(t,e,n){n=n||et(),t.each(function(){var t=tt.select(this.parentNode).data()[0],i=e(t),r=tt.select(this),a=!1,o=r.text().split(/\s+/).reduce(function(t,e,o){if(a)return t;var s=o>0?[t,e].join(" "):e,u=n(r.text(s));if(u<i)t=s;else{var l=Math.floor(i/u*s.length);t=s.substr(0,l-4)+"...",a=!0}return t},"");r.text(o)})},it=function(t,e,n,i,r,a){a=a||et();var o=function(t,e,n,i,r,a,o){var s=o*n+a;return t.append("tspan").attr("x",i).attr("y",r).attr("dy",s+"em").text(e)};t.each(function(){var t=tt.select(this.parentNode).data()[0],s=e(t),u=tt.select(this),l=u.text().split(/\s+/),c=u.attr("x"),d=u.attr("y"),h=parseFloat(u.attr("dy"));u.text(null);var f=o(u,null,1.1,c,d,h,0),p=!1,g=l.length-1,m=l.reduce(function(t,e,i){if(p)return t;var r=t.length===n||i===g,o=t[t.length-1],u=""!==o?o+" "+e:e,l=a(f.text(u)),c=l>s;if(c&&r){var d=Math.floor(s/l*u.length);t[t.length-1]=u.substr(0,d-4)+"...",p=!0}return c&&!r&&t.push(e),c||(t[t.length-1]=u),t},[""]).filter(function(t){return t.length>0});d=r?-1*(m.length-1)*Math.floor(.5*i):d,m.forEach(function(t,e){return o(u,t,1.1,c,d,h,e)}),f.remove()})};var rt=function(t,e,n){return e>0&&!document.hidden&&((t=t.transition(n).duration(e)).attr=at),t.onTransitionEnd=function(t){return ut(this,t),this},t},at=function(t,e){var n,i=this,r=tt.transition.prototype.attr.apply(this,arguments);if(0===arguments.length)throw new Error("Unexpected `transition().attr()` arguments.");1===arguments.length?n=t:arguments.length>1&&((u={})[t]=e,n=u);var a="__transitionAttrs__",o="__lastTransitions__",s=st();this.each(function(){var t=this,e={};for(var i in n)"function"==typeof n[i]?e[i]=n[i].apply(this,arguments):e[i]=n[i];this[a]=Object.assign(this[a]||{},e),this[a][o]||Object.defineProperty(this[a],o,{value:{}}),Object.keys(e).forEach(function(e){return t[a][o][e]=s})});var u,l=function(){var t=this;this[a]&&(Object.keys(n).filter(function(e){return t[a][o][e]===s}).forEach(function(e){return delete t[a][e]}),0===Object.keys(this[a]).length&&delete this[a])};return this.on("interrupt."+s,function(){return i.each(l)}),this.on("end."+s,function(){return i.each(l)}),r},ot=0,st=function(){return++ot},ut=function(t,e){if(tt.transition.prototype.isPrototypeOf(t)&&!t.empty()){var n=function(){return e.call(null,t)};return t.on("interrupt.d3_on_transition_end",n),t.on("end.d3_on_transition_end",n),t}e.call(null,t)},lt=function(t,e,n,i){var r=i||function(t){return t},a=function(){r(this)};return function(i){var r=i;return e&&(r=r.call(ht(Jt(e,n)))),r=(r=rt(r,t)).call(ht(n)),t>0?r.on("end.d3_animationInterceptor",function(){return r.each(a)}):r.each(a),r}},ct=function(t,e){var n=t.node();return t.selectAll(e).filter(function(){return this.parentNode===n})},dt=function(t,e,n,i,r){void 0===r&&(r="linear");var a="__pathPoints__";return function(t){var o=this;this[a]||(this[a]=n.map(function(){return[]}));var s=n.map(function(e,n){var s=Xt(t,i).map(e),u=(Q(r)||Q("linear"))(s),l=o[a][n];return{pointsFrom:l,pointsTo:u,interpolate:R(l,u,Z(r))}});return function(t){if(0===t){var n=s.map(function(t){return t.pointsFrom});return e.apply(void 0,n)}if(1===t){var i=s.map(function(t){return t.pointsTo});return o[a]=i,e.apply(void 0,i)}var r=s.map(function(e){return e.interpolate(t)});return o[a]=r,e.apply(void 0,r)}}},ht=function(t){return function(e){return Object.keys(t).forEach(function(n){return e.attr(n,t[n])}),e}},ft=function(t){return function(e){return Object.keys(t).forEach(function(n){return e.classed(n,t[n])}),e}},pt=function(e){function n(t){var n=e.call(this,t)||this;n.config=t,n.config.guide=Jt(n.config.guide||{},{animationSpeed:0,enableColorToBarPosition:!1}),n.config.guide.size=n.config.guide.size||{};var i=n.config.stack,r=n.config.guide.enableColorToBarPosition,a=[t.flip&&C.get("flip"),i&&C.get("stack"),r&&C.get("positioningByColor")];return n.decorators=(n.config.transformRules||a).concat(t.transformModel||[]),n.adjusters=(n.config.adjustRules||[]).concat(t.adjustScales||[]),n}return m(n,e),n.prototype.defineGrammarModel=function(t){var e=this,n=this.config;this.regScale("x",t("pos",n.x,[0,n.options.width])).regScale("y",t("pos",n.y,[n.options.height,0])).regScale("y",t("pos",n.y,function(t){return["ordinal","period"].indexOf(t.type)>=0?[0,n.options.height]:[n.options.height,0]})).regScale("size",t("size",n.size,{})).regScale("color",t("color",n.color,{})).regScale("split",t("split",n.split,{})).regScale("label",t("label",n.label,{})).regScale("identity",t("identity",n.identity,{}));var i=this.getScale("x"),r=this.getScale("y"),a=this.getScale("size"),o=this.getScale("label"),s=this.getScale("color"),u=this.getScale("split"),l=this.getScale("identity"),c=r.domain(),d=r.discrete?c[0]:Math.max(0,Math.min.apply(Math,c)),h=r.value(d)+.5*r.stepSize(d),f=s.domain(),p={data:function(){return e.data()},flip:!1,scaleX:i,scaleY:r,scaleSize:a,scaleLabel:o,scaleColor:s,scaleSplit:u,scaleIdentity:l,color:function(t){return s.value(t[s.dim])},label:function(t){return o.value(t[o.dim])},group:function(t){return t[s.dim]+"(@taucharts@)"+t[u.dim]},order:function(t){var e=t.split("(@taucharts@)")[0],n=f.indexOf(e);return n<0?Number.MAX_VALUE:n},size:function(t){return a.value(t[a.dim])},id:function(t){return l.value(t[l.dim],t)},xi:function(t){return i.value(t[i.dim])},yi:function(t){return r.value(t[r.dim])},y0:function(){return h}};return p.data().forEach(function(t){return p.id(t)}),p},n.prototype.getGrammarRules=function(){return this.decorators.filter(function(t){return t})},n.prototype.getAdjustScalesRules=function(){return(this.adjusters||[]).filter(function(t){return t})},n.prototype.createScreenModel=function(t){var e=t.flip,n=function(t,e,n){return t?e:n};return{flip:e,id:t.id,x:n(e,t.yi,t.xi),y:n(e,t.xi,t.yi),x0:n(e,t.y0,t.xi),y0:n(e,t.xi,t.y0),size:t.size,group:t.group,order:t.order,label:t.label,color:function(e){return t.scaleColor.toColor(t.color(e))},class:function(e){return t.scaleColor.toClass(t.color(e))},model:t,toFibers:function(){var e=Yt(t.data(),t.group);return Object.keys(e).sort(function(e,n){return t.order(e)-t.order(n)}).reduce(function(t,n){return t.concat([e[n]])},[])}}},n.prototype.drawFrames=function(){var e=this,n=this.config.options,i=function(t){return n=e.screenModel.size(t)/2,i=4,r=Math.pow(10,i),Math.round(r*n)/r;var n,i,r},r=lt,a=function(n,i,a){var o=e.config.guide.animationSpeed,s=n.selectAll("."+i).data(function(t){return[t]},e.screenModel.id);s.exit().call(r(o,null,{width:0},function(e){return t.select(e).remove()})),s.call(r(o,null,a)),s.enter().append("rect").style("stroke-width",0).call(r(o,{width:0},a))},o=this.config.flip,s=o?"y":"x",u=o?"x":"y",l=o?"x0":"y0",c=o?"height":"width",d=o?"width":"height",h=function(t){var n,r,o;a(t,"lvl-top",((n={})[c]=function(t){return i(t)},n[d]=1,n[s]=function(t){return e.screenModel[s](t)-i(t)/2},n[u]=function(t){return e.screenModel[u](t)},n.fill=function(t){return e.screenModel.color(t)},n.class=function(t){return"lvl-top "+e.screenModel.class(t)},n)),a(t,"lvl-btm",((r={})[c]=function(t){return i(t)},r[d]=1,r[s]=function(t){return e.screenModel[s](t)-i(t)/2},r[u]=function(t){return e.screenModel[l](t)},r.fill=function(t){return e.screenModel.color(t)},r.class=function(t){return"lvl-btm "+e.screenModel.class(t)},r)),a(t,"lvl-link",((o={})[c]=.5,o[d]=function(t){return Math.abs(e.screenModel[u](t)-e.screenModel[l](t))},o[s]=function(t){return e.screenModel[s](t)-.25},o[u]=function(t){return Math.min(e.screenModel[u](t),e.screenModel[l](t))},o.fill=function(t){return e.screenModel.color(t)},o.class=function(t){return"lvl-link "+e.screenModel.class(t)},o))},f=function(t){t.attr("class","frame-id-"+e.config.uid).call(function(t){var n=t.selectAll(".generic").data(function(t){return t},e.screenModel.id);n.exit().remove(),n.call(h),n.enter().append("g").attr("class","generic").call(h)})},p=Yt(this.data(),e.screenModel.group),g=Object.keys(p).sort(function(t,n){return e.screenModel.order(t)-e.screenModel.order(n)}).reduce(function(t,e){return t.concat([p[e]])},[]),m=n.container.selectAll(".frame-id-"+e.config.uid).data(g);m.exit().remove(),m.call(f),m.enter().append("g").call(f)},n}(w),gt=y({},e,n);function mt(t,e,n,i){var r=i(n(t),t);return(r[e]||[]).forEach(function(t){return mt(t,e,n,i)}),r}function yt(t,e,n,i){void 0===i&&(i=0),e(t,i)&&(t.units||[]).map(function(t){return yt(t,e,n,i+1)}),n(t,i)}var vt=function(){var t=[];function e(t){for(var e in t)this[e]=t[e]}function n(){this.copiedObjects=[];var t=this;this.recursiveDeepCopy=function(e){return t.deepCopy(e)},this.depth=0}function i(t,e){var i=new n;return e&&(i.maxDepth=e),i.deepCopy(t)}return e.prototype={constructor:e,canCopy:function(t){return!1},create:function(t){},populate:function(t,e,n){}},n.prototype={constructor:n,maxDepth:256,cacheResult:function(t,e){this.copiedObjects.push([t,e])},getCachedResult:function(t){for(var e=this.copiedObjects,n=e.length,i=0;i<n;i++)if(e[i][0]===t)return e[i][1]},deepCopy:function(e){if(null===e)return null;if("object"!=typeof e)return e;var n=this.getCachedResult(e);if(n)return n;for(var i=0;i<t.length;i++){var r=t[i];if(r.canCopy(e))return this.applyDeepCopier(r,e)}throw new Error("no DeepCopier is able to copy "+e)},applyDeepCopier:function(t,e){var n=t.create(e);if(this.cacheResult(e,n),this.depth++,this.depth>this.maxDepth)throw new Error("Exceeded max recursion depth in deep copy.");return t.populate(this.recursiveDeepCopy,e,n),this.depth--,n}},i.DeepCopier=e,i.deepCopiers=t,i.register=function(n){n instanceof e||(n=new e(n)),t.unshift(n)},i.register({canCopy:function(){return!0},create:function(t){return t instanceof t.constructor?"object"==typeof(e=t.constructor.prototype)?JSON.parse(JSON.stringify(e)):e:{};var e},populate:function(t,e,n){for(var i in e)e.hasOwnProperty(i)&&(n[i]=t(e[i]));return n}}),i.register({canCopy:function(t){return t instanceof Array},create:function(t){return new t.constructor},populate:function(t,e,n){for(var i=0;i<e.length;i++)n.push(t(e[i]));return n}}),i.register({canCopy:function(t){return t instanceof Date},create:function(t){return new Date(t)}}),i}(),xt=function(t){return/^(#|rgb\(|rgba\()/.test(t)},_t=/(.)^/,bt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},wt={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},St=/\\|'|\r|\n|\u2028|\u2029/g,Tt="(?:"+Object.keys(bt).join("|")+")",Et=RegExp(Tt),Mt=RegExp(Tt,"g"),kt={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};function At(t){return vt(t)}function Ct(t){return t instanceof Date&&!isNaN(Number(t))}function Ot(t){return null!=t&&"object"==typeof t}function Lt(t){var e=parseFloat(Math.min.apply(Math,t).toFixed(15)),n=parseFloat(Math.max.apply(Math,t).toFixed(15));e===n&&(n-=(n>=0?-1:1)*(n||1)/10);for(var i=[e=Math.min(0,e),n=Math.max(0,n)],r=i[1]-i[0],a=Math.pow(10,Math.floor(Math.log(r/10)/Math.LN10)),o=10/r*a,s=[[.15,10],[.35,5],[.75,2],[1,1],[2,1]],u=-1;o>s[++u][0];);a*=s[u][1],i[0]=Math.floor(i[0]/a)*a,i[1]=Math.ceil(i[1]/a)*a;var l=e-i[0],c=i[1]-n,d=a/2;if(e<0){var h=l>=d?-l:0;i[0]=i[0]-h}if(n>0){var f=c>=d?-c:0;i[1]=i[1]+f}return[parseFloat(i[0].toFixed(15)),parseFloat(i[1].toFixed(15))]}function Nt(t,e,n){var i=(void 0===n?{utc:!1}:n).utc,r=gt.extent(t),a=r[0],o=r[1],s=+o-+a,u=i?gt.scaleUtc:gt.scaleTime;if(0===s){return a=new Date(a.getTime()-864e5),o=new Date(o.getTime()+864e5),u().domain([a,o]).nice(e).domain()}var l=u().domain([a,o]).nice(e);if(e)return l.domain();var c=u().domain([a,o]).nice(e).domain(),d=c[0],h=c[1],f=l.ticks(),p=f.length-1;return(+a-+d)/(+f[1]-+d)<.5&&(a=d),(+h-+o)/(+h-+f[p-1])<.5&&(o=h),[a,o]}var Ft=0,Rt={};function Dt(t){var e=btoa(encodeURIComponent(t)).replace(/=/g,"_");return Rt.hasOwnProperty(e)||(Rt[e]="H"+ ++Ft),Rt[e]}function jt(t,e,n){var i=0,r=null,a=Qt(function(t,e){return Xt(t.map(function(t){return e.reduce(function(e,n){return e.concat(Ct(i=t[n])?i.getTime():i);var i},[])}),function(t){return JSON.stringify(t)}).reduce(function(t,e){var n=e[0];return t[n]=t[n]||0,t[n]+=1,t},{})},function(t,e){var n=r===t?i:++i;return r=t,e.join("")+"-"+n});return function(i,r,o){var s=o.length,u=n.getSpec(),l=u.sources["/"].data,c=u.unit.units[0].guide||{};c.padding=c.padding||{l:0,r:0,t:0,b:0};var d=0;"x"===t?d=c.padding.l+c.padding.r:"y"===t&&(d=c.padding.t+c.padding.b);var h,f,p=(r-s*d)/(h=a(l,e),Object.keys(h).reduce(function(t,e){return t+h[e]},0));return((f=i,a(l,e)[f])*p+d)/r}}function It(t){var e=!0;try{yt(t,function(t){if(0===t.type.indexOf("COORDS.")&&"COORDS.RECT"!==t.type)throw new Error("Not applicable")},function(t){return t})}catch(t){"Not applicable"===t.message&&(e=!1)}return e}function zt(t,e,n,i){if(void 0===i&&(i=0),"requestAnimationFrame"===i){var r=!1;return function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];r||(requestAnimationFrame(function(){r=!1}),n.apply(this,i),r=!0),t.e=e,t.ts=Date.now()}}return function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];var o={e:e,ts:Date.now()};(t.e&&t.e===o.e?o.ts-t.ts:i)>=i&&n.apply(this,r),t.e=o.e,t.ts=o.ts}}function Pt(t,e){var n=t[0],i=t[1],r=(i-n)/(e-1),a=e>=2?Wt(e-2).map(function(t){return n+r*(t+1)}):[];return[n].concat(a,[i])}function Ht(t){return xt(t)?t:""}function Bt(t){return xt(t)?"":t}function qt(t){return t/180*Math.PI}function Ut(t){return Math.abs(t)>=360&&(t%=360),t<0&&(t=360+t),t}function Wt(t,e){1===arguments.length&&(e=t,t=0);for(var n=[],i=t;i<e;i++)n.push(i);return n}function Gt(t){return Array.isArray(t)?[].concat.apply([],t.map(function(t){return Gt(t)})):t}function Xt(t,e){for(var n={},i=[],r=t.length,a=e||function(t){return String(t)},o=0;o<r;++o){var s=t[o],u=a(s);n.hasOwnProperty(u)||(n[u]=!0,i.push(s))}return i}function Yt(t,e){return t.reduce(function(t,n){var i=e(n);return t[i]=t[i]||[],t[i].push(n),t},{})}function Vt(t,e){return Xt(t.concat(e))}function Kt(t,e){return t.filter(function(t){return-1!==e.indexOf(t)})}function Jt(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=e.length;if(0===i||!t)return t;for(var r=0;r<i;r++)for(var a=e[r],o=Ot(a)?Object.keys(a):[],s=o.length,u=0;u<s;u++){var l=o[u];void 0===t[l]&&(t[l]=a[l])}return t}function $t(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=Object.assign({},t);return e.forEach(function(t){delete i[t]}),i}function Qt(t,e){var n=function(i){var r=n.cache,a=String(e?e.apply(this,arguments):i);return r.hasOwnProperty(a)||(r[a]=t.apply(this,arguments)),r[a]};return n.cache={},n}function Zt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e,n){var i=0;return t.every(function(t){return 0===(i=t(e,n))}),i}}function te(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return null==t?{}:e.reduce(function(e,n){var i=t[n];return i&&(e[n]=i),e},{})}var ee="  ",ne=32,ie=["img","input","br","embed","link","meta","area","base","basefont","bgsound","col","command","frame","hr","image","isindex","keygen","menuitem","nextid","param","source","track","wbr","circle","ellipse","line","path","polygon","rect"].reduce(function(t,e){return t[e]=!0,t},{});function re(t){var e=t,n={next:function(t){return e=t(e),n},result:function(){return e},branch:function(t){t.filter(function(t){return t}).forEach(function(t){t(re(e))})}};return n}var ae=[pt];function oe(t){return ae.some(function(e){return t instanceof e})}var se=Object.freeze({traverseJSON:mt,traverseSpec:yt,clone:At,isDate:Ct,isObject:Ot,niceZeroBased:Lt,niceTimeDomain:Nt,generateHash:Dt,generateRatioFunction:jt,isSpecRectCoordsOnly:It,throttleLastEvent:zt,splitEvenly:Pt,extRGBColor:Ht,extCSSClass:Bt,toRadian:qt,normalizeAngle:Ut,range:Wt,flatten:Gt,unique:Xt,groupBy:Yt,union:Vt,intersection:Kt,defaults:Jt,omit:$t,memoize:Qt,createMultiSorter:Zt,pick:te,escape:function(t){return t=null==t?"":String(t),Et.test(t)?t.replace(Mt,function(t){return bt[t]}):t},template:function(t,e,n){!e&&n&&(e=n),e=Jt({},e,kt);var i=RegExp([(e.escape||_t).source,(e.interpolate||_t).source,(e.evaluate||_t).source].join("|")+"|$","g"),r=0,a="__p+='";t.replace(i,function(e,n,i,o,s){return a+=t.slice(r,s).replace(St,function(t){return"\\"+wt[t]}),r=s+e.length,n?a+="'+\n((__t=("+n+"))==null?'':utils.escape(__t))+\n'":i?a+="'+\n((__t=("+i+"))==null?'':__t)+\n'":o&&(a+="';\n"+o+"\n__p+='"),e}),a+="';\n",e.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{var o=new Function(e.variable||"obj",a)}catch(t){throw t.source=a,t}var s=function(t){return o.call(this,t)},u=e.variable||"obj";return s.source="function("+u+"){\n"+a+"}",s},escapeHtml:function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},xml:function(t){var e=2,n=arguments[1];("object"!=typeof arguments[1]||Array.isArray(arguments[1]))&&(e=1,n={});var i=Gt(Array.prototype.slice.call(arguments,e)),r=1===i.length&&"<"!==i[0].trim()[0],a=ie[t];if(a&&i.length>0)throw new Error('Tag "'+t+'" is void but content is assigned to it');var o="<"+t,s=Object.keys(n).map(function(t){return" "+t+'="'+n[t]+'"'}).join("");s.length>ne&&(s=Object.keys(n).map(function(t){return"\n"+ee+t+'="'+n[t]+'"'}).join(""));var u=r?i[0]:"\n"+i.map(function(t){return String(t).split("\n").map(function(t){return""+ee+t}).join("\n")}).join("\n")+"\n";return""+o+s+(a?"/>":">"+u+"</"+t+">")},take:re,isChartElement:oe}),ue=document.createElement("div"),le=new WeakMap;function ce(t,e){var n;return t instanceof Node?n=t:(ue.insertAdjacentHTML("afterbegin",t),n=ue.childNodes[0]),e.appendChild(n),n}function de(t){if(le.has(t))return le.get(t);var e=t.style.overflow;t.style.overflow="scroll";var n={width:t.offsetWidth-t.clientWidth,height:t.offsetHeight-t.clientHeight};return t.style.overflow=e,le.set(t,n),n}function he(t,e){var n="horizontal"===(e=e||"both")||"both"===e,i="vertical"===e||"both"===e,r=de(t),a=i?r.width+"px":"0",o=n?r.height+"px":"0";t.style.overflow="hidden",t.style.padding="0 "+a+" "+o+" 0";var s=t.scrollWidth>t.clientWidth,u=t.scrollHeight>t.clientHeight,l=i&&!u?r.width+"px":"0",c=n&&!s?r.height+"px":"0";return t.style.padding="0 "+l+" "+c+" 0",t.style.overflow="",t.style.overflowX=s?"scroll":"hidden",t.style.overflowY=u?"scroll":"hidden",r}function fe(t,e){return window.getComputedStyle(t).getPropertyValue(e)}function pe(t,e){return parseInt(fe(t,e)||"0",10)}function ge(t){var e=pe(t,"padding-left"),n=pe(t,"padding-right"),i=pe(t,"padding-bottom"),r=pe(t,"padding-top"),a=pe(t,"border-top-width")+pe(t,"border-left-width")+pe(t,"border-right-width")+pe(t,"border-bottom-width"),o=t.getBoundingClientRect();return{width:o.width-e-n-2*a,height:o.height-i-r-2*a}}function me(t){var e=document.createElement("div");e.style.position="absolute",e.style.visibility="hidden",e.style.width="100px",e.style.height="100px",e.style.border="1px solid green",e.style.top="0",document.body.appendChild(e),e.innerHTML='<svg class="tau-chart__svg">\n                <g class="tau-chart__cell cell">\n                <g class="x axis">\n                <g class="tick"><text>'+t+"</text></g>\n                </g>\n                </g>\n                </svg>";var n={width:0,height:0},i=e.querySelector(".x.axis .tick text").getBoundingClientRect();n.width=i.right-i.left,n.height=i.bottom-i.top;var r=0!==t.length?n.width/t.length:0;return n.width=n.width+1.5*r,document.body.removeChild(e),n}function ye(t,e){for(var n=e.fontSize,i=e.fontFamily,r=e.fontWeight,a="string"==typeof n?n:n+"px",o=0,s=t.length-1,u=0;u<=s;u++){var l=t.charAt(u);o+=ve(l,{fontSize:a,fontFamily:i,fontWeight:r}).width}return{width:o,height:parseInt(a)}}var ve=Qt(function(t,e){var n=e.fontSize,i=e.fontFamily,r=e.fontWeight,a=document.createElement("div");a.style.position="absolute",a.style.visibility="hidden",a.style.border="0px",a.style.top="0",a.style.fontSize=n,a.style.fontFamily=i,a.style.fontWeight=r,document.body.appendChild(a),a.innerHTML=" "===t?"&nbsp;":t;var o={width:0,height:0},s=a.getBoundingClientRect();return o.width=s.right-s.left,o.height=s.bottom-s.top,document.body.removeChild(a),o},function(t,e){return t+"_"+JSON.stringify(e)});function xe(e,n){var i={".":function(t,e){return e.classed(t,!0)},"#":function(t,e){return e.attr("id",t)}},r=Object.keys(i).join("");if(n.indexOf(" ")>=0)throw new Error("Selector should not contain whitespaces.");if(r.indexOf(n[0])>=0)throw new Error("Selector must have tag at the beginning.");var a,o=e instanceof Element,s=o?t.select(e):e,u=function(t){return o?t.node():t},l=s.selectAll(n).filter(function(){return this.parentNode===s.node()}).filter(function(t,e){return 0===e});if(!l.empty())return u(l);for(var c,d=-1,h=null,f=1,p=n.length;f<=p;f++)(f==p||r.indexOf(n[f])>=0)&&(c=n.substring(d+1,f),d<0?a=s.append(c):i[h].call(null,c,a),h=n[f],d=f);return u(a)}function _e(t,e){return be(t,e)[0]||null}function be(t,e){for(var n=[],i=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,r=t.firstElementChild;Boolean(r);r=r.nextElementSibling)i.call(r,e)&&n.push(r);return n}function we(t,e){if(t.childElementCount>0){var n,i,r=Array.prototype.filter.call(t.childNodes,function(t){return t.nodeType===Node.ELEMENT_NODE}),a=r.slice().sort(e),o=r.reduce(function(t,e,n){return t.set(e,n),t},new Map),s=a.reduce(function(t,e,r){var s=o.get(e),u=r-s;return u!==i&&(n&&t.push(n),i=u,n={from:s,to:r,elements:[]}),n.elements.push(e),r===a.length-1&&t.push(n),t},[]),u=s.slice().sort(function(t,e){return t.from-e.from}),l=u.reduce(function(t,e,n){return t.set(e,n),t},new Map),c=function(t){for(var e,n,i,r=s.map(function(t,e){return{elements:t.elements,from:l.get(t),to:e}}).sort(Zt(function(t,e){return t.elements.length-e.elements.length},t?function(t,e){return e.to-t.to}:function(t,e){return t.to-e.to})),a=0;a<r.length;a++){if((n=r[a]).from>n.to)for(e=a+1;e<r.length;e++)(i=r[e]).from>=n.to&&i.from<n.from&&i.from++;if(n.from<n.to)for(e=a+1;e<r.length;e++)(i=r[e]).from>n.from&&i.from<=n.to&&i.from--}return r.filter(function(t){return t.from!==t.to})},d=c(!0),h=c(!1),f=d.length<h.length?d:h,p=u.map(function(t){return t.elements});f.forEach(function(e){var n,i=p.splice(e.from,1)[0],r=p[e.to],a=r?r[0]:null;1===e.elements.length?n=i[0]:(n=document.createDocumentFragment(),i.forEach(function(t){n.appendChild(t)})),t.insertBefore(n,a),p.splice(e.to,0,i)})}}function Se(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=[];return t.filter(function(t){return Boolean(t)}).forEach(function(t){"string"==typeof t?n.push(t):"object"==typeof t&&n.push.apply(n,Object.keys(t).filter(function(e){return Boolean(t[e])}))}),Xt(n).join(" ").trim().replace(/\s{2,}/g," ")}var Te=Object.freeze({appendTo:ce,getScrollbarSize:de,setScrollPadding:he,getStyle:fe,getStyleAsNum:pe,getContainerSize:ge,getAxisTickLabelSize:me,getLabelSize:ye,getCharSize:ve,selectOrAppend:xe,selectImmediate:_e,selectAllImmediate:be,sortChildren:we,classes:Se,dispatchMouseEvent:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var r,a=document.createEvent("MouseEvents"),o=[!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null],s=n.concat(o.slice(n.length));(r=a).initMouseEvent.apply(r,[e].concat(s)),t.dispatchEvent(a)}});function Ee(t,e){return"translate("+t+","+e+")"}function Me(t){return"rotate("+t+")"}function ke(t){return["bottom","top"].indexOf(t.toLowerCase())>=0?"h":"v"}function Ae(t,e,n,i,r,a,o,s){var u,l,c,d,h,f;return f=((c=o-r)*(e-a)-(d=s-a)*(t-r))/(-c*(l=i-e)+(u=n-t)*d),(h=(-l*(t-r)+u*(e-a))/(-c*l+u*d))>=0&&h<=1&&f>=0&&f<=1}function Ce(t){for(var e,n,i=function(t){var e={x:0,y:0},n=t.indexOf("translate(");if(n>=0){var i=t.indexOf(")",n+10),r=t.substring(n+10,i).trim().replace(","," ").replace(/\s+/," ").split(" ");e.x=parseFloat(r[0]),r.length>1&&(e.y=parseFloat(r[1]))}return e},r={x:0,y:0},a=t;a&&"SVG"!==a.nodeName.toUpperCase();)(n=a.getAttribute("transform"))&&(e=i(n),r.x+=e.x,r.y+=e.y),a=a.parentNode;return r}function Oe(e,n,i){var r=e.selectAll(n).filter(i);if(!r.empty()){var a=t.select(r.node().parentNode).selectAll(n).filter(function(t){return!i(t)}).nodes(),o=a[a.length-1];if(o){var s=Array.prototype.indexOf.call(o.parentNode.childNodes,o),u=o.nextSibling;r.each(function(){Array.prototype.indexOf.call(this.parentNode.childNodes,this)>s||this.parentNode.insertBefore(this,u)})}}}var Le=Object.freeze({translate:Ee,rotate:Me,getOrientation:ke,isIntersect:Ae,getDeepTransformTranslate:Ce,raiseElements:Oe}),Ne=function(t){return Ct(t)?t.getTime():t},Fe={cross:function(t,e,n){var i=t(),r=Xt(i.map(function(t){return t[e]}),Ne),a=Xt(i.map(function(t){return t[n]}),Ne),o=0===r.length?[null]:r;return(0===a.length?[null]:a).reduce(function(t,i){return t.concat(o.map(function(t){var r={};return e&&(r[e]=Ne(t)),n&&(r[n]=Ne(i)),r}))},[])},cross_period:function(t,e,n,i,r,a){var o=t(),s=!!a&&a.utcTime,u=Xt(o.map(function(t){return t[e]}),Ne),l=Xt(o.map(function(t){return t[n]}),Ne),c=0===u.length?[null]:u,d=0===l.length?[null]:l;return i&&(c=E.generate(Math.min.apply(Math,u),Math.max.apply(Math,u),i,{utc:s})),r&&(d=E.generate(Math.min.apply(Math,l),Math.max.apply(Math,l),r,{utc:s})),d.reduce(function(t,i){return t.concat(c.map(function(t){var r={};return e&&(r[e]=Ne(t)),n&&(r[n]=Ne(i)),r}))},[])},groupBy:function(t,e){return Xt(t().map(function(t){return t[e]}),Ne).map(function(t){return(n={})[e]=Ne(t),n;var n})},none:function(){return[null]}},Re=function(){function t(t,e,n){var i=t.key,r=t.pipe,a=t.source,o=t.units;void 0===n&&(n={}),this.key=i,this.pipe=r||[],this.source=a,this.units=o,this._frame={key:i,source:a,pipe:this.pipe},this._data=e,this._pipeReducer=function(t,e){return n[e.type](t,e.args)}}return t.prototype.hash=function(){return Dt([this._frame.pipe,this._frame.key,this._frame.source].map(function(t){return JSON.stringify(t)}).join(""))},t.prototype.full=function(){return this._data},t.prototype.part=function(t){return void 0===t&&(t=function(t){return t}),this._frame.pipe.map(t).reduce(this._pipeReducer,this._data)},t}(),De=function(t){return Ct(t)?t.getTime():t},je=function(t){var e=this;Object.keys(t).forEach(function(n){return e[n]=t[n]})},Ie=function(t,e,n){return t.map(function(t){return"string"==typeof t?n.get(t):t}).filter(function(t){return t}).reduce(function(t,e){return n=t,void 0===(i=e(t,{}))&&(i={}),Object.assign(new je(n),i);var n,i},e)},ze=function(t){function e(e,n,i,r){var a=t.call(this)||this;return Jt(e.scales,{size_null:{type:"size",source:"?"},split_null:{type:"value",source:"?"},label_null:{type:"value",source:"?"},color_null:{type:"color",source:"?"},identity_null:{type:"identity",source:"?"},"size:default":{type:"size",source:"?"},"color:default":{type:"color",source:"?"},"split:default":{type:"value",source:"?"},"label:default":{type:"value",source:"?"},"identity:default":{type:"identity",source:"?"}}),e.settings=e.settings||{},a.config=e,a.sources=e.sources,a.scales=e.scales,a.unitSet=i,a.grammarRules=r,a.scalesHub=n,a.transformations=Object.assign(e.transformations||{},{where:function(t,e){var n=Object.keys(e||{}).map(function(t){return function(n){return De(n[t])===e[t]}});return t.filter(function(t){return n.every(function(e){return e(t)})})}}),a}return m(e,t),e.traverseSpec=function(t,e,n,i,r){void 0===i&&(i=null),void 0===r&&(r=null);var a=[],o=function(t,e,n,i,r){a.push(function(){e(t,i,r)}),t.frames&&t.frames.forEach(function(i){(i.units||[]).map(function(r){return o(r,e,n,t,i)})}),a.push(function(){return n(t,i,r)})};return o(t.unit,e,n,i,r),a},e.prototype.unfoldStructure=function(){return this.root=this._expandUnitsStructure(this.config.unit),this.config},e.prototype.getDrawScenarioQueue=function(t){var e=this,n=this.grammarRules,i=this._flattenDrawScenario(t,function(t,i,r){var a=!1===i.expression.inherit?null:r,o=e._createFrameScalesFactoryMethod(a),s=e.unitSet.create(i.type,Object.assign({},i,{options:t.allocateRect(r.key)})),u=new je(s.defineGrammarModel(o)),l=Ie(s.getGrammarRules(),u,n);return Ie(s.getAdjustScalesRules(),l,n),s.node().screenModel=s.createScreenModel(l),s}),r=this._flattenDrawScenario(t,function(t,i,r){var a=!1===i.expression.inherit?null:r,o=e._createFrameScalesFactoryMethod(a),s=e.unitSet.create(i.type,Object.assign({},i,{options:t.allocateRect(r.key)})),u=new je(s.defineGrammarModel(o)),l=Ie(s.getGrammarRules(),u,n);return s.node().screenModel=s.createScreenModel(l),s.parentUnit=t,s.addInteraction(),s});return i.concat(function(){Object.keys(e.scales).forEach(function(t){return e.scalesHub.createScaleInfo(e.scales[t]).commit()})}).concat(r)},e.prototype._flattenDrawScenario=function(t,n){var i={},r=[],a=[t],o=e.traverseSpec({unit:this.root},function(t,e,o){var s;t.uid=((s=Dt((e?e.uid+"/":"")+JSON.stringify(Object.keys(t).filter(function(e){return"string"==typeof t[e]}).reduce(function(e,n){return e[n]=t[n],e},{}))+"-"+JSON.stringify(o.pipe)))in i?s+="-"+ ++i[s]:i[s]=0,s),t.guide=At(t.guide);var u,l=n(a[0],t,o);r.push(l),0===t.type.indexOf("COORDS.")&&(u=l,a.unshift(u))},function(t){0===t.type.indexOf("COORDS.")&&a.shift()},null,this._datify({source:this.root.expression.source,pipe:[]}));return o.push(function(){return r}),o},e.prototype._expandUnitsStructure=function(t,e){var n=this;void 0===e&&(e=[]);var i=this;if(!1===t.expression.operator)t.frames=t.frames.map(function(t){return i._datify(t)});else{var r=this._parseExpression(t.expression,e,t.guide);t.transformation=t.transformation||[],t.frames=r.exec().map(function(n){var a=(r.inherit?e:[]).concat([{type:"where",args:n}]).concat(t.transformation);return i._datify({key:n,pipe:a,source:r.source,units:t.units?t.units.map(function(t){var e=At(t);return e.guide=t.guide,e}):[]})})}return t.frames.forEach(function(t){return t.units.forEach(function(e){return n._expandUnitsStructure(e,t.pipe)})}),t},e.prototype._createFrameScalesFactoryMethod=function(t){var e=this;return function(n,i,r){var a=i||n+":default";return e.scalesHub.createScaleInfo(e.scales[a],t).create("function"==typeof r?r(e.scales[a]):r)}},e.prototype._datify=function(t){return new Re(t,this.sources[t.source].data,this.transformations)},e.prototype._parseExpression=function(t,e,n){var i=this,r=t.operator||"none",a=t.source,o=!1!==t.inherit,s=t.params,u={source:a,pipe:o?e:[]},l=Fe[r];if(!l)throw new Error(r+" operator is not supported");return{source:a,inherit:o,func:l,args:s,exec:function(){return l.apply(void 0,[function(){return i._datify(u).part()}].concat(s||[],[n]))}}},e}(b),Pe="tau-chart__",He=function(t,e){return t.indexOf(e)},Be=window,qe=Be.document,Ue=qe.documentElement,We=["top","bottom"];function Ge(t,e){for(var n in e)t[n]=e[n];return t}function Xe(t){var e,n=Be.pageYOffset||Ue.scrollTop,i=Be.pageXOffset||Ue.scrollLeft,r={left:0,right:0,top:0,bottom:0,width:0,height:0};if((e=t)&&null!=e.setInterval)r.width=Be.innerWidth||Ue.clientWidth,r.height=Be.innerHeight||Ue.clientHeight;else{if(!Ue.contains(t)||null==t.getBoundingClientRect)return r;Ge(r,t.getBoundingClientRect()),r.width=r.right-r.left,r.height=r.bottom-r.top}return r.top=r.top+n-Ue.clientTop,r.left=r.left+i-Ue.clientLeft,r.right=r.left+r.width,r.bottom=r.top+r.height,r}var Ye=Be.getComputedStyle;function Ve(t){var e=String(Ye(t,Ve.propName)),n=e.match(/([0-9.]+)([ms]{1,2})/);return n&&(e=Number(n[1]),"s"===n[2]&&(e*=1e3)),0|e}Ve.propName=function(){for(var t=qe.createElement("div"),e=["transitionDuration","webkitTransitionDuration"],n=0;n<e.length;n++)if(t.style[e[n]]="1s","1s"===t.style[e[n]])return e[n]}();var Ke=Object.create;function Je(t,e){if(!(this instanceof Je))return new Je(t,e);this.hidden=1,this.options=Ge(Ke(Je.defaults),e),this._createElement(),t&&this.content(t)}Je.prototype._createElement=function(){var t,e;this.element=qe.createElement("div"),this.classes=(t=this.element,{add:function(e){t.classList.add(e)},remove:function(e){t.classList.remove(e)}}),this.classes.add(this.options.baseClass);for(var n=0;n<Je.classTypes.length;n++)e=Je.classTypes[n]+"Class",this.options[e]&&this.classes.add(this.options[e])},Je.prototype.type=function(t){return this.changeClassType("type",t)},Je.prototype.effect=function(t){return this.changeClassType("effect",t)},Je.prototype.changeClassType=function(t,e){return t+="Class",this.options[t]&&this.classes.remove(this.options[t]),this.options[t]=e,e&&this.classes.add(e),this},Je.prototype.updateSize=function(){var t;return this.hidden&&(this.element.style.visibility="hidden",qe.body.appendChild(this.element)),this.width=this.element.offsetWidth,this.height=this.element.offsetHeight,null==this.spacing&&(this.spacing=null!=this.options.spacing?this.options.spacing:(t=Ye(this.element,"top"),0|Math.round(String(t).replace(/[^\-0-9.]/g,"")))),this.hidden?(qe.body.removeChild(this.element),this.element.style.visibility=""):this.position(),this},Je.prototype.content=function(t){return"object"==typeof t?(this.element.innerHTML="",this.element.appendChild(t)):this.element.innerHTML=t,this.updateSize(),this},Je.prototype.place=function(t){return this.options.place=t,this.hidden||this.position(),this},Je.prototype.attach=function(t){return this.attachedTo=t,this.hidden||this.position(),this},Je.prototype.detach=function(){return this.hide(),this.attachedTo=null,this},Je.prototype._pickPlace=function(t){if(!this.options.auto)return this.options.place;var e=Xe(Be),n=this.options.place.split("-"),i=this.spacing;if(-1!==He(We,n[0]))switch(t.top-this.height-i<=e.top?n[0]="bottom":t.bottom+this.height+i>=e.bottom&&(n[0]="top"),n[1]){case"left":t.right-this.width<=e.left&&(n[1]="right");break;case"right":t.left+this.width>=e.right&&(n[1]="left");break;default:t.left+t.width/2+this.width/2>=e.right?n[1]="left":t.right-t.width/2-this.width/2<=e.left&&(n[1]="right")}else switch(t.left-this.width-i<=e.left?n[0]="right":t.right+this.width+i>=e.right&&(n[0]="left"),n[1]){case"top":t.bottom-this.height<=e.top&&(n[1]="bottom");break;case"bottom":t.top+this.height>=e.bottom&&(n[1]="top");break;default:t.top+t.height/2+this.height/2>=e.bottom?n[1]="top":t.bottom-t.height/2-this.height/2<=e.top&&(n[1]="bottom")}return n.join("-")},Je.prototype.position=function(t,e){this.attachedTo&&(t=this.attachedTo),null==t&&this._p?(t=this._p[0],e=this._p[1]):this._p=arguments;var n,i,r="number"==typeof t?{left:0|t,right:0|t,top:0|e,bottom:0|e,width:0,height:0}:Xe(t),a=this.spacing,o=this._pickPlace(r);switch(o!==this.curPlace&&(this.curPlace&&this.classes.remove(this.curPlace),this.classes.add(o),this.curPlace=o),this.curPlace){case"top":n=r.top-this.height-a,i=r.left+r.width/2-this.width/2;break;case"top-left":n=r.top-this.height-a,i=r.right-this.width;break;case"top-right":n=r.top-this.height-a,i=r.left;break;case"bottom":n=r.bottom+a,i=r.left+r.width/2-this.width/2;break;case"bottom-left":n=r.bottom+a,i=r.right-this.width;break;case"bottom-right":n=r.bottom+a,i=r.left;break;case"left":n=r.top+r.height/2-this.height/2,i=r.left-this.width-a;break;case"left-top":n=r.bottom-this.height,i=r.left-this.width-a;break;case"left-bottom":n=r.top,i=r.left-this.width-a;break;case"right":n=r.top+r.height/2-this.height/2,i=r.right+a;break;case"right-top":n=r.bottom-this.height,i=r.right+a;break;case"right-bottom":n=r.top,i=r.right+a}return this.element.style.top=Math.round(n)+"px",this.element.style.left=Math.round(i)+"px",this},Je.prototype.show=function(t,e){return t=this.attachedTo?this.attachedTo:t,clearTimeout(this.aIndex),null!=t&&this.position(t,e),this.hidden&&(this.hidden=0,qe.body.appendChild(this.element)),this.attachedTo&&this._aware(),this.options.inClass&&this.classes.add(this.options.inClass),this},Je.prototype.getElement=function(){return this.element},Je.prototype.hide=function(){if(!this.hidden){var t=this,e=0;return this.options.inClass&&(this.classes.remove(this.options.inClass),this.options.effectClass&&(e=Ve(this.element))),this.attachedTo&&this._unaware(),clearTimeout(this.aIndex),this.aIndex=setTimeout(function(){t.aIndex=0,qe.body.removeChild(t.element),t.hidden=1},e),this}},Je.prototype.toggle=function(t,e){return this[this.hidden?"show":"hide"](t,e)},Je.prototype.destroy=function(){clearTimeout(this.aIndex),this._unaware(),this.hidden||qe.body.removeChild(this.element),this.element=this.options=null},Je.prototype._aware=function(){-1===He(Je.winAware,this)&&Je.winAware.push(this)},Je.prototype._unaware=function(){var t=He(Je.winAware,this);-1!==t&&Je.winAware.splice(t,1)},Je.reposition=function(){var t,e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(t){return setTimeout(t,17)};function n(){t=0;for(var e=0,n=Je.winAware.length;e<n;e++)Je.winAware[e].position()}return function(){!t&&Je.winAware.length&&(t=e(n))}}(),Je.winAware=[],window.addEventListener("resize",Je.reposition),window.addEventListener("scroll",Je.reposition),Je.classTypes=["type","effect"],Je.defaults={baseClass:"tooltip",typeClass:null,effectClass:null,inClass:"in",place:"top",spacing:null,auto:0},Je.defaults.baseClass=Pe+"tooltip";var $e=["top","bottom"];var Qe,Ze,tn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e.prototype._pickPlace=function(t){if(!this.options.auto)return this.options.place;var e,n,i,r,a,o,s,u,l=0|this.options.winBound,c=(e=l,i=window,r=document.documentElement,a=(i.pageYOffset||r.scrollTop)-r.clientTop,o=(i.pageXOffset||r.scrollLeft)-r.clientTop,s=i.innerWidth||r.clientWidth,u=i.innerHeight||r.clientHeight,{top:(n={top:a,right:o+s,bottom:a+u,left:o,width:s,height:u}).top+e,right:n.right-e,bottom:n.bottom-e,left:n.left+e,width:n.width-2*e,height:n.height-2*e}),d=this.options.place.split("-"),h=this.spacing;if(-1!==$e.indexOf(d[0]))switch(t.top-this.height-h<=c.top?d[0]="bottom":t.bottom+this.height+h>=c.bottom&&(d[0]="top"),d[1]){case"left":t.right-this.width<=c.left&&(d[1]="right");break;case"right":t.left+this.width>=c.right&&(d[1]="left");break;default:t.left+t.width/2+this.width/2>=c.right?d[1]="left":t.right-t.width/2-this.width/2<=c.left&&(d[1]="right")}else switch(t.left-this.width-h<=c.left?d[0]="right":t.right+this.width+h>=c.right&&(d[0]="left"),d[1]){case"top":t.bottom-this.height<=c.top&&(d[1]="bottom");break;case"bottom":t.top+this.height>=c.bottom&&(d[1]="top");break;default:t.top+t.height/2+this.height/2>=c.bottom?d[1]="top":t.bottom-t.height/2-this.height/2<=c.top&&(d[1]="bottom")}return d.join("-")},e}(Je),en=function(){function t(t,e){this.chart=e,this.handlers=new Map,this.plugins=t.map(this.initPlugin,this)}return t.prototype.initPlugin=function(t){var e=this;t.init&&t.init(this.chart);var n=[];this.handlers.set(t,n);var i=function(i,r){n.push(e.chart.on(i,r,t))};return t.destroy&&i("destroy",t.destroy.bind(t)),Object.keys(t).forEach(function(e){if(0===e.indexOf("on")){var n=e.substr(2).toLowerCase();i(n,t[e].bind(t))}}),t},t.prototype.destroyPlugin=function(t){var e=this;t.destroy&&t.destroy(),this.handlers.get(t).forEach(function(n){e.chart.removeHandler(n,t)})},t.prototype.destroy=function(){var t=this;this.plugins.forEach(function(e){return t.destroyPlugin(e)})},t}(),nn={},rn={},an={reg:function(t,e,n){return n?(rn[t]=n,nn[t]=function(t,e){this.___tauchartsseed___=new e(this.init(t))},nn[t].prototype=Object.assign({init:function(t){return t},defineGrammarModel:function(t){return this.node().defineGrammarModel(t)},getGrammarRules:function(t){return this.node().getGrammarRules(t)},getAdjustScalesRules:function(t){return this.node().getAdjustScalesRules(t)},createScreenModel:function(t){return this.node().createScreenModel(t)},addInteraction:function(){this.node().addInteraction()},node:function(){return this.___tauchartsseed___},draw:function(){this.node().draw()}},e)):nn[t]=e,this},get:function(t){if(!nn.hasOwnProperty(t))throw new M("Unknown unit type: "+t,k.UNKNOWN_UNIT_TYPE);return nn[t]},create:function(t,e){var n,i=this.get(t);rn[t]?n=new i(e,this.get(rn[t])):n=new i(e);return n}},on={},sn={},un={reg:function(t,e,n){return void 0===n&&(n=function(t){return t}),on[t]=e,sn[t]=n,un},get:function(t){return on[t]},instance:function(t){return void 0===t&&(t={}),{create:function(e,n,i){return new(un.get(e))(n,(0,sn[e])(i,t))}}}},ln=function(){function t(t,e,n){this.registry=t,this.sources=e,this.scales=n}return t.prototype.createScaleInfo=function(t,e){void 0===e&&(e=null);var n=t.dim,i=t.source,r=(this.sources[i].dims[n]||{}).type,a=this.sources[i].data,o=e||new Re({source:i},a);return t.dimType=r,this.registry.create(t.type,o,t)},t.prototype.createScaleInfoByName=function(t,e){return void 0===e&&(e=null),this.createScaleInfo(this.scales[t],e)},t}(),cn=function(t,e,n){var i=!0,r=null;try{t.reduce(function(t,i){var a=function(t,e){var n=i[e],r=Ot(n)?JSON.stringify(n):n;return t.push(r),t},o=e.reduce(a,[]).join("/"),s=n.reduce(a,[]).join("/");if(t.hasOwnProperty(o)){var u=t[o];if(u!==s)throw r={type:"RelationIsNotAFunction",keyX:e.join("/"),keyY:n.join("/"),valX:o,errY:[u,s]},new Error("RelationIsNotAFunction")}else t[o]=s;return t},{})}catch(t){if("RelationIsNotAFunction"!==t.message)throw t;i=!1}return{result:i,error:r}},dn=function(t,e){var n=Object.keys(t).reduce(function(e,n){var i=t[n];return i.hasOwnProperty("hasNull")&&!i.hasNull||"measure"!==i.type&&"period"!==i.scale||e.push(n),e},[]);return function(t){var i=!n.some(function(e){return!(e in t)||null===t[e]});return i||e(t),i}},hn=function(t){var e={category:"ordinal",order:"ordinal",measure:"linear"},n={};return Object.keys(t).forEach(function(i){var r=t[i],a=(r.type||"category").toLowerCase();n[i]=Object.assign({},r,{type:a,scale:r.scale||e[a],value:r.value})}),n},fn=function(t){var e={type:"category",scale:"ordinal"};return t.reduce(function(t,n){return Object.keys(n).forEach(function(i){var r,a,o,s=n.hasOwnProperty(i)?n[i]:null;if(t[i]=t[i]||{type:null,hasNull:!1},null===s)t[i].hasNull=!0;else{var u=(r=s,a=At(e),o=a,Ct(r)?(o.type="measure",o.scale="time"):Ot(r)?(o.type="order",o.scale="ordinal"):Number.isFinite(r)&&(o.type="measure",o.scale="linear"),o),l=u.type,c=u.scale,d=null!==t[i].type&&t[i].type!==l;t[i].type=d?e.type:l,t[i].scale=d?e.scale:c}}),t},{})},pn=function(t,e,n){var i=t,r=["period","time"].indexOf(n.scale)>=0?function(t){return new Date(t)}:function(t){return t},a=t.reduce(function(t,e,n){return t.set(e,n),t},new Map);if("measure"===n.type||"period"===n.scale)i=t.slice().sort(Zt(function(t,n){return r(t[e])-r(n[e])},function(t,e){return a.get(t)-a.get(e)}));else if(n.order){var o=n.order.reduce(function(t,e,n){return t[e]=n,t},{}),s=n.order.length,u="(___"+e+"___)";i=t.map(function(t){var n=o[t[e]];return n=n>=0?n:s,t[u]=n,t}).sort(Zt(function(t,e){return t[u]-e[u]},function(t,e){return a.get(t)-a.get(e)})).map(function(t){return delete t[u],t})}return i},gn=function(t,e){var n=document.createElement("div");return n.classList.add(Pe+t),e&&e.appendChild(n),n},mn=function(){var t=gn("layout"),e=gn("layout__header",t),n=gn("layout__container",t),i=gn("layout__sidebar",n),r=gn("layout__content",n),a=gn("layout__content__wrap",r),o=gn("layout__sidebar-right",n);return{layout:t,header:e,content:a,contentContainer:r,leftSidebar:i,rightSidebar:gn("layout__sidebar-right__wrap",o),rightSidebarContainer:o,footer:gn("layout__footer",t)}},yn=function(){function t(t){this.spec=t,this.dist={sources:{"?":{dims:{},data:[{}]},"/":{dims:{},data:[]}},scales:{x_null:{type:"ordinal",source:"?"},y_null:{type:"ordinal",source:"?"},size_null:{type:"size",source:"?"},color_null:{type:"color",source:"?"},split_null:{type:"value",source:"?"},"pos:default":{type:"ordinal",source:"?"},"size:default":{type:"size",source:"?"},"label:default":{type:"value",source:"?"},"color:default":{type:"color",source:"?"},"split:default":{type:"value",source:"?"}},settings:t.settings}}return t.prototype.convert=function(){var t=this.spec,e=this.dist;return this.ruleAssignSourceDims(t,e),this.ruleAssignStructure(t,e),this.ruleAssignSourceData(t,e),this.ruleApplyDefaults(e),e},t.prototype.ruleApplyDefaults=function(t){var e=t.settings||{},n=function(t,e,i){e(t,i),(t.units||[]).map(function(i){return n(i,e,t)})};n(t.unit,function(t,n){if(t.namespace="chart",t.guide=Jt(t.guide||{},{animationSpeed:e.animationSpeed||0,utcTime:e.utcTime||!1}),n&&!t.hasOwnProperty("units")){t=Jt(t,{x:n.x,y:n.y});var i=At(n.guide)||{};t.guide.x=Jt(t.guide.x||{},i.x),t.guide.y=Jt(t.guide.y||{},i.y),t.expression.inherit=n.expression.inherit}return t},null)},t.prototype.ruleAssignSourceData=function(t,e){var n=t.spec.dimensions||{},i=e.sources["/"].dims,r=function(t,e){var n=t[e];return Ot(n)&&!Ct(n)&&Object.keys(n).forEach(function(i){return t[e+"."+i]=n[i]}),t};e.sources["/"].data=t.data.map(function(t){var e=Object.keys(t).reduce(r,t);return Object.keys(i).reduce(function(t,e){return t.hasOwnProperty(e)||(t[e]=null),null!==t[e]&&n[e]&&["period","time"].indexOf(n[e].scale)>=0&&(t[e]=new Date(t[e])),t},e)})},t.prototype.ruleAssignSourceDims=function(t,e){var n=t.spec.dimensions;e.sources["/"].dims=Object.keys(n).reduce(function(t,e){return t[e]={type:n[e].type},t},{})},t.prototype.ruleAssignStructure=function(t,e){var n=this,i=function(t){var r=At($t(t,"unit"));return n.ruleCreateScales(t,r,e.settings),r.expression=n.ruleInferExpression(t),t.unit&&(r.units=t.unit.map(i)),r},r=i(t.spec.unit);r.expression.inherit=!1,e.unit=r},t.prototype.ruleCreateScales=function(t,e,n){var i=this,r=t.guide||{};["identity","color","size","label","x","y","split"].forEach(function(a){t.hasOwnProperty(a)&&(e[a]=i.scalesPool(a,t[a],r[a]||{},n))})},t.prototype.ruleInferDim=function(t,e){var n=t,i=this.spec.spec.dimensions;if(!i.hasOwnProperty(n))return n;e.hasOwnProperty("tickLabel")?n=t+"."+e.tickLabel:i[t].value&&(n=t+"."+i[t].value);var r=this.dist.sources["/"].dims;return r.hasOwnProperty(n)||(r[n]={type:r[t].type},delete r[t]),n},t.prototype.scalesPool=function(t,e,n,i){var r=t+"_"+e;if(this.dist.scales.hasOwnProperty(r))return r;var a=this.spec.spec.dimensions,o={};if("color"===t&&null!==e&&(o={type:"color",source:"/",dim:this.ruleInferDim(e,n)},n.hasOwnProperty("brewer")&&(o.brewer=n.brewer),a[e]&&a[e].hasOwnProperty("order")&&(o.order=a[e].order),n.hasOwnProperty("min")&&(o.min=n.min),n.hasOwnProperty("max")&&(o.max=n.max),n.hasOwnProperty("nice")&&(o.nice=n.nice)),"size"===t&&null!==e&&(o={type:"size",source:"/",dim:this.ruleInferDim(e,n)},n.hasOwnProperty("func")&&(o.func=n.func),n.hasOwnProperty("min")&&(o.min=n.min),n.hasOwnProperty("max")&&(o.max=n.max),n.hasOwnProperty("minSize")&&(o.minSize=n.minSize),n.hasOwnProperty("maxSize")&&(o.maxSize=n.maxSize)),"label"===t&&null!==e&&(o={type:"value",source:"/",dim:this.ruleInferDim(e,n)}),"split"===t&&null!==e&&(o={type:"value",source:"/",dim:this.ruleInferDim(e,n)}),"identity"===t&&null!==e&&(o={type:"identity",source:"/",dim:this.ruleInferDim(e,n)}),a.hasOwnProperty(e)&&("x"===t||"y"===t)){if(o={type:a[e].scale,source:"/",dim:this.ruleInferDim(e,n)},a[e].hasOwnProperty("order")&&(o.order=a[e].order),n.hasOwnProperty("min")&&(o.min=n.min),n.hasOwnProperty("max")&&(o.max=n.max),n.hasOwnProperty("autoScale")?o.autoScale=n.autoScale:o.autoScale=!0,n.hasOwnProperty("nice")?o.nice=n.nice:o.nice=o.autoScale,n.hasOwnProperty("niceInterval")?o.niceInterval=n.niceInterval:o.niceInterval=null,n.hasOwnProperty("tickPeriod")&&(o.period=n.tickPeriod,o.type="period"),n.hasOwnProperty("tickPeriod")&&n.hasOwnProperty("timeInterval"))throw new Error('Use "tickPeriod" for period scale, "timeInterval" for time scale, but not both');if(n.hasOwnProperty("timeInterval")){o.period=n.timeInterval,o.type="time";var s=E.get(o.period,{utc:i.utcTime});n.hasOwnProperty("min")&&(o.min=s.cast(new Date(n.min))),n.hasOwnProperty("max")&&(o.max=s.cast(new Date(n.max)))}o.fitToFrameByDims=n.fitToFrameByDims,o.ratio=n.ratio}return this.dist.scales[r]=o,r},t.prototype.getScaleConfig=function(t,e){var n=t+"_"+e;return this.dist.scales[n]},t.prototype.ruleInferExpression=function(t){var e={operator:"none",params:[]},n=t.guide||{},i=n.x||{},r=n.y||{},a=this.getScaleConfig("x",t.x),o=this.getScaleConfig("y",t.y);return 0===t.type.indexOf("ELEMENT.")?t.color&&(e={operator:"groupBy",params:[this.ruleInferDim(t.color,n.color||{})]}):"COORDS.RECT"===t.type&&1===t.unit.length&&"COORDS.RECT"===t.unit[0].type&&(e=a.period||o.period?{operator:"cross_period",params:[this.ruleInferDim(t.x,i),this.ruleInferDim(t.y,r),a.period,o.period]}:{operator:"cross",params:[this.ruleInferDim(t.x,i),this.ruleInferDim(t.y,r)]}),Object.assign({inherit:!0,source:"/"},e)},t}(),vn=y({},r,a),xn=vn.format(".4s"),_n=vn.format(".2r"),bn=vn.format(".1e"),wn=(Qe=/\.0+([^\d].*)?$/,Ze=/(\.\d+?)0+([^\d].*)?$/,function(t){return t.replace(Qe,"$1").replace(Ze,"$1$2")}),Sn={"x-num-auto":function(t){if(isNaN(t))return"NaN";var e=Math.abs(t);return wn(e<1?0===e?"0":e<1e-6?bn(t):_n(t):xn(t))},percent:function(t){return parseFloat((100*t).toFixed(2)).toString()+"%"},day:vn.timeFormat("%d-%b-%Y"),"day-utc":vn.utcFormat("%d-%b-%Y"),"day-short":vn.timeFormat("%d-%b"),"day-short-utc":vn.utcFormat("%d-%b"),week:vn.timeFormat("%d-%b-%Y"),"week-utc":vn.utcFormat("%d-%b-%Y"),"week-short":vn.timeFormat("%d-%b"),"week-short-utc":vn.utcFormat("%d-%b"),month:function(t){var e=0===new Date(t).getMonth()?"%B, %Y":"%B";return vn.timeFormat(e)(t)},"month-utc":function(t){var e=0===new Date(t).getUTCMonth()?"%B, %Y":"%B";return vn.utcFormat(e)(t)},"month-short":function(t){var e=0===new Date(t).getMonth()?"%b '%y":"%b";return vn.timeFormat(e)(t)},"month-short-utc":function(t){var e=0===new Date(t).getUTCMonth()?"%b '%y":"%b";return vn.utcFormat(e)(t)},"month-year":vn.timeFormat("%B, %Y"),"month-year-utc":vn.utcFormat("%B, %Y"),quarter:function(t){var e=new Date(t),n=e.getMonth();return"Q"+((n-n%3)/3+1)+" "+e.getFullYear()},"quarter-utc":function(t){var e=new Date(t),n=e.getUTCMonth();return"Q"+((n-n%3)/3+1)+" "+e.getUTCFullYear()},year:vn.timeFormat("%Y"),"year-utc":vn.utcFormat("%Y"),"x-time-auto":null},Tn={get:function(t,e){var n=e||"",i=function(t){return String(null===t||void 0===t?n:t)},r=Sn.hasOwnProperty(t),a=r?Sn[t]:i;return r&&(a=Sn[t]),!r&&t&&(a=function(e){return(Ct(e)?vn.timeFormat(t):vn.format(t))(e)}),r||t||(a=i),a},add:function(t,e){Sn[t]=e}},En=function(t){return t.reduce(function(t,e){return t+e},0)};var Mn=function(t,e){var n=e.guide||{},i={x:["label"],y:["label"],size:["label"],color:["label"],padding:[]};return Object.keys(i).forEach(function(e){var r,a,o,s,u,l=i[e];a=t,o=e,s=l,u=(u=(r=n).hasOwnProperty(o)?r[o]:{})||{},s.forEach(function(t){Object.assign(a.guide[o][t],u[t])})}),Object.assign(t.guide,Object.keys(n).reduce(function(t,e){return i.hasOwnProperty(e)||(t[e]=n[e]),t},{})),t},kn=function(t,e,n){return t[e]=Jt(t[e]||{},{label:""}),t[e].label=Ot(t[e].label)?t[e].label:{text:t[e].label},t[e].label=Jt(t[e].label,n||{},{padding:32,rotate:0,textAnchor:"middle",cssClass:"label",dock:null}),t[e]},An=function(t,e,n){return t[e]=Jt(t[e],n||{},{padding:0,density:30,rotate:0,tickPeriod:null,tickFormat:null,autoScale:!0}),t[e].tickFormat=t[e].tickFormat||t[e].tickPeriod,t[e].nice=t[e].hasOwnProperty("nice")?t[e].nice:t[e].autoScale,t[e]},Cn=function(t){var e=t.units||[],n=!t.hasOwnProperty("units"),i=!e.some(function(t){return t.hasOwnProperty("units")});return{type:t.type,isLeaf:n,isLeafParent:!n&&i}},On=function(t,e,i,r){if(0===t.length)return{width:0,height:0};if(null===e){var a=i("TauChart Library");return a.width=.625*r,a}t.every(function(t){return"number"==typeof t})&&(t=n.scaleLinear().domain(t).ticks());var o=t.reduce(function(t,n){var i=e(n).toString().length;return!t.computed||i>t.computed?{value:n,computed:i}:t},{}).value;return i(e(o))},Ln=function(t,e){var n=t.dimType,i=t.scaleType,r=[n,i,"*"].join(":"),a=[n,i].join(":");return e[r]||e[a]||e[n]||null},Nn=function(t,e,n){return t.hasOwnProperty(e+":"+n)?t[e+":"+n]:t[""+e]},Fn=function(t,e){return["day","week","month"].indexOf(t)>=0&&(t+="-short"+(e?"-utc":"")),t},Rn=function(t,e){var n=t.width,i=t.height,r=Math.abs(qt(e));return{width:Math.max(Math.cos(r)*n,i),height:Math.max(Math.sin(r)*n,i)}},Dn=function(t,e){void 0===e&&(e="x");var n=Ut(t),i="x"===e?[[0,45,"middle"],[45,135,"start"],[135,225,"middle"],[225,315,"end"],[315,360,"middle"]]:[[0,90,"end"],[90,135,"middle"],[135,225,"start"],[225,315,"middle"],[315,360,"end"]];return i[i.findIndex(function(t){return n>=t[0]&&n<t[1]})][2]},jn=function(t,e,n){var i=Math.ceil(t.width/e);return{height:Math.min(i,n)*t.height,width:e}},In=function(t,e,n,i,r){var a=n.values,o=i.values,s=n.isEmpty||t.x.hideTicks,u=i.isEmpty||t.y.hideTicks,l=On(a,Tn.get(t.x.tickFormat,t.x.tickFormatNullAlias),e.getAxisTickLabelSize,e.xAxisTickLabelLimit),c=On(o,Tn.get(t.y.tickFormat,t.y.tickFormatNullAlias),e.getAxisTickLabelSize,e.yAxisTickLabelLimit),d=l,h=c;l.width>e.xAxisTickLabelLimit&&(t.x.tickFormatWordWrap=!0,t.x.tickFormatWordWrapLines=e.xTickWordWrapLinesLimit,d=jn(l,e.xAxisTickLabelLimit,e.xTickWordWrapLinesLimit)),c.width>e.yAxisTickLabelLimit&&(t.y.tickFormatWordWrap=!0,t.y.tickFormatWordWrapLines=e.yTickWordWrapLinesLimit,h=jn(c,e.yAxisTickLabelLimit,e.yTickWordWrapLinesLimit));var f=s?0:1,p=u?0:1,g=t.x.label,m=t.y.label,y=g.text&&!g.hide?1:0,v=m.text&&!m.hide?1:0,x=Rn(d,t.x.rotate),_=Rn(h,t.y.rotate);r?(g.padding=(-e.xAxisPadding-e.xFontLabelHeight)/2+e.xFontLabelHeight,g.paddingNoTicks=g.padding,m.padding=(-e.yAxisPadding-e.yFontLabelHeight)/2,m.paddingNoTicks=m.padding,y=0,v=0):(g.padding=En([f*(e.xTickWidth+x.height),y*(e.distToXAxisLabel+e.xFontLabelHeight)]),g.paddingNoTicks=y*(e.distToXAxisLabel+e.xFontLabelHeight),m.padding=En([p*(e.yTickWidth+_.width),v*e.distToYAxisLabel]),m.paddingNoTicks=v*e.distToYAxisLabel);var b=e.xFontLabelDescenderLineHeight;return t.padding=Object.assign(t.padding,{b:t.x.hide?0:En([t.x.padding,f*(e.xTickWidth+x.height),y*(e.distToXAxisLabel+e.xFontLabelHeight+b)]),l:t.y.hide?0:En([t.y.padding,p*(e.yTickWidth+_.width),v*(e.distToYAxisLabel+e.yFontLabelHeight)])}),t.paddingNoTicks=Object.assign({},t.paddingNoTicks,{b:t.x.hide?0:En([t.x.padding,y*(e.distToXAxisLabel+e.xFontLabelHeight+b)]),l:t.y.hide?0:En([t.y.padding,v*(e.distToYAxisLabel+e.yFontLabelHeight)])}),t.x=Object.assign(t.x,{density:x.width+2*Nn(e,"xDensityPadding",n.dimType),tickFontHeight:l.height,$minimalDomain:a.length,$maxTickTextW:d.width,$maxTickTextH:d.height,tickFormatWordWrapLimit:e.xAxisTickLabelLimit}),t.y=Object.assign(t.y,{density:_.height+2*Nn(e,"yDensityPadding",i.dimType),tickFontHeight:c.height,$minimalDomain:o.length,$maxTickTextW:h.width,$maxTickTextH:h.height,tickFormatWordWrapLimit:e.yAxisTickLabelLimit}),t},zn=function(t){var e=t.unit,n=t.meta,i=t.settings,r=t.allowXVertical,a=t.allowYVertical,o=t.inlineLabels,s=n.dimension(e.x),u=n.dimension(e.y),l=n.scaleMeta(e.x,e.guide.x),c=n.scaleMeta(e.y,e.guide.y),d=l.isEmpty,h=c.isEmpty;e.guide.x.tickFormat=Fn(e.guide.x.tickFormat||Ln(s,i.defaultFormats),i.utcTime),e.guide.y.tickFormat=Fn(e.guide.y.tickFormat||Ln(u,i.defaultFormats),i.utcTime);var f=!!r&&!("measure"===s.dimType),p=!!a&&!("measure"===u.dimType);if(e.guide.x.padding=d?0:i.xAxisPadding,e.guide.x.paddingNoTicks=e.guide.x.padding,e.guide.y.padding=h?0:i.yAxisPadding,e.guide.y.paddingNoTicks=e.guide.y.padding,e.guide.x.rotate=f?-90:0,e.guide.x.textAnchor=Dn(e.guide.x.rotate,"x"),e.guide.y.rotate=p?-90:0,e.guide.y.textAnchor=Dn(e.guide.y.rotate,"y"),e.guide=In(e.guide,i,l,c,o),o){var g=e.guide.x.label,m=e.guide.y.label;g.cssClass+=" inline",g.dock="right",g.textAnchor="end",m.cssClass+=" inline",m.dock="right",m.textAnchor="end"}return e},Pn={NONE:function(t,e,n){var i=At(t);return Hn(At(i.unit),i.unit,function(t,e){return e.guide.x.tickFontHeight=n.getAxisTickLabelSize("X").height,e.guide.y.tickFontHeight=n.getAxisTickLabelSize("Y").height,e.guide.x.tickFormatWordWrapLimit=n.xAxisTickLabelLimit,e.guide.y.tickFormatWordWrapLimit=n.yAxisTickLabelLimit,e}),i},"BUILD-LABELS":function(t,e){var n=At(t),i=[],r=[],a=null,o=null;mt(n.unit,"units",Cn,function(t,n){if(t.isLeaf)return n;!a&&n.x&&(a=n),!o&&n.y&&(o=n),n.guide=n.guide||{},n.guide.x=n.guide.x||{label:""},n.guide.y=n.guide.y||{label:""},n.guide.x.label=Ot(n.guide.x.label)?n.guide.x.label:{text:n.guide.x.label},n.guide.y.label=Ot(n.guide.y.label)?n.guide.y.label:{text:n.guide.y.label},n.x&&(n.guide.x.label.text=n.guide.x.label.text||e.dimension(n.x).dimName),n.y&&(n.guide.y.label.text=n.guide.y.label.text||e.dimension(n.y).dimName);var s=n.guide.x.label.text;s&&(i.push(s),n.guide.x.tickFormatNullAlias=n.guide.x.hasOwnProperty("tickFormatNullAlias")?n.guide.x.tickFormatNullAlias:"No "+s,n.guide.x.label.text="",n.guide.x.label._original_text=s);var u=n.guide.y.label.text;return u&&(r.push(u),n.guide.y.tickFormatNullAlias=n.guide.y.hasOwnProperty("tickFormatNullAlias")?n.guide.y.tickFormatNullAlias:"No "+u,n.guide.y.label.text="",n.guide.y.label._original_text=u),n});return a&&(a.guide.x.label.text=a.guide.x.label.hide?"":i.join("  ")),o&&(o.guide.y.label.text=o.guide.y.label.hide?"":r.join("  ")),n},"BUILD-GUIDE":function(t,e,n){var i=At(t);return Hn(At(i.unit),i.unit,function(t,i){if(t.isLeaf)return i;var r=!t.isLeaf&&!t.isLeafParent,a=e.scaleMeta(i.x,i.guide.x),o=e.scaleMeta(i.y,i.guide.y),s=!r&&Boolean(a.dimType)&&"measure"!==a.dimType;return i.guide.x.rotate=s?-90:0,i.guide.x.textAnchor=Dn(i.guide.x.rotate),i.guide.x.tickFormat=i.guide.x.tickFormat||Ln(a,n.defaultFormats),i.guide.y.tickFormat=i.guide.y.tickFormat||Ln(o,n.defaultFormats),i.guide.x.padding=r?0:n.xAxisPadding,i.guide.x.paddingNoTicks=i.guide.x.padding,i.guide.y.padding=r?0:n.yAxisPadding,i.guide.y.paddingNoTicks=i.guide.y.padding,i.guide=In(i.guide,Jt({distToXAxisLabel:a.isEmpty?n.xTickWidth:n.distToXAxisLabel,distToYAxisLabel:o.isEmpty?n.yTickWidth:n.distToYAxisLabel},n),a,o),i.guide.x=Object.assign(i.guide.x,{cssClass:r?i.guide.x.cssClass+" facet-axis":i.guide.x.cssClass,avoidCollisions:!!r||i.guide.x.avoidCollisions}),i.guide.y=Object.assign(i.guide.y,{cssClass:r?i.guide.y.cssClass+" facet-axis":i.guide.y.cssClass,avoidCollisions:!r&&i.guide.y.avoidCollisions}),i.guide=Object.assign(i.guide,{showGridLines:i.guide.hasOwnProperty("showGridLines")?i.guide.showGridLines:t.isLeafParent?"xy":""}),i}),i},"BUILD-COMPACT":function(t,e,n){var i=At(t);return Hn(At(i.unit),i.unit,function(t,i){return t.isLeaf?i:(i.guide.hasOwnProperty("showGridLines")||(i.guide.showGridLines=t.isLeafParent?"xy":""),t.isLeafParent?zn({unit:i,meta:e,settings:Jt({xTickWordWrapLinesLimit:1,yTickWordWrapLinesLimit:1},n),allowXVertical:!0,allowYVertical:!1,inlineLabels:!0}):(i.guide.x.cssClass+=" facet-axis compact",i.guide.x.avoidCollisions=!0,i.guide.y.cssClass+=" facet-axis compact",i.guide.y.avoidCollisions=!0,zn({unit:i,meta:e,settings:Jt({xAxisPadding:0,yAxisPadding:0,distToXAxisLabel:0,distToYAxisLabel:0,xTickWordWrapLinesLimit:1,yTickWordWrapLinesLimit:1},n),allowXVertical:!1,allowYVertical:!0,inlineLabels:!1})))}),i}};Pn.AUTO=function(t,e,n){return["BUILD-LABELS","BUILD-GUIDE"].reduce(function(t,i){return Pn[i](t,e,n)},t)},Pn.COMPACT=function(t,e,n){return["BUILD-LABELS","BUILD-COMPACT"].reduce(function(t,i){return Pn[i](t,e,n)},t)};var Hn=function(t,e,n){var i,r=((i=e).options=i.options||{},i.guide=i.guide||{},i.guide.padding=Jt(i.guide.padding||{},{l:0,b:0,r:0,t:0}),i.guide.x=kn(i.guide,"x"),i.guide.x=An(i.guide,"x",{cssClass:"x axis",scaleOrient:"bottom",textAnchor:"middle"}),i.guide.y=kn(i.guide,"y",{rotate:-90}),i.guide.y=An(i.guide,"y",{cssClass:"y axis",scaleOrient:"left",textAnchor:"end"}),i.guide.size=kn(i.guide,"size"),i.guide.color=kn(i.guide,"color"),i);r=n(Cn(r),r);var a=$t(r=Mn(r,t),"units");return(r.units||[]).forEach(function(t){return Hn(At(t),(i=a,(e=t).guide=e.guide||{},e.guide.padding=e.guide.padding||{l:0,t:0,r:0,b:0},e.hasOwnProperty("units")||((e=Jt(e,i)).guide=Jt(e.guide,At(i.guide)),e.guide.x=Jt(e.guide.x,At(i.guide.x)),e.guide.y=Jt(e.guide.y,At(i.guide.y))),e),n);var e,i}),r},Bn=function(t,e,n,i){var r={dimension:function(t){var e=n.scales[t],i=n.sources[e.source].dims[e.dim]||{};return{dimName:e.dim,dimType:i.type,scaleType:e.type}},scaleMeta:function(t){var e=i("pos",t).domain(),r=n.scales[t],a=n.sources[r.source].dims[r.dim]||{};return{dimName:r.dim,dimType:a.type,scaleType:r.type,values:e,isEmpty:null==a.type}}},a=(Pn[t]||Pn.NONE)({unit:At(n.unit)},r,e);return n.unit=a.unit,n},qn=function(){function t(t){this.spec=t,this.isApplicable=It(t.unit)}return t.prototype.transform=function(t){var e=this.spec;if(!this.isApplicable)return e;var n=e.settings.size,i=e.settings.specEngine.find(function(t){return n.width<=t.width||n.height<=t.height});return Bn(i.name,e.settings,e,function(e,n){return t.getScaleInfo(n||e+":default")})},t}(),Un=function(){function t(){}return t.optimizeXAxisLabel=function(t,e){var n=e.xAxisTickLabelLimit,i=function(t){if(!t.guide.x.hide&&!t.guide.x.hideTicks&&0!==t.guide.x.rotate){t.guide.x.rotate=0,t.guide.x.textAnchor="middle";var e=0-Math.min(n,t.guide.x.$maxTickTextW)+t.guide.x.$maxTickTextH;r(t,e)}(t.units||[]).filter(function(t){return"COORDS.RECT"===t.type}).forEach(function(t){return i(t)})},r=function(e,n){t!==e&&"extract-axes"===e.guide.autoLayout?(t.guide.x.padding+=n,t.guide.padding.b+=n):(e.guide.x.label.padding+=e.guide.x.label.padding>0?n:0,e.guide.padding.b+=e.guide.padding.b>0?n:0)};i(t)},t.hideAxisTicks=function(t,e,n){var i=function(t){var e="x"===n?"b":"l",r=t.guide;if(!r[n].hide&&!r[n].hideTicks){r[n].hideTicks=!0;var a=r[n].label.text&&!r[n].label.hide;r.padding[e]=r.paddingNoTicks?r.paddingNoTicks[e]:0,r[n].padding=r[n].paddingNoTicks||0,r[n].label.padding=a?r[n].label.paddingNoTicks:0}(t.units||[]).filter(function(t){return"COORDS.RECT"===t.type}).forEach(function(t){return i(t)})};i(t)},t}(),Wn=function(t){return t.$maxTickTextW},Gn=function(t){return 0==t.rotate?t.$maxTickTextW:t.$maxTickTextH},Xn=function(t){return t.density},Yn=function(t){var e=[],n=[],i=function(t){if("COORDS.RECT"===t.type&&t.units&&t.units[0]&&"COORDS.RECT"===t.units[0].type){var r=t.x.replace(/^x_/,""),a=t.y.replace(/^y_/,"");"null"!==r&&e.push(r),"null"!==a&&n.push(a),t.units.forEach(i)}};i(t.unit);var r={},a={},o=function(t){"COORDS.RECT"===t.type&&t.frames.forEach(function(t){t.key&&(Object.keys(t.key).forEach(function(i){e.indexOf(i)>=0&&(i in r||(r[i]=[]),r[i].indexOf(t.key[i])<0&&r[i].push(t.key[i])),n.indexOf(i)>=0&&(i in a||(a[i]=[]),a[i].indexOf(t.key[i])<0&&a[i].push(t.key[i]))}),t.units&&t.units.forEach(o))})};return o(t.unit),{xFacetCount:Object.keys(r).reduce(function(t,e){return t*r[e].length},1),yFacetCount:Object.keys(a).reduce(function(t,e){return t*a[e].length},1)}},Vn={"entire-view":function(t,e,n,i){var r=n.unit.guide,a=Yn(n),o=a.xFacetCount,s=a.yFacetCount,u=r.paddingNoTicks?r.padding.l-r.paddingNoTicks.l:0,l=r.paddingNoTicks?r.padding.b-r.paddingNoTicks.b:0,c=r.paddingNoTicks&&t.height-l<n.settings.minChartHeight||s*n.settings.minFacetHeight+l>t.height||o*n.settings.minFacetWidth+u>t.width,d=r.paddingNoTicks&&t.width-u<n.settings.minChartWidth||s*n.settings.minFacetHeight+l>t.height||o*n.settings.minFacetWidth+u>t.width;c&&Un.hideAxisTicks(n.unit,n.settings,"x"),d&&Un.hideAxisTicks(n.unit,n.settings,"y");var h=t.width;if(e("x",n.unit,Wn)<=t.width)i(n.unit,n.settings);else{var f=e("x",n.unit,Gn);if(f>t.width){var p=Math.max(t.width,e("x",n.unit,Xn));h=Math.min(f,p)}}var g=Math.max(t.height,e("y",n.unit,Xn));return!c&&h>t.width&&Un.hideAxisTicks(n.unit,n.settings,"x"),!d&&g>t.height&&Un.hideAxisTicks(n.unit,n.settings,"y"),{newW:t.width,newH:t.height}},minimal:function(t,e,n){return{newW:e("x",n.unit,Xn),newH:e("y",n.unit,Xn)}},normal:function(t,e,n,i){var r=n.unit.guide;r.paddingNoTicks&&(t.width-r.padding.l+r.paddingNoTicks.l<n.settings.minChartWidth&&Un.hideAxisTicks(n.unit,n.settings,"y"),t.height-r.padding.b+r.paddingNoTicks.b<n.settings.minChartHeight&&Un.hideAxisTicks(n.unit,n.settings,"x"));var a=t.width;if(e("x",n.unit,Wn)<=t.width)i(n.unit,n.settings);else{var o=e("x",n.unit,Gn);if(o>t.width){var s=Math.max(t.width,e("x",n.unit,Xn));a=Math.min(o,s)}}return{newW:a,newH:Math.max(t.height,e("y",n.unit,Xn))}},"fit-width":function(t,e,n,i){var r=n.unit.guide,a=r.paddingNoTicks?r.padding.l-r.paddingNoTicks.l:0;return(r.paddingNoTicks&&t.width-a<n.settings.minChartWidth||Yn(n).xFacetCount*n.settings.minFacetWidth+a>t.width)&&Un.hideAxisTicks(n.unit,n.settings,"y"),e("x",n.unit,Wn)<=t.width&&i(n.unit,n.settings),{newW:t.width,newH:e("y",n.unit,Xn)}},"fit-height":function(t,e,n){var i=n.unit.guide,r=i.paddingNoTicks?i.padding.b-i.paddingNoTicks.b:0;return(i.paddingNoTicks&&t.height-r<n.settings.minChartHeight||Yn(n).yFacetCount*n.settings.minFacetHeight+r>t.height)&&Un.hideAxisTicks(n.unit,n.settings,"x"),{newW:e("x",n.unit,Xn),newH:t.height}}},Kn=function(){function t(t){this.spec=t,this.isApplicable=It(t.unit)}return t.prototype.transform=function(t){var e=this.spec;if(!this.isApplicable)return e;var n=e.settings.fitModel;if(!n)return e;var i=e.scales,r=function(t,e){return t.discrete?e*t.domain().length:4*e},a=function(e,n,o,s){void 0===s&&(s=null);var u="x"===e?n.x:n.y,l="x"===e?n.y:n.x,c=n.guide,d=o("x"===e?c.x:c.y),h=n.units[0],f="x"===e?c.padding.l+c.padding.r:c.padding.b+c.padding.t;if("ELEMENT.INTERVAL"===h.type&&"y"===e===Boolean(h.flip)&&h.label&&!t.getScaleInfo(h.label,s).isEmpty()){var p,g=2*(c.label&&c.label.fontSize?c.label.fontSize:10),m=t.getScaleInfo(u,s);if(m.discrete&&(null==h.guide.enableColorToBarPosition?!h.stack:h.guide.enableColorToBarPosition)){var y=h.color;if(y){var v=t.getScaleInfo(y,s);if(v.discrete){v.domain();p=v}}}var x=n.frames.reduce(function(t,e){return t+function(t){var e=t.part(),n=Xt(e.map(function(t){return t[m.dim]})).length,i=1;if(p){var r=e.reduce(function(t,e){var n=e[m.dim],i=e[p.dim];return t[n]=t[n]||{},t[n][i]||(t[n][i]=!0),t},{}),a=Object.keys(r).map(function(t){return Object.keys(r[t]).length});i=Math.max.apply(Math,a)}return n*i*g}(e)},0),_=r(m,d);return f+Math.max(x,_)}if("COORDS.RECT"!==h.type){var b=t.getScaleInfo(u,s);return f+r(b,d)}var w,S,T=(w=n.frames,S=i[l].dim,w.reduce(function(t,e){var n=(e.key||{})[S];return t[n]=t[n]||[],t[n].push(e),t},{})),E=Object.keys(T).map(function(t){return T[t].map(function(t){return a(e,t.units[0],o,t)}).reduce(function(t,e){return t+e},0)});return f+Math.max.apply(Math,E)},o=e.settings.size,s=o.width,u=o.height,l=Vn[n];if(l){var c=l(o,a,e,Un.optimizeXAxisLabel);s=c.newW,u=c.newH}var d,h,f,p,g,m,y,v;return e.settings.size=(d=o,h={width:s,height:u},f=e.settings.avoidScrollAtRatio,p=e.settings.getScrollbarSize(t.getLayout().contentContainer),g=h.width>d.width&&h.width<=d.width*f?d.width:h.width,m=h.height>d.height&&h.height<=d.height*f?d.height:h.height,y=d.width-g,v=d.height-m>=0?0:p.width,{height:m-(y>=0?0:p.height),width:g-v}),e},t}(),Jn=function(){function t(t){this.spec=t,this.isApplicable=t.settings.autoRatio&&It(t.unit)}return t.prototype.transform=function(t){var e=this.spec;if(!this.isApplicable)return e;try{this.ruleApplyRatio(e,t)}catch(t){if("Not applicable"!==t.message)throw t}return e},t.prototype.ruleApplyRatio=function(t,e){var n=function(t){return"COORDS.RECT"===t.type||"RECT"===t.type},i=function(t,e,n,r){void 0===r&&(r=0),e(t,r)&&(t.units||[]).map(function(t){return i(t,e,n,r+1)}),n(t,r)},r=[],a=[];i(t.unit,function(t,e){if(e>1||!n(t))throw new Error("Not applicable");return r.push(t.x),a.push(t.y),1===(t.units||[]).map(function(t){if(!n(t)&&0!==t.type.indexOf("ELEMENT."))throw new Error("Not applicable");return t}).filter(n).length},function(){return 0});var o=function(e){return t.scales[e]},s=function(t){return"/"===t.source&&!t.ratio&&!t.fitToFrameByDims},u=function(t){return"ordinal"===t.type||"period"===t.type&&!t.period},l=r.map(o).filter(s),c=a.map(o).filter(s);if([l.length,c.length].some(function(t){return 2===t})){var d=function(t){return t.dim},h=function(t,e,n){t.fitToFrameByDims=n.slice(0,e).map(d)},f=function(t,n){2===n.filter(u).length&&(n.forEach(h),n[0].ratio=jt(t,n.map(d),e))};f("x",l),f("y",c)}},t}(),$n=function(){function t(t){this.spec=t,this.isApplicable="EXTRACT"===t.settings.layoutEngine&&It(t.unit)}return t.prototype.transform=function(){var t=this.spec;if(!this.isApplicable)return t;try{this.ruleExtractAxes(t)}catch(t){if("Not applicable"!==t.message)throw t;console.log("[TauCharts]: can't extract axes for the given chart specification")}return t},t.prototype.ruleExtractAxes=function(t){var e=function(t){return"COORDS.RECT"===t.type||"RECT"===t.type},n=function(t){return t?10:0},i={l:0,r:10,t:10,b:0},r={l:0,b:0},a=[],o=[];yt(t.unit,function(t,n){if(n>1||!e(t))throw new Error("Not applicable");t.guide=t.guide||{};var s=t.guide,u=s.padding||{l:0,r:0,t:0,b:0},l=s.paddingNoTicks||{l:0,b:0};return i.l+=u.l,i.r+=u.r,i.t+=u.t,i.b+=u.b,r.l+=l.l,r.b+=l.b,a.push(Object.assign({},i)),o.push(Object.assign({},r)),1===(t.units||[]).map(function(t){if(!e(t)&&0!==t.type.indexOf("ELEMENT."))throw new Error("Not applicable");return t}).filter(e).length},function(t){var e=a.pop(),s=o.pop(),u=t.guide||{};u.x=u.x||{},u.x.padding=u.x.padding||0,u.x.paddingNoTicks=u.x.paddingNoTicks||0,u.y=u.y||{},u.y.padding=u.y.padding||0,u.y.paddingNoTicks=u.y.paddingNoTicks||0,u.padding={l:n(t.y),r:n(1),t:n(1),b:n(t.x)},u.paddingNoTicks={l:0,b:0},u.autoLayout="extract-axes",u.x.padding+=i.b-e.b,u.y.padding+=i.l-e.l,u.x.paddingNoTicks+=r.b-s.b,u.y.paddingNoTicks+=r.l-s.l}),t.unit.guide.padding=i,t.unit.guide.paddingNoTicks=r},t}(),Qn=function(){function t(t){var e=void 0===t?{}:t,n=e.src,i=void 0===n?null:n,r=e.timeout,a=void 0===r?Number.MAX_SAFE_INTEGER:r,o=e.syncInterval,s=void 0===o?Number.MAX_SAFE_INTEGER:o,u=e.callbacks,l=void 0===u?{}:u,c=this;this.setTimeoutDuration(a),this.setSyncInterval(s),this.setCallbacks(l),this._running=!1,this._queue=[],this._result=i,this._syncDuration=0,this._asyncDuration=0,this._requestedFrameId=null,this._visibilityChangeHandler=function(){if(c._running&&c._requestedFrameId){var t=c._getCancelFrameFunction(),e=c._getRequestFrameFunction();t(c._requestedFrameId),c._requestedFrameId=e(c._requestedFrameCallback)}},this._tasksCount=0,this._finishedTasksCount=0}return t.prototype.setTimeoutDuration=function(e){t.checkType(e,"number","timeout"),this._timeout=e},t.prototype.setSyncInterval=function(e){t.checkType(e,"number","syncInterval"),this._syncInterval=e},t.prototype.setCallbacks=function(e){t.checkType(e,"object","callbacks"),this._callbacks=Object.assign(this._callbacks||{},e)},t.prototype.addTask=function(t){return this._queue.push(t),this._tasksCount++,this},t.prototype.run=function(){if(this._running)throw new Error("Task Runner is already running");this._running=!0,t.runnersInProgress++,document.addEventListener("visibilitychange",this._visibilityChangeHandler),this._loopTasks()},t.prototype.isRunning=function(){return this._running},t.prototype._loopTasks=function(){for(var e,n,i,r,a=0,o=this._syncInterval/t.runnersInProgress;this._running&&!(i=this._asyncDuration>this._timeout)&&!(r=a>o)&&(e=this._queue.shift());){if(null===(n=this._runTask(e)))return;this._syncDuration+=n,this._asyncDuration+=n,a+=n}i&&this._queue.length>0&&(this.stop(),this._callbacks.timeout&&this._callbacks.timeout.call(null,this._asyncDuration,this)),!i&&r&&this._queue.length>0&&this._requestFrame(),0===this._queue.length&&(this.stop(),this._callbacks.done&&this._callbacks.done.call(null,this._result,this))},t.prototype._runTask=function(t){var e=performance.now();if(this._callbacks.error)try{this._result=t.call(null,this._result,this)}catch(t){return this.stop(),this._callbacks.error.call(null,t,this),null}else this._result=t.call(null,this._result,this);var n=performance.now()-e;return this._finishedTasksCount++,this._callbacks.progress&&this._callbacks.progress.call(null,this._finishedTasksCount/this._tasksCount,this),n},t.prototype._requestFrame=function(){var t=this,e=performance.now(),n=function(){t._requestedFrameId=null;var n=performance.now();t._asyncDuration+=n-e,t._loopTasks()},i=this._getRequestFrameFunction();this._requestedFrameCallback=n,this._requestedFrameId=i(n)},t.prototype._getRequestFrameFunction=function(){var t=this;return document.hidden?function(e){return t._requestedFrameType="idle",window.requestIdleCallback(e,{timeout:17})}:function(e){return t._requestedFrameType="animation",requestAnimationFrame(e)}},t.prototype._getCancelFrameFunction=function(){switch(this._requestedFrameType){case"animation":return function(t){return cancelAnimationFrame(t)};case"idle":return function(t){return window.cancelIdleCallback(t)}}},t.prototype.stop=function(){if(!this._running)throw new Error("Task Runner is already stopped");(this._running=!1,t.runnersInProgress--,document.removeEventListener("visibilitychange",this._visibilityChangeHandler),this._requestedFrameId)&&(this._getCancelFrameFunction()(this._requestedFrameId),this._requestedFrameId=null)},t.checkType=function(t,e,n){if(typeof t!==e)throw new Error('Task Runner "'+n+'" property is not "'+e+'"')},t.runnersInProgress=0,t}(),Zn=y({},t),ti=xe,ei=_e,ni=function(e){function n(t){var n=e.call(this)||this;return n._nodes=[],n._svg=null,n._filtersStore={filters:{},tick:0},n._layout=mn(),n.transformers=[Jn,qn],n.onUnitsStructureExpandedTransformers=[$n,Kn],n._chartDataModel=function(t){return t},n._reportProgress=null,n._taskRunner=null,n._renderingPhase=null,n.applyConfig(t),n}return m(n,e),n.prototype.on=function(t,n,i){return e.prototype.on.call(this,t,n,i)},n.prototype.updateConfig=function(t){this.applyConfig(t),this.refresh()},n.prototype.applyConfig=function(t){this._filtersStore.filters={},t=this.setupConfigSettings(t),this.configGPL=this.createGPLConfig(t),this._originData=Object.assign({},this.configGPL.sources),this._liveSpec=this.configGPL,this._emptyContainer=t.emptyContainer||"",this.setupPlugins(t)},n.prototype.createGPLConfig=function(t){var e;return this.isGPLConfig(t)?e=t:(t=this.setupConfig(t),e=new yn(t).convert()),e=n.setupPeriodData(e)},n.prototype.isGPLConfig=function(t){return 2===["sources","scales"].filter(function(e){return t.hasOwnProperty(e)}).length},n.prototype.setupPlugins=function(t){var e=t.plugins||[];this._plugins&&this._plugins.destroy(),this._plugins=new en(e,this)},n.prototype.setupConfigSettings=function(t){var e;return this._dataRefs=this._dataRefs||(e=0,{references:new WeakMap,refCounter:function(){return++e}}),t.settings=n.setupSettings(Jt(t.settings||{},this._dataRefs)),t},n.prototype.destroy=function(){this.destroyNodes(),Zn.select(this._svg).remove(),Zn.select(this._layout.layout).remove(),this._cancelRendering(),e.prototype.destroy.call(this)},n.prototype.setupChartSourceModel=function(t){this._chartDataModel=t},n.prototype.setupConfig=function(t){if(!t.spec||!t.spec.unit)throw new Error("Provide spec for plot");var e=Jt(t,{spec:{},data:[],plugins:[],settings:{}});e.spec.dimensions=n.setupMetaInfo(e.spec.dimensions,e.data);var i=e.settings.log;return e.settings.excludeNull&&this.addFilter({tag:"default",src:"/",predicate:dn(e.spec.dimensions,function(t){return i([t,"point was excluded, because it has undefined values."],"WARN")})}),e},n.setupPeriodData=function(t){var e=n.__api__.tickPeriod,i=t.settings.log;return Object.keys(t.scales).map(function(e){return t.scales[e]}).filter(function(t){return"period"===t.type}).forEach(function(n){e.get(n.period,{utc:t.settings.utcTime})||(i(['Unknown period "'+n.period+'".',"Docs: http://api.taucharts.com/plugins/customticks.html#how-to-add-custom-tick-period"],"WARN"),n.period=null)}),t},n.setupMetaInfo=function(t,e){var n=t||fn(e);return hn(n)},n.setupSettings=function(t){var e=n.globalSettings,i=Object.keys(e).reduce(function(t,n){return t[n]="function"==typeof e[n]?e[n]:At(e[n]),t},{}),r=Jt(t||{},i);return Array.isArray(r.specEngine)||(r.specEngine=[{width:Number.MAX_VALUE,name:r.specEngine}]),r},n.prototype.insertToLeftSidebar=function(t){return ce(t,this._layout.leftSidebar)},n.prototype.insertToRightSidebar=function(t){return ce(t,this._layout.rightSidebar)},n.prototype.insertToFooter=function(t){return ce(t,this._layout.footer)},n.prototype.insertToHeader=function(t){return ce(t,this._layout.header)},n.prototype.addBalloon=function(t){return new tn("",t||{})},n.prototype.destroyNodes=function(){this._nodes.forEach(function(t){return t.destroy()}),this._nodes=[],this._renderedItems=[]},n.prototype.onUnitDraw=function(t){var e=this;this._nodes.push(t),this.fire("unitdraw",t),["click","mouseover","mouseout"].forEach(function(n){return t.on(n,function(t,i){e.fire("element"+n,{element:t,data:i.data,event:i.event})})})},n.prototype.onUnitsStructureExpanded=function(t){var e=this;this.onUnitsStructureExpandedTransformers.forEach(function(n){return new n(t).transform(e)}),this.fire("unitsstructureexpanded",t)},n.prototype._getClosestElementPerUnit=function(t,e){return this._renderedItems.filter(function(t){return t.getClosestElement}).map(function(n){var i=n.getClosestElement(t,e);return{unit:n.node(),closest:i}})},n.prototype.disablePointerEvents=function(){this._layout.layout.style.pointerEvents="none"},n.prototype.enablePointerEvents=function(){this._layout.layout.style.pointerEvents=""},n.prototype._handlePointerEvent=function(t){var e=this._svg.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top,r="click"===t.type?"data-click":"data-hover",a=null,o=null,s=null,u=this._getClosestElementPerUnit(n,i),l=u.filter(function(t){return t.closest}).sort(function(t,e){return t.closest.distance===e.closest.distance?t.closest.secondaryDistance-e.closest.secondaryDistance:t.closest.distance-e.closest.distance});if(l.length>0){var c=l.findIndex(function(t){return t.closest.distance!==l[0].closest.distance||t.closest.secondaryDistance!==l[0].closest.secondaryDistance}),d=c<0?l:l.slice(0,c);if(1===d.length)a=d[0].closest.data,o=d[0].closest.node,s=d[0].unit;else{var h=d.reduce(function(t,e){return t+e.closest.x},0)/d.length,f=d.reduce(function(t,e){return t+e.closest.y},0)/d.length,p=Math.atan2(f-i,h-n)+Math.PI,g=Math.round((d.length-1)*p/2/Math.PI),m=d[g].closest;a=m.data,o=m.node,s=d[g].unit}}u.forEach(function(e){return e.unit.fire(r,{event:t,data:a,node:o,unit:s})})},n.prototype._initPointerEvents=function(){var e=this;this._liveSpec.settings.syncPointerEvents||(this._pointerAnimationFrameId=null);var n=Zn.select(this._svg),i=this._liveSpec.settings.syncPointerEvents?function(e){return function(){return e(t.event)}}:function(n){return function(){var i=t.event;e._pointerAnimationFrameId&&"mousemove"!==i.type&&e._cancelPointerAnimationFrame(),e._pointerAnimationFrameId||(e._pointerAnimationFrameId=requestAnimationFrame(function(){e._pointerAnimationFrameId=null,n(i)}))}},r=function(t){return e._handlePointerEvent(t)};n.on("mousemove",i(r)),n.on("click",i(r)),n.on("mouseleave",i(function(t){"none"!==window.getComputedStyle(e._svg).pointerEvents&&e.select(function(){return!0}).forEach(function(e){return e.fire("data-hover",{event:t,data:null,node:null,unit:null})})}))},n.prototype._cancelPointerAnimationFrame=function(){cancelAnimationFrame(this._pointerAnimationFrameId),this._pointerAnimationFrameId=null},n.prototype._setupTaskRunner=function(t){var e=this;return this._resetTaskRunner(),this._taskRunner=new Qn({timeout:t.settings.renderingTimeout||Number.MAX_SAFE_INTEGER,syncInterval:t.settings.asyncRendering?t.settings.syncRenderingInterval:Number.MAX_SAFE_INTEGER,callbacks:{done:function(){e._completeRendering(),e._renderingPhase=null},timeout:function(t,n){e._displayTimeoutWarning({timeout:t,proceed:function(){e.disablePointerEvents(),n.setTimeoutDuration(Number.MAX_SAFE_INTEGER),n.run()},cancel:function(){e._cancelRendering()}}),e.enablePointerEvents(),e.fire("renderingtimeout",t)},progress:function(t){var n={spec:0,draw:1}[e._renderingPhase]/2+t/2;e._reportProgress(n)},error:t.settings.handleRenderingErrors?function(n){e._cancelRendering(),e._displayRenderingError(n),e.fire("renderingerror",n),t.settings.log(["An error occured during chart rendering.",'Set "handleRenderingErrors: false" in chart settings to debug.',"Error message: "+n.message].join(" "),"ERROR")}:null}}),this._taskRunner},n.prototype._resetTaskRunner=function(){this._taskRunner&&this._taskRunner.isRunning()&&(this._taskRunner.stop(),this._taskRunner=null)},n.prototype.renderTo=function(t,e){this._resetProgressLayout(),this.disablePointerEvents();var n=this._createLiveSpec(t,e);if(!n)return this._svg=null,this._layout.content.innerHTML=this._emptyContainer,void this.enablePointerEvents();var i=this._createGPL(n),r=this._setupTaskRunner(n);this._scheduleDrawScenario(r,i),this._scheduleDrawing(r,i),r.run()},n.prototype._createLiveSpec=function(t,e){var n=this;this._target=t,this._defaultSize=Object.assign({},e);var i=Zn.select(t).node();if(null===i)throw new Error("Target element not found");this._layout.layout.parentNode!==i&&i.appendChild(this._layout.layout);var r=this._layout.content,a=de(this._layout.contentContainer);this._layout.contentContainer.style.padding="0 "+a.width+"px "+a.height+"px 0",he(this._layout.rightSidebarContainer,"vertical");var o=Object.assign({},e)||{};if(!o.width||!o.height){var s=r.parentElement,u=s.scrollLeft,l=s.scrollTop;r.style.display="none",o=Jt(o,ge(r.parentNode)),r.style.display="",r.parentElement.scrollLeft=u,r.parentElement.scrollTop=l,o.height||(o.height=ge(this._layout.layout).height)}return this.configGPL.settings.size=o,this._liveSpec=At($t(this.configGPL,"plugins")),this._liveSpec.sources=this.getDataSources(),this._liveSpec.settings=this.configGPL.settings,this._experimentalSetupAnimationSpeed(this._liveSpec),this.isEmptySources(this._liveSpec.sources)?null:(this._liveSpec=this.transformers.reduce(function(t,e){return new e(t).transform(n)},this._liveSpec),this.destroyNodes(),this.fire("specready",this._liveSpec),this._liveSpec)},n.prototype._experimentalSetupAnimationSpeed=function(t){t.settings.initialAnimationSpeed=t.settings.initialAnimationSpeed||t.settings.animationSpeed;var e=t.settings.experimentalShouldAnimate(t)?t.settings.initialAnimationSpeed:0;t.settings.animationSpeed=e;var n=function(t){t.guide=t.guide||{},t.guide.animationSpeed=e,t.units&&t.units.forEach(n)};n(t.unit)},n.prototype._createGPL=function(t){var e=new ze(t,this.getScaleFactory(),an,C),n=e.unfoldStructure();return this.onUnitsStructureExpanded(n),e},n.prototype._scheduleDrawScenario=function(t,e){var n=this,i=Zn.select(this._layout.content),r=e.config.settings.size;t.addTask(function(){return n._renderingPhase="spec"}),e.getDrawScenarioQueue({allocateRect:function(){return{slot:function(t){return i.selectAll(".uid_"+t)},frameId:"root",left:0,top:0,width:r.width,containerWidth:r.width,height:r.height,containerHeight:r.height}}}).forEach(function(e){return t.addTask(e)})},n.prototype._scheduleDrawing=function(t,e){var n=this,i=e.config.settings.size;t.addTask(function(t){n._renderingPhase="draw",n._renderRoot({scenario:t,newSize:i}),n._cancelPointerAnimationFrame(),n._scheduleRenderScenario(t)})},n.prototype._resetProgressLayout=function(){this._createProgressBar(),this._clearRenderingError(),this._clearTimeoutWarning()},n.prototype._renderRoot=function(t){var e=this,n=t.scenario,i=t.newSize,r=Zn.select(this._layout.content),a=n[0].config.uid,o=ti(r,"svg").attr("width",Math.floor(i.width)).attr("height",Math.floor(i.height));o.attr("class")||o.attr("class",Pe+"svg"),this._svg=o.node(),this._initPointerEvents(),this.fire("beforerender",this._svg);var s=o.selectAll("g.frame-root").data([a],function(t){return t});s.enter().append("g").classed(Pe+"cell cell frame-root uid_"+a,!0).merge(s).call(function(t){t.classed("tau-active",!0),rt(t,e.configGPL.settings.animationSpeed,"frameRootToggle").attr("opacity",1)}),s.exit().call(function(t){t.classed("tau-active",!1),rt(t,e.configGPL.settings.animationSpeed,"frameRootToggle").attr("opacity",1e-6).remove()})},n.prototype._scheduleRenderScenario=function(t){var e=this;t.forEach(function(t){e._taskRunner.addTask(function(){t.draw(),e.onUnitDraw(t.node()),e._renderedItems.push(t)})})},n.prototype._completeRendering=function(){he(this._layout.contentContainer),this._layout.rightSidebar.style.maxHeight=this._liveSpec.settings.size.height+"px",this.enablePointerEvents(),this._svg&&this.fire("render",this._svg),he(this._layout.rightSidebarContainer,"vertical")},n.prototype._cancelRendering=function(){this.enablePointerEvents(),this._resetTaskRunner(),this._cancelPointerAnimationFrame()},n.prototype._createProgressBar=function(){var t=Zn.select(this._layout.header),e=ti(t,"div."+Pe+"progress");e.select("div."+Pe+"progress__value").remove();var n=e.append("div").classed(Pe+"progress__value",!0).style("width",0);this._reportProgress=function(t){requestAnimationFrame(function(){e.classed(Pe+"progress_active",t<1),n.style("width",100*t+"%")})}},n.prototype._displayRenderingError=function(t){this._layout.layout.classList.add(Pe+"layout_rendering-error")},n.prototype._clearRenderingError=function(){this._layout.layout.classList.remove(Pe+"layout_rendering-error")},n.prototype.getScaleFactory=function(t){return void 0===t&&(t=null),new ln(un.instance(this._liveSpec.settings),t||this._liveSpec.sources,this._liveSpec.scales)},n.prototype.getScaleInfo=function(t,e){return void 0===e&&(e=null),this.getScaleFactory().createScaleInfoByName(t,e)},n.prototype.getSourceFiltersIterator=function(t){var e=this,n=Gt(Object.keys(this._filtersStore.filters).map(function(t){return e._filtersStore.filters[t]})).filter(function(e){return!t(e)}).map(function(t){return t.predicate});return function(t){return n.reduce(function(e,n){return e&&n(t)},!0)}},n.prototype.getDataSources=function(t){var e=this;void 0===t&&(t={});var n=this._chartDataModel(this._originData);return Object.keys(n).filter(function(t){return"?"!==t}).reduce(function(i,r){var a,o=n[r],s=e.getSourceFiltersIterator((a=r,function(e){return t.excludeFilter&&-1!==t.excludeFilter.indexOf(e.tag)||e.src!==a}));return i[r]={dims:o.dims,data:o.data.filter(s)},i},{"?":n["?"]})},n.prototype.isEmptySources=function(t){return!Object.keys(t).filter(function(t){return"?"!==t}).filter(function(e){return t[e].data.length>0}).length},n.prototype.getChartModelData=function(t,e){return void 0===t&&(t={}),void 0===e&&(e="/"),this.getDataSources(t)[e].data},n.prototype.getDataDims=function(t){return void 0===t&&(t="/"),this._originData[t].dims},n.prototype.getData=function(t){return void 0===t&&(t="/"),this._originData[t].data},n.prototype.setData=function(t,e){void 0===e&&(e="/"),this._originData[e].data=t,this.refresh()},n.prototype.getSVG=function(){return this._svg},n.prototype.addFilter=function(t){t.src=t.src||"/";var e=t.tag,n=this._filtersStore.filters[e]=this._filtersStore.filters[e]||[],i=this._filtersStore.tick++;return t.id=i,n.push(t),i},n.prototype.removeFilter=function(t){var e=this;return Object.keys(this._filtersStore.filters).map(function(n){e._filtersStore.filters[n]=e._filtersStore.filters[n].filter(function(e){return e.id!==t})}),this},n.prototype.refresh=function(){this._target&&this.renderTo(this._target,this._defaultSize)},n.prototype.resize=function(t){void 0===t&&(t={}),this.renderTo(this._target,t)},n.prototype.select=function(t){return this._nodes.filter(t)},n.prototype.traverseSpec=function(t,e){var n=function(t,e,i,r){e(t,i,r),t.frames?t.frames.forEach(function(i){(i.units||[]).map(function(r){return n(r,e,t,i)})}):(t.units||[]).map(function(i){return n(i,e,t,null)})};n(t.unit,e,null,null)},n.prototype.getSpec=function(){return this._liveSpec},n.prototype.getLayout=function(){return this._layout},n.prototype._displayTimeoutWarning=function(t){var e=this,n=t.proceed,i=t.cancel,r=t.timeout,a=Math.round(100/3/1.5),o=function(t){return Math.round(100/3/1.5*t)};this._layout.content.style.height="100%",this._layout.content.insertAdjacentHTML("beforeend",'\n            <div class="'+Pe+'rendering-timeout-warning">\n            <svg\n                viewBox="0 0 200 100">\n                <text\n                    text-anchor="middle"\n                    font-size="'+a+'">\n                    <tspan x="100" y="'+o(1)+'">Rendering took more than '+Math.round(r)/1e3+'s</tspan>\n                    <tspan x="100" y="'+o(2)+'">Would you like to continue?</tspan>\n                </text>\n                <text\n                    class="'+Pe+'rendering-timeout-continue-btn"\n                    text-anchor="end"\n                    font-size="'+a+'"\n                    cursor="pointer"\n                    text-decoration="underline"\n                    x="'+(100-a/3)+'"\n                    y="'+o(3)+'">\n                    Continue\n                </text>\n                <text\n                    class="'+Pe+'rendering-timeout-cancel-btn"\n                    text-anchor="start"\n                    font-size="'+a+'"\n                    cursor="pointer"\n                    text-decoration="underline"\n                    x="'+(100+a/3)+'"\n                    y="'+o(3)+'">\n                    Cancel\n                </text>\n            </svg>\n            </div>\n        '),this._layout.content.querySelector("."+Pe+"rendering-timeout-continue-btn").addEventListener("click",function(){e._clearTimeoutWarning(),n.call(e)}),this._layout.content.querySelector("."+Pe+"rendering-timeout-cancel-btn").addEventListener("click",function(){e._clearTimeoutWarning(),i.call(e)})},n.prototype._clearTimeoutWarning=function(){var t=ei(this._layout.content,"."+Pe+"rendering-timeout-warning");t&&(this._layout.content.removeChild(t),this._layout.content.style.height="")},n}(b),ii={},ri={},ai=function(t){var e="Chart type "+t+" is not supported.";throw console.log(e),console.log("Use one of "+Object.keys(ii).join(", ")+"."),new M(e,k.NOT_SUPPORTED_TYPE_CHART)},oi={validate:function(t,e){return ri.hasOwnProperty(t)||ai(t),ri[t].reduce(function(t,n){return t.concat(n(e)||[])},[])},get:function(t){var e=ii[t];return"function"!=typeof e&&ai(t),e},add:function(t,e,n){return void 0===n&&(n=[]),ii[t]=e,ri[t]=n,oi},getAllRegisteredTypes:function(){return ii}},si=function(t){function e(n){var i=t.call(this,n)||this;return n.autoResize&&e.winAware.push(i),i}return m(e,t),e.prototype.applyConfig=function(e){var n=oi.validate(e.type,e);if(n.length>0)throw new Error(n[0]);var i=oi.get(e.type);(e=Jt(e,{autoResize:!0})).settings=ni.setupSettings(e.settings),e.dimensions=ni.setupMetaInfo(e.dimensions,e.data),t.prototype.applyConfig.call(this,i(e))},e.prototype.destroy=function(){var n=e.winAware.indexOf(this);-1!==n&&e.winAware.splice(n,1),t.prototype.destroy.call(this)},e}(ni);function ui(t){return t}si.winAware=[],si.resizeOnWindowEvent=function(){var t;function e(){t=0;for(var e=0,n=si.winAware.length;e<n;e++)si.winAware[e].resize()}return function(){!t&&si.winAware.length&&(t=window.requestAnimationFrame(e))}}(),window.addEventListener("resize",si.resizeOnWindowEvent);var li=1e-6;function ci(t){return"translate("+(t+.5)+",0)"}function di(t){return"translate(0,"+(t+.5)+")"}var hi={top:1,right:2,bottom:3,left:4};function fi(t){var e=hi[t.scaleGuide.scaleOrient],n=t.scale,i=t.scaleGuide,r=i.label,a=Jt(t,{tickSize:6,tickPadding:3,gridOnly:!1}),o=a.ticksCount,s=a.tickFormat,u=a.tickSize,l=a.tickPadding,c=a.gridOnly,d="linear"===n.scaleType,h="ordinal"===n.scaleType||"period"===n.scaleType,f=e===hi.top||e===hi.bottom,p=e===hi.top||e===hi.left?-1:1,g=f?"x":"y",m=f?"y":"x",y=f?ci:di,v=f?1:-1;return function(t){var a;if(n.ticks){a=n.ticks(o);for(var x=Math.floor(1.25*o);a.length>x&&x>2&&a.length>2;)a=n.ticks(--x)}else a=n.domain();i.hideTicks&&(a=c?a.filter(function(t){return 0==t}):[]);var _,b=null==s?n.tickFormat?n.tickFormat(o):ui:s,w=Math.max(u,0)+l,S=n.range(),T=S[0]+.5,E=S[S.length-1]+.5,M=(n.bandwidth?function(t){var e=Math.max(0,t.bandwidth()-1)/2;return t.round()&&(e=Math.round(e)),function(n){return t(n)+e}}:ui)(n),k=t.selection?t:null,A=k?k.selection():t;function C(t){var n=Ut(i.rotate);if(t.attr("transform",Me(n)),Math.abs(n/90)%2>0){var r=n<180?1:-1,a=f?.5:-2,o=e===hi.top||e===hi.left?-1:1,s=a*(e===hi.top||e===hi.bottom?o<0?0:.71:.32);t.attr("x",9*r).attr("y",0).attr("dx",f?null:s+"em").attr("dy",s+"em")}}function O(t){!function(t,e){var n=e?-10:20,i=e?0:1,r=e?1:-1,a=[];t.each(function(){var t=tt.select(this),e=t.attr("transform").replace("translate(","").replace(" ",",").split(",")[i],n=r*parseFloat(e),o=t.select("text"),s=o.node().getBBox().width/2,u=n-s,l=n+s;a.push({c:n,s:u,e:l,l:0,textRef:o,tickRef:t})});var o,s=a.sort(function(t,e){return t.c-e.c});o=function(t,i,r){var a,o,s,u=t.e>i.s,l=r.s<i.e;if(u||l){i.l=(a=t.l,o={"[T][1]":-1,"[T][-1]":0,"[T][0]":1,"[F][0]":-1},s="["+u.toString().toUpperCase().charAt(0)+"]["+a+"]",o.hasOwnProperty(s)?o[s]:0);var c=i.textRef.size(),d=i.textRef.text();c>1&&(d=d.replace(/([\.]*$)/gi,"")+"...");var h=11*i.l,f=parseFloat(i.textRef.attr("y"))+h,p=e?0:h,g=e?h:0,m=function(t){var e=0;if(!t)return e;var n=t.indexOf("rotate(");if(n>=0){var i=t.indexOf(")",n+7),r=t.substring(n+7,i);e=parseFloat(r.trim())}return e}(i.textRef.attr("transform"));i.textRef.text(function(t,e){return 0===e?d:""}).attr("transform","translate("+p+","+g+") rotate("+m+")");var y={x1:0,x2:0,y1:f+(e?-1:5),y2:n};e||(y.transform="rotate(-90)"),xe(i.tickRef,"line.label-ref").call(ht(y))}else i.tickRef.selectAll("line.label-ref").remove();return i},s.map(function(t,e,n){return o(n[e-1]||{e:-1/0,s:-1/0,l:0},t,n[e+1]||{e:1/0,s:1/0,l:0})})}(t,f)}A.attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",e===hi.right?"start":e===hi.left?"end":"middle"),c||(_=i.hideTicks||i.hide?[]:[null],re(A.selectAll(".domain").data(_)).next(function(t){return t.merge(t.enter().insert("path",".tick").attr("class","domain").attr("stroke","#000"))}).next(function(t){return k?t.transition(k):t}).next(function(t){t.attr("d",e===hi.left||e==hi.right?"M"+p*u+","+T+"H0.5V"+E+"H"+p*u:"M"+T+","+p*u+"V0.5H"+E+"V"+p*u)}));var L,N,F,R,D,j,I=re(A.selectAll(".tick").data(a,function(t){return String(n(t))}).order()).next(function(t){var e=t.exit(),n=t.enter().append("g").attr("class","tick");return{tickExit:e,tickEnter:n,tick:t.merge(n)}}).next(function(t){if(d){var e=n.ticks(),i=n.domain(),r=a.length-1,o=e.length>1&&i[0]*i[1]<0&&-i[0]>(e[1]-e[0])/2&&i[1]>(e[r]-e[r-1])/2;t.tick.classed("zero-tick",function(t){return 0==t&&o})}return t}).result();re(I).next(function(t){var e=t.tickEnter,n=t.tickExit,i=t.tick;return k?(e.attr("opacity",li).attr("transform",function(t){var e=M(t);return y(e)}),{tick:i.transition(k),tickExit:n.transition(k).attr("opacity",li).attr("transform",function(t){var e=M(t);return isFinite(e)?y(e):this.getAttribute("transform")})}):{tick:i,tickExit:n}}).next(function(t){var e=t.tick;t.tickExit.remove(),e.attr("opacity",1).attr("transform",function(t){return y(M(t))})}),L=p*u,N=h?function(t){return v*n.stepSize(t)/2}:null,re(I).next(function(t){var e=t.tick,n=t.tickEnter,i=e.select("line"),r=n.append("line").attr("stroke","#000").attr(m+"2",L);return h&&r.attr(g+"1",N).attr(g+"2",N),i.merge(r)}).next(function(t){return k?t.transition(k):t}).next(function(t){t.attr(m+"2",L),h&&t.attr(g+"1",N).attr(g+"2",N)}),h&&c&&h&&a&&a.length&&re(A.selectAll(".extra-tick-line").data([null])).next(function(t){return t.merge(t.enter().insert("line",".tick").attr("class","extra-tick-line").attr("stroke","#000"))}).next(function(t){return k?t.transition(k):t}).next(function(t){t.attr(g+"1",T).attr(g+"2",T).attr(m+"1",0).attr(m+"2",p*u)}),c||(F=I,R=i.textAnchor,D=p*w,j=e===hi.top?"0em":e===hi.bottom?"0.71em":"0.32em",re(F).next(function(t){var e=t.tick,n=t.tickEnter,i=e.select("text"),r=n.append("text").attr("fill","#000").attr(m,D).attr("dy",j);return C(r),i.merge(r)}).next(function(t){var e,r;return t.text(b).attr("text-anchor",R),e=t,r=function(t){return Math.max(n.stepSize(t),i.tickFormatWordWrapLimit)},i.tickFormatWordWrap?it(e,r,i.tickFormatWordWrapLines,i.tickFontHeight,!f):nt(e,r),f&&"time"===n.scaleType&&function(t){if(!(a.length<2)){var e=0,n=-1,i=t.nodes();i.forEach(function(t,i){var r=t.textContent||"",a=r.length;a>e&&(e=a,n=i)});var r=M(a[1])-M(a[0]),o=!1;if(n>=0){var s=i[n].getBoundingClientRect();o=r-s.width<8}A.classed(Pe+"time-axis-overflow",o)}}(t),!f||"time"!==n.scaleType&&"linear"!==n.scaleType||function(t){if(0!==a.length){for(var e=a[0],n=a[a.length-1],i=A.node();i&&"svg"!==i.tagName;)i=i.parentNode;var r=i.getBoundingClientRect(),o=A.append("line").attr("x1",M(e)).attr("x2",M(e)).attr("y1",0).attr("y2",1),s=A.append("line").attr("x1",M(n)).attr("x2",M(n)).attr("y1",0).attr("y2",1),u={left:o.node().getBoundingClientRect().left-r.left,right:r.right-s.node().getBoundingClientRect().right};o.remove(),s.remove();var l=function(t,e,n){var i=t.getBoundingClientRect(),r=e>0?"right":"left",a=(M(n),u[r]),o=Math.ceil(i.width/2-a+1);t.setAttribute("dx",String(o>0?-e*o:0))},c=t.filter(function(t){return t===e}).node(),d=t.filter(function(t){return t===n}).node();t.attr("dx",null),l(c,-1,e),l(d,1,n)}}(t),t}).next(function(t){return k?t.transition(k):t}).next(function(t){t.attr(m,D),C(t),h&&i.avoidCollisions&&(k?k.on("end.fixTickTextCollision",function(){return O(F.tick)}):O(F.tick))}),r.hide||function(){var t=r,e=xe(A,"text.label").attr("class",Se("label",t.cssClass)).attr("transform",Me(t.rotate)).attr("text-anchor",t.textAnchor);re(e).next(function(t){return k?t.transition(k):t}).next(function(e){var n=v*t.padding,i=Math.abs(E-T),r=v*i*.5;"left"!==t.dock&&"right"!==t.dock||(r="left"===t.dock?f?0:-i:f?i:0),e.attr("x",r).attr("y",n)});for(var n=t.text.split("  "),i=n.length-1;i>0;i--)n.splice(i,0,"  ");e.selectAll("tspan").data(n).enter().append("tspan").attr("class",function(t,e){return e%2?"label-token-delimiter label-token-delimiter-"+e:"label-token label-token-"+e}).text(function(t){return t}).exit().remove()}())}}function pi(t){return fi({scale:t.scale,scaleGuide:t.scaleGuide,ticksCount:t.ticksCount,tickSize:t.tickSize,gridOnly:!0})}var gi=xe,mi=function(t){var e=t<=20?1:.75;return Math.max(2,Math.round(t*e))},yi=function(t){function e(e){var n=t.call(this,e)||this;n.config=e,n.config.guide=Jt(n.config.guide||{},{showGridLines:"xy",padding:{l:50,r:0,t:0,b:50}}),n.config.guide.x=n.config.guide.x||{},n.config.guide.x=Jt(n.config.guide.x,{cssClass:"x axis",textAnchor:"middle",padding:10,hide:!1,scaleOrient:"bottom",rotate:0,density:20,label:{},tickFormatWordWrapLimit:100}),"string"==typeof n.config.guide.x.label&&(n.config.guide.x.label={text:n.config.guide.x.label}),n.config.guide.x.label=Jt(n.config.guide.x.label,{text:"X",rotate:0,padding:40,textAnchor:"middle"}),n.config.guide.y=n.config.guide.y||{},n.config.guide.y=Jt(n.config.guide.y,{cssClass:"y axis",textAnchor:"start",padding:10,hide:!1,scaleOrient:"left",rotate:0,density:20,label:{},tickFormatWordWrapLimit:100}),"string"==typeof n.config.guide.y.label&&(n.config.guide.y.label={text:n.config.guide.y.label}),n.config.guide.y.label=Jt(n.config.guide.y.label,{text:"Y",rotate:-90,padding:20,textAnchor:"middle"});var i=n.config,r=i.guide;if("extract-axes"===r.autoLayout){var a=i.options.containerHeight-(i.options.top+i.options.height);r.x.hide=r.x.hide||Math.floor(a)>0,r.y.hide=r.y.hide||Math.floor(i.options.left)>0}var o=n.config.options,s=n.config.guide.padding;return n.L=o.left+s.l,n.T=o.top+s.t,n.W=o.width-(s.l+s.r),n.H=o.height-(s.t+s.b),n}return m(e,t),e.prototype.defineGrammarModel=function(t){var e=this.W,n=this.H;return this.xScale=t("pos",this.config.x,[0,e]),this.yScale=t("pos",this.config.y,function(t){return["ordinal","period"].indexOf(t.type)>=0?[0,n]:[n,0]}),this.regScale("x",this.xScale).regScale("y",this.yScale),{scaleX:this.xScale,scaleY:this.yScale,xi:function(){return e/2},yi:function(){return n/2},sizeX:function(){return e},sizeY:function(){return n}}},e.prototype.getGrammarRules=function(){return[function(t){var e=t.scaleX,n=t.scaleY;return{xi:function(n){return n?e(n[e.dim]):t.xi(n)},yi:function(e){return e?n(e[n.dim]):t.yi(e)},sizeX:function(n){return n?e.stepSize(n[e.dim]):t.sizeX(n)},sizeY:function(e){return e?n.stepSize(e[n.dim]):t.sizeY(e)}}}]},e.prototype.createScreenModel=function(t){return t},e.prototype.allocateRect=function(t){var e=this,n=this.screenModel;return{slot:function(t){return e.config.options.container.selectAll(".uid_"+t)},left:n.xi(t)-n.sizeX(t)/2,top:n.yi(t)-n.sizeY(t)/2,width:n.sizeX(t),height:n.sizeY(t),containerWidth:this.W,containerHeight:this.H}},e.prototype.drawFrames=function(t){var e=Object.assign({},this.config),n=e.options,i=this.W,r=this.H;if(e.x=this.xScale,e.y=this.yScale,e.x.scaleObj=this.xScale,e.y.scaleObj=this.yScale,e.x.guide=e.guide.x,e.y.guide=e.guide.y,e.x.guide.label.size=i,e.y.guide.label.size=r,(n.container.attr("transform")?rt(n.container,this.config.guide.animationSpeed,"cartesianContainerTransform"):n.container).attr("transform",Ee(this.L,this.T)),e.x.guide.hide)this._removeDimAxis(n.container,e.x);else{var a="top"===e.x.guide.scaleOrient?[0,0-e.guide.x.padding]:[0,r+e.guide.x.padding];this._drawDimAxis(n.container,e.x,a,i)}if(e.y.guide.hide)this._removeDimAxis(n.container,e.y);else{var o="right"===e.y.guide.scaleOrient?[i+e.guide.y.padding,0]:[0-e.guide.y.padding,0];this._drawDimAxis(n.container,e.y,o,r)}var s=t.reduce(function(t,e){return t.concat((e.units||[]).map(function(t){return t.uid}))},[]),u=this._drawGrid(n.container,e,i,r,n),l=ct(u,".cell").data(s,function(t){return t});l.enter().append("g").attr("class",function(t){return Pe+"cell cell uid_"+t}).merge(l).classed("tau-active",!0),rt(l,this.config.guide.animationSpeed).attr("opacity",1),rt(l.exit().classed("tau-active",!1),this.config.guide.animationSpeed).attr("opacity",1e-6).remove()},e.prototype._drawDimAxis=function(t,e,n,i){var r=Tn.get(e.guide.tickFormat,e.guide.tickFormatNullAlias),a=fi({scale:e.scaleObj,scaleGuide:e.guide,ticksCount:r?mi(i/e.guide.density):null,tickFormat:r||null}),o=this.config.guide.animationSpeed;gi(t,this._getAxisSelector(e)).classed("tau-active",!0).classed(e.guide.cssClass,!0).call(function(t){var e=rt(t,o,"axisTransition"),i=t.attr("transform");Ee.apply(Le,n)!==i&&(i?e:t).attr("transform",Ee.apply(Le,n)),e.call(a),e.attr("opacity",1)})},e.prototype._removeDimAxis=function(t,e){var n=ct(t,this._getAxisSelector(e)).classed("tau-active",!1);rt(n,this.config.guide.animationSpeed,"axisTransition").attr("opacity",1e-6).remove()},e.prototype._getAxisSelector=function(t){return"g."+("h"===ke(t.guide.scaleOrient)?"x":"y")+".axis"},e.prototype._drawGrid=function(t,e,n,i){var r=this;return gi(t,"g.grid").attr("transform",Ee(0,0)).call(function(t){var a=t,o=r.config.guide.animationSpeed,s=(e.guide.showGridLines||"").toLowerCase();if(s.length>0){var u=gi(a,"g.grid-lines");if(s.indexOf("x")>-1){var l=e.x,c=Tn.get(l.guide.tickFormat),d=pi({scale:l.scaleObj,scaleGuide:l.guide,tickSize:i,ticksCount:c?mi(n/l.guide.density):null}),h=gi(u,"g.grid-lines-x");rt(h,o).call(d)}if(s.indexOf("y")>-1){var f=e.y,p=(c=Tn.get(f.guide.tickFormat),pi({scale:f.scaleObj,scaleGuide:f.guide,tickSize:-n,ticksCount:c?mi(i/f.guide.density):null})),g=gi(u,"g.grid-lines-y");rt(g,o).call(p)}}})},e}(w),vi=y({},o,s,t),xi=function(e){function n(t){var n=e.call(this,t)||this;n.config=t,n.config.guide=Jt(n.config.guide||{},{padding:{l:50,r:50,t:50,b:50},enableBrushing:!1}),n.columnsBrushes={},n.columnsSelections={},n.on("force-brush",function(t,e){return n._forceBrushing(e)});var i=n.config.options,r=n.config.guide.padding;return n.L=i.left+r.l,n.T=i.top+r.t,n.W=i.width-(r.l+r.r),n.H=i.height-(r.t+r.b),n}return m(n,e),n.prototype.defineGrammarModel=function(t){var e=this.config,n=this.W,i=this.H;this.columnsScalesMap=e.columns.reduce(function(e,n){return e[n]=t("pos",n,[0,i]),e},{});var r=n/(e.columns.length-1),a=e.columns.reduce(function(t,e,n){return t[e]=n*r,t},{});return this.xBase=function(t){return a[t]},this.regScale("columns",this.columnsScalesMap),{}},n.prototype.allocateRect=function(){var t=this;return{slot:function(e){return t.config.options.container.selectAll(".uid_"+e)},left:0,top:0,width:this.W,height:this.H,containerWidth:this.W,containerHeight:this.H}},n.prototype.drawFrames=function(t){var e=this,n=Object.assign({},this.config),i=n.options,r=this._fnDrawGrid(i.container,n,i.frameId,Object.keys(this.columnsScalesMap).reduce(function(t,n){return t.concat([e.columnsScalesMap[n].getHash()])},[]).join("_")),a=r.selectAll(".parent-frame-"+i.frameId).data(t,function(t){return t.hash()});a.exit().remove(),a.enter().append("g").attr("class",function(t){return Pe+"cell cell parent-frame-"+i.frameId+" frame-"+t.hash()}).merge(a).each(function(t){var e,n,r,a;e=i.frameId,n=vi.select(this),r=t,(a=n.selectAll(".layer_"+e).data(r.units,function(t){return t.uid})).exit().remove(),a.enter().append("g").attr("class",function(t){return"layer_"+e+" uid_"+t.uid})});var o=this._fnDrawColumns(r,n);n.guide.enableBrushing&&this._enableBrushing(o)},n.prototype._fnDrawGrid=function(t,e,n,i){var r=t.selectAll(".grid_"+n).data([i],function(t){return t});return r.exit().remove(),r.enter().append("g").attr("class","grid grid_"+n).attr("transform",Ee(this.L,this.T)).merge(r)},n.prototype._fnDrawColumns=function(t,e){var n=e.guide.columns||{},i=this.xBase,r=this.columnsScalesMap,a=vi.axisLeft(),o=t.selectAll(".column").data(e.columns,function(t){return t});return o.exit().remove(),o.enter().append("g").attr("class","column").attr("transform",function(t){return Ee(i(t),0)}).call(function(t){t.append("g").attr("class","y axis").each(function(t){var e=r[t].dim,i=a.scale(r[t]),o=n[e]||{},s=Tn.get(o.tickFormat,o.tickFormatNullAlias);null!==s&&i.tickFormat(s),vi.select(this).call(i)}).append("text").attr("class","label").attr("text-anchor","middle").attr("y",-9).text(function(t){return((n[t]||{}).label||{}).text||r[t].dim})}).merge(o)},n.prototype._enableBrushing=function(e){var n=this,i=this.columnsSelections,r=this.columnsScalesMap,a=this.columnsBrushes,o=!0,s=function(t){return t},u=function(t){return t},l=function(){var e=Object.keys(a).find(function(e){return a[e]===t.event.target});if(i[e]=t.event.selection,o){var s=Object.keys(a).filter(function(t){return i[t]}).map(function(t){var e=[];if(r[t].discrete){var n=i[t];e=r[t].domain().filter(function(e){var i=r[t](e);return n[0]<=i&&n[1]>=i})}else{var a=i[t].map(r[t].invert);e=[a[0],a[1]]}return{dim:r[t].dim,func:r[t].discrete?"inset":"between",args:e}});n.fire("brush",s)}};return e.selectAll(".brush").remove(),e.append("g").attr("class","brush").each(function(t){var e=r[t].range();a[t]=vi.brushY().extent([[0,e[0]],[16,e[1]]]).on("start",s).on("brush",l).on("end",u),vi.select(this).classed("brush-"+Dt(t),!0).call(a[t]),o=!1,a[t].move(vi.select(this),e),o=!0}).selectAll("rect").attr("transform","translate(-8,0)").attr("width",16),e},n.prototype._forceBrushing=function(t){void 0===t&&(t={});var e=this.columnsBrushes,n=this.columnsScalesMap;Object.keys(t).filter(function(i){return e[i]&&n[i]&&t[i]}).forEach(function(i){var r=t[i],a=[];if(n[i].discrete){var o=r.map(n[i]).filter(function(t){return t>=0}),s=n[i].stepSize()/2;a=[Math.min.apply(Math,o)-s,Math.max.apply(Math,o)+s]}else a=[r[0],r[1]];var u=Dt(i);e[i](vi.select(".brush-"+u)),e[i].move(vi.select(".brush-"+u),a.map(n[i]))})},n}(w),_i=function(){var t,e=[],n=[],i=1,r=1,a={},o=!1,s=function(t){var i=e.length,r=0,a=e[t].x-n[t].x,o=n[t].y-e[t].y,s=Math.sqrt(a*a+o*o);s>0&&(r+=.2*s),o/=s,r+=(a/=s)>0&&o>0?0:a<0&&o>0?3:a<0&&o<0?6:9;for(var u,l,d,h,f=e[t].x,p=e[t].y-e[t].height+2,g=e[t].x+e[t].width,m=e[t].y+2,y=0;y<i;y++)y!=t&&(c(n[t].x,e[t].x,n[y].x,e[y].x,n[t].y,e[t].y,n[y].y,e[y].y)&&(r+=1),u=e[y].x,d=e[y].y-e[y].height+2,l=e[y].x+e[y].width,h=e[y].y+2,r+=30*(Math.max(0,Math.min(l,g)-Math.max(u,f))*Math.max(0,Math.min(h,m)-Math.max(d,p)))),u=n[y].x-n[y].r,d=n[y].y-n[y].r,l=n[y].x+n[y].r,h=n[y].y+n[y].r,r+=30*(Math.max(0,Math.min(l,g)-Math.max(u,f))*Math.max(0,Math.min(h,m)-Math.max(d,p)));return r},u=function(a){var u,l=Math.floor(Math.random()*e.length),c=e[l].x,d=e[l].y;u=o?t(l,e,n):s(l),e[l].x+=5*(Math.random()-.5),e[l].y+=5*(Math.random()-.5),e[l].x>i&&(e[l].x=c),e[l].x<0&&(e[l].x=c),e[l].y>r&&(e[l].y=d),e[l].y<0&&(e[l].y=d);var h=(o?t(l,e,n):s(l))-u;Math.random()<Math.exp(-h/a)||(e[l].x=c,e[l].y=d)},l=function(a){var u,l=Math.floor(Math.random()*e.length),c=e[l].x,d=e[l].y;u=o?t(l,e,n):s(l);var h=.5*(Math.random()-.5),f=Math.sin(h),p=Math.cos(h);e[l].x-=n[l].x,e[l].y-=n[l].y;var g=e[l].x*p-e[l].y*f,m=e[l].x*f+e[l].y*p;e[l].x=g+n[l].x,e[l].y=m+n[l].y,e[l].x>i&&(e[l].x=c),e[l].x<0&&(e[l].x=c),e[l].y>r&&(e[l].y=d),e[l].y<0&&(e[l].y=d);var y=(o?t(l,e,n):s(l))-u;Math.random()<Math.exp(-y/a)||(e[l].x=c,e[l].y=d)},c=function(t,e,n,i,r,a,o,s){var u,l,c;return l=((e-t)*(r-o)-(a-r)*(t-n))/(c=(s-o)*(e-t)-(i-n)*(a-r)),!((u=((i-n)*(r-o)-(s-o)*(t-n))/c)<0||u>1||l<0||l>1)},d=function(t,e,n){return t-e/n};return a.start=function(t){for(var n=e.length,i=1,r=0;r<t;r++){for(var a=0;a<n;a++)Math.random()<.5?u(i):l(i);i=d(i,1,t)}},a.width=function(t){return arguments.length?(i=t,a):i},a.height=function(t){return arguments.length?(r=t,a):r},a.label=function(t){return arguments.length?(e=t,a):e},a.anchor=function(t){return arguments.length?(n=t,a):n},a.alt_energy=function(e){return arguments.length?(t=e,o=!0,a):s},a.alt_schedule=function(){return arguments.length?a:d},a},bi=y({},e,u,l,t),wi=["land","continents","georegions","countries","regions","subunits","states","counties"],Si=function(e){function n(t){var n=e.call(this,t)||this;return n.config=t,n.config.guide=Jt(n.config.guide||{},{defaultFill:"rgba(128,128,128,0.25)",padding:{l:0,r:0,t:0,b:0},showNames:!0}),n.contourToFill=null,n.on("highlight-area",function(t,e){return n._highlightArea(e)}),n.on("highlight-point",function(t,e){return n._highlightPoint(e)}),n.on("highlight",function(t,e){return n._highlightPoint(e)}),n}return m(n,e),n.prototype.defineGrammarModel=function(t){var e=this.config,n=e.options,i=e.guide.padding,r=n.width-(i.l+i.r),a=n.height-(i.t+i.b);return this.latScale=t("pos",e.latitude,[0,a]),this.lonScale=t("pos",e.longitude,[r,0]),this.sizeScale=t("size",e.size),this.colorScale=t("color",e.color),this.codeScale=t("value",e.code),this.fillScale=t("fill",e.fill),this.W=r,this.H=a,this.regScale("latitude",this.latScale).regScale("longitude",this.lonScale).regScale("size",this.sizeScale).regScale("color",this.colorScale).regScale("code",this.codeScale).regScale("fill",this.fillScale),{}},n.prototype.drawFrames=function(t){var e=this,n=this.config.guide;"string"==typeof n.sourcemap?bi.json(n.sourcemap,function(n,i){if(n)throw n;e._drawMap(t,i)}):this._drawMap(t,n.sourcemap)},n.prototype._calcLabels=function(t,e,n){var i=this.W,r=this.H,a={};return e.forEach(function(e){var o=(c.feature(t,t.objects[e]).features||[]).map(function(t){var r=t.properties||{},a=n.centroid(t),o=n.bounds(t),s=a[0],u=a[1],l=o[1][0]-o[0][0],c=r.name||"",d=r.abbr||c,h=l<5.5*c.length?d:c,f=l<13.75,p=f?i-s-16.5:0;return{id:e+"-"+t.id,sx:s,sy:u,x:s+p,y:u,width:5.5*h.length,height:10,name:h,r:p,isRef:f}}).filter(function(t){return!Number.isNaN(t.x)&&!Number.isNaN(t.y)}),s=o.map(function(t){return{x:t.sx,y:t.sy,r:t.r}});_i().label(o).anchor(s).width(i).height(r).start(10),o.filter(function(t){return!t.isRef}).map(function(t){return t.x=t.sx,t.y=t.sy,t}).reduce(function(t,e){return t[e.id]=e,t},a);var u=o.filter(function(t){return t.isRef});u.length<6&&u.reduce(function(t,e){return t[e.id]=e,t},a)}),a},n.prototype._drawMap=function(e,n){var i,r,a=this,o=this,s=this.config.guide,u=this.config.options,l=this.config.options.container,d=this.latScale,h=this.lonScale,f=this.sizeScale,p=this.colorScale,g=this.codeScale,m=this.fillScale,y=this.W,v=this.H,x=wi.filter(function(t){return(n.objects||{}).hasOwnProperty(t)});if(0===x.length)throw new Error("Invalid map: should contain some contours");if(m.dim){if(!g.georole)throw console.log("Specify [georole] for code scale"),new Error("[georole] is missing");if(-1===x.indexOf(g.georole))throw console.log('There is no contour for georole "'+g.georole+'"'),console.log("Available contours are: "+x.join(" | ")),new Error("Invalid [georole]");i=g.georole}else i=x[x.length-1];if(this.contourToFill=i,d.dim&&h.dim){var _=bi.extent(d.domain()),b=bi.extent(h.domain());r=[(b[1]+b[0])/2,(_[1]+_[0])/2]}var w=this._createProjection(n,x[0],r),S=bi.geoPath().projection(w),T=l.selectAll(".map-container").data([""+y+v+r+x.join("-")],function(t){return t});T.exit().remove();var E=T.enter().append("g").call(function(t){var e=t;e.attr("class","map-container");var i={},r=x.reduceRight(function(t,e){return t.concat(e)},[]);if(s.showNames&&(i=o._calcLabels(n,r,S)),r.forEach(function(t,r){var a=function(e){return i[t+"-"+e.id]};e.selectAll(".map-contour-"+t).data(c.feature(n,n.objects[t]).features||[]).enter().append("g").call(function(e){var n=e;n.attr("class","map-contour-"+t+" map-contour-level map-contour-level-"+r).attr("fill","none"),n.append("title").text(function(t){return(t.properties||{}).name}),n.append("path").attr("d",S),n.append("text").attr("class","place-label-"+t).attr("transform",function(t){var e=a(t);return e?"translate("+[e.x,e.y]+")":""}).text(function(t){var e=a(t);return e?e.name:""}),n.append("line").attr("class","place-label-link-"+t).attr("stroke","gray").attr("stroke-width",.25).attr("x1",function(t){var e=a(t);return e&&e.isRef?e.sx:0}).attr("y1",function(t){var e=a(t);return e&&e.isRef?e.sy:0}).attr("x2",function(t){var e=a(t);return e&&e.isRef?e.x-.6*e.name.length*5.5:0}).attr("y2",function(t){var e=a(t);return e&&e.isRef?e.y-3.5:0})})}),n.objects.hasOwnProperty("places")){var a=c.feature(n,n.objects.places),u=a.features.map(function(t){var e=w(t.geometry.coordinates);return{x:e[0]+3.5,y:e[1]+3.5,width:5.5*t.properties.name.length,height:12,name:t.properties.name}}),l=a.features.map(function(t){var e=w(t.geometry.coordinates);return{x:e[0],y:e[1],r:2.5}});_i().label(u).anchor(l).width(y).height(v).start(100),e.selectAll(".place").data(l).enter().append("circle").attr("class","place").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).attr("r",function(t){return t.r+"px"}),e.selectAll(".place-label").data(u).enter().append("text").attr("class","place-label").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).text(function(t){return t.name})}}).merge(T);this.groupByCode=e.reduce(function(t,e){return e.part().reduce(function(t,e){return t[(e[g.dim]||"").toLowerCase()]=e,t},t)},{});var M=this._resolveFeature.bind(this);if(E.selectAll(".map-contour-"+i).data(c.feature(n,n.objects[i]).features).call(function(t){t.classed("map-contour",!0).attr("fill",function(t){var e=M(t);return null===e?s.defaultFill:m(e[m.dim])})}).on("mouseover",function(e){return a.fire("area-mouseover",{data:M(e),event:t.event})}).on("mouseout",function(e){return a.fire("area-mouseout",{data:M(e),event:t.event})}).on("click",function(e){return a.fire("area-click",{data:M(e),event:t.event})}),!d.dim||!h.dim)return[];var k=function(e){return e.attr("r",function(t){return f(t[f.dim])}).attr("transform",function(t){var e=t.data;return"translate("+w([e[h.dim],e[d.dim]])+")"}).attr("class",function(t){var e=t.data;return p(e[p.dim])}).attr("opacity",.5).on("mouseover",function(e){var n=e.data;return o.fire("point-mouseover",{data:n,event:t.event})}).on("mouseout",function(e){var n=e.data;return o.fire("point-mouseout",{data:n,event:t.event})}).on("click",function(e){var n=e.data;return o.fire("point-click",{data:n,event:t.event})})},A=E.selectAll(".frame").data(e.map(function(t){return{tags:t.key||{},hash:t.hash(),data:t.part()}}),function(t){return t.hash});return A.exit().remove(),A.enter().append("g").merge(A).call(function(t){t.attr("class",function(t){return"frame frame-"+t.hash}).call(function(t){var e=t.selectAll("circle").data(function(t){return t.data.map(function(t){return{data:t,uid:u.uid}})});e.exit().remove(),e.call(k),e.enter().append("circle").call(k)})}),[]},n.prototype._resolveFeature=function(t){var e,n=this.groupByCode,i=t.properties,r=["c1","c2","c3","abbr","name"].filter(function(t){return i.hasOwnProperty(t)&&i[t]&&n.hasOwnProperty(i[t].toLowerCase())});if(0===r.length)e=null;else if(r.length>0){var a=i[r[0]].toLowerCase();e=n[a]}return e},n.prototype._highlightArea=function(t){var e=this,n=this.config.options.container,i=this.contourToFill;n.selectAll(".map-contour-"+i).classed("map-contour-highlighted",function(n){return t(e._resolveFeature(n))})},n.prototype._highlightPoint=function(t){this.config.options.container.selectAll("circle").classed("map-point-highlighted",function(e){var n=e.data;return t(n)}).attr("opacity",function(e){var n=e.data;return t(n)?.5:.1})},n.prototype._createProjection=function(t,e,n){var i=this.W,r=this.H,a=this.config.guide,o=100,s=[i/2,r/2],u=n||t.center,l=a.projection||t.projection||"mercator",d=this._createD3Projection(l,u,o,s),h=bi.geoPath().projection(d).bounds(c.feature(t,t.objects[e])),f=o*i/(h[1][0]-h[0][0]),p=o*r/(h[1][1]-h[0][1]);return o=f<p?f:p,s=[i-(h[0][0]+h[1][0])/2,r-(h[0][1]+h[1][1])/2],this._createD3Projection(l,u,o,s)},n.prototype._createD3Projection=function(t,e,n,i){var r="geo"+t.substring(0,1).toUpperCase()+t.substring(1),a=bi[r];if(!a)throw console.log('Unknown projection "'+t+'"'),console.log("See available projection types here: https://github.com/mbostock/d3/wiki/Geo-Projections"),new Error('Invalid map: unknown projection "'+t+'"');var o=a();return[{method:"scale",args:n},{method:"center",args:e},{method:"translate",args:i}].filter(function(t){return t.args}).reduce(function(t,e){return t[e.method]&&(t=t[e.method](e.args)),t},o)},n}(w),Ti=function(t){return function(){return t}},Ei=function(){function t(t){this.model=t.model,this.x=t.x||Ti(0),this.y=t.y||Ti(0),this.dx=t.dx||Ti(0),this.dy=t.dy||Ti(0),this.w=t.w||Ti(0),this.h=t.h||Ti(0),this.hide=t.hide||Ti(!1),this.label=t.label||Ti(""),this.color=t.color||Ti(""),this.angle=t.angle||Ti(0)}return t.seed=function(e,n){var i=n.fontColor,r=n.flip,a=n.formatter,o=n.labelRectSize,s=n.paddingKoeff,u=void 0===s?.5:s,l=r?e.yi:e.xi,c=r?e.xi:e.yi,d=function(t){return a(e.label(t))};return new t({model:e,x:function(t){return l(t)},y:function(t){return c(t)},dy:function(t){return o(d(t)).height*u},w:function(t){return o(d(t)).width},h:function(t){return o(d(t)).height},label:d,color:function(){return i},angle:function(){return 0}})},t.compose=function(e,n){return void 0===n&&(n={}),Object.keys(n).reduce(function(t,e){return t[e]=n[e],t},new t(e))},t}(),Mi={},ki=function(){function t(){}return t.regRule=function(t,e){return Mi[t]=e,this},t.getRule=function(t){return Mi[t]},t}(),Ai=function(t,e,n){return n<e?Math.max(1,Math.floor(n*t.length/e))-1:t.length},Ci=function(t,e){return 0===e?"":t.slice(0,e).replace(/\.+$/g,"")+""},Oi=function(t,e){return t.discrete||!t.discrete&&e[t.dim]>=0},Li=function(t,e){return!t.discrete&&e[t.dim]<0},Ni=function(t,e){return t.w(e)/2+Math.floor(t.model.size(e)/5)},Fi=function(t,e){return t.h(e)/2+Math.floor(t.model.size(e)/5)},Ri=function(t){return function(e){return{dx:function(n){var i=e.model.scaleY;if("+"===t[2]&&!Oi(i,n))return e.dx(n);if("-"===t[2]&&!Li(i,n))return e.dx(n);var r=t[1],a=t[0]===t[0].toUpperCase()?1:0;return e.dx(n)+r*a*e.model.size(n)/2+r*Ni(e,n)}}}},Di=function(t){return function(e){return{dy:function(n){var i=e.model.scaleY;if("+"===t[2]&&!Oi(i,n))return e.dy(n);if("-"===t[2]&&!Li(i,n))return e.dy(n);var r=t[1],a=t[0]===t[0].toUpperCase()?1:0;return e.dy(n)+r*a*e.model.size(n)/2+r*Fi(e,n)}}}};ki.regRule("l",Ri(["l",-1,null])).regRule("L",Ri(["L",-1,null])).regRule("l+",Ri(["l",-1,"+"])).regRule("l-",Ri(["l",-1,"-"])).regRule("L+",Ri(["L",-1,"+"])).regRule("L-",Ri(["L",-1,"-"])).regRule("r",Ri(["r",1,null])).regRule("R",Ri(["R",1,null])).regRule("r+",Ri(["r",1,"+"])).regRule("r-",Ri(["r",1,"-"])).regRule("R+",Ri(["R",1,"+"])).regRule("R-",Ri(["R",1,"-"])).regRule("t",Di(["t",-1,null])).regRule("T",Di(["T",-1,null])).regRule("t+",Di(["t",-1,"+"])).regRule("t-",Di(["t",-1,"-"])).regRule("T+",Di(["T",-1,"+"])).regRule("T-",Di(["T",-1,"-"])).regRule("b",Di(["b",1,null])).regRule("B",Di(["B",1,null])).regRule("b+",Di(["b",1,"+"])).regRule("b-",Di(["b",1,"-"])).regRule("B+",Di(["B",1,"+"])).regRule("B-",Di(["B",1,"-"])).regRule("rotate-on-size-overflow",function(t,e){var n=e.data,i={};if(n.reduce(function(e,n){return e+(i=n,t.model.size(i)<t.w(i)?1:0);var i},0)/n.length>.5){i={angle:function(){return-90},w:function(e){return t.h(e)},h:function(e){return t.w(e)},dx:function(e){return.5*t.h(e)-2},dy:function(){return 0}}}return i}).regRule("hide-by-label-height-vertical",function(t){return{hide:function(e){var n,i;return 0===t.angle(e)?(i=t.h(e),n=Math.abs(t.model.y0(e)-t.model.yi(e))):(i=t.w(e),n=t.model.size(e)),i>n||t.hide(e)}}}).regRule("cut-label-vertical",function(t){return{h:function(e){var n=t.h(e);if(Math.abs(t.angle(e))>0){var i=t.label(e),r=Math.abs(t.model.y0(e)-t.model.yi(e));return Ai(i,n,r)<i.length?r:n}return n},w:function(e){var n=t.w(e);if(0===t.angle(e)){var i=t.label(e),r=t.model.size(e);return Ai(i,n,r)<i.length?r:n}return n},label:function(e){var n,i;0===t.angle(e)?(n=t.w(e),i=t.model.size(e)):(n=t.h(e),i=Math.abs(t.model.y0(e)-t.model.yi(e)));var r=t.label(e),a=Ai(r,n,i);return a<r.length?Ci(r,a):r},dy:function(e){var n=t.dy(e);if(0!==t.angle(e)){var i=t.h(e),r=Math.abs(t.model.y0(e)-t.model.yi(e)),a=t.label(e);return Ai(a,i,r)<a.length?r*n/i:n}return n}}}).regRule("cut-outer-label-vertical",function(t){return{h:function(e,n){var i=t.h(e);if(Math.abs(t.angle(e))>0){var r=t.label(e),a=t.model.y0(e)<t.model.yi(e)?n.maxHeight-t.model.yi(e):t.model.yi(e);return Ai(r,i,a)<r.length?a:i}return i},w:function(e){var n=t.w(e);if(0===t.angle(e)){var i=t.label(e),r=t.model.size(e);return Ai(i,n,r)<i.length?r:n}return n},label:function(e,n){var i,r;0===t.angle(e)?(i=t.w(e),r=t.model.size(e)):(i=t.h(e),r=t.model.y0(e)<t.model.yi(e)?n.maxHeight-t.model.yi(e):t.model.yi(e));var a=t.label(e),o=Ai(a,i,r);return o<a.length?Ci(a,o):a},dy:function(e,n){var i=t.dy(e);if(0!==t.angle(e)){var r=t.h(e),a=t.model.y0(e)<t.model.yi(e)?n.maxHeight-t.model.yi(e):t.model.yi(e),o=t.label(e);return Ai(o,r,a)<o.length?a*i/r:i}return i}}}).regRule("from-beginning",function(t){var e=function(e){return t.model.y0(e)};return t.model.flip?{x:e}:{y:e}}).regRule("to-end",function(t){var e=function(e){return t.model.yi(e)};return t.model.flip?{x:e}:{y:e}}).regRule("towards",function(t){var e=t.model.flip?Ni:Fi,n=function(n){return r=n,((i=t).model.yi(r)-i.model.y0(r)>=0?1:-1)*e(t,n);var i,r};return t.model.flip?{dx:n}:{dy:n}}).regRule("inside-start-then-outside-end-horizontal",function(t,e){var n=[ki.getRule("from-beginning"),ki.getRule("towards"),ki.getRule("cut-label-horizontal")].reduce(function(t,n){return Ei.compose(t,n(t,e))},t),i=[ki.getRule("to-end"),ki.getRule("towards"),ki.getRule("cut-outer-label-horizontal")].reduce(function(t,n){return Ei.compose(t,n(t,e))},t);return Object.assign({},n,["x","dx","hide","label"].reduce(function(t,e){return t[e]=function(t){return(r=t,n.label(r).length>=i.label(r).length?n:i)[e](t);var r},t},{}))}).regRule("inside-start-then-outside-end-vertical",function(t,e){var n=[ki.getRule("from-beginning"),ki.getRule("towards"),ki.getRule("cut-label-vertical")].reduce(function(t,n){return Ei.compose(t,n(t,e))},t),i=[ki.getRule("to-end"),ki.getRule("towards"),ki.getRule("cut-outer-label-vertical")].reduce(function(t,n){return Ei.compose(t,n(t,e))},t);return Object.assign({},n,["y","dy","hide","label"].reduce(function(t,e){return t[e]=function(t){return(r=t,n.label(r).length>=i.label(r).length?n:i)[e](t);var r},t},{}))}).regRule("outside-then-inside-horizontal",function(t,e){var n=["r+","l-","cut-outer-label-horizontal"].map(ki.getRule).reduce(function(t,n){return Ei.compose(t,n(t,e))},t),i=["r-","l+","hide-by-label-height-horizontal","cut-label-horizontal"].map(ki.getRule).reduce(function(t,n){return Ei.compose(t,n(t,e))},t);return Object.assign({},n,["x","dx","hide","label"].reduce(function(t,e){return t[e]=function(t){return(r=t,i.label(r).length>n.label(r).length?i:n)[e](t);var r},t},{}))}).regRule("outside-then-inside-vertical",function(t,e){var n=["t+","b-","cut-outer-label-vertical"].map(ki.getRule).reduce(function(t,n){return Ei.compose(t,n(t,e))},t),i=["t-","b+","hide-by-label-height-vertical","cut-label-vertical"].map(ki.getRule).reduce(function(t,n){return Ei.compose(t,n(t,e))},t);return Object.assign({},n,["y","dy","hide","label"].reduce(function(t,r){return t[r]=function(t){return(a=t,i.label(a,e).length>n.label(a,e).length?i:n)[r](t,e);var a},t},{}))}).regRule("hide-by-label-height-horizontal",function(t){return{hide:function(e){return t.model.size(e)<t.h(e)||t.hide(e)}}}).regRule("cut-label-horizontal",function(t){return{dx:function(e){var n=t.label(e),i=t.w(e),r=Math.abs(t.model.y0(e)-t.model.yi(e)),a=Ai(n,i,r),o=t.dx(e);return a<n.length?r*o/i:o},w:function(e){var n=t.label(e),i=t.w(e),r=Math.abs(t.model.y0(e)-t.model.yi(e));return Ai(n,i,r)<n.length?r:i},label:function(e){var n=t.label(e),i=t.w(e),r=Math.abs(t.model.y0(e)-t.model.yi(e)),a=Ai(n,i,r);return a<n.length?Ci(n,a):n}}}).regRule("cut-outer-label-horizontal",function(t,e){return{dx:function(n){var i=t.label(n),r=t.w(n),a=t.model.y0(n)<t.model.yi(n)?e.maxWidth-t.model.yi(n):t.model.yi(n),o=Ai(i,r,a),s=t.dx(n);return o<i.length?a*s/r:s},w:function(n){var i=t.label(n),r=t.w(n),a=t.model.y0(n)<t.model.yi(n)?e.maxWidth-t.model.yi(n):t.model.yi(n);return Ai(i,r,a)<i.length?a:r},label:function(n){var i=t.label(n),r=t.w(n),a=t.model.y0(n)<t.model.yi(n)?e.maxWidth-t.model.yi(n):t.model.yi(n),o=Ai(i,r,a);return o<i.length?Ci(i,o):i}}}).regRule("keep-within-diameter-or-top",function(t){return{dy:function(e){return t.model.size(e)/t.w(e)<1?t.dy(e)-t.h(e)/2-t.model.size(e)/2:t.dy(e)}}}).regRule("keep-in-box",function(t,e){var n=e.maxWidth,i=e.maxHeight;return{dx:function(e){var i=t.dx(e),r=t.x(e)+i,a=t.w(e),o=r+a/2,s=0-(r-a/2);if(s>0)return i+s;var u=o-n;return u>0?i-u:i},dy:function(e){var n=t.dy(e),r=t.y(e)+n,a=t.h(e),o=r+a/2;if(0-(r-a/2)>0)return 0;var s=o-i;return s>0?n-s:n}}});var ji=function(){function t(t){this.minError=Number.MAX_VALUE,this.items=t.items,this.revision=this.items.map(function(t){return{i:t.i,x:t.x,y:t.y}}),this.penalties=t.penalties,this.transactor=t.transactor,this.cooling_schedule=t.cooling_schedule||function(t,e,n){return t-e/n}}return t.prototype.energy=function(t){return this.penalties.reduce(function(e,n){return e+n(t)},0)},t.prototype.move=function(t){var e=Math.floor(Math.random()*this.items.length),n=this.transactor(this.items[e]),i=this.energy(e);this.items[e]=n.modify();var r=this.energy(e),a=r-i,o=a<0?1:Math.exp(-a/t);Math.random()>=o?this.items[e]=n.revert():r<this.minError&&(this.minError=r,this.revision=this.items.map(function(t){return{i:t.i,x:t.x,y:t.y}}))},t.prototype.start=function(t){var e=1,n=this.items.length;t:for(var i=0;i<t;i++){for(var r=0;r<n;r++)if(this.move(e),this.minError<=10)break t;e=this.cooling_schedule(e,1,t)}return this.revision},t}(),Ii=function(t,e,n,i,r,a,o,s){return Ae(t,r,e,a,n,o,i,s)},zi={},Pi=function(){function t(){}return t.reg=function(t,e){return zi[t]=e,this},t.get=function(t){return zi[t]},t}();Pi.reg("auto:avoid-label-label-overlap",function(t,e,n){return void 0===n&&(n=1),function(e){var i=t[e].x,r=t[e].y-t[e].h+2,a=t[e].x+t[e].w,o=t[e].y+2;return t.reduce(function(t,s,u){var l=Number(u!==e),c=s.x,d=s.y-s.h+2,h=s.x+s.w,f=s.y+2;return t+l*(Math.max(0,Math.min(h,a)-Math.max(c,i))*Math.max(0,Math.min(f,o)-Math.max(d,r))*n)},0)}}).reg("auto:avoid-label-anchor-overlap",function(t,e,n){return void 0===n&&(n=1),function(e){var i=t[e],r=i.x-i.w/2,a=i.x+i.w/2,o=i.y-i.h/2+2,s=i.y+i.h/2+2;return t.reduce(function(t,e){var i=e.x0-e.size/2,u=e.x0+e.size/2,l=e.y0-e.size/2,c=e.y0+e.size/2;return t+Math.max(0,Math.min(u,a)-Math.max(i,r))*Math.max(0,Math.min(c,s)-Math.max(l,o))*n},0)}}).reg("auto:avoid-label-edges-overlap",function(t,e,n){return void 0===n&&(n=1),function(i){var r=t[i],a=r.x-r.w/2,o=r.x+r.w/2,s=r.y-r.h/2,u=r.y+r.h/2;return e.reduce(function(t,e){var i=Ii(a,o,e.x0,e.x1,s,u,e.y0,e.y1),r=Ii(a,o,e.x0,e.x1,u,s,e.y0,e.y1);return t+(Number(i)+Number(r))*n},0)}});var Hi=function(t,e,n,i,r,a,o,s){return Ae(t,r,e,a,n,o,i,s)},Bi=function(){function t(t,e,n,i){var r=i.width,a=i.height,o=i.container;this.container=o,this.model=t,this.flip=e,this.w=r,this.h=a,this.guide=Jt(n||{},{fontFamily:"Helvetica Neue, Segoe UI, Open Sans, Ubuntu, sans-serif",fontWeight:"normal",fontSize:10,fontColor:"#000",hideEqualLabels:!1,position:[],tickFormat:null,tickFormatNullAlias:""})}return t.prototype.draw=function(t){var e=this,n=this.model,i=this.guide,r=Ei.seed(n,{fontColor:i.fontColor,flip:e.flip,formatter:Tn.get(i.tickFormat,i.tickFormatNullAlias),labelRectSize:function(t){return ye(t,i)}}),a={maxWidth:e.w,maxHeight:e.h,data:t.reduce(function(t,e){return t.concat(e)},[])},o=i.position.filter(function(t){return-1===t.indexOf("auto:")}).map(ki.getRule).reduce(function(t,e){return Ei.compose(t,e(t,a))},r),s=t.reduce(function(t,e){var n=e.map(function(t){return{data:t,x:o.x(t)+o.dx(t),y:o.y(t)+o.dy(t),w:o.w(t),h:o.h(t,a),hide:o.hide(t),extr:null,size:o.model.size(t),angle:o.angle(t),label:o.label(t),color:o.color(t)}});return t.text=t.text.concat(n),t.edges=t.edges.concat(function(t,e){for(var n=t.length-1,i=[],r=0;r<=n;r++){var a=0===r?r:r-1,o=r,s=r===n?r:r+1;i.push(e(t[a],t[o],t[s]))}return i}(n,function(t,e,n){return e.y===Math.max(e.y,t.y,n.y)?e.extr="min":e.y===Math.min(e.y,t.y,n.y)?e.extr="max":e.extr="norm",{x0:t.x,x1:e.x,y0:t.y,y1:e.y}})),t},{text:[],edges:[]});s.text=s.text.filter(function(t){return t.label}).map(function(t,e){return Object.assign(t,{i:e})});var u=this.guide.position.filter(function(t){return 0===t.indexOf("auto:avoid")});s=s.text.length>0&&u.length>0?this.autoPosition(s,u):s;var l=this.guide.position.reduce(function(t,e){return Object.assign(t,((n={})[e]=!0,n));var n},{});s.text=s.text=l["auto:adjust-on-label-overflow"]?this.adjustOnOverflow(s.text,a):s.text,s.text=l["auto:hide-on-label-edges-overlap"]?this.hideOnLabelEdgesOverlap(s.text,s.edges):s.text,s.text=l["auto:hide-on-label-label-overlap"]?this.hideOnLabelLabelOverlap(s.text):s.text,s.text=l["auto:hide-on-label-anchor-overlap"]?this.hideOnLabelAnchorOverlap(s.text):s.text;var c=s.text,d=function(t){return function(e,n){return c[n][t]}},h=d("x"),f=d("y"),p=d("angle"),g=d("color"),m=d("label"),y=function(t){t.style("fill",g).style("font-size",e.guide.fontSize+"px").style("display",function(t,e){return c[e].hide?"none":null}).attr("class","i-role-label").attr("text-anchor","middle").attr("transform",function(t,e){return"translate("+h(t,e)+","+f(t,e)+") rotate("+p(t,e)+")"}).text(m)};i.hideEqualLabels&&c.filter(function(t){return!t.hide}).filter(function(t,e,n){return e<n.length-1&&t.label===n[e+1].label}).forEach(function(t){return t.hide=!0});var v=this.container.selectAll(".i-role-label").data(c.map(function(t){return t.data}));return v.exit().remove(),v.call(y),v.enter().append("text").call(y),v},t.prototype.autoPosition=function(t,e){var n=function(t,e){var n=4+(t.size+t.w)/2,i=2+(t.size+t.h)/2;return{x:n*Math.cos(e),y:i*Math.sin(e)}},i=t.edges,r=t.text.map(function(t){var e={max:-Math.PI/2,min:Math.PI/2,norm:Math.random()*Math.PI*2},i=n(t,e[t.extr]);return{i:t.i,x0:t.x,y0:t.y,x:t.x+i.x,y:t.y+i.y,w:t.w,h:t.h,size:t.size,hide:t.hide,extr:t.extr}}).filter(function(t){return!t.hide}),a=new ji({items:r,transactor:function(t){var e=t.x,i=t.y;return{modify:function(){var e={max:-Math.PI,min:Math.PI,norm:2*Math.PI}[t.extr],i=e/4+Math.random()*(2*e)/4,r=n(t,i);return t.x=t.x0+r.x,t.y=t.y0+r.y,t},revert:function(){return t.x=e,t.y=i,t}}},penalties:e.map(function(t){return Pi.get(t)}).filter(function(t){return t}).map(function(t){return t(r,i)})}).start(5);return t.text=a.reduce(function(t,e){var n=t[e.i];return n.x=e.x,n.y=e.y,t},t.text),t},t.prototype.hideOnLabelEdgesOverlap=function(t,e){var n=this;return t.filter(function(t){return!t.hide}).forEach(function(t){var i,r,a;i=t,r=e,a=n.getLabelRect(i),r.reduce(function(t,e){var n=Hi(a.x0,a.x1,e.x0,e.x1,a.y0,a.y1,e.y0,e.y1),i=Hi(a.x0,a.x1,e.x0,e.x1,a.y1,a.y0,e.y0,e.y1);return t+2*(Number(n)+Number(i))},0)>0&&(t.hide=!0)}),t},t.prototype.hideOnLabelLabelOverlap=function(t){var e=this,n={min:0,max:1,norm:2},i={"min/min":function(t,e){return e.y-t.y},"max/max":function(t,e){return t.y-e.y},"min/max":function(){return-1},"min/norm":function(){return-1},"max/norm":function(){return-1},"norm/norm":function(t,e){return t.y-e.y}};return t.filter(function(t){return!t.hide}).sort(function(t,e){return n[t.extr]-n[e.extr]}).forEach(function(r){t.forEach(function(t){r.i!==t.i&&function(t,r){var a=e.getLabelRect(t),o=e.getLabelRect(r),s=Number(!t.hide&&!r.hide);if(s*Math.max(0,Math.min(o.x1,a.x1)-Math.max(a.x0,o.x0))*(s*Math.max(0,Math.min(o.y1,a.y1)-Math.max(a.y0,o.y0)))>0){var u=[t,r];u.sort(function(t,e){return n[t.extr]-n[e.extr]}),(i[u[0].extr+"/"+u[1].extr](u[0],u[1])<0?u[0]:u[1]).hide=!0}}(r,t)})}),t},t.prototype.getLabelRect=function(t,e){return void 0===e&&(e=0),{x0:t.x-t.w/2-e,x1:t.x+t.w/2+e,y0:t.y-t.h/2-e,y1:t.y+t.h/2+e}},t.prototype.getPointRect=function(t,e){return void 0===e&&(e=0),{x0:t.x-t.size/2-e,x1:t.x+t.size/2+e,y0:t.y-t.size/2-e,y1:t.y+t.size/2+e}},t.prototype.hideOnLabelAnchorOverlap=function(t){var e=this;return t.filter(function(t){return!t.hide}).forEach(function(n){for(var i,r,a,o,s=t.length,u=0;u<s;u++){var l=t[u];if(n.i!==l.i&&(i=n,r=l,void 0,void 0,a=e.getLabelRect(i,2),o=e.getPointRect(r,2),Math.max(0,Math.min(o.x1,a.x1)-Math.max(o.x0,a.x0))*Math.max(0,Math.min(o.y1,a.y1)-Math.max(o.y0,a.y0))>.001)){n.hide=!0;break}}}),t},t.prototype.adjustOnOverflow=function(t,e){var n=e.maxWidth,i=e.maxHeight;return t.map(function(t){return t.hide||(t.x=Math.min(Math.max(t.x,t.w/2),n-t.w/2),t.y=Math.max(Math.min(t.y,i-t.h/2),t.h/2)),t})},t}(),qi=y({},d,t),Ui={init:function(t){var e=Object.assign({},t);e.guide=Jt(e.guide||{},{animationSpeed:0,avoidScalesOverflow:!0,enableColorToBarPosition:!1,maxHighlightDistance:32}),e.guide.size=e.guide.size||{},e.guide.label=Jt(e.guide.label||{},{position:["auto:avoid-label-label-overlap","auto:avoid-label-anchor-overlap","auto:adjust-on-label-overflow","auto:hide-on-label-label-overlap","auto:hide-on-label-anchor-overlap"]});var n=e.guide.avoidScalesOverflow,i=e.guide.enableColorToBarPosition;return e.transformRules=[function(t){var e=[t.scaleX,t.scaleY].sort(function(t,e){var n=t.discrete?1:0;return(e.discrete?1:0)*e.domain().length-n*t.domain().length})[0];return t.scaleY===e?C.get("flip")(t):C.get("identity")(t)},e.stack&&C.get("stack"),i&&C.get("positioningByColor")].filter(function(t){return t}),e.adjustRules=[e.stack&&C.get("adjustYScale"),function(t,n){var i=t.scaleSize.isEmptyScale(),r=Jt(e.guide.size,{defMinSize:10,defMaxSize:i?10:40,enableDistributeEvenly:!i}),a=Object.assign({},n,{defMin:r.defMinSize,defMax:r.defMaxSize,minLimit:r.minSize,maxLimit:r.maxSize});return(r.enableDistributeEvenly?C.get("adjustSigmaSizeScale"):C.get("adjustStaticSizeScale"))(t,a)},n&&function(t,e){var n=Object.assign({},e,{sizeDirection:"xy"});return C.get("avoidScalesOverflow")(t,n)}].filter(function(t){return t}),e},addInteraction:function(){var t=this,e=this.node();e.on("highlight",function(e,n){return t.highlight(n)}),e.on("data-hover",function(e,n){return t.highlight((i=n.data,r=null,function(t){return t===i||r}));var i,r})},draw:function(){var t=this.node(),e=t.config,n=e.options;n.container=n.slot(e.uid);var i,r=function(t){return rt(t,e.guide.animationSpeed)},a=Pe+"dot dot i-role-element i-role-datum",o=t.screenModel,s={fill:function(t){return o.color(t)},class:function(t){return a+" "+o.class(t)}},u={r:function(t){return Math.round(1e4*o.size(t)/2)/1e4},cx:function(t){return o.x(t)},cy:function(t){return o.y(t)}},l=[],c=o.toFibers();this._getGroupOrder=(i=c.reduce(function(t,e,n){return t.set(e,n),t},new Map),function(t){return i.get(t)});var d=n.container.selectAll(".frame").data(c,function(t){return o.group(t[0])});d.enter().append("g").attr("opacity",0).merge(d).call(function(e){e.attr("class","frame").call(function(e){var n=e.selectAll("circle").data(function(t){return t},o.id),i=n.enter().append("circle").call(ht(u)).merge(n).call(ht(s));r(i).call(ht(u)),r(n.exit()).attr("r",0).remove(),l.push.apply(l,i.nodes()),t.subscribe(i)}),r(e).attr("opacity",1)});this._boundsInfo=this._getBoundsInfo(l),r(d.exit()).attr("opacity",0).remove().selectAll("circle").attr("r",0),t.subscribe(new Bi(o.model,o.flip,e.guide.label,n).draw(c))},_getBoundsInfo:function(t){if(0===t.length)return null;var e=this.node().screenModel,n=t.map(function(t){var n=qi.select(t).data()[0];return{node:t,data:n,x:e.x(n),y:e.y(n),r:e.size(n)/2}}).filter(function(t){return!isNaN(t.x)&&!isNaN(t.y)}),i=n.reduce(function(t,e){var n=e.x,i=e.y;return t.left=Math.min(n,t.left),t.right=Math.max(n,t.right),t.top=Math.min(i,t.top),t.bottom=Math.max(i,t.bottom),t},{left:Number.MAX_VALUE,right:Number.MIN_VALUE,top:Number.MAX_VALUE,bottom:Number.MIN_VALUE}),r=n.reduce(function(t,e){var n=e.x+","+e.y;return t[n]||(t[n]=[]),t[n].push(e),t},{});return{bounds:i,tree:qi.quadtree().x(function(t){return t[0].x}).y(function(t){return t[0].y}).addAll(Object.keys(r).map(function(t){return r[t]}))}},getClosestElement:function(t,e){if(!this._boundsInfo)return null;var n=this._boundsInfo,i=n.bounds,r=n.tree,a=Ce(this.node().config.options.container.node()),o=t-a.x,s=e-a.y,u=this.node().config.guide.maxHighlightDistance;if(o<i.left-u||o>i.right+u||s<i.top-u||s>i.bottom+u)return null;var l=(r.find(o,s)||[]).map(function(t){var e=Math.sqrt(Math.pow(o-t.x,2)+Math.pow(s-t.y,2));if(e>u)return null;var n=e<t.r?t.r-e:e;return{node:t.node,data:t.data,x:t.x,y:t.y,distance:e,secondaryDistance:n}}).filter(function(t){return t}).sort(function(t,e){return t.secondaryDistance-e.secondaryDistance}),c=l.findIndex(function(t){return t.distance!==l[0].distance||t.secondaryDistance!==l[0].secondaryDistance}),d=c<0?l:l.slice(0,c);if(1===d.length)return d[0];var h=d.reduce(function(t,e){return t+e.x},0)/d.length,f=d.reduce(function(t,e){return t+e.y},0)/d.length,p=Math.atan2(f-s,h-o)+Math.PI;return d[Math.round((d.length-1)*p/2/Math.PI)]},highlight:function(t){var e,n=this.node().config.options.container,i=((e={})["tau-chart__highlighted"]=function(e){return!0===t(e)},e["tau-chart__dimmed"]=function(e){return!1===t(e)},e);n.selectAll(".dot").call(ft(i)),n.selectAll(".i-role-label").call(ft(i)),this._sortElements(t)},_sortElements:function(t){var e=this,n=this.node().config.options.container,i=new Map,r=new Map;n.selectAll(".frame").each(function(e){i.set(this,e.some(t)),r.set(this,e)});var a=Zt(function(t,e){return i.get(t)-i.get(e)},function(t,n){return e._getGroupOrder(r.get(t))-e._getGroupOrder(r.get(n))});we(n.node(),function(t,e){return"g"===t.tagName&&"g"===e.tagName?a(t,e):t.tagName.localeCompare(e.tagName)}),Oe(n,".dot",t)}},Wi="taucharts_synthetic_record";function Gi(t){return!0!==t[Wi]}function Xi(t){return function(e){var n=t.stack,i=e.scaleX.period,r="linear"===e.scaleY.scaleType,a=!t.guide.x||null==t.guide.x.fillGaps;return!a&&t.guide.x.fillGaps||a&&(n||i&&r)?C.get("fillGaps")(e,{isStack:n,xPeriod:i,utc:t.guide.utcTime}):{}}}function Yi(t){if(0===t.length)return"";if(1===t.length)return Ki(t[0]);for(var e=[],n=1;n<t.length;n++)e.push(Ji(t[n-1],t[n]));return e.join(" ")}function Vi(t){if(0===t.length)return"";if(1===t.length)return Ki(t[0]);for(var e=[],n=3;n<t.length;n+=3)e.push($i(t[n-3],t[n-2],t[n-1],t[n]));return e.join(" ")}function Ki(t){var e=t.size/2;return["M"+t.x+","+(t.y-e),"A"+e+","+e+" 0 0 1",t.x+","+(t.y+e),"A"+e+","+e+" 0 0 1",t.x+","+(t.y-e),"Z"].join(" ")}function Ji(t,e){var n=rr(t,e);return n?["M"+n.left[0].x+","+n.left[0].y,"L"+n.left[1].x+","+n.left[1].y,"A"+e.size/2+","+e.size/2+" 0 "+Number(t.size<e.size)+" 1",n.right[1].x+","+n.right[1].y,"L"+n.right[0].x+","+n.right[0].y,"A"+t.size/2+","+t.size/2+" 0 "+Number(t.size>e.size)+" 1",n.left[0].x+","+n.left[0].y,"Z"].join(" "):Ki(t.size>e.size?t:e)}function $i(t,e,n,i){var r=function(t,e,n,i){var r=tr(t,i);if(0===r||r+t.size/2<=i.size/2||r+i.size/2<=t.size/2)return null;var a=function(r){var a=r?[i,n,e,t]:[t,e,n,i],o=nr.apply(void 0,[1/12*2].concat(a)),s=nr.apply(void 0,[.5].concat(o.slice(0,4))),u=s[3],l=s[6],c=rr(a[0],u),d=rr(u,l),h=[c.left[0],N(.5,c.left[1],d.left[0]),d.left[1]],f=[c.right[0],N(.5,c.right[1],d.right[0]),d.right[1]],p=ir.apply(void 0,h)[1],g=ir.apply(void 0,f)[1],m=N(4,c.left[0],p),y=N(4,c.right[0],g);return{left:r?[y,f[0]]:[h[0],m],right:r?[m,h[0]]:[f[0],y]}},o=a(!1),s=a(!0);return{left:o.left.concat(s.left),right:o.right.concat(s.right)}}(t,e,n,i);if(!r)return Ji(t,i);var a=Zi(Qi(t,r.right[0]),Qi(t,r.left[0])),o=Zi(Qi(i,r.right[1]),Qi(i,r.left[1]));return["M"+r.left[0].x+","+r.left[0].y,"C"+r.left[1].x+","+r.left[1].y,r.left[2].x+","+r.left[2].y,r.left[3].x+","+r.left[3].y,"A"+i.size/2+","+i.size/2+" 0 "+Number(a>Math.PI)+" 1",r.right[3].x+","+r.right[3].y,"C"+r.right[2].x+","+r.right[2].y,r.right[1].x+","+r.right[1].y,r.right[0].x+","+r.right[0].y,"A"+t.size/2+","+t.size/2+" 0 "+Number(o>Math.PI)+" 1",r.left[0].x+","+r.left[0].y,"Z"].join(" ")}function Qi(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}function Zi(t,e){return e<t&&(e+=2*Math.PI),e-t}function tr(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0,i=1;i<t.length;i++)n+=Math.sqrt((t[i].x-t[i-1].x)*(t[i].x-t[i-1].x)+(t[i].y-t[i-1].y)*(t[i].y-t[i-1].y));return n}function er(t,e,n){return{x:t.x+e*Math.cos(n),y:t.y+e*Math.sin(n)}}function nr(t,e,n,i,r){var a=F(t,e,n,i,r),o=1/(1+tr(a[3],a[4],a[5],a[6],a[3])/tr(a[0],a[1],a[2],a[3],a[0]));return a[3].size=e.size*(1-o)+r.size*o,a}function ir(t,e,n){return[t,N(2,N(tr(t,e)/tr(t,e,n),t,n),e),n]}function rr(t,e){var n=tr(t,e);if(0===n||n+t.size/2<=e.size/2||n+e.size/2<=t.size/2)return null;var i=Qi(t,e),r=Math.asin((t.size-e.size)/n/2),a=i-Math.PI/2+r,o=i+Math.PI/2-r;return{left:[er(t,t.size/2,a),er(e,e.size/2,a)],right:[er(t,t.size/2,o),er(e,e.size/2,o)]}}var ar={circle:{element:"circle",getInitialAttrs:function(t,e){var n=t.config.guide,i=t.screenModel;return{r:"hover"===n.showAnchors?0:function(t){return i.size(t)/2},cx:function(t){return e.x(t)},cy:function(t){return e.y(t)}}},getHighlightAttrs:function(t,e,n){var i=t.screenModel;return{r:"hover"===t.config.guide.showAnchors?function(t){return n(t)?Math.max(4,i.size(t)/2):0}:function(t){var e=i.size(t)/2;return n(t)&&(e=Math.max(4,Math.ceil(1.25*e))),e}}}},"vertical-stick":{element:"path",getInitialAttrs:function(t,e){var n=t.config.guide,i=t.screenModel;return{"shape-rendering":"crispEdges",d:function(t){var r=e.x(t),a=e.y(t),o=e.x0(t),s=e.y0(t),u="hover"===n.showAnchors?0:i.size(t)/2;return Yi([{x:r,y:a,size:u},{x:o,y:s,size:u}])}}},getHighlightAttrs:function(t,e,n){var i=t.screenModel,r="hover"===t.config.guide.showAnchors;return{d:function(t){var a=e.x(t),o=e.y(t),s=e.x0(t),u=e.y0(t),l=r?n(t)?Math.max(4,i.size(t)/2):0:n(t)?Math.max(4,Math.ceil(i.size(t)/2*1.25)):i.size(t)/2;return Yi([{x:a,y:o,size:l},{x:s,y:u,size:l}])}}}}};function or(t,e,n){var i=n.sort(function(t,e){return t.distance===e.distance?t.secondaryDistance-e.secondaryDistance:t.distance-e.distance}),r=i.findIndex(function(t){return t.distance!==i[0].distance||t.secondaryDistance!==i[0].secondaryDistance}),a=r<0?i:i.slice(0,r);if(1===a.length)return a[0];var o=a.reduce(function(t,e){return t+e.x},0)/a.length,s=a.reduce(function(t,e){return t+e.y},0)/a.length,u=Math.atan2(s-e,o-t)+Math.PI;return a[Math.round((a.length-1)*u/2/Math.PI)]}var sr=Pe+"dot-line dot-line i-role-dot i-role-datum "+Pe+"dot",ur={init:function(t){var e=t;return e.guide=Jt(e.guide||{},{animationSpeed:0,cssClass:"",maxHighlightDistance:32,widthCssClass:"",color:{},label:{}}),e.guide.label=Jt(e.guide.label,{fontSize:11,hideEqualLabels:!0,position:["auto:avoid-label-label-overlap","auto:avoid-label-anchor-overlap","auto:avoid-label-edges-overlap","auto:adjust-on-label-overflow","auto:hide-on-label-label-overlap","auto:hide-on-label-edges-overlap"]}),e.guide.color=Jt(e.guide.color||{},{fill:null}),["never","hover","always"].indexOf(e.guide.showAnchors)<0&&(e.guide.showAnchors="hover"),e.transformRules=[],e.adjustRules=[],e},baseModel:function(t){var e={gog:t.model,x:t.x,y:t.y,x0:t.x0,y0:t.y0,size:t.size,group:t.group,order:t.order,color:t.color,class:t.class,groupAttributes:{},pathAttributesUpdateInit:{},pathAttributesUpdateDone:{},pathAttributesEnterInit:{},pathAttributesEnterDone:{},pathElement:null,dotAttributes:{r:function(t){return Math.round(1e4*e.size(t)/2)/1e4},cx:function(t){return e.x(t)},cy:function(t){return e.y(t)},fill:function(t){return e.color(t)},class:function(t){return sr+" "+e.class(t)}},dotAttributesDefault:{r:0,cy:function(t){return e.y0(t)}}};return e},addInteraction:function(){var t=this,e=this.node(),n=this.node().config;e.on("highlight",function(e,n){return t.highlight(n)}),e.on("highlight-data-points",function(e,n){return t.highlightDataPoints(n)}),"never"!==n.guide.showAnchors&&e.on("data-hover",function(e,n){return t.highlightDataPoints((i=n.data,r=null,function(t){return t===i||r}));var i,r})},draw:function(){var e=this.node(),n=e.config,i=n.guide,r=n.options;r.container=r.slot(n.uid);var a=e.screenModel,o=this.buildModel(a);this.domElementModel=o;var s=lt,u=function(r){r.call(ht(o.groupAttributes));var u,l=r.selectAll((u=sr,u.split(/\s+/g).map(function(t){return"."+t}).join(""))).data(function(t){return t.length<=1?t:[]},a.id);l.exit().call(s(i.animationSpeed,null,{r:0},function(e){return t.select(e).remove()})),l.call(s(i.animationSpeed,null,o.dotAttributes));var c=l.enter().append("circle").call(s(i.animationSpeed,o.dotAttributesDefault,o.dotAttributes)).merge(l);e.subscribe(c);var d=r.selectAll(o.pathElement+":not(.i-data-anchor)").data(function(t){return t.length>1?[t]:[]},h);d.exit().remove(),d.call(s(i.animationSpeed,o.pathAttributesUpdateInit,o.pathAttributesUpdateDone,o.afterPathUpdate));var f,p,g,m,v,x,_,b;d.enter().append(o.pathElement).call(s(i.animationSpeed,o.pathAttributesEnterInit,o.pathAttributesEnterDone,o.afterPathUpdate)).merge(d).call(function(t){n.guide.animationSpeed>0&&!document.hidden?(t.attr(o.pathTween.attr,function(t){return o.pathTween.fn.call(this,t)(0)}),rt(t,n.guide.animationSpeed,"pathTransition").attrTween(o.pathTween.attr,o.pathTween.fn)):t.attr(o.pathTween.attr,function(t){return o.pathTween.fn.call(this,t)(1)})});if(e.subscribe(c),"never"!==i.showAnchors){var w=(f=e,g=r,m=(p=o).anchorShape,v=f.config.guide,x=f.screenModel,_=y({},ar[m].getInitialAttrs(f,p),{opacity:"hover"===v.showAnchors?0:1,fill:function(t){return x.color(t)},class:"i-data-anchor"}),(b=g.selectAll(".i-data-anchor").data(function(t){return t.filter(Gi)},x.id)).exit().remove(),b.call(lt(v.animationSpeed,null,_)),b.enter().append(ar[p.anchorShape].element).call(lt(v.animationSpeed,{r:0},_)).merge(b));e.subscribe(w)}},l=a.toFibers(),c=l.map(function(t){return t.filter(Gi)}),d=r.container.selectAll(".frame"),h=function(){var t=d.empty()?[]:d.data(),e=new Map;d.each(function(t){e.set(t,Number(this.getAttribute("data-id")))});var n=t.reduce(function(t,e){return t.set(e,e.map(a.id)),t},new Map),i=new Map,r=Math.max.apply(Math,[0].concat(Array.from(e.values())));return function(t){if(i.has(t))return i.get(t);var o,s=t.map(function(t){return a.id(t)}),u=(Array.from(n.entries()).find(function(t){var e=t[1];return s.some(function(t){return e.some(function(e){return e===t})})})||[null])[0];return o=u?e.get(u):++r,i.set(t,o),o}}();this._getDataSetId=h;var f=d.data(l,h);f.exit().remove(),f.call(u),f.enter().append("g").attr("data-id",h).call(u),f.order(),this._boundsInfo=this._getBoundsInfo(r.container.selectAll(".i-data-anchor").nodes()),e.subscribe(new Bi(a.model,n.flip,n.guide.label,r).draw(c))},_getBoundsInfo:function(e){if(0===e.length)return null;var n=this.node().screenModel,i=this.node().config.flip,r=e.map(function(e){var i=t.select(e).data()[0];return{node:e,data:i,x:n.x(i),y:n.y(i)}}).filter(function(t){return!isNaN(t.x)&&!isNaN(t.y)}),a=r.reduce(function(t,e){var n=e.x,i=e.y;return t.left=Math.min(n,t.left),t.right=Math.max(n,t.right),t.top=Math.min(i,t.top),t.bottom=Math.max(i,t.bottom),t},{left:Number.MAX_VALUE,right:Number.MIN_VALUE,top:Number.MAX_VALUE,bottom:Number.MIN_VALUE}),o=Xt(r.map(i?function(t){return t.y}:function(t){return t.x})).sort(function(t,e){return t-e}),s=o.reduce(function(t,e){return t[e]=[],t},{});r.forEach(function(t){var e=o.find(i?function(e){return t.y===e}:function(e){return t.x===e});s[e].push(t)});var u=function(t){if(1===t.length)return s[t[0]];var e=Math.ceil(t.length/2);return{middle:(t[e-1]+t[e])/2,lower:u(t.slice(0,e)),greater:u(t.slice(e))}};return{bounds:a,tree:u(o)}},getClosestElement:function(t,e){if(!this._boundsInfo)return null;var n=this._boundsInfo,i=n.bounds,r=n.tree,a=this.node().config.options.container,o=this.node().config.flip,s=Ce(a.node()),u=this.node().config.guide.maxHighlightDistance;if(t<i.left+s.x-u||t>i.right+s.x+u||e<i.top+s.y-u||e>i.bottom+s.y+u)return null;var l=o?e-s.y:t-s.x,c=function t(e){return Array.isArray(e)?e:t(l>e.middle?e.greater:e.lower)}(r).map(function(n){var i=n.x+s.x,r=n.y+s.y,a=Math.abs(o?e-r:t-i),u=Math.abs(o?t-i:e-r);return{node:n.node,data:n.data,distance:a,secondaryDistance:u,x:i,y:r}});return or(t,e,c)},highlight:function(t){var e=this.node().config.options.container,n="tau-chart__highlighted",i="tau-chart__dimmed",r=e.selectAll(".i-role-path"),a=r.data().filter(function(e){return e.filter(Gi).some(t)}),o=a.length>0;r.call(ft(((s={})[n]=function(t){return o&&a.indexOf(t)>=0},s[i]=function(t){return o&&a.indexOf(t)<0},s)));var s,u,l=((u={})[n]=function(e){return!0===t(e)},u[i]=function(e){return!1===t(e)},u);e.selectAll(".i-role-dot").call(ft(l)),e.selectAll(".i-role-label").call(ft(l)),this._sortElements(t)},highlightDataPoints:function(t){var e,n,i,r,a,o,s=this.node(),u=this.domElementModel,l=(e=s,i=t,r=(n=u).anchorShape,a=e.screenModel,o="hover"===e.config.guide.showAnchors,e.config.options.container.selectAll(".i-data-anchor").call(ht(ar[r].getHighlightAttrs(e,n,i))).attr("opacity",o?function(t){return i(t)?1:0}:function(){return 1}).attr("fill",function(t){return a.color(t)}).attr("class",function(t){return Se("i-data-anchor",a.class(t))}).classed(Pe+"highlighted",i)),c=s.config.options.container,d=s.config.flip,h=l.filter(t),f=c.select(".cursor-line");if(h.empty())f.remove();else{f.empty()&&(f=c.append("line"));var p=s.screenModel.model,g=p.xi(h.data()[0]),m=p.xi(h.data()[0]),y=p.scaleY.domain(),v=p.scaleY(y[0]),x=p.scaleY(y[1]);f.attr("class","cursor-line").attr("x1",d?v:g).attr("y1",d?g:v).attr("x2",d?x:m).attr("y2",d?m:x)}this._sortElements(t)},_sortElements:function(t){var e=this.node().config.options.container,n=new Map,i=new Map,r=this._getDataSetId;e.selectAll(".i-role-path").each(function(e){n.set(this,r(e)),i.set(this,e.filter(Gi).some(t))});var a=Zt(function(t,e){return i.get(t)-i.get(e)},function(t,e){return n.get(t)-n.get(e)}),o={line:0,g:1,text:2};we(e.node(),function(t,e){return"g"===t.tagName&&"g"===e.tagName?a(t,e):o[t.tagName]-o[e.tagName]})}},lr=[1,2,3,4,5],cr=lr.map(function(t){return Pe+"line-opacity-"+t}),dr=lr.map(function(t){return Pe+"line-width-"+t});function hr(t){return cr[t-1]||cr[4]}function fr(t,e){return t.length<2?"":String.prototype.concat.apply("",t.concat(e.slice().reverse()).map(function(t,e){return(0===e?"":" ")+t.x+","+t.y}))}function pr(t,e){if(t.length<2)return"";var n=function(t){var e=t.map(function(t,e){return""+((e-1)%3==0?"C":"")+t.x+","+t.y+" "});return String.prototype.concat.apply("",e)};return"M"+n(t)+"L"+n(e.slice().reverse())+"Z"}var gr=y({},h,t),mr={draw:ur.draw,highlight:ur.highlight,highlightDataPoints:ur.highlightDataPoints,addInteraction:ur.addInteraction,_sortElements:ur._sortElements,init:function(t){var e=ur.init(t),n=e.stack;return e.transformRules=[e.flip&&C.get("flip"),!n&&C.get("groupOrderByAvg"),Xi(e),n&&C.get("stack")],e.adjustRules=[function(t,n){var i=t.scaleSize.isEmptyScale(),r=Jt(e.guide.size||{},{defMinSize:2,defMaxSize:i?6:40}),a=Object.assign({},n,{defMin:r.defMinSize,defMax:r.defMaxSize,minLimit:r.minSize,maxLimit:r.maxSize});return C.get("adjustStaticSizeScale")(t,a)}],e},buildModel:function(t){var e=ur.baseModel(t),n=this.node().config.guide,i=hr(t.model.scaleColor.domain().length),r=Pe+"area area i-role-path "+i+" "+n.cssClass+" ";e.groupAttributes={class:function(t){return r+" "+e.class(t[0])+" frame"}};var a={fill:function(t){return e.color(t[0])},stroke:function(t){var n=e.color(t[0]);return n.length>0&&(n=gr.rgb(n).darker(1)),n}};e.pathAttributesEnterInit=a,e.pathAttributesUpdateDone=a;var o="polyline"===Z(n.interpolate);return e.pathElement=o?"polygon":"path",e.anchorShape="vertical-stick",e.pathTween={attr:o?"points":"d",fn:dt(0,o?fr:pr,[function(n){return{id:t.id(n),x:e.x(n),y:e.y(n)}},function(n){return{id:t.id(n),x:e.x0(n),y:e.y0(n)}}],t.id,n.interpolate)},e},_getBoundsInfo:function(t){if(0===t.length)return null;var e,n,i=this.node().screenModel,r=this.node().config.flip,a=t.map(function(t){var e=gr.select(t).data()[0];return{node:t,data:e,x:i.x(e),y:i.y(e),y0:i.y0(e),group:i.group(e)}}),o=a.reduce(function(t,e){var n=e.x,i=e.y,r=e.y0;return t.left=Math.min(n,t.left),t.right=Math.max(n,t.right),t.top=Math.min(i,r,t.top),t.bottom=Math.max(i,r,t.bottom),t},{left:Number.MAX_VALUE,right:Number.MIN_VALUE,top:Number.MAX_VALUE,bottom:Number.MIN_VALUE}),s=Xt(a.map(r?function(t){return t.y}:function(t){return t.x})).sort(function(t,e){return t-e}),u=s.reduce(function(t,e){return t[e]=[],t},{});if(a.forEach(function(t){var e=s.find(r?function(e){return t.y===e}:function(e){return t.x===e});u[e].push(t)}),e=Object.keys(a.reduce(function(t,e){return t[e.group]=!0,t},{})),n=e.reduce(function(t,e,n){return t[e]=n,t},{}),s.forEach(function(t){var i=u[t];if(i.sort(function(t,e){return n[t.group]-n[e.group]}),i.length<e.length)for(var r=0;r<e.length;r++){var a=!1,o=void 0,s=void 0;if(r===i.length?(o=s=0===r?0:i[r-1].y,a=!0):i[r].group!==e[r]&&(o=s=i[r].y0,a=!0),a){var l={x:t,y:o,y0:s,data:null,node:null,group:e[r]};i.splice(r,0,l)}}}),1===s.length)return{bounds:o,tree:{start:s[0],end:s[0],isLeaf:!0,items:{start:u[s[0]],end:u[s[0]]}}};var l=function(t){if(2===t.length){var e=t[0],n=t[1];return{start:e,end:n,isLeaf:!0,items:{start:u[e],end:u[n]}}}var i=t.length%2==0?t.length/2:(t.length-1)/2;return{start:t[0],end:t[t.length-1],isLeaf:!1,left:l(t.slice(0,i+1)),right:l(t.slice(i))}};return{bounds:o,tree:l(s)}},getClosestElement:function(t,e){if(!this._boundsInfo)return null;var n=this._boundsInfo,i=n.bounds,r=n.tree,a=this.node().config.options.container,o=this.node().config.flip,s=Ce(a.node()),u=this.node().config.guide.maxHighlightDistance;if(t<i.left+s.x-u||t>i.right+s.x+u||e<i.top+s.y-u||e>i.bottom+s.y+u)return null;var l=o?e-s.y:t-s.x,c=function t(e){if(e.isLeaf)return e;var n=e.left.end;return t(l<n?e.left:e.right)}(r),d=c.end===c.start?0:(l-c.start)/(c.end-c.start);d<0&&(d=0),d>1&&(d=1);var h,f=(h=c.items.start.reduce(function(t,e){return t[e.group]={start:e,end:null,y:null,y0:null},t},{}),c.items.end.forEach(function(t){void 0!==h[t.group]?h[t.group].end=t:delete h[t.group]}),Object.keys(h).forEach(function(t){var e=h[t];e.end?(e.y=e.start.y+d*(e.end.y-e.start.y),e.y0=e.start.y0+d*(e.end.y0-e.start.y0)):delete h[t]}),Object.keys(h).map(function(t){return h[t]}).map(function(t){return{y:t.y,y0:t.y0,el:d<.5?t.start:t.end}}).filter(function(t){return null!=t.el.data})),p=e-s.y,g=f.filter(function(t){return p>=t.y&&p<=t.y0}),m=(g.length>0?g:f).map(function(t){return t.el}).map(function(n){var i=n.x+s.x,r=n.y+s.y,a=Math.abs(o?e-r:t-i),u=Math.abs(o?t-i:e-r);return{node:n.node,data:n.data,distance:a,secondaryDistance:u,x:i,y:r}});return or(t,e,m)}},yr={draw:ur.draw,getClosestElement:ur.getClosestElement,highlight:ur.highlight,highlightDataPoints:ur.highlightDataPoints,addInteraction:ur.addInteraction,_getBoundsInfo:ur._getBoundsInfo,_sortElements:ur._sortElements,init:function(t){var e=ur.init(t);return e.transformRules=[e.flip&&C.get("flip")],e.adjustRules=[function(t,n){var i=t.scaleSize.isEmptyScale(),r=Jt(e.guide.size||{},{defMinSize:2,defMaxSize:i?6:40}),a=Object.assign({},n,{defMin:r.defMinSize,defMax:r.defMaxSize,minLimit:r.minSize,maxLimit:r.maxSize});return C.get("adjustStaticSizeScale")(t,a)}],e},buildModel:function(t){var e=ur.baseModel(t),n=this.node().config.guide,i=hr(t.model.scaleColor.domain().length),r=Pe+"area area i-role-path "+i+" "+n.cssClass+" ";e.groupAttributes={class:function(t){return r+" "+e.class(t[0])+" frame"}};var a,o,s={fill:function(t){return e.color(t[0])},stroke:function(t){return e.color(t[0])}};return e.pathAttributesEnterInit=s,e.pathAttributesUpdateDone=s,e.pathElement="polygon",e.anchorShape="circle",e.pathTween={attr:"points",fn:dt(0,(a=function(t){return t.x},o=function(t){return t.y},function(t){return t.map(function(t){return[a(t),o(t)].join(",")}).join(" ")}),[function(n){return{id:t.id(n),x:e.x(n),y:e.y(n)}}],t.id)},e}};function vr(t){if(t.length<2)return"";for(var e="",n=0;n<t.length;n++)e+=(0===n?"M":" L")+t[n].x+","+t[n].y;return e}function xr(t){if(t.length<4)return"";for(var e="M"+t[0].x+","+t[0].y,n=3;n<t.length;n+=3)e+=" C"+t[n-2].x+","+t[n-2].y+" "+t[n-1].x+","+t[n-1].y+" "+t[n].x+","+t[n].y;return e}var _r={draw:ur.draw,getClosestElement:ur.getClosestElement,highlight:ur.highlight,highlightDataPoints:ur.highlightDataPoints,addInteraction:ur.addInteraction,_getBoundsInfo:ur._getBoundsInfo,_sortElements:ur._sortElements,init:function(t){var e=ur.init(t),n=e.stack;e.guide=Jt(e.guide||{},{avoidScalesOverflow:!0,interpolate:"linear"}),e.transformRules=[e.flip&&C.get("flip"),!n&&C.get("groupOrderByAvg"),Xi(e),n&&C.get("stack")];var i=e.guide.avoidScalesOverflow,r=function(t){return t.scaleSize.isEmptyScale()};return e.adjustRules=[function(t,n){var i=Jt(e.guide.size||{},{defMinSize:2,defMaxSize:r(t)?6:40}),a=Object.assign({},n,{defMin:i.defMinSize,defMax:i.defMaxSize,minLimit:i.minSize,maxLimit:i.maxSize});return C.get("adjustStaticSizeScale")(t,a)},i&&function(t,e){if(r(t))return function(){return{}};var n=Object.assign({},e,{sizeDirection:"xy"});return C.get("avoidScalesOverflow")(t,n)}].filter(function(t){return t}),e},buildModel:function(t){var e,n,i=this.node().config,r=i.guide,a=i.options,o=!t.model.scaleSize.dim,s=o?r.widthCssClass||(e=a.width,n=0,e>=160&&e<320?n=1:e>=320&&e<480?n=2:e>=480&&e<640?n=3:e>=640&&(n=4),dr[n]):"",u=hr(t.model.scaleColor.domain().length),l=o?"line":"area",c=""+Pe+l+" "+l+" i-role-path "+s+" "+u+" "+r.cssClass+" ",d=o?{stroke:function(t){return f.color(t[0])},class:"i-role-datum"}:{fill:function(t){return f.color(t[0])}},h="cubic"===Z(r.interpolate)?o?xr:Vi:o?vr:Yi,f=ur.baseModel(t),p=o?function(e){return{id:t.id(e),x:f.x(e),y:f.y(e)}}:function(e){return{id:t.id(e),x:f.x(e),y:f.y(e),size:f.size(e)}};return f.groupAttributes={class:function(t){return c+" "+f.class(t[0])+" frame"}},f.pathElement="path",f.anchorShape="circle",f.pathAttributesEnterInit=d,f.pathAttributesUpdateDone=d,f.pathTween={attr:"d",fn:dt(0,h,[p],t.id,r.interpolate)},f}},br=function(e){return t.select(e).data()[0]},wr={init:function(t){var e=Object.assign({},t);e.guide=e.guide||{},e.guide=Jt(e.guide,{animationSpeed:0,avoidScalesOverflow:!0,maxHighlightDistance:32,prettify:!0,sortByBarHeight:!0,enableColorToBarPosition:null!=e.guide.enableColorToBarPosition?e.guide.enableColorToBarPosition:!e.stack}),e.guide.size=Jt(e.guide.size||{},{enableDistributeEvenly:!0}),e.guide.label=Jt(e.guide.label||{},{position:e.flip?e.stack?["r-","l+","hide-by-label-height-horizontal","cut-label-horizontal"]:["outside-then-inside-horizontal","auto:hide-on-label-label-overlap"]:e.stack?["rotate-on-size-overflow","t-","b+","hide-by-label-height-vertical","cut-label-vertical","auto:hide-on-label-label-overlap"]:["rotate-on-size-overflow","outside-then-inside-vertical","auto:hide-on-label-label-overlap"]});var n=e.guide.avoidScalesOverflow,i=e.guide.enableColorToBarPosition,r=e.guide.size.enableDistributeEvenly;return e.transformRules=[e.flip&&C.get("flip"),e.stack&&C.get("stack"),i&&C.get("positioningByColor")].filter(function(t){return t}),e.adjustRules=[r&&function(t,n){var i=Jt(e.guide.size||{},{defMinSize:e.guide.prettify?3:0,defMaxSize:e.guide.prettify?40:Number.MAX_VALUE}),r=Object.assign({},n,{defMin:i.defMinSize,defMax:i.defMaxSize,minLimit:i.minSize,maxLimit:i.maxSize});return C.get("size_distribute_evenly")(t,r)},n&&r&&function(t,e){var n=Object.assign({},e,{sizeDirection:"x"});return C.get("avoidScalesOverflow")(t,n)},e.stack&&C.get("adjustYScale")].filter(function(t){return t}),e},addInteraction:function(){var t=this,e=this.node();e.on("highlight",function(e,n){return t.highlight(n)}),e.on("data-hover",function(e,n){return t.highlight((i=n.data,r=null,function(t){return t===i||r}));var i,r})},draw:function(){var e=this.node(),n=e.config,i=n.options;i.container=i.slot(n.uid);var r=n.guide.prettify,a="i-role-element i-role-datum bar "+Pe+"bar",o=e.screenModel,s=this.buildModel(o,{prettify:r,minBarH:1,minBarW:1,baseCssClass:a}),u=lt,l=n.flip?"y":"x",c=n.flip?"x":"y",d=n.flip?"width":"height",h=n.flip?"height":"width",p=o.toFibers(),g=p.reduce(function(t,e){return t.concat(e)},[]),m=s.class,y=$t(s,"class"),v=i.container.selectAll(".bar").data(g,o.id);v.exit().classed("tau-removing",!0).call(u(n.guide.animationSpeed,null,((w={})[l]=function(){var t=f.select(this);return t.attr(l)-0+(t.attr(h)-0)/2},w[c]=function(){return this.getAttribute("data-zero")},w[h]=0,w[d]=0,w),function(e){var n=t.select(e);n.classed("tau-removing")&&n.remove()})),v.call(u(n.guide.animationSpeed,null,y));var x=v.enter().append("rect").call(u(n.guide.animationSpeed,(S={},S[c]=o[c+"0"],S[d]=0,S),y)).merge(v).attr("class",m).attr("data-zero",o[c+"0"]);e.subscribe(new Bi(o.model,o.model.flip,n.guide.label,i).draw(p));var _,b=(_=g.reduce(function(t,e,n){return t.set(e,n+1),t},new Map),function(t,e){return(_.get(br(t))||-1)-(_.get(br(e))||-1)});this._barsSorter=n.guide.sortByBarHeight?n.flip?function(t,e){var n=br(t),i=br(e),r=s.width(n),a=s.width(i);if(r===a){var o=s.y(n),u=s.y(i);return o===u?b(t,e):o-u}return a-r}:function(t,e){var n=br(t),i=br(e),r=s.height(n),a=s.height(i);if(r===a){var o=s.x(n),u=s.x(i);return o===u?b(t,e):o-u}return a-r}:b;var w,S,T={rect:0,text:1};this._typeSorter=function(t,e){return T[t.tagName]-T[e.tagName]},this._sortElements(this._typeSorter,this._barsSorter),e.subscribe(x),this._boundsInfo=this._getBoundsInfo(x.nodes())},buildModel:function(t,e){var n,i=e.prettify,r=e.minBarH,a=e.minBarW,o=e.baseCssClass,s=function(e){var n=t.size(e);return i&&(n=Math.max(a,n)),n},u=function(e){return e[t.model.scaleY.dim]};if(t.flip){var l=function(e){return Math.abs(t.x(e)-t.x0(e))};n={y:function(e){return t.y(e)-.5*s(e)},x:function(e){var n=Math.min(t.x0(e),t.x(e));if(i){var a=l(e),o=u(e),s=0;return 0===o&&(s=0),o>0&&(s=a),o<0&&(s=0-r),a<r?n+s:n}return n},height:function(t){return s(t)},width:function(t){var e=l(t);return i?0===u(t)?e:Math.max(r,e):e}}}else{var c=function(e){return Math.abs(t.y(e)-t.y0(e))};n={x:function(e){return t.x(e)-.5*s(e)},y:function(e){var n=Math.min(t.y0(e),t.y(e));i&&(n=c(e)<r&&u(e)>0?n-r:n);return n},width:function(t){return s(t)},height:function(t){var e=c(t);return i&&(e=0===u(t)?e:Math.max(r,e)),e}}}return Object.assign(n,{class:function(e){return o+" "+t.class(e)},fill:function(e){return t.color(e)}})},_sortElements:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];we(this.node().config.options.container.node(),Zt.apply(se,t))},_getBoundsInfo:function(e){if(0===e.length)return null;var n=this.node().screenModel,i=this.node().config.flip,r=e.map(function(e){var i=t.select(e).data()[0],r=n.x(i),a=n.x0(i),o=n.y(i),s=n.y0(i),u=Math.abs(r-a),l=Math.abs(o-s),c=(r+a)/2,d=(o+s)/2;return{node:e,data:i,cx:c,cy:d,box:{top:d-l/2,right:c+u/2,bottom:d+l/2,left:c-u/2},invert:o>s}}),a=r.reduce(function(t,e){var n=e.box;return t.left=Math.min(n.left,t.left),t.right=Math.max(n.right,t.right),t.top=Math.min(n.top,t.top),t.bottom=Math.max(n.bottom,t.bottom),t},{left:Number.MAX_VALUE,right:Number.MIN_VALUE,top:Number.MAX_VALUE,bottom:Number.MIN_VALUE}),o=Xt(r.map(i?function(t){return t.cy}:function(t){return t.cx})).sort(function(t,e){return t-e}),s=o.reduce(function(t,e){return t[e]=[],t},{});r.forEach(function(t){var e=o.find(i?function(e){return t.cy===e}:function(e){return t.cx===e});s[e].push(t)});var u=function(t){if(1===t.length)return s[t];var e=Math.ceil(t.length/2);return{middle:(t[e-1]+t[e])/2,lower:u(t.slice(0,e)),greater:u(t.slice(e))}};return{bounds:a,tree:u(o)}},getClosestElement:function(t,e){if(!this._boundsInfo)return null;var n=this._boundsInfo,i=n.bounds,r=n.tree,a=this.node().config.options.container,o=this.node().config.flip,s=Ce(a.node()),u=t-s.x,l=e-s.y,c=this.node().config.guide.maxHighlightDistance;if(u<i.left-c||u>i.right+c||l<i.top-c||l>i.bottom+c)return null;var d=o?l:u,h=o?u:l;return function t(e){return Array.isArray(e)?e:t(d>e.middle?e.greater:e.lower)}(r).map(function(t){var e,n=o?t.box.left:t.box.top,i=o?t.box.right:t.box.bottom,r=(e=h)>=n&&e<=i;if(!r&&Math.abs(h-n)>c&&Math.abs(h-i)>c)return null;var a=Math.abs(h-(t.invert!==o?i:n));return Object.assign(t,{distToValue:a,cursorInside:r})}).filter(function(t){return t}).sort(function(t,e){return t.cursorInside!==e.cursorInside?e.cursorInside-t.cursorInside:Math.abs(t.distToValue)-Math.abs(e.distToValue)}).map(function(t){var e=t.cx,n=t.cy,i=Math.abs(o?l-n:u-e),r=Math.abs(o?u-e:l-n);return{node:t.node,data:t.data,distance:i,secondaryDistance:r,x:e,y:n}})[0]||null},highlight:function(t){var e,n=this.node().config.options.container,i=((e={})["tau-chart__highlighted"]=function(e){return!0===t(e)},e["tau-chart__dimmed"]=function(e){return!1===t(e)},e);n.selectAll(".bar").call(ft(i)),n.selectAll(".i-role-label").call(ft(i)),this._sortElements(function(e,n){return t(br(e))-t(br(n))},this._typeSorter,this._barsSorter)}},Sr=function(t){function e(e){var n=t.call(this,e)||this;return n.config=e,n.config.guide=Jt(n.config.guide||{},{}),n.on("highlight",function(t,e){return n.highlight(e)}),n}return m(e,t),e.prototype.defineGrammarModel=function(t){var e=this.config,n=e.options;this.color=t("color",e.color,{}),this.scalesMap=e.columns.reduce(function(e,i){return e[i]=t("pos",i,[0,n.height]),e},{});var i=n.width/(e.columns.length-1),r=e.columns.reduce(function(t,e,n){return t[e]=n*i,t},{});return this.xBase=function(t){return r[t]},this.regScale("columns",this.scalesMap).regScale("color",this.color),{}},e.prototype.drawFrames=function(t){var e=this.config,n=this.config.options,i=this.scalesMap,r=this.xBase,a=this.color,o=f.line(),s=function(t){t.attr("d",function(t){return o(e.columns.map(function(e){return[r(e),i[e](t[i[e].dim])]}))})},u=function(t){t.attr("stroke",function(t){return a.toColor(a(t[a.dim]))}),t.attr("class",function(t){return Pe+"__line line "+a.toClass(a(t[a.dim]))+" foreground"})},l=function(t){var e=t.selectAll(".background").data(function(t){return t.part()});e.exit().remove(),e.call(s),e.enter().append("path").attr("class","background line").call(s);var n=t.selectAll(".foreground").data(function(t){return t.part()});n.exit().remove(),n.call(function(t){s(t),u(t)}),n.enter().append("path").call(function(t){s(t),u(t)})},c=n.container.selectAll(".lines-frame").data(t,function(t){return t.hash()});c.exit().remove(),c.call(l),c.enter().append("g").attr("class","lines-frame").call(l),this.subscribe(n.container.selectAll(".lines-frame .foreground"))},e.prototype.highlight=function(t){this.config.options.container.selectAll(".lines-frame .foreground").style("visibility",function(e){return t(e)?"":"hidden"})},e}(w),Tr=function(){function t(t,e){var n,i=this;if(this._fields={},Array.isArray(e.fitToFrameByDims)&&e.fitToFrameByDims.length){n=t.part(function(t){var n={};return"where"===t.type&&t.args?(n.type=t.type,n.args=e.fitToFrameByDims.reduce(function(e,n){return t.args.hasOwnProperty(n)&&(e[n]=t.args[n]),e},{})):n=t,n})}else n=t.full();var r=this.getVarSet(n,e);e.order&&(r=Vt(Kt(e.order,r),r)),this.vars=r;var a=r.map(function(t){return t});this.scaleConfig=e,this.scaleConfig.nice=this.scaleConfig.hasOwnProperty("nice")?this.scaleConfig.nice:this.scaleConfig.autoScale,this.addField("dim",this.scaleConfig.dim).addField("scaleDim",this.scaleConfig.dim).addField("scaleType",this.scaleConfig.type).addField("source",this.scaleConfig.source).addField("domain",function(){return i.vars}).addField("isInteger",a.every(Number.isInteger)).addField("originalSeries",function(){return a}).addField("isContains",function(t){return i.isInDomain(t)}).addField("isEmptyScale",function(){return i.isEmpty()}).addField("fixup",function(t){var e=i.scaleConfig;e.__fixup__=e.__fixup__||{},e.__fixup__=Object.assign(e.__fixup__,t(Object.assign({},e,e.__fixup__)))}).addField("commit",function(){i.scaleConfig=Object.assign(i.scaleConfig,i.scaleConfig.__fixup__),delete i.scaleConfig.__fixup__})}return t.prototype.isInDomain=function(t){return this.domain().indexOf(t)>=0},t.prototype.addField=function(t,e){return this._fields[t]=e,this[t]=e,this},t.prototype.getField=function(t){return this._fields[t]},t.prototype.isEmpty=function(){return!Boolean(this._fields.dim)},t.prototype.toBaseScale=function(t,e){var n=this;void 0===e&&(e=null);var i=Object.keys(this._fields).reduce(function(t,e){return t[e]=n._fields[e],t},t);return i.getHash=function(){return Dt([n.vars,e].map(function(t){return JSON.stringify}).join(""))},i.value=i,i},t.prototype.getVarSet=function(t,e){return Xt(e.hasOwnProperty("series")?e.series:t.map(function(t){return t[e.dim]}),"date"===e.dimType?function(t){return new Date(t).getTime()}:function(t){return t})},t}(),Er=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i._references=n.references,i._refCounter=n.refCounter,i.addField("scaleType","identity"),i}return m(e,t),e.prototype.create=function(){var t=this._references,e=this._refCounter;return this.toBaseScale(function(n,i){if(null==n){var r=t.get(i);null==r&&(r=e(),t.set(i,r))}else r=n;return r})},e}(Tr),Mr=y({},e,n),kr=function(t){function e(e,n){var i=t.call(this,e,n)||this,r="measure"!==n.dimType,a=i.scaleConfig.brewer||(r?Wt(20).map(function(t){return"color20-"+(1+t)}):["#eee","#000"]),o=i.scaleConfig;if(!r){var s=Mr.extent(i.vars),u=function(t){return Number.isFinite(t)||Ct(t)},l=u(o.min)?o.min:s[0],c=u(o.max)?o.max:s[1],d=[l,s[0]].filter(u),h=[c,s[1]].filter(u);if(s=[d.sort(function(t,e){return t-e})[0],h.sort(function(t,e){return e-t})[0]],o.nice&&s[0]<0&&s[1]>0){var f=Math.max.apply(Math,s.map(Math.abs));s=[-f,f]}i.vars=s}return i.addField("scaleType","color").addField("discrete",r).addField("brewer",a).addField("toColor",Ht).addField("toClass",Bt),i}return m(e,t),e.prototype.create=function(){var t=this.discrete,e=this.vars,n=this.getField("brewer"),i=t?this.createDiscreteScale(e,n):this.createContinuesScale(e,n);return this.toBaseScale(i)},e.prototype.createDiscreteScale=function(t,e){var n,i,r,a,o,s,u=function(t,e){var n=t.map(function(t){return String(t).toString()});return Mr.scaleOrdinal().range(e).domain(n)},l=function(t){return function(e){return t(String(e).toString())}};if(Array.isArray(e))n=l(u(t,e));else if("function"==typeof e)n=function(n){return e(n,l(u(t,Wt(20).map(function(t){return"color20-"+(1+t)}))))};else{if(!Ot(e))throw new Error("This brewer is not supported");i=e,r=function(){return"color-default"},a=Object.keys(i),o=a.map(function(t){return i[t]}),s=Mr.scaleOrdinal().range(o).domain(a),n=function(t){return i.hasOwnProperty(t)?s(String(t)):r(t)}}return n},e.prototype.createContinuesScale=function(t,e){if(!Array.isArray(e))throw new Error("This brewer is not supported");return Mr.scaleLinear().domain(Pt(t.map(function(t){return t-0}),e.length)).range(e)},e}(Tr),Ar={sqrt:function(t){return Math.sqrt(t)},linear:function(t){return t}},Cr=function(t){function n(n,i){var r=t.call(this,n,i)||this,a=r.scaleConfig,o=e.extent(r.vars),s=Number.isFinite(a.min)?a.min:o[0],u=Number.isFinite(a.max)?a.max:o[1];return r.vars=[Math.min.apply(Math,[s,o[0]].filter(Number.isFinite)),Math.max.apply(Math,[u,o[1]].filter(Number.isFinite))],r.addField("scaleType","size"),r.addField("funcType",i.func||"sqrt"),r}return m(n,t),n.prototype.isInDomain=function(t){var e=this.domain().sort(),n=e[0],i=e[e.length-1];return!Number.isNaN(n)&&!Number.isNaN(i)&&t<=i&&t>=n},n.prototype.create=function(){var t,e=this.scaleConfig,n=this.vars,i=Jt({},e,{func:"sqrt",minSize:0,maxSize:1}),r=i.func,a=i.minSize,o=i.maxSize,s=Ar[r],u=n.filter(function(t){return Number.isFinite(Number(t))});if(0===u.length)t=function(){return o};else{var l,c,d=Math.min.apply(Math,u),h=Math.max.apply(Math,u),f=s(Math.max(Math.abs(d),Math.abs(h),h-d));c=d<0?d:0,l=0===f?1:(o-a)/f,t=function(t){var e=null!==t?parseFloat(t):0;return Number.isFinite(e)?a+s(e-c)*l:o}}return this.toBaseScale(t)},n}(Tr),Or=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.addField("scaleType","ordinal").addField("discrete",!0),i}return m(e,t),e.prototype.create=function(t){var e=this.scaleConfig,i=this.vars,r=n.scalePoint().domain(i).range(t).padding(.5),a=Math.max.apply(Math,t),o=function(t){return"function"==typeof e.ratio?e.ratio(t,a,i):"object"==typeof e.ratio?e.ratio[t]:1/i.length},s=function(t){return e.ratio?a-i.slice(i.indexOf(t)+1).reduce(function(t,e){return t+a*o(e)},a*o(t)*.5):r(t)};return Object.keys(r).forEach(function(t){return s[t]=r[t]}),s.stepSize=function(t){return o(t)*a},this.toBaseScale(s,t)},e}(Tr),Lr=y({},e,n),Nr=function(t){function e(e,n){var i=t.call(this,e,n)||this,r=i.scaleConfig,a=i.vars,o=Lr.extent(a),s=null===r.min||void 0===r.min?o[0]:new Date(r.min).getTime(),u=null===r.max||void 0===r.max?o[1]:new Date(r.max).getTime(),l=[new Date(Math.min(s,o[0])),new Date(Math.max(u,o[1]))],c=E.get(r.period,{utc:r.utcTime});return r.fitToFrameByDims||null===c?i.vars=Xt(a.map(function(t){return new Date(t)}),function(t){return t.getTime()}).sort(function(t,e){return Number(e)-Number(t)}):i.vars=E.generate(l[0],l[1],r.period,{utc:r.utcTime}),i.periodGenerator=c,i.addField("scaleType","period").addField("utcTime",i.scaleConfig.utcTime).addField("period",i.scaleConfig.period).addField("discrete",!0),i}return m(e,t),e.prototype.isInDomain=function(t){var e=this.periodGenerator,n=new Date(t),i=(e?e.cast(n):n).getTime();return this.domain().map(function(t){return t.getTime()}).indexOf(i)>=0},e.prototype.create=function(t){var e=this.periodGenerator,n=this.vars,i=this.vars.map(function(t){return t.getTime()}),r=this.scaleConfig,a=Lr.scalePoint().domain(n).range(t).padding(.5),o=Lr.scalePoint().domain(i.map(String)).range(t).padding(.5),s=Math.max.apply(Math,t),u=function(t){var e=new Date(t).getTime();return"function"==typeof r.ratio?r.ratio(e,s,i):"object"==typeof r.ratio?r.ratio[e]:1/n.length},l=function(t){var n=new Date(t),a=(e?e.cast(n):n).getTime();return r.ratio?s-i.slice(i.indexOf(a)+1).reduce(function(t,e){return t+s*u(e)},s*u(t)*.5):o(String(a))};return Object.keys(a).forEach(function(t){return l[t]=a[t]}),l.stepSize=function(t){return u(t)*s},this.toBaseScale(l,t)},e}(Tr),Fr=y({},e,n,p),Rr=function(t){function e(e,n){var i,r=t.call(this,e,n)||this,a=r.scaleConfig,o=r.vars,s=a.period?E.get(r.scaleConfig.period,{utc:a.utcTime}):null,u=Fr.extent(o).map(s?function(t){return s.cast(new Date(t))}:function(t){return new Date(t)}),l=null==a.min?u[0]:new Date(a.min).getTime(),c=null==a.max?u[1]:new Date(a.max).getTime();if(o=[new Date(Math.min(l,Number(u[0]))),new Date(Math.max(c,Number(u[1])))],r.niceIntervalFn=null,a.nice&&!s){var d=a.niceInterval,h=d&&Dr(d)?a.utcTime?Fr["utc"+(i=d)[0].toUpperCase()+i.slice(1)]:Dr(d):null;r.niceIntervalFn=h||null,r.vars=Nt(o,r.niceIntervalFn,{utc:a.utcTime})}else r.vars=o;if(s&&Number(r.vars[0])===Number(r.vars[1])){var f=r.vars[0];r.vars[0]=s.cast(new Date(Number(f)-1)),r.vars[1]=s.next(f)}return r.periodGenerator=s,r.addField("scaleType","time").addField("utcTime",r.scaleConfig.utcTime).addField("period",r.scaleConfig.period),r}return m(e,t),e.prototype.isInDomain=function(t){var e=new Date(t);this.scaleConfig.period&&(e=this.periodGenerator.cast(e));var n=this.domain(),i=n[0],r=n[n.length-1];return!Number.isNaN(i)&&!Number.isNaN(r)&&e<=r&&e>=i},e.prototype.create=function(t){var e=this,n=this.vars,i=this.scaleConfig.utcTime,r=this.periodGenerator,a=(i?Fr.scaleUtc:Fr.scaleTime)().domain(n).range(t),o=function(t){var e=n[0],i=n[1];return t>i&&(t=i),t<e&&(t=e),a(new Date(t))};if(this.scaleConfig.period){var s=n[0],u=n[1];a.ticks=function(t){return"number"!=typeof t&&(t=10),function(t,e,n,i){void 0===i&&(i=10);var r=t[0],a=t[1],o=E.get(e,{utc:n}),s=Number(r),u=Number(a),l=Number(o.next(o.cast(r)))-Number(o.cast(r));if((u-s)/l<=i)return E.generate(r,a,e,{utc:n}).filter(function(t){return t>=r&&t<=a});return function(t,e,n){void 0===n&&(n=10);var i,r,a=Number(t[0]),o=Number(t[1]),s=Math.abs(o-a)/n,u=Fr.bisector(function(t){return t.duration}).right(zr,s);if(u===zr.length)i=e?Fr.utcYear:Fr.timeYear,r=Fr.tickStep(a/Ir.year.duration,o/Ir.year.duration,n);else if(u){var l=s/zr[u-1].duration,c=zr[u].duration/s,d=zr[l<c?u-1:u];i=e?d.time.utc:d.time.interval,r=d.step}else i=e?Fr.utcMillisecond:Fr.timeMillisecond,r=Fr.tickStep(a,o,n);return i.every(r).range(new Date(a),new Date(o+1))}(t,n,i)}([s,u],e.scaleConfig.period,i,t)};for(var l=r.cast(s);l<s;)l=r.next(l);var c=r.cast(u);o=function(t){var e=r.cast(t);return e<l&&(e=l),e>c&&(e=c),a(e)}}return Object.keys(a).forEach(function(t){return o[t]=a[t]}),o.stepSize=function(){return 0},this.toBaseScale(o,t)},e}(Tr);function Dr(t){return Fr["time"+t[0].toUpperCase()+t.slice(1)]}var jr,Ir={second:{duration:1e3,interval:Fr.timeSecond,utc:Fr.utcSecond},minute:{duration:6e4,interval:Fr.timeMinute,utc:Fr.utcMinute},hour:{duration:36e5,interval:Fr.timeHour,utc:Fr.utcHour},day:{duration:864e5,interval:Fr.timeDay,utc:Fr.utcDay},week:{duration:6048e5,interval:Fr.timeWeek,utc:Fr.utcWeek},month:{duration:2592e6,interval:Fr.timeMonth,utc:Fr.utcMonth},year:{duration:31536e6,interval:Fr.timeYear,utc:Fr.utcYear}},zr=[(jr=function(t,e){return{time:t,step:e,duration:e*t.duration}})(Ir.second,1),jr(Ir.second,5),jr(Ir.second,15),jr(Ir.second,30),jr(Ir.minute,1),jr(Ir.minute,5),jr(Ir.minute,15),jr(Ir.minute,30),jr(Ir.hour,1),jr(Ir.hour,3),jr(Ir.hour,6),jr(Ir.hour,12),jr(Ir.day,1),jr(Ir.day,2),jr(Ir.week,1),jr(Ir.month,1),jr(Ir.month,3),jr(Ir.year,1)];var Pr=y({},e,n),Hr=function(t){function e(e,n){var i=t.call(this,e,n)||this,r=i.scaleConfig,a=Pr.extent(i.vars),o=Number.isFinite(r.min)?r.min:a[0],s=Number.isFinite(r.max)?r.max:a[1];if(a=[Math.min.apply(Math,[o,a[0]].filter(Number.isFinite)),Math.max.apply(Math,[s,a[1]].filter(Number.isFinite))],i.vars=r.nice?Lt(a):Pr.extent(a),i.vars[0]===i.vars[1]){var u=Math.pow(10,Math.floor(Math.log(i.vars[0])/Math.LN10));i.vars[0]-=u,i.vars[1]+=u||10}return i.addField("scaleType","linear").addField("discrete",!1),i}return m(e,t),e.prototype.isInDomain=function(t){var e=this.domain(),n=e[0],i=e[e.length-1];return!Number.isNaN(n)&&!Number.isNaN(i)&&t<=i&&t>=n},e.prototype.create=function(t){var e=this.vars,n=this.extendScale(Pr.scaleLinear());return n.domain(e).range(t).clamp(!0),this.toBaseScale(n,t)},e.prototype.extendScale=function(t){var e=this,n=t.copy,i=t.ticks;return Object.assign(t,{stepSize:function(){return 0},copy:function(){return e.extendScale(n.call(t))},ticks:this.getField("isInteger")?function(e){return i.call(t,e).filter(Number.isInteger)}:t.ticks}),t},e}(Tr),Br=y({},e,n),qr=function(t){function e(e,n){var i,r,a,o,s,u,l,c,d=t.call(this,e,n)||this,h=d.scaleConfig,f=Br.extent(d.vars),p=Number.isFinite(h.min)?h.min:f[0],g=Number.isFinite(h.max)?h.max:f[1];return Wr(f=[Math.min.apply(Math,[p,f[0]].filter(Number.isFinite)),Math.max.apply(Math,[g,f[1]].filter(Number.isFinite))]),h.nice&&(r=(i=f)[0]>0,a=i.map(function(t){return Math.abs(t)}),o=Math.max.apply(Math,a),s=Math.min.apply(Math,a).toExponential().split("e"),u=o.toExponential().split("e"),l=parseFloat(Math.floor(Number(s[0]))+"e"+s[1]),c=parseFloat(Math.ceil(Number(u[0]))+"e"+u[1]),f=r?[l,c]:[-c,-l]),d.vars=f,d.addField("scaleType","logarithmic").addField("discrete",!1),d}return m(e,t),e.prototype.isInDomain=function(t){var e=this.domain(),n=e[0],i=e[e.length-1];return!Number.isNaN(n)&&!Number.isNaN(i)&&t<=i&&t>=n},e.prototype.create=function(t){var e=this.vars;Wr(e);var n=function t(e){var n=e.copy;e.ticks=function(t){for(var n=[],i=Br.extent(e.domain()),r=Math.floor(Ur(i[0])),a=Math.ceil(Ur(i[1])),o=Math.ceil(10*(a-r)/(10*Math.ceil(t/10))),s=r;s<=a;s+=o)for(var u=1;u<=10;u++){var l=Math.pow(u,o)*Math.pow(10,s);(l=parseFloat(l.toExponential(0)))>=i[0]&&l<=i[1]&&n.push(l)}return n};e.copy=function(){var i=n.call(e);return t(i),i};return e}(Br.scaleLog()).domain(e).range(t);return n.stepSize=function(){return 0},this.toBaseScale(n,t)},e}(Tr);function Ur(t){return Math.log(t)/Math.LN10}function Wr(t){if(t[0]*t[1]<=0)throw new M("Logarithmic scale domain cannot cross zero.",k.INVALID_LOG_DOMAIN)}var Gr,Xr=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.addField("scaleType","value").addField("georole",n.georole),i}return m(e,t),e.prototype.create=function(){return this.toBaseScale(function(t){return t})},e}(Tr),Yr=y({},e,n),Vr=function(t){function e(e,n){var i=t.call(this,e,n)||this,r=i.scaleConfig,a=Yr.extent(i.vars),o=Number.isFinite(r.min)?r.min:a[0],s=Number.isFinite(r.max)?r.max:a[1];a=[Math.min(o,a[0]),Math.max(s,a[1])],i.vars=r.nice?Lt(a):Yr.extent(a);var u=Wt(10).map(function(t){return"rgba(90,180,90,"+(.2+t*(.8/9)).toFixed(2)+")"}),l=r.brewer||u;return i.addField("scaleType","fill").addField("brewer",l),i}return m(e,t),e.prototype.isInDomain=function(t){var e=this.domain(),n=e[0],i=e[e.length-1];return!Number.isNaN(n)&&!Number.isNaN(i)&&t<=i&&t>=n},e.prototype.create=function(){var t=this.vars,e=this.getField("brewer");if(!Array.isArray(e))throw new Error("This brewer is not supported");var n=e.length,i=(t[1]-t[0])/n,r=Wt(n-1).map(function(t){return t+1}).reduce(function(e,n){return e.concat([t[0]+n*i])},[]),a=Yr.scaleThreshold().domain(r).range(e);return this.toBaseScale(a)},e}(Tr),Kr=function(t){return t||null},Jr=function(t,e){return void 0===e&&(e=null),Array.isArray(t)?0===t.length?[e]:t:[t]},$r=function(t,e){return{type:t,x:e.x,y:e.y,identity:e.identity,size:e.size,color:e.color,split:e.split,label:e.label,guide:{color:e.colorGuide,size:e.sizeGuide},flip:e.flip,stack:e.stack}},Qr={SUCCESS:"SUCCESS",WARNING:"WARNING",FAIL:"FAIL"},Zr=((Gr={})[Qr.SUCCESS]=function(t){return t},Gr[Qr.FAIL]=function(t,e){throw new Error((e.messages||[]).join("\n")||["This configuration is not supported,","See https://api.taucharts.com/basic/facet.html#easy-approach-for-creating-facet-chart"].join(" "))},Gr[Qr.WARNING]=function(t,e,n){var i=e.axis,r=e.indexMeasureAxis[0],a=t[r],o=t.filter(function(t){return t!==a});o.push(a);var s=n[r][i]||{},u=n[n.length-1][i]||{};return n[n.length-1][i]=s,n[r][i]=u,o},Gr);function ta(t,e,n){return e.reduce(function(e,i,r){var a=t[i];return a?e.status!=Qr.FAIL&&("measure"===a.type&&(e.countMeasureAxis++,e.indexMeasureAxis.push(r)),"measure"!==a.type&&1===e.countMeasureAxis?e.status=Qr.WARNING:e.countMeasureAxis>1&&(e.status=Qr.FAIL,e.messages.push('There is more than one measure dimension for "'+n+'" axis'))):(e.status=Qr.FAIL,i?e.messages.push('"'+i+'" dimension is undefined for "'+n+'" axis'):e.messages.push('"'+n+'" axis should be specified')),e},{status:Qr.SUCCESS,countMeasureAxis:0,indexMeasureAxis:[],messages:[],axis:n})}function ea(t){for(var e=Jr(t.x),n=Jr(t.y),i=Math.max(e.length,n.length),r=Jr(t.guide||{},{}),a=i-r.length,o=0;o<a;o++)r.push({});r=r.slice(0,i);var s=ta(t.dimensions,e,"x"),u=ta(t.dimensions,n,"y");e=Zr[s.status](e,s,r),n=Zr[u.status](n,u,r);var l=["identity","color","size","label","split"].reduce(function(e,n){var i,r=t[n],a=(t.dimensions,null==(i=r)?i:String(i));return null!=a&&(e[n]=a),e},{});return Object.assign({},t,{x:e,y:n,guide:r},l)}function na(t,e){for(var n=e.x,i=e.y,r=e.guide,a=Math.max(n.length,i.length),o={type:"COORDS.RECT",unit:[]},s=[].concat(n),u=[].concat(i),l=[].concat(r),c=a;c>0;c--){var d=s.pop(),h=u.pop(),f=l.pop()||{};c===a?(o.x=d,o.y=h,o.unit.push($r(t,{x:Kr(d),y:Kr(h),identity:e.identity,split:e.split,color:e.color,label:e.label,size:e.size,flip:e.flip,stack:e.stack,colorGuide:f.color,sizeGuide:f.size})),o.guide=Jt(f,{x:{label:d},y:{label:h}})):o={type:"COORDS.RECT",x:Kr(d),y:Kr(h),unit:[o],guide:Jt(f,{x:{label:d},y:{label:h}})}}return e.spec={dimensions:e.dimensions,unit:o},e}var ia,ra,aa,oa,sa,ua=function(t){var e,n,i,r=ea(t);return n=((e=r).flip?e.y:e.x).indexOf(e.color)>=0,i=e.guide[e.guide.length-1],n&&!i.hasOwnProperty("enableColorToBarPosition")&&(i.enableColorToBarPosition=!1),na("ELEMENT.INTERVAL",r=e)},la=function(t){var e=ea(t),n=e.data,i=e.settings.log,r=(0,{horizontal:function(t){return{prop:t.x[t.x.length-1],flip:!1}},vertical:function(t){return{prop:t.y[t.y.length-1],flip:!0}},auto:function(t){var e,r=t.x,a=t.y,o=r[r.length-1],s=r.slice(0,r.length-1),u=a[a.length-1],l=a.slice(0,a.length-1),c=t.color,d=s.concat(l).concat([c]).filter(function(t){return null!==t}),h=-1,f=[[[o].concat(d),u],[[u].concat(d),o]],p=null;return f.some(function(t,e){var r=t[0],a=t[1],o=cn(n,r,[a]);return o.result?h=e:i(["Attempt to find a functional relation between",t[0]+" and "+t[1]+" is failed.","There are several "+o.error.keyY+" values (e.g. "+o.error.errY.join(",")+")","for ("+o.error.keyX+" = "+o.error.valX+")."].join(" ")),o.result})?(e=f[h][0][0],p=0!==h):(i("All attempts are failed. Gonna transform AREA to general PATH."),e=null),{prop:e,flip:p}}}["boolean"!=typeof e.flip?"auto":e.flip?"vertical":"horizontal"])(e);return null!==r.prop&&(e.data=pn(n,r.prop,e.dimensions[r.prop]),e.flip=r.flip),na("ELEMENT.AREA",e)},ca=function(){function t(t){this.unitRef=t}return t.prototype.value=function(){return this.unitRef},t.prototype.clone=function(){return JSON.parse(JSON.stringify(this.unitRef))},t.prototype.traverse=function(t){var e=function(t,n,i){n(t,i),(t.units||[]).map(function(i){return e(i,n,t)})};return e(this.unitRef,t,null),this},t.prototype.reduce=function(t,e){var n=e;return this.traverse(function(e,i){return n=t(n,e,i)}),n},t.prototype.addFrame=function(t){return this.unitRef.frames=this.unitRef.frames||[],t.key.__layerid__=["L",(new Date).getTime(),this.unitRef.frames.length].join(""),t.source=t.hasOwnProperty("source")?t.source:this.unitRef.expression.source,t.pipe=t.pipe||[],this.unitRef.frames.push(t),this},t.prototype.addTransformation=function(t,e){return this.unitRef.transformation=this.unitRef.transformation||[],this.unitRef.transformation.push({type:t,args:e}),this},t.prototype.isCoordinates=function(){return 0===(this.unitRef.type||"").toUpperCase().indexOf("COORDS.")},t.prototype.isElementOf=function(t){if(this.isCoordinates())return!1;var e=(this.unitRef.type||"").split("/");return 1===e.length&&e.unshift("RECT"),e[0].toUpperCase()===t.toUpperCase()},t}(),da=function(){function t(t){this.specRef=t}return t.prototype.value=function(){return this.specRef},t.prototype.unit=function(t){return t&&(this.specRef.unit=t),new ca(this.specRef.unit)},t.prototype.addTransformation=function(t,e){return this.specRef.transformations=this.specRef.transformations||{},this.specRef.transformations[t]=e,this},t.prototype.getSettings=function(t){return this.specRef.settings[t]},t.prototype.setSettings=function(t,e){return this.specRef.settings=this.specRef.settings||{},this.specRef.settings[t]=e,this},t.prototype.getScale=function(t){return this.specRef.scales[t]},t.prototype.addScale=function(t,e){return this.specRef.scales[t]=e,this},t.prototype.regSource=function(t,e){return this.specRef.sources[t]=e,this},t.prototype.getSourceData=function(t){return(this.specRef.sources[t]||{data:[]}).data},t.prototype.getSourceDim=function(t,e){return(this.specRef.sources[t]||{dims:{}}).dims[e]||{}},t}(),ha={},fa=function(){function t(){}return t.unit=function(t){return new ca(t)},t.spec=function(t){return new da(t)},t.cloneObject=function(t){return JSON.parse(JSON.stringify(t))},t.depthFirstSearch=function(e,n){if(n(e))return e;for(var i=e.hasOwnProperty("frames")?e.frames:[{units:e.units}],r=0;r<i.length;r++)for(var a=i[r].units||[],o=0;o<a.length;o++){var s=t.depthFirstSearch(a[o],n);if(s)return s}},t.traverseSpec=function(t,e){var n=function(t,e,i){e(t,i),(t.units||[]).map(function(i){return n(i,e,t)})};n(t.unit,e,null)},t.extractFieldsFormatInfo=function(e){var n=e.scales,i=function(t){return!n[t].dim},r=function(t,e,i){var r=e.guide||{},a=n[e[i]],o=r[i]||{};t[a.dim]=t[a.dim]||{label:[],format:[],nullAlias:[],tickLabel:[]};var s=o.label,u=o.label||{};t[a.dim].label.push("string"==typeof s?s:u._original_text||u.text);var l=o.tickFormat||o.tickPeriod;t[a.dim].format.push(l),t[a.dim].nullAlias.push(o.tickFormatNullAlias),t[a.dim].tickLabel.push(o.tickLabel)},a=[];t.traverseSpec(e,function(t){a.push(t)});var o=a.reduce(function(t,e){return"COORDS.RECT"===e.type&&e.hasOwnProperty("x")&&!i(e.x)&&r(t,e,"x"),"COORDS.RECT"===e.type&&e.hasOwnProperty("y")&&!i(e.y)&&r(t,e,"y"),e.hasOwnProperty("color")&&!i(e.color)&&r(t,e,"color"),e.hasOwnProperty("size")&&!i(e.size)&&r(t,e,"size"),e.hasOwnProperty("label")&&!i(e.label)&&r(t,e,"label"),t},{}),s=function(t,e){return t.filter(function(t){return t})[0]||e};return Object.keys(o).reduce(function(t,n){t[n]={},t[n].label=s(o[n].label,n);var i=s(o[n].format,null);t[n].nullAlias=s(o[n].nullAlias,"No "+t[n].label),t[n].tickLabel=s(o[n].tickLabel,null);var r="x-time-auto"===i?e.settings.utcTime?"day-utc":"day":i,a=t[n].nullAlias,u=r?Tn.get(r,a):function(t){return null===t?a:String(t)};if(t[n].format=u,t[n].tickLabel){var l=n.replace("."+t[n].tickLabel,"");t[l]={label:t[n].label,nullAlias:t[n].nullAlias,tickLabel:t[n].tickLabel,format:function(e){return u(e&&e[t[l].tickLabel])},isComplexField:!0},t[n].parentField=l}return t},{})},t.getFieldFormatters=function(e,n){var i=t.extractFieldsFormatInfo(e);Object.keys(i).forEach(function(t){i[t].parentField&&delete i[t]});return Object.keys(n).forEach(function(t){var e,r,a=(e=n[t],r={},"function"==typeof e||"string"==typeof e?r={format:e}:Ot(e)&&(r=te(e,"label","format","nullAlias")),r);i[t]=Object.assign({label:t,nullAlias:"No "+t},i[t]||{},te(a,"label","nullAlias")),a.hasOwnProperty("format")?i[t].format="function"==typeof a.format?a.format:Tn.get(a.format,i[t].nullAlias):i[t].format=i[t].hasOwnProperty("format")?i[t].format:Tn.get(null,i[t].nullAlias)}),Object.keys(i).reduce(function(t,e){var n=i[e];return t[e]={label:n.label,format:n.format},t},{})},t.tokens=function(){return{reg:function(t,e){return ha[t]=e,this},get:function(t){return ha[t]||t}}},t.getParentUnit=function(t,e){var n=null,i=function(t,r){return t.uid===e.uid?(n=r,!0):(t.frames?t.frames.some(function(e){return(e.units||[]).some(function(e){return i(e,t)})}):(t.units||[]).some(function(e){return i(e,t)}),!1)};return i(t.unit,null),n},t}();if(window.requestAnimationFrame||(ia=0,window.requestAnimationFrame=function(t){var e=Date.now(),n=Math.max(0,16-e+ia);return ia=e+n,setTimeout(function(){t.call(null,e+n)},n)},window.cancelAnimationFrame=function(t){clearTimeout(t)}),window.requestIdleCallback||(window.requestIdleCallback=function(t,e){return setTimeout(t,e&&e.timeout?e.timeout:0)},window.cancelIdleCallback=function(t){clearTimeout(t)}),Number.isFinite||Object.defineProperty(Number,"isFinite",{value:function(t){return"number"==typeof t&&isFinite(t)},configurable:!0,enumerable:!1,writable:!0}),Number.isNaN||Object.defineProperty(Number,"isNaN",{value:function(t){return"number"==typeof t&&isNaN(t)},configurable:!0,enumerable:!1,writable:!0}),Number.isInteger||Object.defineProperty(Number,"isInteger",{value:function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},configurable:!0,enumerable:!1,writable:!0}),Number.MAX_SAFE_INTEGER||Object.defineProperty(Number,"MAX_SAFE_INTEGER",{value:9007199254740991,configurable:!1,enumerable:!1,writable:!1}),Math.sign||(Math.sign=function(t){return(t>0)-(t<0)||Number(t)}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(t){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,n=Object(this),i=n.length>>>0,r=arguments[1],a=0;a<i;a++)if(e=n[a],t.call(r,e,a,n))return e},configurable:!0,enumerable:!1,writable:!0}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(t){if(null==this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,n=Object(this),i=n.length>>>0,r=arguments[1],a=0;a<i;a++)if(e=n[a],t.call(r,e,a,n))return a;return-1},configurable:!0,enumerable:!1,writable:!0}),!Array.from){Object.defineProperty(Array,"from",{value:(ra=Object.prototype.toString,aa=function(t){return"function"==typeof t||"[object Function]"===ra.call(t)},oa=Math.pow(2,53)-1,sa=function(t){var e,n=(e=Number(t),isNaN(e)?0:0!==e&&isFinite(e)?(e>0?1:-1)*Math.floor(Math.abs(e)):e);return Math.min(Math.max(n,0),oa)},function(t){var e=Object(t);if(null==t)throw new TypeError("Array.from requires an array-like object - not null or undefined");var n,i=arguments.length>1?arguments[1]:void 0;if(void 0!==i){if(!aa(i))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(n=arguments[2])}for(var r,a=sa(e.length),o=aa(this)?Object(new this(a)):new Array(a),s=0;s<a;)r=e[s],o[s]=i?void 0===n?i(r,s):i.call(n,r,s):r,s+=1;return o.length=a,o}),configurable:!0,enumerable:!1,writable:!0});var pa=Map.prototype.set;Object.defineProperty(Map.prototype,"set",{value:function(){return pa.apply(this,arguments),this},configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(Map.prototype,"values",{value:function(){var t={},e=0;return this.forEach(function(n){return t[String(e++)]=n}),t.length=e,t},configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(Map.prototype,"entries",{value:function(){var t={},e=0;return this.forEach(function(n,i){return t[String(e++)]=[i,n]}),t.length=e,t},configurable:!0,enumerable:!1,writable:!0})}Object.assign||Object.defineProperty(Object,"assign",{value:function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(void 0!==i&&null!==i)for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])}return e},configurable:!0,enumerable:!1,writable:!0}),Element.prototype.matches||Object.defineProperty(Element.prototype,"matches",{value:Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,configurable:!0,enumerable:!0,writable:!0});var ga={},ma={},ya={errorCodes:k,unitsRegistry:an,scalesRegistry:un,grammarRegistry:C,tickFormat:Tn,isChartElement:oe,utils:se,svgUtils:Le,domUtils:Te,tickPeriod:E,colorBrewers:{add:function(t,e){t in ga||(ga[t]=e)},get:function(t){return ga[t]}},d3_animationInterceptor:lt,pluginsSDK:fa,plugins:{add:function(t,e){if(t in ma)throw new Error("Plugin is already registered.");ma[t]=e},get:function(t){return ma[t]||function(e){throw new Error('"'+t+'" plugin is not defined')}}},chartTypesRegistry:oi,globalSettings:{animationSpeed:750,renderingTimeout:1e4,asyncRendering:!0,syncRenderingInterval:50,syncPointerEvents:!1,handleRenderingErrors:!1,experimentalShouldAnimate:function(t){var e=function(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg",t);return Object.keys(e).forEach(function(t){return n.setAttribute(t,String(e[t]))}),n},n=document.createElement("div");n.style.position="absolute",n.style.visibility="hidden",document.body.appendChild(n);var i=e("svg",{width:100,height:100});n.appendChild(i);var r,a,o,s=performance.now();for(r=0;r<10;r++)for(a=0;a<10;a++)o=e("circle",{fill:"black",r:5,cx:10*r,cy:10*a}),i.appendChild(o);var u=performance.now()-s;return document.body.removeChild(n),t.sources["/"].data.length*u<500},defaultNiceColor:!0,defaultColorBrewer:["#fde725","#fbe723","#f8e621","#f6e620","#f4e61e","#f1e51d","#efe51c","#ece51b","#eae51a","#e7e419","#e5e419","#e2e418","#dfe318","#dde318","#dae319","#d8e219","#d5e21a","#d2e21b","#d0e11c","#cde11d","#cae11f","#c8e020","#c5e021","#c2df23","#c0df25","#bddf26","#bade28","#b8de29","#b5de2b","#b2dd2d","#b0dd2f","#addc30","#aadc32","#a8db34","#a5db36","#a2da37","#a0da39","#9dd93b","#9bd93c","#98d83e","#95d840","#93d741","#90d743","#8ed645","#8bd646","#89d548","#86d549","#84d44b","#81d34d","#7fd34e","#7cd250","#7ad151","#77d153","#75d054","#73d056","#70cf57","#6ece58","#6ccd5a","#69cd5b","#67cc5c","#65cb5e","#63cb5f","#60ca60","#5ec962","#5cc863","#5ac864","#58c765","#56c667","#54c568","#52c569","#50c46a","#4ec36b","#4cc26c","#4ac16d","#48c16e","#46c06f","#44bf70","#42be71","#40bd72","#3fbc73","#3dbc74","#3bbb75","#3aba76","#38b977","#37b878","#35b779","#34b679","#32b67a","#31b57b","#2fb47c","#2eb37c","#2db27d","#2cb17e","#2ab07f","#29af7f","#28ae80","#27ad81","#26ad81","#25ac82","#25ab82","#24aa83","#23a983","#22a884","#22a785","#21a685","#21a585","#20a486","#20a386","#1fa287","#1fa187","#1fa188","#1fa088","#1f9f88","#1f9e89","#1e9d89","#1e9c89","#1e9b8a","#1f9a8a","#1f998a","#1f988b","#1f978b","#1f968b","#1f958b","#1f948c","#20938c","#20928c","#20928c","#21918c","#21908d","#218f8d","#218e8d","#228d8d","#228c8d","#228b8d","#238a8d","#23898e","#23888e","#24878e","#24868e","#25858e","#25848e","#25838e","#26828e","#26828e","#26818e","#27808e","#277f8e","#277e8e","#287d8e","#287c8e","#297b8e","#297a8e","#29798e","#2a788e","#2a778e","#2a768e","#2b758e","#2b748e","#2c738e","#2c728e","#2c718e","#2d718e","#2d708e","#2e6f8e","#2e6e8e","#2e6d8e","#2f6c8e","#2f6b8e","#306a8e","#30698e","#31688e","#31678e","#31668e","#32658e","#32648e","#33638d","#33628d","#34618d","#34608d","#355f8d","#355e8d","#365d8d","#365c8d","#375b8d","#375a8c","#38598c","#38588c","#39568c","#39558c","#3a548c","#3a538b","#3b528b","#3b518b","#3c508b","#3c4f8a","#3d4e8a","#3d4d8a","#3e4c8a","#3e4a89","#3e4989","#3f4889","#3f4788","#404688","#404588","#414487","#414287","#424186","#424086","#423f85","#433e85","#433d84","#443b84","#443a83","#443983","#453882","#453781","#453581","#463480","#46337f","#46327e","#46307e","#472f7d","#472e7c","#472d7b","#472c7a","#472a7a","#482979","#482878","#482677","#482576","#482475","#482374","#482173","#482071","#481f70","#481d6f","#481c6e","#481b6d","#481a6c","#48186a","#481769","#481668","#481467","#471365","#471164","#471063","#470e61","#470d60","#460b5e","#460a5d","#46085c","#46075a","#450559","#450457","#440256","#440154"],defaultClassBrewer:Wt(20).map(function(t){return"color20-"+(1+t)}),log:function(t,e){e=e||"INFO",Array.isArray(t)||(t=[t]),console[e.toLowerCase()].apply(console,t)},facetLabelDelimiter:"  ",excludeNull:!0,minChartWidth:300,minChartHeight:200,minFacetWidth:150,minFacetHeight:100,specEngine:[{name:"COMPACT",width:600,height:400},{name:"AUTO",width:Number.MAX_VALUE,height:Number.MAX_VALUE}],fitModel:"normal",layoutEngine:"EXTRACT",autoRatio:!0,defaultSourceMap:["https://raw.githubusercontent.com","TargetProcess/tauCharts/master/src/addons","world-countries.json"].join("/"),getAxisTickLabelSize:Qt(me,function(t){return String(String(t).length)}),getScrollbarSize:de,avoidScrollAtRatio:1.5,xAxisTickLabelLimit:150,yAxisTickLabelLimit:150,xTickWordWrapLinesLimit:2,yTickWordWrapLinesLimit:2,xTickWidth:9,yTickWidth:9,distToXAxisLabel:10,distToYAxisLabel:10,xAxisPadding:20,yAxisPadding:20,xFontLabelDescenderLineHeight:4,xFontLabelHeight:10,yFontLabelHeight:10,xDensityPadding:2,yDensityPadding:2,"xDensityPadding:measure":8,"yDensityPadding:measure":8,utcTime:!1,defaultFormats:{measure:"x-num-auto","measure:time":"x-time-auto"}}};ni.__api__=ya,ni.globalSettings=ya.globalSettings,ya.unitsRegistry.reg("COORDS.RECT",yi).reg("COORDS.MAP",Si).reg("COORDS.PARALLEL",xi).reg("ELEMENT.GENERIC.CARTESIAN",pt).reg("ELEMENT.POINT",Ui,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.LINE",_r,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.PATH",yr,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.AREA",mr,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.INTERVAL",wr,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.INTERVAL.STACKED",wr,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.INTERVAL.STACKED",wr,"ELEMENT.GENERIC.CARTESIAN").reg("PARALLEL/ELEMENT.LINE",Sr),ya.scalesRegistry.reg("identity",Er,function(t,e){return Jt(t,{references:e.references,refCounter:e.refCounter})}).reg("color",kr,function(t,e){return Jt(t,{nice:e.defaultNiceColor,brewer:"measure"===t.dimType?e.defaultColorBrewer:e.defaultClassBrewer})}).reg("fill",Vr).reg("size",Cr).reg("ordinal",Or).reg("period",Nr,function(t,e){return Jt(t,{utcTime:e.utcTime})}).reg("time",Rr,function(t,e){return Jt(t,{utcTime:e.utcTime})}).reg("linear",Hr).reg("logarithmic",qr).reg("value",Xr);var va=[function(t){return t.data?[]:["[data] must be specified"]}];ya.chartTypesRegistry.add("scatterplot",function(t){return na("ELEMENT.POINT",ea(t))},va).add("line",function(t){var e=ea(t),n=e.data,i=e.settings.log,r={none:function(){return null},horizontal:function(t){return t.x[t.x.length-1]},vertical:function(t){return t.y[t.y.length-1]},auto:function(t){var e,r=t.x,a=t.y,o=r[r.length-1],s=r.slice(0,r.length-1),u=a[a.length-1],l=a.slice(0,a.length-1),c=t.color,d=s.concat(l).concat([c]).filter(function(t){return null!==t}),h=-1,f=[[[o].concat(d),u],[[u].concat(d),o]];return f.some(function(t,e){var r=t[0],a=t[1],o=cn(n,r,[a]);return o.result?h=e:i(["Attempt to find a functional relation between",t[0]+" and "+t[1]+" is failed.","There are several "+o.error.keyY+" values (e.g. "+o.error.errY.join(",")+")","for ("+o.error.keyX+" = "+o.error.valX+")."].join(" ")),o.result})?e=f[h][0][0]:(i(["All attempts are failed.","Will orient line horizontally by default.","NOTE: the [scatterplot] chart is more convenient for that data."].join(" ")),e=o),e}},a=(e.lineOrientation||"").toLowerCase(),o=(r.hasOwnProperty(a)?r[a]:r.auto)(e);return null!==o&&(e.data=pn(n,o,e.dimensions[o])),na("ELEMENT.LINE",e)},va).add("area",la,va).add("stacked-area",function(t){return la(Jt(t,{stack:!0}))},va).add("bar",function(t){return ua(Jt(t,{flip:!1}))},va).add("horizontalBar",function(t){return ua(Jt({flip:!0},t))},va).add("horizontal-bar",function(t){return ua(Jt({flip:!0},t))},va).add("stacked-bar",function(t){return ua(Jt({flip:!1,stack:!0},t))},va).add("horizontal-stacked-bar",function(t){return ua(Jt({flip:!0,stack:!0},t))},va).add("map",function(t){var e=Object.assign({sourcemap:t.settings.defaultSourceMap},t.guide||{});e.size=Jt(e.size||{},{min:1,max:10}),e.code=Jt(e.code||{},{georole:"countries"});var n={},i=function(t,e,i){var r;void 0===i&&(i={});var a,o=e;return e?(r=t+"_"+e,a="/"):(r=t+":default",a="?"),n.hasOwnProperty(r)||(n[r]=Object.assign({type:t,source:a,dim:o},i)),r};return{sources:{"?":{dims:{},data:[{}]},"/":{dims:Object.keys(t.dimensions).reduce(function(e,n){return e[n]={type:t.dimensions[n].type},e},{}),data:t.data}},scales:n,unit:{type:"COORDS.MAP",expression:{operator:"none",source:"/"},code:i("value",t.code,e.code),fill:i("fill",t.fill,e.fill),size:i("size",t.size,e.size),color:i("color",t.color,e.color),latitude:i("linear",t.latitude,{nice:!1}),longitude:i("linear",t.longitude,{nice:!1}),guide:e},plugins:t.plugins||[]}},va.concat([function(t){var e=t.fill&&t.code;if(t.fill&&!e)return"[code] must be specified when using [fill]"},function(t){var e=t.latitude&&t.longitude;if((t.latitude||t.longitude)&&!e)return"[latitude] and [longitude] both must be specified"}])).add("parallel",function(t){var e=Object.assign({columns:{}},t.guide||{}),n={},i=function(t,e,i){var r;void 0===i&&(i={});var a,o=e;return e?(r=t+"_"+e,a="/"):(r=t+":default",a="?"),n.hasOwnProperty(r)||(n[r]=Object.assign({type:t,source:a,dim:o},i)),r},r=t.columns.map(function(n){return i(t.dimensions[n].scale,n,e.columns[n])});return{sources:{"?":{dims:{},data:[{}]},"/":{dims:Object.keys(t.dimensions).reduce(function(e,n){return e[n]={type:t.dimensions[n].type},e},{}),data:t.data}},scales:n,unit:{type:"COORDS.PARALLEL",expression:{operator:"none",source:"/"},columns:r,guide:e,units:[{type:"PARALLEL/ELEMENT.LINE",color:i("color",t.color,e.color),columns:r,expression:{operator:"none",source:"/"}}]},plugins:t.plugins||[]}},va.concat([function(t){if(!(t.columns&&t.columns.length>1))return"[columns] property must contain at least 2 dimensions"}]));return{GPL:ze,Plot:ni,Chart:si,api:ya,version:"{{VERSION}}"}}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("taucharts"),require("d3-color")):"function"==typeof define&&define.amd?define(["taucharts","d3-color"],e):(t.Taucharts=t.Taucharts||{},t.Taucharts.Annotations=e(t.Taucharts,t.d3))}(this,function(t,e){"use strict";var n=(t=t&&t.hasOwnProperty("default")?t.default:t).api.utils,i=t.api.pluginsSDK,r=function(t,e,n){"front"===n?t.push(e):t.unshift(e)},a=function(e){return function(n){var i={},r=[{dim:n.scaleX.dim,scale:n.scaleY,method:"yi",k:-1},{dim:n.scaleY.dim,scale:n.scaleX,method:"xi",k:1},{dim:null,scale:null,method:null,k:null}].find(function(t){return Array.isArray(e.dim)?e.dim.indexOf(t.dim)>=0:t.dim===e.dim});if(null===r.method)return i;var a=r.k,o={l:-.5,r:.5},s=r.method,u=r.scale;return i[s]=function(e){var i=(o[e.__pos__]||0)*a;if(u.discrete)return n[s](e)+u.stepSize(e[u.dim])*i;if(u.period){for(var r=t.api.tickPeriod.get(u.period,{utc:u.utcTime}),l=u.domain(),c=r.cast(l[0]);c<l[0];)c=r.next(c);var d=r.cast(l[1]),h=(u(d)-u(c))/(d-c);switch(e.__pos__){case"l":var f=Math.min(0,l[0]-c);return u(c)+h*f;case"r":f=Math.max(0,l[1]-d);return u(d)+h*f}}return n[s](e)},i}};function o(o){var s=n.defaults(o||{},{items:[],showValue:!1,formatters:{}}),u="annotation_text";return{init:function(e){var n=this;this._chart=e;var i=e.getSpec();i.scales[u]={type:"value",dim:"text",source:"?"},i.transformations=i.transformations||{};var r=function(t){return i.settings.log(t,"LOG")};this._dataRefs={},i.transformations.dataRange=function(a,o){var s=o.from,u=o.to,l=e.getScaleInfo(o.primaryScale);if(l.period){var c=t.api.tickPeriod.get(l.period,{utc:i.settings.utcTime});s=c.cast(new Date(o.from)),u=c.cast(new Date(o.to))}var d=!l.isInDomain(s),h=!l.isInDomain(u);if(l.discrete?d||h:d&&h)return r("Annotation is out of domain"),[];var f=e.getScaleInfo(o.secondaryScale),p=f.domain(),g=[p[0],p[p.length-1]],m=l.dim,y=f.dim,v={},x={},_={},b={};return v.__pos__="l",v[m]=s,v[y]=g[0],x.__pos__="l",x[m]=u,x[y]=g[0],_.__pos__="r",_[m]=u,_[y]=g[1],b.__pos__="r",b[m]=s,b[y]=g[1],("y"===o.axis?_:b).text=o.text,n._useSavedDataRefs([v,x,_,b],String([m,s,u]))},i.transformations.dataLimit=function(a,o){var u=o.primaryScale,l=o.secondaryScale,c=e.getScaleInfo(u),d=c.period?t.api.tickPeriod.get(c.period,{utc:i.settings.utcTime}).cast(new Date(o.from)):o.from;if(!c.isInDomain(d))return r("Annotation is out of domain"),[];var h=e.getScaleInfo(l),f=h.domain(),p=[f[0],f[f.length-1]],g={},m={},y=c.dim,v=h.dim;if(g[y]=d,g[v]=p[0],g.__pos__="l",s.showValue){var x=n._getFormat(y);g.text=x(d)}return m[y]=d,m[v]=p[1],m.__pos__="r",m.text=o.text,n._useSavedDataRefs([g,m],String(d))},i.transformations.lineNoteData=function(i,a){var o=a.xScale,u=a.yScale,l=e.getScaleInfo(o),c=e.getScaleInfo(u),d=l.period?t.api.tickPeriod.get(l.period,{utc:l.utcTime}):null,h=c.period?t.api.tickPeriod.get(c.period,{utc:c.utcTime}):null,f=a.points.map(function(t){return[d?d.cast(t[0]):t[0],h?h.cast(t[1]):t[1]]});if(f.some(function(t){return!l.isInDomain(t[0])||!c.isInDomain(t[1])}))return r("Annotation is out of domain"),[];var p=l.dim,g=c.dim,m=f.map(function(t,e){return(i={})[p]=t[0],i[g]=t[1],i.text=s.showValue&&0===e?n._getFormat(g)(t[1]):a.text,i;var i});return n._useSavedDataRefs(m,JSON.stringify([p,g,a.points]))}},addAreaNote:function(t,e,n){var i,o=t.scales[e.x],s=t.scales[e.y],l=n.dim===o.dim?["x","y"]:n.dim===s.dim?["y","x"]:null;if(null===l)return i="Annotation doesn't match any data field",void t.settings.log(i,"LOG");var c=n.val[0],d=n.val[1],h={type:"ELEMENT.PATH",namespace:"annotations",x:e.x,y:e.y,color:n.colorScaleName,label:u,expression:{inherit:!1,operator:"none",params:[],source:"/"},transformModel:[a(n)],transformation:[{type:"dataRange",args:{axis:l[0],text:n.text,from:c,to:d,primaryScale:e[l[0]],secondaryScale:e[l[1]]}}],guide:{animationSpeed:e.guide.animationSpeed,showAnchors:"never",cssClass:"tau-chart__annotation-area",label:{fontColor:n.color,position:["r","b","keep-in-box"]}}};r(e.units,h,n.position)},addLineNote:function(t,e,n){var i,o,s=t.scales[e.x],l=t.scales[e.y],c=null,d=!0;if(Array.isArray(n.dim)?(d=!1,((i=n.dim)[0]===s.dim&&i[1]===l.dim||i[0]===l.dim&&i[1]===s.dim)&&(c=["x","y"])):n.dim===s.dim?c=["x","y"]:n.dim===l.dim&&(c=["y","x"]),null===c)return o="Annotation doesn't match any field",void t.settings.log(o,"LOG");var h=n.text,f={type:"ELEMENT.LINE",namespace:"annotations",x:e.x,y:e.y,label:u,color:n.colorScaleName,expression:{inherit:!1,operator:"none",params:[],source:"/"},guide:{animationSpeed:e.guide.animationSpeed,showAnchors:"never",widthCssClass:"tau-chart__line-width-2",cssClass:"tau-chart__annotation-line",label:{fontColor:n.color,position:d?["r","b","keep-in-box"]:["auto:avoid-label-edges-overlap","auto:adjust-on-label-overflow","keep-in-box"]},x:{fillGaps:!1},y:{fillGaps:!1}}},p=d?{transformModel:[a(n)],transformation:[{type:"dataLimit",args:{from:n.val,text:h,primaryScale:e[c[0]],secondaryScale:e[c[1]]}}]}:{transformation:[{type:"lineNoteData",args:{points:i[0]===s.dim?n.val:n.val.map(function(t){return t.slice().reverse()}),text:h,xScale:e.x,yScale:e.y}}]};Object.assign(f,p),r(e.units,f,n.position)},onUnitsStructureExpanded:function(){var t=this._chart,e=t.getSpec(),i=t.getDataSources()["/"].data,r=this._getAnnotatedDimValues(s.items);Object.keys(r).forEach(function(t){["x_"+t,"y_"+t].forEach(function(a){if(a in e.scales){var o=e.scales[a],s=i.map(function(e){return e[t]}),u=["period","time"].indexOf(o.type)>=0?r[t].map(function(t){return new Date(t)}):r[t];o.series=n.unique(s.concat(u))}})}),this._startWatchingDataRefs()},onRender:function(){this._clearUnusedDataRefs()},onSpecReady:function(t,n){var r=this,a=[];t.traverseSpec(n,function(t){t&&"COORDS.RECT"===t.type&&t.units&&a.push(t)}),this._formatters=i.getFieldFormatters(n,s.formatters);var o=i.spec(n);a.forEach(function(t){s.items.map(function(t,n){var i=(t.color||"#BD10E0").toLowerCase(),r=e.rgb(i).toString();"black"!==i&&"rgb(0, 0, 0)"===r&&(r=null);var a=r||i,s="annotation_color_"+n;return o.addScale(s,{type:"color",source:"?",brewer:[a]}),{dim:t.dim,val:t.val,text:t.text,color:a,position:t.position,colorScaleName:s}}).forEach(function(e){var i;Array.isArray(e.dim)?Array.isArray(e.val)&&e.val.every(Array.isArray)?r.addLineNote(n,t,e):(i="Point annotation is not implemented yet",n.settings.log(i,"LOG")):Array.isArray(e.val)?r.addAreaNote(n,t,e):r.addLineNote(n,t,e)})})},_getFormat:function(t){return this._formatters[t]?this._formatters[t].format:function(t){return String(t)}},_useSavedDataRefs:function(t,e){var n=this._dataRefs;return this._usedDataRefsKeys.add(e),e in n?(n[e].forEach(function(e,n){return Object.assign(e,t[n])}),n[e]):(n[e]=t,t)},_startWatchingDataRefs:function(){var t=this._dataRefs;this._initialDataRefsKeys=new Set(Object.keys(t)),this._usedDataRefsKeys=new Set},_clearUnusedDataRefs:function(){var t=this._dataRefs,e=this._initialDataRefsKeys,n=this._usedDataRefsKeys;Array.from(e).filter(function(t){return!n.has(t)}).forEach(function(e){return delete t[e]}),this._initialDataRefsKeys=null,this._usedDataRefsKeys=null},_getDataRowsFromItems:function(t){var e=function(t,e){return t.reduce(function(t,n,i){return t[n]=e[i],t},{})};return t.reduce(function(t,n){return Array.isArray(n.dim)?Array.isArray(n.val)&&n.val.every(Array.isArray)&&n.val.forEach(function(i){t.push(e(n.dim,i))}):Array.isArray(n.val)?n.val.forEach(function(i){t.push(e([n.dim],[i]))}):t.push(e([n.dim],[n.val])),t},[])},_getAnnotatedDimValues:function(t){var e={};return this._getDataRowsFromItems(t).forEach(function(t){Object.keys(t).forEach(function(n){e[n]=e[n]||[],e[n].push(t[n])})}),e}}}return t.api.plugins.add("annotations",o),o}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("taucharts")):"function"==typeof define&&define.amd?define(["taucharts"],e):(t.Taucharts=t.Taucharts||{},t.Taucharts.BarAsSpan=e(t.Taucharts))}(this,function(t){"use strict";var e=(t=t&&t.hasOwnProperty("default")?t.default:t).api.utils;function n(t){var n=t.x0,i=t.y0,r=null==t.collapse||t.collapse,a=function(t){return{y0:function(e){return t.scaleY.value(e[n])}}},o=function(t){return{y0:function(e){return t.scaleY.value(e[i])}}},s=function(t){var e=t.data();if(0===e.length)return{};var r=t.scaleY,a=Number.MAX_VALUE,o=Number.MIN_VALUE,s=t.flip?n:i,u=r.dim;return e.forEach(function(t){var e=t[s],n=t[u],i=e<n?e:n,r=n>e?n:e;a=i<a?i:a,o=r>o?r:o}),r.fixup(function(t){var e={};return(!t.hasOwnProperty("max")||t.max<o)&&(e.max=o),(!t.hasOwnProperty("min")||t.min>a)&&(e.min=a),e}),{}},u={},l={},c=function(t){var a=t.data().slice(),o=t.scaleX,s=t.scaleY;if(0===a.length||!o.discrete)return{};var c=t.flip?n:i,d=s.dim;a.sort(e.createMultiSorter(function(t,e){return t[c]-e[c]},function(t,e){return t[d]-e[d]}));var h=o.dim,f=o.domain().reduce(function(t,e){return t[e]=[],t},{}),p=new Map;return a.forEach(r?function(t){var e=t[h],n=f[e],i=n.findIndex(function(e){return e[e.length-1][d]<=t[c]});i<0&&(i=n.length,n.push([])),n[i].push(t),p.set(t,i)}:function(t){var e=t[h],n=f[e],i=i=n.length;n.push([]),n[i].push(t),p.set(t,i)}),Object.keys(f).forEach(function(t){u[t]=f[t]}),o.fixup(function(t){var e={},n=o.domain().reduce(function(t,e){return t+u[e].length},0);return o.domain().forEach(function(t){l[t]=n}),e.ratio=function(t){return u[t].length/l[t]},e}),{xi:function(e){var n=e[h],i=o.stepSize(n);return t.xi(e)-i/2+i/u[n].length*(p.get(e)+.5)}}};return{onSpecReady:function(t,e){t.traverseSpec(e,function(t,e){"ELEMENT.INTERVAL"===t.type&&(t.transformModel=[t.flip?a:o,c],t.adjustScales=[s],t.guide.enableColorToBarPosition=!1,t.guide.label=t.guide.label||{},t.guide.label.position=t.guide.label.position||(t.flip?["inside-start-then-outside-end-horizontal","hide-by-label-height-horizontal"]:["inside-start-then-outside-end-vertical"]))})}}}return t.api.plugins.add("bar-as-span",n),n}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("taucharts"),require("d3-selection")):"function"==typeof define&&define.amd?define(["taucharts","d3-selection"],e):(t.Taucharts=t.Taucharts||{},t.Taucharts.BoxWhiskers=e(t.Taucharts,t.d3))}(this,function(t,e){"use strict";var n=(t=t&&t.hasOwnProperty("default")?t.default:t).api.utils,i={MIN:"minimum",MAX:"maximum",MEDIAN:"median",Q1:"Q1",Q3:"Q3"};function r(t,e){var n=t.length-1,i=e/100*n,r=Math.floor(i);if(0===r)return{pos:0,value:t[0]};if(r===n)return{pos:n,value:t[n]};var a=i-r;return a?{pos:i,value:t[r]+a*(t[r+1]-t[r])}:{pos:i,value:t[i]}}function a(t,e,n){for(var i=t.sort(function(t,e){return t-e}),a=r(i,25),o=r(i,50),s=r(i,75),u=s.value-a.value,l=a.value-1.5*u,c=s.value+1.5*u,d=i[0],h=i[i.length-1],f=0;f<=a.pos;f++){var p=i[f];if(p>l){d=p;break}}for(var g=i.length-1;g>=s.pos;g--){var m=i[g];if(m<c){h=m;break}}return e[n.MIN]=d,e[n.MAX]=h,e[n.MEDIAN]=o.value,e[n.Q1]=a.value,e[n.Q3]=s.value,e}function o(t){return t=n.defaults(t||{},{mode:"outliers-only"}),{init:function(t){this._chart=t},onSpecReady:function(e,n){var r=!0===t.flip;n.transformations=n.transformations||{},n.transformations.empty=function(){return[]},n.transformations.outliers=function(t,e){var n=e.x.dim,r=e.y.dim,o=t.reduce(function(t,e){var i=e[n];return t[i]=t[i]||[],t[i].push(e[r]),t},{}),s=Object.keys(o).reduce(function(t,e){var s=a(o[e],{},i),u=s[i.MAX],l=s[i.MIN];return t.concat(function(t){return t[n]!==e||(t[r]>u||t[r]<l)})},[]);return t.filter(function(t){return!s.some(function(e){return!e(t)})})},e.traverseSpec(n,function(e,i){if("ELEMENT.POINT"===e.type){var a=JSON.parse(JSON.stringify(e));a.type="ELEMENT.BOX-WHISKERS",a.flip=r,a.namespace="boxwhiskers",a.guide=a.guide||{},a.guide.fitScale="hide-scatter"===t.mode;var o={"show-scatter":[],"hide-scatter":[{type:"empty"}],"outliers-only":[{type:"outliers",args:{x:n.scales[r?e.y:e.x],y:n.scales[r?e.x:e.y]}}]};e.transformation=e.transformation||[],e.transformation=e.transformation.concat(o[t.mode]),i.units.push(a)}})}}}return t.api.unitsRegistry.reg("ELEMENT.BOX-WHISKERS",{getAdjustScalesRules:function(){var t=this,e=[];return t.node().config.guide.fitScale&&e.push(function(e){t.fixScale(e,t.calcStat(e))}),e},fixScale:function(t,e){var n=e.reduce(function(t,e){return t.concat([e[i.MIN],e[i.MAX]])},[]).sort(function(t,e){return t-e}),r=n[0],a=n[n.length-1];t.scaleY.fixup(function(t){var e={};if(t.hasOwnProperty("series")){var n=Math.min(t.series[0],r),i=Math.max(t.series[1],a);e.series=[n,i]}else e.series=[r,a];return e})},calcStat:function(t){var e=t.data().reduce(function(e,n){var i=n[t.scaleX.dim];return e[i]=e[i]||[],e[i].push(n[t.scaleY.dim]),e},{});return Object.keys(e).reduce(function(n,r){var o={};return o[t.scaleX.dim]=r,n.concat(a(e[r],o,i))},[])},buildRangeModel:function(t,e){var n=t.flip,i=n?"y":"x",r=n?"x":"y",a=n?"height":"width",o=n?"width":"height",s=n?e.y1:e.y0,u=n?e.y0:e.y1,l=e.size,c=t.model.scaleX,d=t.model.scaleY,h={class:e.class};return h[i]=function(t){return c(t[c.dim])-.5*l},h[r]=function(t){return d(t[u])},h[a]=function(){return l},h[o]=function(t){return Math.max(e.minHeight||1,Math.abs(d(t[s])-d(t[u])))},Object.assign(h,{fill:function(){return e.color||"rgba(0,0,256, 0.5)"}})},draw:function(){var t=this.node().config,e=t.options.slot(t.uid),n=this.calcStat(this.node().screenModel.model);this.drawElement(e,n)},drawElement:function(n,i){var r=this,a=this.node().screenModel,o=t.api.d3_animationInterceptor,s=function(t,n){var i=r.node().config.guide.animationSpeed,s=t.selectAll("."+n.class).data(function(t){return[t]},a.id);s.exit().call(o(i,null,{width:0},function(t){e.select(t).remove()})),s.call(o(i,null,n)),s.enter().append("rect").style("stroke-width",0).call(o(i,{width:0},n))},u=function(t){s(t,r.buildRangeModel(a,{size:2,y0:"minimum",y1:"Q1",class:"range-min-Q1"})),s(t,r.buildRangeModel(a,{size:2,y0:"Q3",y1:"maximum",class:"range-Q3-max"})),s(t,r.buildRangeModel(a,{size:20,y0:"Q1",y1:"Q3",class:"range-Q1-Q3"})),s(t,r.buildRangeModel(a,{size:20,minHeight:1,y0:"maximum",y1:"maximum",class:"limit-max"})),s(t,r.buildRangeModel(a,{size:20,minHeight:1,y0:"minimum",y1:"minimum",class:"limit-min"})),s(t,r.buildRangeModel(a,{size:20,minHeight:2,y0:"median",y1:"median",color:"#ff0000",class:"limit-median"}))},l=n.selectAll(".box-whiskers-node").data(i);l.exit().remove(),l.call(u),l.enter().append("g").attr("class","box-whiskers-node").call(u)}},"ELEMENT.GENERIC.CARTESIAN"),t.api.plugins.add("box-whiskers",o),o}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("taucharts")):"function"==typeof define&&define.amd?define(["taucharts"],e):(t.Taucharts=t.Taucharts||{},t.Taucharts.CategoryFilter=e(t.Taucharts))}(this,function(t){"use strict";var e=(t=t&&t.hasOwnProperty("default")?t.default:t).api.utils,n=t.api.pluginsSDK,i="tau-chart__category-filter",r=i+"__value",a=r+"_checked",o=r+"__toggle",s=function(t){return t.join("\n")},u=function(t){var e=t.label,n=t.values;return'\n    <div class="'+i+'__category">\n        <div class="'+i+'__category__label">'+e+'</div>\n        <div class="'+i+'__category__values">\n            '+s(n.map(function(t){return l(t)}))+"\n    </div>\n\n"},l=function(t){var e=t.key,n=t.label,i=t.checked;return'\n    <div class="'+r+(i?" "+a:"")+'" data-key="'+e+'">\n        '+c()+'\n        <span class="'+r+'__label">'+n+"</span>\n    </div>\n"},c=function(){return['<span class="'+o+'">','<span class="'+o+'__icon"></span>',"</span>"].join("")},d=function(t,e,n,i){t.addEventListener(e,function(t){for(var e=t.target;e!==t.currentTarget&&null!==e;)e.matches(n)&&i(t,e),e=e.parentNode})},h=function(t,e){var n=function(t){return JSON.stringify(null==(e=t)||""===e?null:t);var e},i=n(e);return function(e){var r=e[t],a=n(r);return i===a}},f=function(){function t(t){this.settings=e.defaults(t||{},{formatters:{},fields:null,skipColorDim:!0}),this._filters={},this.onRender=this._createRenderHandler()}return t.prototype.init=function(t){var n=this;this._chart=t;var i=function(e){var n=t.getSpec().scales;return Object.keys(n).map(function(t){return{name:t,config:n[t]}}).filter(e)},r=i(function(t){var e=t.config;return"ordinal"===e.type&&e.dim}),a=e.unique(r.map(function(t){return t.config.dim}));if(this.settings.fields&&(a=a.filter(function(t){return n.settings.fields.indexOf(t)>=0})),this.settings.skipColorDim){var o=i(function(t){var e=t.config;return"color"===e.type&&e.dim}).map(function(t){return t.config.dim});a=a.filter(function(t){return o.indexOf(t)<0})}r=r.filter(function(t){return a.indexOf(t.config.dim)>=0}),this._categoryScales=r,this._render()},t.prototype.destroy=function(){var t=this._filters,e=this._chart;Object.keys(t).forEach(function(n){return e.removeFilter(t[n])});var n;(n=this._node)&&n.parentElement&&n.parentElement.removeChild(n)},t.prototype._createRenderHandler=function(){return function(){if(this._lastClickedScrollInfo){var t=this._lastClickedScrollInfo.key,e=this._node.querySelector('[data-key="'+t+'"]');if(e){var n=this._lastClickedScrollInfo.top,i=e.getBoundingClientRect().top,r=this._getScrollContainer(),a=r.getBoundingClientRect().top;r.scrollTop=r.scrollTop-n-a+i}this._lastClickedScrollInfo=null}}},t.prototype._getContent=function(t){return e={categories:t}.categories,'\n    <div class="'+i+'">\n        '+s(e.map(function(t){return u(t)}))+"\n    </div>\n";var e},t.prototype._getCategoriesInfo=function(){var t=this;return this._categoryScales.map(function(e){var n=e.name;return t._chart.getScaleInfo(n)}).map(function(n){var i=n.dim,r=t._getFieldLabel(i),a=t._getFieldFormat(i),o=t._chart.getDataSources({excludeFilter:["category-filter"]}),s=e.unique(o[n.source].data.map(function(t){return t[i]})).map(function(e){var n=a(e),r=t._getFilterKey(i,e);return{label:n,checked:!t._filters[r],key:r,value:e}});return{dim:i,label:r,values:s}})},t.prototype._render=function(){this._clear(),this._formatters=n.getFieldFormatters(this._chart.getSpec(),this.settings.formatters);var t,e,i=this._getCategoriesInfo(),r=this._getContent(i),a=(t=r,(e=document.createElement("div")).innerHTML=t,e.firstElementChild);this._node=a,this._chart.insertToRightSidebar(a),this._subscribeToEvents(),this._filterKeys=i.reduce(function(t,e){var n=e.dim;return e.values.forEach(function(e){var i=e.key,r=e.value;t[i]={dim:n,value:r}}),t},{})},t.prototype._subscribeToEvents=function(){var t=this,e=this._node;d(e,"click","."+r,function(e,n){var i=n.getAttribute("data-key"),r=e.target.matches("."+o);t._toggleCategory(i,r?"toggle":"focus")}),d(e,"mouseover","."+r,function(e,n){var i=n.getAttribute("data-key");t._toggleHighlight(i,!0)}),d(e,"mouseout","."+r,function(e,n){var i=n.getAttribute("data-key");t._toggleHighlight(i,!1)})},t.prototype._isFilteredOut=function(t){return t in this._filters},t.prototype._toggleCategory=function(t,e){var n=this,i=Array.from(this._node.querySelectorAll("."+r)).reduce(function(t,e){return t[e.getAttribute("data-key")]=e,t},{}),o=Object.keys(this._filterKeys).map(function(t){var e=n._filterKeys[t],r=e.dim,a=e.value;return{node:i[t],key:t,dim:r,value:a,isChecked:!n._isFilteredOut(t)}}),s=o.reduce(function(t,e){return t[e.key]=e,t},{})[t],u=o.filter(function(t){return t.dim===s.dim}),l=function(t,e){e?t.classList.add(a):t.classList.remove(a)};switch(e){case"toggle":s.isChecked?(this._addFilter(t),l(s.node,!1)):(this._removeFilter(t),l(s.node,!0));break;case"focus":s.isChecked&&u.every(function(t){return t===s||!t.isChecked})?u.forEach(function(t){t.isChecked||(l(t.node,!0),n._removeFilter(t.key))}):(u.forEach(function(t){t!==s&&t.isChecked&&(l(t.node,!1),n._addFilter(t.key))}),s.isChecked||(l(s.node,!0),this._removeFilter(s.key)))}this._lastClickedScrollInfo={key:t,top:s.node.getBoundingClientRect().top-this._getScrollContainer().getBoundingClientRect().top},this._chart.refresh()},t.prototype._toggleHighlight=function(t,e){if(!this._isFilteredOut(t)){var n=this._filterKeys[t],i=n.dim,r=n.value,a=e?h(i,r):function(t){return null};this._chart.select(function(t){return!0}).forEach(function(t){return t.fire("highlight",a)})}},t.prototype._clear=function(){var t=this._node;t&&t.parentElement&&t.parentElement.removeChild(t)},t.prototype._getScrollContainer=function(){return this._node.parentElement.parentElement},t.prototype._getFilterKey=function(t,e){return t+"__"+e},t.prototype._addFilter=function(t){var e=this._filterKeys[t],n=e.dim,i=e.value,r=h(n,i);this._filters[t]=this._chart.addFilter({tag:"category-filter",predicate:function(t){return!r(t)}})},t.prototype._removeFilter=function(t){var e=this._filters[t];delete this._filters[t],this._chart.removeFilter(e)},t.prototype._getFieldLabel=function(t){return this._formatters[t]?this._formatters[t].label:t},t.prototype._getFieldFormat=function(t){return this._formatters[t]?this._formatters[t].format:function(t){return String(t)}},t}();function p(t){return new f(t)}return t.api.plugins.add("category-filter",p),p}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("taucharts"),require("d3-selection")):"function"==typeof define&&define.amd?define(["taucharts","d3-selection"],e):(t.Taucharts=t.Taucharts||{},t.Taucharts.Crosshair=e(t.Taucharts,t.d3))}(this,function(t,e){"use strict";var n="http://www.w3.org/2000/svg",i=(t=t&&t.hasOwnProperty("default")?t.default:t).api.utils,r=t.api.svgUtils,a=t.api.pluginsSDK;function o(t){t=t||{};var i=document.createElementNS(n,"g"),r=e.select(i).attr("class","tau-crosshair__label");r.append("rect").attr("class","tau-crosshair__label__box"),r.append("text").attr("class","tau-crosshair__label__text-shadow"),r.append("text").attr("class","tau-crosshair__label__text");var a={options:function(e){return t=Object.assign(t,e),a},show:function(e){return t.container.appendChild(i),function(e){var n=e.x,i=e.y,a=e.text,o=e.color,s=e.colorCls;r.attr("class","tau-crosshair__label "+s);var u=t.halign,l=t.valign,c=t.hpad,d=t.vpad,h={left:"end",middle:"middle",right:"start"}[u],f={left:-c,middle:0,right:c}[u],p=r.select(".tau-crosshair__label__text").attr("fill",o),g=r.selectAll(".tau-crosshair__label__text, .tau-crosshair__label__text-shadow").attr("text-anchor",h).attr("x",n+f).attr("y",0).text(a),m=p.node().getBBox(),y={top:-d-m.height/2,middle:0,bottom:d+m.height/2}[l]-m.height/2-m.y;g.attr("y",i+y);var v=m.width+2*c,x=m.height+2*d,_={left:-v,middle:-v/2,right:0}[u],b={top:-x,middle:-x/2,bottom:0}[l];r.select(".tau-crosshair__label__box").attr("fill",o).attr("rx",t.boxCornerRadius).attr("ry",t.boxCornerRadius).attr("x",n+_).attr("y",i+b).attr("width",v).attr("height",x)}(e),function(){r.attr("transform","");var e=t.chart.getLayout().contentContainer.getBoundingClientRect(),n=t.chart.getSVG().getBoundingClientRect(),a=i.getBoundingClientRect(),o=Math.max(0,Math.max(e.left,n.left)-a.left)||Math.min(0,Math.min(e.right,n.right)-a.right),s=Math.max(0,Math.max(e.top,n.top)-a.top)||Math.min(0,Math.min(e.bottom,n.bottom)-a.bottom);r.attr("transform","translate("+o+","+s+")")}(),a},hide:function(){return i.parentNode&&i.parentNode.removeChild(i),a}};return a}function s(t){var s=i.defaults(t||{},{xAxis:!0,yAxis:!0,formatters:{},labelBoxHPadding:5,labelBoxVPadding:3,labelBoxCornerRadius:3,axisHPadding:22,axisVPadding:22});return{init:function(t){this._chart=t,this._formatters={},this._createNode()},_createNode:function(){var t=e.select(document.createElementNS(n,"g")).attr("class","tau-crosshair");this._labels={x:null,y:null};var i=function(e){var n=t.append("g").attr("class","tau-crosshair__group "+e);n.append("line").attr("class","tau-crosshair__line-shadow"),n.append("line").attr("class","tau-crosshair__line"),this._labels[e]=o({container:n.node(),chart:this._chart,halign:"x"===e?"middle":"left",valign:"x"===e?"bottom":"middle",boxCornerRadius:s.labelBoxCornerRadius,hpad:s.labelBoxHPadding,vpad:s.labelBoxVPadding})}.bind(this);s.xAxis&&i("x"),s.yAxis&&i("y"),this._element=t},_setValues:function(t,e,n){var i=function(t){var e=this._element.select(".tau-crosshair__group."+t.dir);e.select(".tau-crosshair__line").attr("class","tau-crosshair__line "+n.cls).attr("stroke",n.color),e.selectAll(".tau-crosshair__line, .tau-crosshair__line-shadow").attr("x1",t.startPt.x).attr("x2",t.valuePt.x).attr("y1",t.startPt.y).attr("y2",t.valuePt.y),("x"===t.dir&&s.xAxis||"y"===t.dir&&s.yAxis)&&this._labels[t.dir].options({halign:t.labelHAlign,valign:t.labelVAlign}).show({x:t.startPt.x,y:t.startPt.y,text:t.label,color:n.color,colorCls:n.cls})}.bind(this);i({dir:"x",startPt:{x:t.value,y:e.start+(t.minMode?0:s.axisVPadding)},valuePt:{x:t.value,y:e.value+e.crossPadding},label:t.label,labelHAlign:"middle",labelVAlign:"bottom"}),i({dir:"y",startPt:{x:t.start-(e.minMode?0:s.axisHPadding),y:e.value},valuePt:{x:t.value-t.crossPadding,y:e.value},label:e.label,labelHAlign:"left",labelVAlign:"middle"})},_showCrosshair:function(t,e,n){var i=this._chart.getSVG(),a=e.config.options.container.node(),o=r.getDeepTransformTranslate(a);this._element.attr("transform",r.translate(o.x,o.y)),i.appendChild(this._element.node());var s=e.getScale("x"),u=e.getScale("y"),l=e.getScale("color"),c=l(t.data[l.dim]),d=t.data[s.dim],h=t.data[u.dim],f=e.screenModel.x(t.data),p=e.screenModel.y(t.data);if(e.config.stack)if(e.config.flip){var g=e.data().filter(function(n){var i=n[u.dim];return n===t.data||(i===h||i-h==0)&&(e.screenModel.x(t.data)-e.screenModel.x(n))*n[s.dim]>0});f=(d<0?Math.min:Math.max).apply(null,g.map(function(t){return e.screenModel.x(t)},0)),d=g.reduce(function(t,e){return t+e[s.dim]},0)}else{var m=e.data().filter(function(n){var i=n[s.dim];return n===t.data||(i===d||i-d==0)&&(e.screenModel.y(n)-e.screenModel.y(t.data))*n[u.dim]>0});p=(h<0?Math.max:Math.min).apply(null,m.map(function(t){return e.screenModel.y(t)},0)),h=m.reduce(function(t,e){return t+e[u.dim]},0)}var y=t.node.getBBox(),v=["ELEMENT.AREA","ELEMENT.INTERVAL","ELEMENT.INTERVAL.STACKED"].indexOf(e.config.type)>=0?{x:y.width*(e.config.flip?d>0?1:0:.5),y:y.height*(e.config.flip?.5:h>0?1:0)}:{x:y.width/2,y:y.height/2};this._setValues({label:this._getFormat(s.dim)(d),start:0,value:f,crossPadding:v.x,minMode:n&&n.guide.x.hide},{label:this._getFormat(u.dim)(h),start:e.config.options.height,value:p,crossPadding:v.y,minMode:n&&n.guide.y.hide},{cls:l.toColor(c)?"":c,color:l.toColor(c)?c:""})},_hideCrosshair:function(){var t=this._element.node();t.parentNode&&t.parentNode.removeChild(t)},destroy:function(){this._hideCrosshair()},_subscribeToHover:function(){var t=["ELEMENT.LINE","ELEMENT.AREA","ELEMENT.PATH","ELEMENT.INTERVAL","ELEMENT.INTERVAL.STACKED","ELEMENT.POINT"];this._chart.select(function(e){return t.indexOf(e.config.type)>=0}).forEach(function(t){t.on("data-hover",function(t,e){if(e.data){if(t===e.unit){var n=a.getParentUnit(this._chart.getSpec(),t.config);this._showCrosshair(e,t,n)}}else this._hideCrosshair()}.bind(this))},this)},_getFormat:function(t){return this._formatters[t]?this._formatters[t].format:function(t){return String(t)}},onRender:function(){this._formatters=a.getFieldFormatters(this._chart.getSpec(),s.formatters),this._subscribeToHover()}}}return t.api.plugins.add("crosshair",s),s}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("taucharts"),require("d3-selection")):"function"==typeof define&&define.amd?define(["taucharts","d3-selection"],e):(t.Taucharts=t.Taucharts||{},t.Taucharts.DiffTooltip=e(t.Taucharts,t.d3))}(this,function(t,e){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};var i="tau-chart__tooltip";function r(t,e){return{render:function(t){return this.args=t,t=Object.assign({},t,{fields:this.filterFields(t.fields)}),this.rootTemplate(t)},rootTemplate:function(t){return['<div class="'+i+"__buttons "+i+'__clickable">',this.buttonsTemplate(),"</div>",'<div class="i-role-content '+i+'__content">',this.contentTemplate(t),"</div>"].join("\n")},contentTemplate:function(t){return this.fieldsTemplate(t)},filterFields:function(e){return e.filter(function(e){var n=e.split(".");return!(2===n.length&&t.skipInfo[n[0]])})},getLabel:function(e){return t.getFieldLabel(e)},getFormatter:function(e){return t.getFieldFormat(e)},fieldsTemplate:function(t){var e=this,n=t.data;return t.fields.map(function(t){return e.itemTemplate({data:n,field:t})}).join("\n")},itemTemplate:function(t){var e=t.data,n=t.field,r=this.getLabel(n),a=this.getFormatter(n)(e[n]);return['<div class="'+i+'__list__item">','  <div class="'+i+'__list__elem">'+r+"</div>",'  <div class="'+i+'__list__elem">'+a+"</div>","</div>"].join("\n")},buttonsTemplate:function(){return[this.buttonTemplate({cls:"i-role-exclude",text:"Exclude",icon:function(){return'<span class="tau-icon-close-gray"></span>'}})].join("\n")},buttonTemplate:function(t){var e=t.icon,n=t.text,r=t.cls;return['<div class="'+i+"__button "+r+'">','  <div class="'+i+'__button__wrap">',"    "+(e?e()+" ":"")+n,"  </div>","</div>"].join("\n")},didMount:function(){var e=t.getDomNode().querySelector(".i-role-exclude");e&&e.addEventListener("click",function(){t.excludeHighlightedElement(),t.setState({highlight:null,isStuck:!1})})}}}var a=t.api.utils,o=t.api.domUtils,s=t.api.pluginsSDK,u="tau-chart__tooltip",l=function(){function t(t){this.settings=a.defaults(t||{},{align:"bottom-right",clsClickable:u+"__clickable",clsStuck:"stuck",clsTarget:u+"-target",escapeHtml:!0,fields:null,formatters:{},getTemplate:null,spacing:24,winBound:12}),this.onRender=this._getRenderHandler()}return t.prototype.init=function(t){this._chart=t,this._tooltip=this._chart.addBalloon({spacing:this.settings.spacing,winBound:this.settings.winBound,auto:!0,effectClass:"fade"}),this._initDomEvents(),this.state={highlight:null,isStuck:!1},this.setState(this.state),this._template=this._getTemplate()},t.prototype._getTemplate=function(){var t=r(this,this.settings);return"function"==typeof this.settings.getTemplate?this.settings.getTemplate(t,this,this.settings):t},t.prototype._renderTemplate=function(t,e){return this._template.render({data:t,fields:e})},t.prototype._initDomEvents=function(){var t=this;this._scrollHandler=function(){t.setState({highlight:null,isStuck:!1})},window.addEventListener("scroll",this._scrollHandler,!0),this._outerClickHandler=function(e){var n=Array.from(document.querySelectorAll("."+t.settings.clsClickable)).concat(t.getDomNode()).map(function(t){return t.getBoundingClientRect()}),i=Math.min.apply(Math,n.map(function(t){return t.top})),r=Math.min.apply(Math,n.map(function(t){return t.left})),a=Math.max.apply(Math,n.map(function(t){return t.right})),o=Math.max.apply(Math,n.map(function(t){return t.bottom}));(e.clientX<r||e.clientX>a||e.clientY<i||e.clientY>o)&&t.setState({highlight:null,isStuck:!1})}},t.prototype.getDomNode=function(){return this._tooltip.getElement()},t.prototype.setState=function(t){var e=this,n=this.settings,i=this.state,r=this.state=Object.assign({},i,t);i.highlight=i.highlight||{data:null,cursor:null,unit:null},r.highlight=r.highlight||{data:null,cursor:null,unit:null},r.isStuck&&i.highlight.data&&(r.highlight=i.highlight),r.highlight.data!==i.highlight.data&&(r.highlight.data?(this._hideTooltip(),this._showTooltip(r.highlight.data,r.highlight.cursor),this._setTargetSvgClass(!0),requestAnimationFrame(function(){e._setTargetSvgClass(!0)})):r.isStuck||!i.highlight.data||r.highlight.data||(this._removeFocus(),this._hideTooltip(),this._setTargetSvgClass(!1))),!r.highlight.data||i.highlight.cursor&&r.highlight.cursor.x===i.highlight.cursor.x&&r.highlight.cursor.y===i.highlight.cursor.y||(this._tooltip.position(r.highlight.cursor.x,r.highlight.cursor.y),this._tooltip.updateSize());var a=this.getDomNode();r.isStuck!==i.isStuck&&(r.isStuck?(window.addEventListener("click",this._outerClickHandler,!0),a.classList.add(n.clsStuck),this._setTargetEventsEnabled(!1),this._accentFocus(r.highlight.data),this._tooltip.updateSize()):(window.removeEventListener("click",this._outerClickHandler,!0),a.classList.remove(n.clsStuck),requestAnimationFrame(function(){e._setTargetEventsEnabled(!0);var t=e._chart.getSVG();t&&o.dispatchMouseEvent(t,"mouseleave")})))},t.prototype._showTooltip=function(t,e){var n=this.settings,i=n.fields||"function"==typeof n.getFields&&n.getFields(this._chart)||Object.keys(t),r=this._renderTemplate(t,i);this._tooltip.content(r).position(e.x,e.y).place(n.align).show().updateSize(),this._template.didMount&&this._template.didMount()},t.prototype._hideTooltip=function(){window.removeEventListener("click",this._outerClickHandler,!0),this._template.willUnmount&&this._template.willUnmount(),this._tooltip.hide()},t.prototype.destroy=function(){window.removeEventListener("scroll",this._scrollHandler,!0),this._setTargetSvgClass(!1),this.setState({highlight:null,isStuck:!1}),this._tooltip.destroy()},t.prototype._subscribeToHover=function(){var t=this,e=["ELEMENT.LINE","ELEMENT.AREA","ELEMENT.PATH","ELEMENT.INTERVAL","ELEMENT.INTERVAL.STACKED","ELEMENT.POINT"];this._chart.select(function(t){return e.indexOf(t.config.type)>=0}).forEach(function(e){e.on("data-hover",function(e,n){var i=document.body.getBoundingClientRect();t.setState({highlight:n.data?{data:n.data,cursor:{x:n.event.clientX-i.left,y:n.event.clientY-i.top},unit:n.unit}:null})}),e.on("data-click",function(e,n){var i=document.body.getBoundingClientRect();t.setState(n.data?{highlight:{data:n.data,cursor:{x:n.event.clientX-i.left,y:n.event.clientY-i.top},unit:n.unit},isStuck:!0}:{highlight:null,isStuck:null})})})},t.prototype.getFieldFormat=function(t){var e=this._formatters[t]?this._formatters[t].format:function(t){return String(t)};return this.settings.escapeHtml?function(t){return a.escapeHtml(e(t))}:e},t.prototype.getFieldLabel=function(t){var e=this._formatters[t]?this._formatters[t].label:t;return this.settings.escapeHtml?a.escapeHtml(e):e},t.prototype._accentFocus=function(t){var e=function(e){return e===t};this._chart.select(function(){return!0}).forEach(function(t){t.fire("highlight",e)})},t.prototype._removeFocus=function(){var t=function(){return null};this._chart.select(function(){return!0}).forEach(function(e){e.fire("highlight",t),e.fire("highlight-data-points",t)})},t.prototype.excludeHighlightedElement=function(){var t=this.state.highlight.data;this._chart.addFilter({tag:"exclude",predicate:function(e){return e!==t}}),this._chart.refresh()},t.prototype._getRenderHandler=function(){return function(){this._formatters=s.getFieldFormatters(this._chart.getSpec(),this.settings.formatters),this._subscribeToHover(),this.setState({highlight:null,isStuck:!1})}},t.prototype._setTargetSvgClass=function(t){e.select(this._chart.getSVG()).classed(this.settings.clsTarget,t)},t.prototype._setTargetEventsEnabled=function(t){t?this._chart.enablePointerEvents():this._chart.disablePointerEvents()},t}(),c="diff-tooltip",d=c+"__item",h=c+"__header";var f=t.api.utils,p="ELEMENT.INTERVAL_HIGHLIGHT",g={draw:function(){var t=this.node().config;this._container=t.options.slot(t.uid)},addInteraction:function(){var t=this;this.node().on("interval-highlight",function(e,n){t._drawRange(n)})},_drawRange:function(t){var n,i=this.node(),r=i.config,a=i.screenModel.flip,o=this._container,s="interval-highlight",u=s+"__gradient",l=t?t[0]:null,c=t?t[1]:null,d=a?r.options.width:r.options.height;f.take((n=o.selectAll("."+s).data(t?[1]:[]),n.exit().remove(),{g:n,gEnter:n.enter().append("g").attr("class",s).attr("pointer-events","none")})).next(function(n){var i,h,f,p,g,m,y,v,x,_,b,w,S,T,E,M,k,A,C,O,L,N,F,R,D,j,I,z,P,H,B,q,U;!function(){for(var n=s+"__defs",i=s+"__gradient-start",l=s+"__gradient-end",c=o.node();"svg"!==(c=c.parentNode).tagName;);var d=n+"__"+r.uid,h=e.select(c).selectAll("#"+d).data(t?[1]:[]);h.exit().remove();var f=h.enter().append("defs").attr("class",n).attr("id",d).append("linearGradient").attr("id",u).attr("x1","0%").attr("y1",a?"100%":"0%").attr("x2",a?"0%":"100%").attr("y2","0%");f.append("stop").attr("class",i).attr("offset","0%"),f.append("stop").attr("class",l).attr("offset","100%")}(),h=(i=n).g,f=i.gEnter,p=s+"__range",g=h.select("."+p),m=f.append("rect").attr("class",p).attr("fill","url(#"+u+")"),v=(y=a?{x:0,y:c,width:d,height:l-c}:{x:l,y:0,width:c-l,height:d}).x,x=y.y,_=y.width,b=y.height,m.merge(g).attr("x",v).attr("y",x).attr("width",_).attr("height",b),S=(w=n).g,T=w.gEnter,E=s+"__range-start",M=S.select("."+E),k=T.append("line").attr("class",E),C=(A=a?{x1:0,y1:l,x2:d,y2:l}:{x1:l,y1:0,x2:l,y2:d}).x1,O=A.y1,L=A.x2,N=A.y2,k.merge(M).attr("x1",C).attr("y1",O).attr("x2",L).attr("y2",N),R=(F=n).g,D=F.gEnter,j=s+"__range-end",I=R.select("."+j),z=D.append("line").attr("class",j),H=(P=a?{x1:0,y1:c,x2:d,y2:c}:{x1:c,y1:0,x2:c,y2:d}).x1,B=P.y1,q=P.x2,U=P.y2,z.merge(I).attr("x1",H).attr("y1",B).attr("x2",q).attr("y2",U)})}},m=t.api.utils,y=function(e){function a(t){var n=e.call(this,t)||this;return n.onSpecReady=n._getSpecReadyHandler(),n}return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(a,e),a.prototype.init=function(t){e.prototype.init.call(this,t),this._unitsGroupedData=new Map},a.prototype._getTemplate=function(){var t,e,n=(t=this,this.settings,e=r(t),Object.assign({},e,{hasColor:function(){return null!=this.args.colorField},contentTemplate:function(t){return[this.fieldsTemplate(t),this.tableTemplate(t)].join("\n")},filterFields:function(n){var i=t.state.highlight.unit.screenModel.model,r=i.scaleColor,a=i.scaleX,o=i.scaleY,s=n.filter(function(t){return t!==r.dim&&t!==a.dim&&t!==o.dim}),u=function(){return s.push(a.dim)};return this.shouldShowColorTable()?u():(u(),r.dim&&s.push(r.dim),s.push(o.dim)),e.filterFields.call(this,s)},itemTemplate:function(t){var e=t.data,n=t.field,r=this.getLabel(n),a=this.getFormatter(n)(e[n]),o=this.args.prev,s=this.shouldShowDiff(n),u=['<span class="'+d+'__value">',""+a,s?" "+this.fieldUpdownTemplate(this.getDiff({data:e,prev:o,field:n})):"","</span>"].join("");return['<div class="'+i+'__list__item">','  <div class="'+i+'__list__elem">'+r+"</div>","  "+u,"</div>"].join("\n")},shouldShowDiff:function(t){return t===this.args.valueField},getDiff:function(t){var e=t.data,n=t.prev,i=t.field,r=this.getFormatter(i),a=(e?e[i]:0)-(n?n[i]:0);return{diff:r(a),sign:Math.sign(a)}},fieldUpdownTemplate:function(t){var e=t.diff,n=t.sign,i=c+"__field__updown";return['<span class="'+i+" "+i+"_"+(n>0?"positive":"negative")+'">',(n>0?"&#x25B2;":n<0?"&#x25BC;":"")+(0===n?"":e),"</span>"].join("")},shouldShowColorTable:function(){var t=this.args.groups;return this.hasColor()&&t.length>1},tableTemplate:function(t){return this.shouldShowColorTable()?['<div class="'+c+'__table">',this.tableHeaderTemplate(t),this.tableBodyTemplate(t),"</div>"].join("\n"):""},tableHeaderTemplate:function(t){var e=t.colorField,n=t.valueField,i=this.getLabel(e),r=this.getLabel(n);return['<div class="'+h+'">','  <span class="'+h+'__text">'+i+"</span>",'  <span class="'+h+'__value">'+r+"</span>",'  <span class="'+h+'__updown">&#x25BC;&#x25B2;</span>',"</div>"].join("\n")},tableBodyTemplate:function(t){var e=this,n=t.data,i=t.groups,r=t.valueField,a=t.colorField,o=n,s=i.map(function(t){var e=t.data;return e?e[r]:0}),u=Math.min.apply(Math,s),l=Math.max.apply(Math,s);return['<div class="'+c+'__body">','<div class="'+c+'__body__content">',i.map(function(t){var n=t.data,i=t.prev;return e.tableRowTemplate({data:n,prev:i,highlighted:o,valueField:r,colorField:a,min:u,max:l})}).join("\n"),"</div>","</div>"].join("\n")},tableRowTemplate:function(t){var e=t.data,n=t.prev,i=t.highlighted,r=t.valueField,a=t.colorField,o=t.min,s=t.max,u=e?e[r]:0,l=this.getFormatter(a)((e||n)[a]),c=this.getFormatter(r)(u),h=e===i,f=this.getDiff({data:e,prev:n,field:r}),p=f.diff,g=f.sign,m=this.getColor(e||n),y=m.color,v=m.colorCls;return['<div class="'+d+(h?" "+d+"_highlighted":"")+'">',"  "+this.valueBarTemplate({min:o,max:s,v:u,color:y,colorCls:v}),'  <span class="'+d+'__text">'+l+"</span>",'  <span class="'+d+'__value">'+c+"</span>","  "+this.updownTemplate({diff:p,sign:g}),"</div>"].join("\n")},valueBarTemplate:function(t){var e=t.min,n=t.max,i=t.v,r=t.color,a=t.colorCls;e=Math.min(e,0);var o=(n=Math.max(0,n))-e;return["<span",'    class="'+d+"__bg"+(a?" "+a:"")+'"','    style="left: '+100*(0===o?0:(i<0?i-e:-e)/o)+"%; width: "+100*(0===o?0:(i<0?-i:i)/o)+"%; background-color: "+r+';"',"    ></span>"].join("\n")},getColor:function(e){var n=t.state.highlight.unit.screenModel;return{color:n.color(e),colorCls:n.class(e)}},updownTemplate:function(t){var e=t.diff,n=t.sign,i=d+"__updown";return['<span class="'+i+" "+i+"_"+(n>0?"positive":"negative")+'">',(n>0?"&#x25B2;":n<0?"&#x25BC;":"")+(0===n?"":e),"</span>"].join("")},didMount:function(){e.didMount.call(this),this._scrollToHighlighted(),this._reserveSpaceForUpdown()},_scrollToHighlighted:function(){var e=t.getDomNode(),n=e.querySelector("."+c+"__body"),i=e.querySelector("."+c+"__body__content"),r=e.querySelector("."+d+"_highlighted");if(n&&i&&r){var a=n.getBoundingClientRect(),o=i.getBoundingClientRect(),s=r.getBoundingClientRect(),u=0;if(s.bottom>a.bottom){var l=s.bottom-a.bottom+s.height,h=o.bottom-a.bottom;u=-Math.min(l,h),i.style.transform="translateY("+u+"px)"}o.top+u<a.top&&n.classList.add(c+"__body_overflow-top"),o.bottom+u>a.bottom&&n.classList.add(c+"__body_overflow-bottom")}},_reserveSpaceForUpdown:function(){var e=t.getDomNode(),n=e.querySelector("."+c+"__body"),i=e.querySelector("."+h);if(n&&i){var r="."+d+"__updown:not(:empty)",a=Array.from(e.querySelectorAll(r)).map(function(t){return t.scrollWidth}),o=Math.max.apply(Math,a),s=Math.max(0,Math.ceil(o-15));n.style.paddingRight=s+"px",i.style.paddingRight=s+"px"}}}));return"function"==typeof this.settings.getTemplate?this.settings.getTemplate(n,this,this.settings):n},a.prototype._renderTemplate=function(t,e){var n,i=this.state.highlight.unit,r=i.screenModel,a=r.model,o=a.scaleColor,s=(a.scaleX,a.scaleY),u=this._unitsGroupedData.get(i),l=this._getHighlightRange(t,i),c=l[0],d=l[1],h=function(t){var e=r.model.color(t);return isFinite(c)&&u[c][e]?u[c][e][0]:null},f=h(t),p=i.config.stack,g=(n=o.domain().slice().reduce(function(t,e,n){return t[e]=n,t},{}),function(t,e){return n[t[o.dim]]-n[e[o.dim]]}),m=i.config.flip?function(t,e){return s(e[s.dim])-s(t[s.dim])}:function(t,e){return s(t[s.dim])-s(e[s.dim])},y=function(t){return Object.keys(u[t]).reduce(function(e,n){return e.concat(u[t][n])},[]).sort(p?g:m)},v=y(d).map(function(t){r.model.color(t);return{data:t,prev:h(t)}});if(isFinite(c)){var x=y(c),_=v.reduce(function(t,e){return t[r.model.color(e.data)]=!0,t},{});x.forEach(function(t){var e=r.model.color(t);_[e]||v.push({data:null,prev:t})}),p&&v.sort(function(t,e){return g(t.data||t.prev,e.data||e.prev)})}return this._template.render({data:t,prev:f,fields:e,groups:v,valueField:s.dim,colorField:o.dim})},a.prototype._getRenderHandler=function(){var t=e.prototype._getRenderHandler.call(this);return function(){var e=this;t.call(this);var n=this._chart,i=n.select(function(t){return"chart"===t.config.namespace&&0===t.config.type.indexOf("ELEMENT.")&&t.config.type!==p}),r=n.select(function(t){return t.config.type===p}).reduce(function(t,e,n){return t[n]=e,t},{});i.forEach(function(t,n){var i=t.data();e._unitsGroupedData.set(t,e._getGroupedData(i,t)),t.on("data-hover",function(i,a){var o=r[n],s=a.unit&&a.unit===t?e._getHighlightRange(a.data,a.unit):null;o.fire("interval-highlight",s)})})}},a.prototype._getSpecReadyHandler=function(){return function(t,e){t.traverseSpec(e,function(t,e){if(0===t.type.indexOf("ELEMENT.")){var n=JSON.parse(JSON.stringify(t));n.type=p,n.namespace="highlight";var i=e.units.indexOf(t);e.units.splice(i,0,n)}})}},a.prototype._getGroupedData=function(e,n){var i=n.screenModel.model.scaleX,r=m.groupBy(e,function(t){return i(t[i.dim]).toString()}),a=n.config.guide.x.tickPeriod||n.config.guide.x.timeInterval;if(a){var o=i.domain(),s=n.config.guide.utcTime;t.api.tickPeriod.generate(o[0],o[1],a,{utc:s}).filter(function(t){return t>=o[0]&&t<=o[1]}).forEach(function(t){var e=i(t);r[e]||(r[e]=[])})}return Object.keys(r).reduce(function(t,e){return t[e]=m.groupBy(r[e],function(t){return n.screenModel.model.color(t)}),t},{})},a.prototype._getHighlightRange=function(t,e){var n=e.screenModel.flip,i=e.screenModel.model.scaleX,r=i(t[i.dim]),a=this._unitsGroupedData.get(e),o=Object.keys(a).map(Number).sort(n?function(t,e){return e-t}:function(t,e){return t-e}),s=o.indexOf(r);return 0===s?[r,r]:[o[s-1],r]},a}(l);function v(t){return new y(t)}return t.api.unitsRegistry.reg(p,g,"ELEMENT.GENERIC.CARTESIAN"),t.api.plugins.add("diff-tooltip",v),v}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("taucharts"),require("d3-selection")):"function"==typeof define&&define.amd?define(["taucharts","d3-selection"],e):(t.Taucharts=t.Taucharts||{},t.Taucharts.FloatingAxes=e(t.Taucharts,t.d3))}(this,function(t,e){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var n=(Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t})({},e),i=t.api.domUtils,r=t.api.utils,a=16,o="#E5E7EB",s="#FFFFFF",u=1,l=0,c="__transitionAttrs__",d="__floatingAxesSrcParent__",h="__floatingAxesSrcTransform__",f=0,p=function(){return++f};function g(c){var f=r.defaults(c||{},{detectBackground:!0,bgcolor:"#fff"});return{init:function(t){this.instanceId=p(),this.chart=t,this.rootNode=t.getLayout().contentContainer,this.beforeExportHandler=t.on("beforeExportSVGNode",function(){this.removeFloatingLayout()},this),this.afterExportHandler=t.on("afterExportSVGNode",function(){this.createFloatingLayout()},this)},onBeforeRender:function(){this.removeFloatingLayout()},onRender:function(){if(f.detectBackground){var t=this.detectChartBackgroundColor();t&&(f.bgcolor=t)}s=f.bgcolor;var e=!0;this.chart.traverseSpec(this.chart.getSpec(),function(t){t&&0===t.type.indexOf("COORDS.")&&("COORDS.RECT"!==t.type?e=!1:"extract-axes"!==(t.guide||{}).autoLayout&&(e=!1))}),e&&this.createFloatingLayout()},destroy:function(){this.removeFloatingLayout(),this.chart.removeHandler(this.beforeExportHandler,this),this.chart.removeHandler(this.afterExportHandler,this)},createFloatingLayout:function(){var r,c,p,g=this.instanceId,x=this.rootNode,_=this.chart.getSVG(),b=n.select(_),w=this.chart.configGPL.settings.animationSpeed,S=this.scrollManager=new function(t){var e={x:[],y:[]},n={x:0,y:0},i={x:null,y:null},r=t,a=[];this.onScroll=function(t){return a.push(t),this},this.handleVisibilityFor=function(t,n){return n.indexOf("x")>=0&&e.x.push(t),n.indexOf("y")>=0&&e.y.push(t),this};var o=function(){var t=r.scrollLeft,o=r.scrollTop;a.forEach(function(e){e.call(null,t,o)});var u=function(r){var a="x"===r?t:o;a!==n[r]&&(clearTimeout(i[r]),s(e[r],function(t){t.transition("floatingAxes_scrollVisibility"),t.attr("opacity",1e-6)}),i[r]=setTimeout(function(){s(e[r],function(t){i[r]=null,t.transition("floatingAxes_scrollVisibility").duration(256).attr("opacity",1)})},128)),n[r]=a};u("x"),u("y")};function s(t,e,n){t.forEach(function(t){e.call(n,t)})}r.addEventListener("scroll",o),this.fireScroll=function(){o.call(null,r.scrollLeft,r.scrollTop)},this.destroy=function(){r.removeEventListener("scroll",o)}}(x),T=(r=function(t){var e=".frame-root.tau-active ",n="> ."+t+".axis.tau-active";return[e+n,e+".cell.tau-active "+n].join(", ")},{x:Array.from(_.querySelectorAll(r("x"))),y:Array.from(_.querySelectorAll(r("y")))}),E=function(){function t(t){return{axis:t,parentTransform:function(t){var e,n={translate0:{x:0,y:0},translate:{x:0,y:0}},i=t;for(;i&&"SVG"!==i.nodeName.toUpperCase();)e=v(i),n.translate0.x+=e.translate0.x,n.translate0.y+=e.translate0.y,n.translate.x+=e.translate.x,n.translate.y+=e.translate.y,i=i.parentNode;return n}(t.parentNode),axisTransform:v(t)}}return{x:T.x.map(t),y:T.y.map(t)}}(),M=(c=E.y.map(function(t){return t.axisTransform.translate.x+t.parentTransform.translate.x}),Math.max.apply(null,c)+1),k=(p=E.x.map(function(t){return t.axisTransform.translate.y+t.parentTransform.translate.y}),Math.min.apply(null,p)-1),A=t.api.globalSettings.getScrollbarSize(x);var C,O,L={scrollLeft:x.scrollLeft,scrollTop:x.scrollTop,visibleWidth:x.clientWidth,visibleHeight:x.clientHeight,scrollbarWidth:A.width,scrollbarHeight:A.height,svgWidth:Number(b.attr("width")),svgHeight:Number(b.attr("height")),minXAxesY:k,maxYAxesX:M},N=(C=b.append("defs").attr("class","floating-axes floating-axes__defs"),O={ns:{x1:0,y1:0,x2:0,y2:1},ew:{x1:1,y1:0,x2:0,y2:0},sn:{x1:0,y1:1,x2:0,y2:0},we:{x1:0,y1:0,x2:1,y2:0}},Object.keys(O).forEach(function(t){var e=O[t],n=C.append("linearGradient").attr("id","shadow-gradient-"+t+"-"+g).attr("x1",e.x1).attr("y1",e.y1).attr("x2",e.x2).attr("y2",e.y2);n.append("stop").attr("class","floating-axes__shadow-start").attr("offset","0%").attr("stop-color",o).attr("stop-opacity",u),n.append("stop").attr("class","floating-axes__shadow-end").attr("offset","100%").attr("stop-color",s).attr("stop-opacity",l)}),C);function F(t,e){e.forEach(function(e){e.axis[d]=e.axis.parentNode;var n=t.append("g");w?n.attr("transform",m(e.parentTransform.translate0.x,e.parentTransform.translate0.y)).transition().duration(w).attr("transform",m(e.parentTransform.translate.x,e.parentTransform.translate.y)):n.attr("transform",m(e.parentTransform.translate.x,e.parentTransform.translate.y)),n.node().appendChild(e.axis),Array.prototype.forEach.call(e.axis.querySelectorAll(".label"),function(t){t[h]=t.getAttribute("transform")})})}var R,D,j=function(){var t=L.svgHeight-L.minXAxesY+1+L.scrollbarHeight,e=b.append("g").attr("class","floating-axes floating-axes__x").call(P,L.svgWidth,t,0,L.minXAxesY);F(e,E.x);var n=e.selectAll(".label");return S.handleVisibilityFor(e,"y").handleVisibilityFor(n,"x").onScroll(function(t,i){var r=Math.min(L.visibleHeight+i-L.svgHeight-L.scrollbarHeight,0);e.attr("transform",m(0,r)),n.each(function(){var e=y(this[h]),n=-L.svgWidth/2+L.visibleWidth/2+t;this.setAttribute("transform","translate("+(e.x+n)+","+e.y+") rotate("+e.r+")")})}),e}(),I=function(){var t=b.append("g").attr("class","floating-axes floating-axes__y").call(P,L.maxYAxesX,L.svgHeight);F(t,E.y);var e=t.selectAll(".label");return S.handleVisibilityFor(t,"x").handleVisibilityFor(e,"y").onScroll(function(n,i){var r=Math.max(n,0);t.attr("transform",m(r,0)),e.each(function(){var t=y(this[h]),e=this.matches(".inline")?i:i-L.svgHeight/2+L.visibleHeight/2;this.setAttribute("transform","translate("+t.x+","+(t.y+e)+") rotate("+t.r+")")})}),t}(),z=(R=L.svgHeight-L.minXAxesY+L.scrollbarHeight,D=b.append("g").attr("class","floating-axes floating-axes__corner").call(P,L.maxYAxesX,R),S.handleVisibilityFor(D,"xy").onScroll(function(t,e){var n=Math.max(t,0),i=L.minXAxesY,r=Math.min(e+L.visibleHeight-R,i);D.attr("transform",m(n,r))}),D);function P(t,e,n,i,r){i=i||0,r=r||0,t.append("rect").attr("class","i-role-bg").attr("x",i-1).attr("y",r-1).attr("width",Math.max(0,e+2)).attr("height",Math.max(0,n+2)).attr("fill",f.bgcolor)}var H,B,q,U,W,G,X,Y,V=(H=L.maxYAxesX,B=L.svgHeight-L.minXAxesY+L.scrollbarHeight,q=b.append("g").attr("class","floating-axes floating-axes__shadows").attr("pointer-events","none"),W=(U=function(t,e,n,i,r){return q.append("rect").attr("fill","url(#shadow-gradient-"+t+"-"+g+")").attr("x",e).attr("y",n).attr("width",Math.max(0,i)).attr("height",Math.max(0,r))})("ns",0,0,H,a),G=U("ew",L.visibleWidth-a,L.visibleHeight-B,a,B),X=U("sn",0,L.visibleHeight-B-a,H,a),Y=U("we",H,L.visibleHeight-B,a,B),void S.handleVisibilityFor(W,"xy").handleVisibilityFor(G,"xy").handleVisibilityFor(X,"xy").handleVisibilityFor(Y,"xy").onScroll(function(t,e){var n=t,i=e;q.attr("transform",m(n,i));var r=function(t,e){t.style("visibility",e?"":"hidden")};r(W,e>0&&L.svgHeight>L.visibleHeight),r(G,t+L.visibleWidth<L.svgWidth&&L.svgWidth>L.visibleWidth),r(X,e+L.visibleHeight<L.svgHeight&&L.svgHeight>L.visibleHeight),r(Y,t>0&&L.svgWidth>L.visibleWidth)})),K=j.node(),J=I.node(),$=z.node();S.onScroll(function(t){_.insertBefore(K,0===t?$.nextElementSibling:J)}),S.fireScroll(),this.floatingLayout={defs:N,xAxes:j,yAxes:I,shadows:V},b.selectAll(".floating-axes").on("mouseenter",function(){i.dispatchMouseEvent(_,"mouseleave")}).on("mousemove",function(){e.event.stopPropagation()}).on("click",function(){e.event.stopPropagation()})},removeFloatingLayout:function(){function t(t){t.selectAll(".axis").each(function(){this[d].appendChild(this),delete this[d],Array.prototype.forEach.call(this.querySelectorAll(".label"),function(t){t.setAttribute("transform",t[h]),delete t[h]})})}this.floatingLayout&&(this.floatingLayout.xAxes.call(t),this.floatingLayout.yAxes.call(t),this.scrollManager.destroy(),this.floatingLayout=null),n.select(this.chart.getSVG()).selectAll(".floating-axes").remove()},detectChartBackgroundColor:function(){var t,e=this.chart.getLayout().layout;do{if("none"!==(t=window.getComputedStyle(e)).backgroundImage)return null;if("transparent"!==t.backgroundColor&&"rgba(0, 0, 0, 0)"!==t.backgroundColor)return t.backgroundColor}while(e=e.parentElement);return null}}}function m(t,e){return"translate("+t+","+e+")"}function y(t){var e={x:0,y:0,r:0};if(!t)return e;var n=t.indexOf("translate(");if(n>=0){var i=t.indexOf(")",n+10),r=t.substring(n+10,i).trim().replace(","," ").replace(/\s+/," ").split(" ");e.x=parseFloat(r[0]),r.length>1&&(e.y=parseFloat(r[1]))}var a=t.indexOf("rotate(");if(a>=0){var o=t.indexOf(")",a+7),s=t.substring(a+7,o);e.r=parseFloat(s.trim())}return e}function v(t){var e=t[c]&&t[c].transform,n=y(t.getAttribute("transform"));return{translate0:n,translate:e?y(t[c].transform):n}}return t.api.plugins.add("floating-axes",g),g}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("taucharts")):"function"==typeof define&&define.amd?define(["taucharts"],e):(t.Taucharts=t.Taucharts||{},t.Taucharts.GeomapLegend=e(t.Taucharts))}(this,function(t){"use strict";var e=(t=t&&t.hasOwnProperty("default")?t.default:t).api.utils;function n(t){e.defaults(t||{},{});var n=function(t,e,n,i){t.addEventListener(e,function(t){for(var e=t.target;e!==t.currentTarget&&null!==e;)e.classList.contains(n)&&i(t,e),e=e.parentNode})};return{init:function(t){this._chart=t,this._currentFilters={},this._legendColorByScaleId={};var e=this._chart.getSpec(),i=function(t){return function(n,i){var r=e.scales[i];return r.type===t&&r.dim&&n.push(i),n}};this._color=Object.keys(e.scales).reduce(i("color"),[]),this._fill=Object.keys(e.scales).reduce(i("fill"),[]);var r=this._color.length>0,a=this._fill.length>0;(r||a)&&(this._container=this._chart.insertToRightSidebar(this._containerTemplate),r&&(n(this._container,"click","tau-chart__legend__item-color",function(t,e){this._toggleLegendItem(e)}.bind(this)),n(this._container,"mouseover","tau-chart__legend__item-color",function(t,e){this._highlightToggle(e,!0)}.bind(this)),n(this._container,"mouseout","tau-chart__legend__item-color",function(t,e){this._highlightToggle(e,!1)}.bind(this))))},onSpecReady:function(){this._assignStaticBrewersOrEx()},onRender:function(){this._clearPanel(),this._drawColorLegend(),this._drawFillLegend()},_containerTemplate:'<div class="tau-chart__legend"></div>',_template:e.template('<div class="tau-chart__legend"><div class="tau-chart__legend__title"><%=name%></div><%=items%></div>'),_itemTemplate:e.template(["<div data-scale-id='<%= scaleId %>' data-dim='<%= dim %>' data-value='<%= value %>' class=\"tau-chart__legend__item tau-chart__legend__item-color <%=classDisabled%>\">",'<div class="tau-chart__legend__guide__wrap">','<div class="tau-chart__legend__guide <%=color%>"></div>',"</div>","<%=label%>","</div>"].join("")),_itemFillTemplate:e.template(['<div data-value=\'<%=value%>\' class="tau-chart__legend__item tau-chart__legend__item-color" style="padding: 6px 0px 10px 40px;margin-left:10px;">','<div class="tau-chart__legend__guide__wrap" style="top:0;left:0;">','   <span class="tau-chart__legend__guide" style="background-color:<%=color%>;border-radius:0"></span>','   <span style="padding-left: 20px"><%=label%></span>',"</div>","</div>"].join("")),_clearPanel:function(){this._container&&(this._container.innerHTML="")},_drawColorLegend:function(){var t=this;t._color.forEach(function(n){var i=t._chart.select(function(t){return t.config.color===n})[0];if(i){var r=i.getScale("color"),a=t._chart.getDataSources({excludeFilter:["legend"]}),o=e.unique(a[r.source].data.map(function(t){return t[r.dim]})).map(function(i){var a=e.escape(i),o=r.dim+a;return{scaleId:n,dim:r.dim,color:r(i),disabled:t._currentFilters.hasOwnProperty(o),label:i,value:a}});t._legendColorByScaleId[n]=o,t._container.insertAdjacentHTML("beforeend",t._template({items:o.map(function(e){return t._itemTemplate({scaleId:e.scaleId,dim:e.dim,color:e.color,classDisabled:e.disabled?"disabled":"",label:e.label,value:e.value})}).join(""),name:(((i.guide||{}).color||{}).label||{}).text||r.dim}))}})},_drawFillLegend:function(){var t=this;t._fill.forEach(function(n){var i=t._chart.select(function(t){return"COORDS.MAP"===t.config.type&&t.config.fill===n});if(i.length>0){var r=i[0].getScale("fill"),a=r.brewer,o=r.domain(),s=(o[1]-o[0])/a.length,u=e.range(a.length).map(function(n){var i=o[0]+n*s,u="";return 0===n&&(u=o[0]),n===a.length-1&&(u=o[1]),t._itemFillTemplate({color:r(i),label:u,value:e.escape(i)})});t._container.insertAdjacentHTML("beforeend",t._template({items:u.join(""),name:(((i[0].guide||{}).fill||{}).label||{}).text||r.dim}))}})},_toggleLegendItem:function(t){var e=t.getAttribute("data-scale-id"),n=t.getAttribute("data-dim"),i=t.getAttribute("data-value"),r=n+i,a=this._legendColorByScaleId[e].filter(function(t){return!t.disabled});if(1!==a.length||e!==a[0].scaleId||i!==a[0].value){var o=this._currentFilters;if(o.hasOwnProperty(r)){var s=o[r];delete o[r],t.classList.remove("disabled"),this._chart.removeFilter(s)}else t.classList.add("disabled"),o[r]=this._chart.addFilter({tag:"legend",predicate:function(t){return t[n]!=i}});this._chart.refresh()}},_highlightToggle:function(t,e){var n=t.getAttribute("data-scale-id"),i=t.getAttribute("data-dim"),r=t.getAttribute("data-value");this._chart.select(function(t){return t.config.color===n}).forEach(function(t){t.fire("highlight",function(t){return!e||t[i]==r})})},_generateColorMap:function(t){var n=e.range(20).map(function(t){return"color20-"+(1+t)});return t.reduce(function(t,e,i){return t[e]=n[i%20],t},{})},_assignStaticBrewersOrEx:function(){var t=this;t._color.forEach(function(e){var n=t._chart.getSpec().scales[e],i=t._chart.getDataSources({excludeFilter:["legend"]}),r=t._chart.getScaleFactory(i).createScaleInfoByName(e).domain();n.brewer||(n.brewer="measure"!==n.dimType?t._generateColorMap(r):["#e5f5e0","#a1d99b","#31a354"])})}}}return t.api.plugins.add("geomap-legend",n),n}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("taucharts")):"function"==typeof define&&define.amd?define(["taucharts"],e):(t.Taucharts=t.Taucharts||{},t.Taucharts.GeomapTooltip=e(t.Taucharts))}(this,function(t){"use strict";var e=(t=t&&t.hasOwnProperty("default")?t.default:t).api.utils;function n(t){e.defaults(t||{},{});var n=function(){return!1};return{init:function(t){this._currNode=null,this._currData=null,this._chart=t,this._tooltip=t.addBalloon({spacing:3,auto:!0,effectClass:"fade"}),this._tooltip.content(this.template),this._tooltip.getElement().addEventListener("click",function(t){for(var e=t.target;e!==t.currentTarget&&null!==e;)e.classList.contains("i-role-exclude")&&(n._exclude(),n._tooltip.hide(),n._blurSelection()),e=e.parentNode},!1);var e,n=this;this._showTooltip=function(t){clearTimeout(e),n._currData=t.data;var i="No data";null!==t.data&&(i=Object.keys(t.data).map(function(e){return n.itemTemplate({label:e,value:t.data[e]})}).join(""));var r=n._tooltip.getElement().querySelectorAll(".i-role-content");r[0]&&(r[0].innerHTML=i);var a=n._tooltip.getElement().querySelectorAll(".i-role-exclude");if(a[0]){var o=t.data&&n._chart.getChartModelData().length>1;a[0].style.visibility=o?"visible":"hidden"}n._tooltip.show(t.event.pageX,t.event.pageY).updateSize()},this._hideTooltip=function(t){e=setTimeout(function(){n._tooltip.hide()},t?0:1e3)},this._tooltip.getElement().addEventListener("mouseover",function(t){clearTimeout(e)},!1),this._tooltip.getElement().addEventListener("mouseleave",function(t){n._hideTooltip(!0),n._blurSelection()},!1)},onRender:function(){var t=this;this._chart.select(function(t){return"COORDS.MAP"===t.config.type}).forEach(function(e){t._subscribeToPoints(e),t._subscribeToArea(e)})},template:['<div class="tau-chart__tooltip__buttons tau-chart__tooltip__clickable">','<div class="tau-chart__tooltip__button i-role-exclude">','<div class="tau-chart__tooltip__button__wrap">','<span class="tau-icon-close-gray"></span>',"Exclude","</div>","</div>","</div>",'<div class="i-role-content tau-chart__tooltip__content"></div>'].join(""),itemTemplate:e.template(['<div class="tau-chart__tooltip__list__item">','<div class="tau-chart__tooltip__list__elem"><%=label%></div>','<div class="tau-chart__tooltip__list__elem"><%=value%></div>',"</div>"].join("")),_exclude:function(){var t;this._chart.addFilter({tag:"exclude",predicate:(t=this._currData,function(e){return JSON.stringify(e)!==JSON.stringify(t)})}),this._chart.refresh()},_blurSelection:function(){this._chart.select(function(t){return"COORDS.MAP"===t.config.type}).forEach(function(t){t.fire("highlight-area",n)}),this._currNode=null,this._currData=null},_subscribeToPoints:function(t){var e=this;t.on("point-mouseover",function(t,n){e._showTooltip(n)}),t.on("point-mouseout",function(t,n){e._hideTooltip()})},_subscribeToArea:function(t){var e=this;!t.getScale("code").dim||t.on("area-click",function(n,i){var r,a;e._currNode=n,i.data?e._currData===i.data?(e._hideTooltip(!0),e._blurSelection()):(t.fire("highlight-area",(r=i.data,a=JSON.stringify(r),function(t){return JSON.stringify(t)===a})),e._showTooltip(i)):(e._showTooltip(i),e._hideTooltip(!1),e._blurSelection())})}}}return t.api.plugins.add("geomap-tooltip",n),n}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("taucharts"),require("d3-array")):"function"==typeof define&&define.amd?define(["taucharts","d3-array"],e):(t.Taucharts=t.Taucharts||{},t.Taucharts.Layers=e(t.Taucharts,t.d3))}(this,function(t,e){"use strict";var n=(t=t&&t.hasOwnProperty("default")?t.default:t).api.utils,i=t.api.pluginsSDK,r=i.tokens();function a(t){var a=n.defaults(t||{},{title:"Layers",label:"Layer Type",showPanel:!0,showLayers:!0,mode:"merge",axisWidth:45,layers:[]});a.layers.forEach(function(t){t.guide=n.defaults(t.guide||{},{scaleOrient:"left",textAnchor:"end",hide:!1})});var o=function(t){return function(e){return Object.assign(e,t)}},s={line:o({type:"ELEMENT.LINE"}),area:o({type:"ELEMENT.AREA"}),dots:o({type:"ELEMENT.POINT"}),scatterplot:o({type:"ELEMENT.POINT"}),bar:o({type:"ELEMENT.INTERVAL"}),"stacked-bar":o({type:"ELEMENT.INTERVAL",stack:!0})};return{init:function(t){this._chart=t;var e=i.spec(this._chart.getSpec()),r=this.checkIfApplicable(e);if(this._isApplicable=0===r.length,e.addTransformation("defined-only",function(t,e){var n=e.key;return t.filter(function(t){return null!==t[n]&&void 0!==t[n]})}),this._isApplicable){this.isFacet=this.checkIsFacet(e),this.primaryY=this.findPrimaryLayer(e);var o=this.getLayersText(),s=this.getLayersGroup(),u=a.label;this.fieldColorScale=u,e.setSettings("excludeNull",!1).setSettings("fitModel",null).addScale(u,{type:"color",source:"/",dim:u,brewer:a.brewer}).addTransformation("slice-layer",function(t,e){var n=e.key,i=e.group;return i?t.filter(function(t){var e=t[i],n=t[e];return e&&null!==n&&void 0!==n}):t.filter(function(t){return t[u]===o[n]&&null!==t[n]&&void 0!==t[n]})});var l=[this.primaryY].concat(a.layers).reduce(function(t,e){return t.concat(e.y)},[]);t.setupChartSourceModel(function(t){var e={};e[u]={type:"category"};var i={"/":{dims:e,data:[]}};return i["/"].dims=Object.assign(e,t["/"].dims),i["/"].data=t["/"].data.reduce(function(t,e){return t.concat(l.map(function(t){var n={};n[u]=o[t];var i=s[t];return i&&(n[i]=e[t],n.subLayer=i),Object.assign(n,e)}))},[]),Object.assign(i,n.omit(t,"/"))}),a.showPanel&&(this._container=t.insertToRightSidebar(this.containerTemplate),this._container.classList.add("applicable-true"),this.uiChangeEventsDispatcher=function(t){var e=t.target,n=e.classList;n.contains("i-role-show-layers")&&(a.showLayers=e.checked),n.contains("i-role-change-mode")&&(a.mode=e.value),this._chart.refresh()}.bind(this),this._container.addEventListener("change",this.uiChangeEventsDispatcher,!1))}else{e.getSettings("log")("[layers plugin]: is not applicable. "+r.join(" / "))}},getLayersText:function(){return[this.primaryY].concat(a.layers).reduce(function(t,e){return(Array.isArray(e.y)?e.y:[e.y]).reduce(function(t,n){return t[n]=this.extractLabelForKey(e,n),t}.bind(this),t)}.bind(this),{})},getLayersGroup:function(){return[this.primaryY].concat(a.layers).reduce(function(t,e){var i=null;return Array.isArray(e.y)&&(i=e.y.join(", ")),n.flatten([e.y]).reduce(function(t,e){return t[e]=i,t},t)}.bind(this),{})},checkIsFacet:function(t){return t.unit().reduce(function(t,e,n){return t||(n&&"COORDS.RECT"===n.type&&"COORDS.RECT"===e.type?t=!0:t)},!1)},checkIfApplicable:function(t){return t.unit().reduce(function(e,n,i){if(i&&"COORDS.RECT"!==i.type)return e.concat("Chart specification contains non-rectangular coordinates");if(i&&"COORDS.RECT"===i.type&&"COORDS.RECT"!==n.type){var r=t.getScale(n.y);if("measure"!==t.getSourceDim(r.source,r.dim).type)return e.concat("Y scale is not a measure")}return e},[])},isLeafElement:function(t,e){return e&&"COORDS.RECT"===e.type&&"COORDS.RECT"!==t.type},isFirstCoordNode:function(t,e){return!e&&t&&"COORDS.RECT"===t.type},isFinalCoordNode:function(t,e){return t&&"COORDS.RECT"===t.type&&t.units.every(function(t){return"COORDS.RECT"!==t.type})},buildLayersLayout:function(t){return t.regSource("$",{dims:{x:{type:"category"},y:{type:"category"}},data:[{x:1,y:1}]}).addScale("xLayoutScale",{type:"ordinal",source:"$",dim:"x"}).addScale("yLayoutScale",{type:"ordinal",source:"$",dim:"y"}).unit({type:"COORDS.RECT",x:"xLayoutScale",y:"yLayoutScale",expression:{source:"$",inherit:!1,operator:!1},guide:{showGridLines:"",x:{cssClass:"facet-axis"},y:{cssClass:"facet-axis"}}})},findPrimaryLayer:function(t){var e=this,n=t.unit().reduce(function(n,i){return n.concat(e.isFinalCoordNode(i)?{y:t.getScale(i.y).dim,isPrimary:!0,guide:i.guide.y,scaleName:i.y}:[])},[]);return i.cloneObject(n[0])},createPrimaryUnitReducer:function(t,e,n,i){var r=this;return function(o,s,u){var l=function(t){return!0!==t.guide.hide};if(r.isFacet&&r.isFirstCoordNode(s,u)){s.guide.y.label=s.guide.y.label||{};var c=s.guide.y.label._original_text||s.guide.y.label.text;s.guide.y.label.text=[c,e.filter(l).map(r.extractLayerLabel.bind(r)).join(", ")].join(t.getSettings("facetLabelDelimiter")),"dock"===a.mode&&(s.guide.y.label.padding-=15,s.guide.y.padding+=15,s.guide.y.rotate=-90,s.guide.y.textAnchor="middle")}return r.isLeafElement(s,u)&&(u.units=u.units.filter(function(t){return t!==s})),r.isFinalCoordNode(s)&&(s.guide.y.label=s.guide.y.label||{},"dock"===a.mode&&(s.guide.padding.l=n,s.guide.padding.r=i,s.guide.y.hide=!0),"merge"===a.mode&&(s.guide.y.label.text=r.isFacet?"":e.filter(l).map(r.extractLayerLabel.bind(r)).join(", "))),o}},createSecondaryUnitReducer:function(t,e,n,r,o,u,l,c){var d=this,h=d.getScaleName(e.scaleName||e.y),f=e.guide.scaleOrient,p=Array.isArray(e.y),g=e.isPrimary;return function(m,y,v){if(d.isFacet&&d.isFirstCoordNode(y,v)&&(y.guide.y.label.text="",y.guide.x.hide=!0,y.guide.y.hide=!0),d.isLeafElement(y,v)){(e.type?s[e.type]:function(t){return t})(y),y.y=h;var x=t.getScale(y.size).dim;if(g&&x);else{var _="size_null"+c;t.addScale(_,{type:"size",source:"?",mid:1}),y.size=_}var b=t.getScale(y.color).dim;g&&b||(y.color=d.fieldColorScale,y.expression.operator="groupBy",y.expression.params=p?["subLayer"]:[d.fieldColorScale]);var w=p?{group:"subLayer"}:{key:e.y};i.unit(y).addTransformation("slice-layer",w)}if(d.isFinalCoordNode(y)){if(y.y=h,y.guide.y=Object.assign(y.guide.y,e.guide||{}),y.guide.y.label=y.guide.y.label||{},y.guide.y.label.text=d.extractLayerLabel(e),y.guide.x.hide=!0,"dock"===a.mode){y.guide.showGridLines="",y.guide.padding.l=n,y.guide.padding.r=r,y.guide.y.label.textAnchor="end",y.guide.y.label.dock="right",y.guide.y.label.padding="right"===f?1:-10,y.guide.y.label.cssClass="label inline";var S="right"===f?l:u;y.guide.y.padding+=o*S}"merge"===a.mode&&(y.guide.showGridLines="",y.guide.y.hide=!0)}return m}},getScaleName:function(t){return Array.isArray(t)?t.join(", "):t},extractLabelForKey:function(t,e){var n=t.guide||{};n.label="string"==typeof n.label?{text:n.label}:n.label;var i=n.label||{},r=i.byKeys||{};return Array.isArray(t.y)?r[e]||e:i.text||i._original_text||t.y},extractLayerLabel:function(t){var e=this;return(Array.isArray(t.y)?t.y:[t.y]).map(function(n){return e.extractLabelForKey(t,n)}).join(", ")},onSpecReady:function(t,e){var r=this,o=i.spec(e);if(a.showLayers&&r._isApplicable){o=a.layers.reduce(function(t,e){var i=r.getScaleName(e.y);return t.addScale(i,Object.assign({type:"linear",source:"/",dim:i,autoScale:!0},n.pick(e.guide||{},"min","max","autoScale","nice","niceInterval")))},o);var s,u=[this.primaryY].concat(a.layers).sort(function(t,e){return(t.guide.zIndex||0)-(e.guide.zIndex||0)}),l=o.unit(),c=a.axisWidth,d=function(t){return function(e){var n=e.guide.scaleOrient||"left";return!0!==e.guide.hide&&n===t}},h=d("left"),f=d("right"),p=u.filter(h).length*c,g=u.filter(f).length*c,m=r.buildLayersLayout(o).addFrame({key:{x:1,y:1},units:[(s=i.unit(l.clone())).reduce(r.createPrimaryUnitReducer(o,u,p,g),s).value()]}),y=-1,v=-1;u.reduce(function(t,e,n){return y=h(e)?y+1:y,v=f(e)?v+1:v,t.addFrame({key:{x:1,y:1},units:[(s=i.unit(l.clone())).reduce(r.createSecondaryUnitReducer(o,e,p,g,c,y,v,n),s).value()]})},m)}else o.unit().traverse(function(t,e){r.isLeafElement(t,e)&&i.unit(t).addTransformation("defined-only",{key:o.getScale(t.y).dim})})},onUnitsStructureExpanded:function(){var t=this;if(t._isApplicable&&"merge"===a.mode){var r=i.spec(t._chart.getSpec()),o=t.primaryY.scaleName,s=a.layers.map(function(e){return t.getScaleName(e.y)}).filter(function(t){return r.getScale(t)}).concat(o),u=s.reduce(function(e,n){var i=t._chart.getScaleInfo(n);return e[n]=i.domain().filter(function(t){return Number.isFinite(t)}),e},{}),l=e.extent(n.flatten(Object.keys(u).map(function(t){return u[t]})));s.forEach(function(t){var e=r.getScale(t);e.min=l[0],e.max=l[1],e.nice=!1})}},containerTemplate:'<div class="tau-chart__trendlinepanel"></div>',template:n.template(['<label class="tau-chart__trendlinepanel__title tau-chart__checkbox">','   <input type="checkbox"','          class="tau-chart__checkbox__input i-role-show-layers"','          <%= (showLayers ? "checked" : "") %>',"   />",'   <span class="tau-chart__checkbox__icon"></span>','   <span class="tau-chart__checkbox__text"><%= title %></span>',"</label>","<div>",'<select class="i-role-change-mode tau-chart__select tau-chart__trendlinepanel__control">','   <option <%= ((mode === "dock")  ? "selected" : "") %> value="dock">'+r.get("Dock")+"</option>",'   <option <%= ((mode === "merge") ? "selected" : "") %> value="merge">'+r.get("Merge")+"</option>","</select>","</div>"].join("")),onRender:function(){this._isApplicable&&a.showPanel&&(this._container.innerHTML=this.template({title:a.title,mode:a.mode,showLayers:a.showLayers}))}}}return t.api.plugins.add("layers",a),a}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("taucharts"),require("d3-format")):"function"==typeof define&&define.amd?define(["taucharts","d3-format"],e):(t.Taucharts=t.Taucharts||{},t.Taucharts.Legend=e(t.Taucharts,t.d3))}(this,function(t,e){"use strict";var n,i,r=(t=t&&t.hasOwnProperty("default")?t.default:t).api.utils,a=t.api.pluginsSDK,o=".tau-chart__legend__reset",s=".tau-chart__legend__item-color",u=".tau-chart__legend__guide--color__overlay",l=4,c=13,d=0,h=function(){return++d},f=t.api.utils.xml,p=function(t,e){var n=t[0],i=t[1],a=(i-n)/(e-1),o=r.range(e-2).map(function(t){return n+a*(t+1)});return[n].concat(o).concat(i)},g=function(t,e,n){if(t.length<3)return t.slice(0);if(e<3)return[t[0],t[t.length-1]];var i,a=t[0]<0?Math.abs(t[0]):0,o=function(t){return t},s="sqrt"===n?function(t){return Math.sqrt(t+a)}:o,u="sqrt"===n?function(t){return Math.pow(t,2)-a}:o,l=[(t=t.map(s))[0]],c=t[t.length-1]-t[0],d=.5*c/(e-1),h=r.range(1,e-1).map(function(t){var n=c*t/(e-1);return{min:n-d,mid:n,max:n+d,diff:Number.MAX_VALUE,closest:null}}),f=0,p=function(){if(f!==h.length){var t=i;(i=h[f++]).min=Math.max(i.min,(t&&null!==t.closest?t.closest:l[0])+d)}};return p(),t.forEach(function(t){if(!(t<i.min)){t>i.max&&p();var e=Math.abs(t-i.mid);e<i.diff&&e<d?(i.diff=e,i.closest=t):p(),0===e&&p()}}),h.forEach(function(t){null!==t.closest&&l.push(t.closest)}),l.push(t[t.length-1]),l=l.map(u)},m=function(t){return Math.log(t)/Math.LN10},y=function(t){return 0===t?0:Math.floor(m(Math.abs(t)))},v=(n=/\.0+([^\d].*)?$/,i=/(\.\d+?)0+([^\d].*)?$/,function(t){return t.replace(n,"$1").replace(i,"$1$2")}),x=e.format(".3s"),_=function(t){return v(x(t))},b=function(t,e){var n=Math.max(Math.abs(t),Math.abs(e)),i=y(n),r=t*e>0?Math.abs(e-t):n,a=y(r),o=Math.abs(i-a);return Math.abs(i)>3&&o<=3?_:function(t){var e=y(n-t),i=Math.min((a<0?Math.abs(a):0)+(e<a?1:0),20);return v(t.toFixed(i))}};function w(t){var e=r.defaults(t||{},{}),n=function(t){return null===t||""===t||void 0===t},i=function(t,e){return function(i){var r=i[t],a=JSON.stringify(n(r)?null:r);return e===a}},d=function(t,e,n,i){t.addEventListener(e,function(t){for(var e=t.target;e!==t.currentTarget&&null!==e;)e.matches(n)&&i(t,e),e=e.parentNode})};return{init:function(t){this.instanceId=h(),this._chart=t,this._currentFilters={},this._legendColorByScaleId={},this._legendOrderState={};var n=this._chart.getSpec(),i=function(t){return function(e,i){var r=n.scales[i];return r.type===t&&r.dim&&e.push(i),e}};this._color=Object.keys(n.scales).reduce(i("color"),[]).filter(function(e){return t.getScaleInfo(e).discrete}),this._fill=Object.keys(n.scales).reduce(i("color"),[]).filter(function(e){return!t.getScaleInfo(e).discrete}),this._size=Object.keys(n.scales).reduce(i("size"),[]);var r=this._color.length>0,a=this._fill.length>0,l=this._size.length>0;if(this._assignStaticBrewersOrEx(),r||a||l){switch(e.position){case"left":this._container=this._chart.insertToLeftSidebar(this._containerTemplate);break;case"right":this._container=this._chart.insertToRightSidebar(this._containerTemplate);break;case"top":this._container=this._chart.insertToHeader(this._containerTemplate);break;case"bottom":this._container=this._chart.insertToFooter(this._containerTemplate);break;default:this._container=this._chart.insertToRightSidebar(this._containerTemplate)}r&&(d(this._container,"click",o,function(t,e){this._toggleLegendItem(e,"reset")}.bind(this)),d(this._container,"click",s,function(t,e){var n=t.ctrlKey||t.target.matches(u)?"leave-others":"focus-single";this._toggleLegendItem(e,n)}.bind(this)),d(this._container,"mouseover",s,function(t,e){this._highlightToggle(e,!0)}.bind(this)),d(this._container,"mouseout",s,function(t,e){this._highlightToggle(e,!1)}.bind(this)))}},destroy:function(){var t=this._currentFilters,e=this._chart;Object.keys(t).forEach(function(n){return e.removeFilter(t[n])}),this._container&&this._container.parentElement&&(this._clearPanel(),this._container.parentElement.removeChild(this._container))},onRender:function(){this._clearPanel(),this._drawColorLegend(),this._drawFillLegend(),this._drawSizeLegend()},_containerTemplate:'<div class="tau-chart__legend"></div>',_template:r.template(['<div class="tau-chart__legend__wrap">',"<%=top%>",'<div class="tau-chart__legend__title"><%=name%></div>',"<%=items%>","</div>"].join("")),_itemTemplate:r.template(["<div data-scale-id='<%= scaleId %>' data-dim='<%= dim %>' data-value='<%= value %>' class=\"tau-chart__legend__item tau-chart__legend__item-color <%=classDisabled%>\">",'   <div class="tau-chart__legend__guide__wrap">','   <div class="tau-chart__legend__guide tau-chart__legend__guide--color <%=cssClass%>"','        style="background-color: <%=cssColor%>; border-color: <%=borderColor%>;">','       <div class="tau-chart__legend__guide--color__overlay">',"       </div>","   </div>","   </div>",'   <span class="tau-chart__legend__guide__label"><%=label%></span>',"</div>"].join("")),_resetTemplate:r.template(['<div class="tau-chart__legend__reset <%=classDisabled%>">','<div role="button" class="tau-chart__button">Reset</div>',"</div>"].join("")),_clearPanel:function(){this._container&&(clearTimeout(this._scrollTimeout),this._getScrollContainer().removeEventListener("scroll",this._scrollListener),this._container.innerHTML="")},_drawFillLegend:function(){var t=this;t._fill.forEach(function(e){var n,i,o,s,u,l=t._chart.select(function(t){return t.config.color===e})[0];if(l){var d=l.config.guide||{},h=l.getScale("color"),g=h.domain().sort(function(t,e){return t-e}),m=g.reduce(function(t,e){return t&&r.isDate(e)},!0),y=m?g.map(Number):g,v=b(y[0],y[y.length-1]),x=(s=t._chart.getSpec(),(u=a.extractFieldsFormatInfo(s)[h.dim].format)||(u=function(t){return new Date(t)}),function(t){return String(u(t))}),_=m?x:v,w=h.brewer.length,S=((d.color||{}).label||{}).text||h.dim,T=function(t){return t.length*c*.618},E=h.isInteger?(y[1]-y[0])%3==0?4:(y[1]-y[0])%2==0?3:2:3,M=p(y,E),k=(m?M.map(function(t){return new Date(t)}):M).map(_);k[0]===k[k.length-1]&&(k=[k[0]]),t._container.insertAdjacentHTML("beforeend",t._template({name:S,top:null,items:'<div class="tau-chart__legend__gradient-wrapper"></div>'}));var A=t._container.lastElementChild.querySelector(".tau-chart__legend__gradient-wrapper"),C=A.getBoundingClientRect().width,O=!1;k.reduce(function(t,e){return t+T(e)},0)>C&&(k.length>1&&T(k[0])+T(k[k.length-1])>C?O=!0:k=[k[0],k[k.length-1]]);var L=O?(o=-.382*c/2,{width:C,height:120,barX:0,barY:0,barWidth:20,barHeight:120,textAnchor:"start",textX:r.range(E).map(function(){return 25}),textY:1===k.length?60+.618*c:k.map(function(t,e){var n=(k.length-1-e)/(k.length-1);return c*(1-n)+120*n+o})}):(n=T(k[0])/2,i=T(k[k.length-1])/2,{width:C,height:28+c,barX:0,barY:0,barWidth:C,barHeight:20,textAnchor:"middle",textX:1===k.length?[C/2]:k.map(function(t,e){var r=e/(k.length-1);return n*(1-r)+(C-i)*r}),textY:r.range(E).map(function(){return 28+c})}),N=p(y,w).map(function(t,e){return f("stop",{offset:e/(w-1)*100+"%",style:"stop-color:"+h(t)+';stop-opacity:1"'})}),F="legend-gradient-"+t.instanceId,R=f.apply(void 0,["svg",{class:"tau-chart__legend__gradient",width:L.width,height:L.height},f("defs",f.apply(void 0,["linearGradient",{id:F,x1:"0%",y1:O?"100%":"0%",x2:O?"0%":"100%",y2:"0%"}].concat(N))),f("rect",{class:"tau-chart__legend__gradient__bar",x:L.barX,y:L.barY,width:L.barWidth,height:L.barHeight,fill:"url(#"+F+")"})].concat(k.map(function(t,e){return f("text",{x:L.textX[e],y:L.textY[e],"text-anchor":L.textAnchor},t)})));A.insertAdjacentHTML("beforeend",R)}})},_drawSizeLegend:function(){var t=this;t._size.forEach(function(e){var n=t._chart.select(function(t){return t.config.size===e})[0];if(n){var i=n.config.guide||{},a=n.getScale("size"),o=a.domain().sort(function(t,e){return t-e});if(!Array.isArray(o)||!o.every(isFinite))return;var s=((i.size||{}).label||{}).text||a.dim,u=o[0],d=o[o.length-1],h=[u];if(d-u){var p=m(d-u),y=Math.round(4-p),v=Math.pow(10,y),x=r.unique(t._chart.getDataSources({excludeFilter:["legend"]})[a.source].data.map(function(t){return t[a.dim]}).filter(function(t){return t>=u&&t<=d})).sort(function(t,e){return t-e}),_=g(x,l,a.funcType);h=r.unique(_.map(function(t){return Math.round(t*v)/v}))}var w=b(h[0],h[h.length-1]),S=function(t){return t.length*c*.618};h.reverse();var T=h.map(a),E=Math.max.apply(null,T),M=h.map(w);t._container.insertAdjacentHTML("beforeend",t._template({name:s,top:null,items:'<div class="tau-chart__legend__size-wrapper"></div>'}));var k=t._container.lastElementChild.querySelector(".tau-chart__legend__size-wrapper"),A=k.getBoundingClientRect().width,C=!1;(Math.max.apply(null,M.map(S))>A/4||1===M.length)&&(C=!0);var O=C?function(){for(var t,e,n=c,i=T[0]/2,a=T[T.length-1]/2,o=[i],s=1;s<T.length;s++)e=T[s-1]/2,t=T[s]/2,o.push(o[s-1]+Math.max(1.618*c,e+n+t));var u=.618*c/2;return{width:A,height:o[o.length-1]+Math.max(a,c/2),circleX:r.range(T.length).map(function(){return E/2}),circleY:o,textAnchor:"start",textX:r.range(M.length).map(function(){return E+8}),textY:o.map(function(t){return t+u})}}():function(){for(var t,e,n=Math.max(S(M[0])/2,T[0]/2),i=Math.max(S(M[M.length-1])/2,T[T.length-1]/2),a=(A-T.reduce(function(t,e,n){return t+(0===n||n===T.length-1?e/2:e)},0)-n-i)/(l-1),o=[n],s=1;s<T.length;s++)e=T[s-1]/2,t=T[s]/2,o.push(o[s-1]+e+a+t);var u=T.map(function(t){return E-t/2});return{width:A,height:E+8+c,circleX:o,circleY:u,textAnchor:"middle",textX:o,textY:r.range(M.length).map(function(){return E+8+c})}}(),L=f.apply(void 0,["svg",{class:"tau-chart__legend__size",width:O.width,height:O.height}].concat(T.map(function(t,e){return f("circle",{class:"tau-chart__legend__size__item__circle "+(n.config.color?"color-definite":"color-default-size"),cx:O.circleX[e],cy:O.circleY[e],r:t/2})}),M.map(function(t,e){return f("text",{class:"tau-chart__legend__size__item__label",x:O.textX[e],y:O.textY[e],"text-anchor":O.textAnchor},t)})));k.insertAdjacentHTML("beforeend",L)}})},_drawColorLegend:function(){var t=this;t._color.forEach(function(e){var i=t._chart.select(function(t){return t.config.color===e})[0];if(i){var a=i.config.guide||{},o=i.getScale("color"),s=t._chart.getDataSources({excludeFilter:["legend"]}),u=r.unique(s[o.source].data.map(function(t){return t[o.dim]})),l=t._chart.getSpec().scales[e];if(l.order)u=r.union(r.intersection(l.order,u),u);else{var c=t._legendOrderState[e];u=u.sort(function(t,e){var n=c[t]-c[e];return n&&n/Math.abs(n)})}var d=((a.color||{}).label||{}).text||o.dim,h=(a.color||{}).tickFormatNullAlias||"No "+d,f=u.map(function(i){var r=JSON.stringify(n(i)?null:i),a=o.dim+r;return{scaleId:e,dim:o.dim,color:o(i),disabled:t._currentFilters.hasOwnProperty(a),label:i,value:r}});t._legendColorByScaleId[e]=f,t._container.insertAdjacentHTML("beforeend",t._template({name:d,top:t._resetTemplate({classDisabled:f.some(function(t){return t.disabled})?"":"disabled"}),items:f.map(function(e){return t._itemTemplate({scaleId:e.scaleId,dim:r.escape(e.dim),color:e.color,cssClass:o.toClass(e.color),cssColor:e.disabled?"transparent":o.toColor(e.color),borderColor:o.toColor(e.color),classDisabled:e.disabled?"disabled":"",label:r.escape(n(e.label)?h:e.label),value:r.escape(e.value)})}).join("")}))}}),t._color.length>0&&(t._updateResetButtonPosition(),t._scrollTimeout=null,t._scrollListener=function(){var e=t._container.querySelector(o);e.style.display="none",t._scrollTimeout&&clearTimeout(t._scrollTimeout),t._scrollTimeout=setTimeout(function(){t._updateResetButtonPosition(),e.style.display="",t._scrollTimeout=null},250)},t._getScrollContainer().addEventListener("scroll",t._scrollListener))},_toggleLegendItem:function(t,e){var n=this._currentFilters,r=t?Array.prototype.filter.call(t.parentNode.childNodes,function(t){return t.matches(s)}):null,a=function(t){var e=t.getAttribute("data-dim"),n=t.getAttribute("data-value");return{sid:t.getAttribute("data-scale-id"),dim:e,val:n,key:e+n}},o=function(t){return t in n},u=function(t,e){var r=a(t);if(o(r.key)===e)if(e){var s=n[r.key];delete n[r.key],t.classList.remove("disabled"),this._chart.removeFilter(s)}else{t.classList.add("disabled");var u=i(r.dim,r.val);n[r.key]=this._chart.addFilter({tag:"legend",predicate:function(t){return!u(t)}})}}.bind(this),l=function(e){return e===t},c=!!t&&o(a(t).key),d=function(t,e){t.querySelector(".tau-chart__legend__guide").style.backgroundColor=e?"":"transparent"};if("reset"===e)r.forEach(function(t){u(t,!0),d(t,!0)});else if("leave-others"===e)r.forEach(function(t){l(t)&&u(t,c)}),d(t,c);else if("focus-single"===e){var h=!c&&r.every(function(t){return l(t)||o(a(t).key)});r.forEach(function(t){var e=l(t)||h;u(t,e)}),c&&d(t,!0)}this._chart.refresh()},_highlightToggle:function(t,e){if(!t.matches(".disabled")){var n=t.getAttribute("data-dim"),r=t.getAttribute("data-value"),a=e?i(n,r):function(t){return null};this._chart.select(function(t){return!0}).forEach(function(t){t.fire("highlight",a)})}},_getScrollContainer:function(){return this._container.parentNode.parentNode},_updateResetButtonPosition:function(){this._container.querySelector(o).style.top=this._getScrollContainer().scrollTop+"px"},_generateColorMap:function(t,e){var n=e.length;return t.reduce(function(t,i,r){return t[i]=e[r%n],t},{})},_assignStaticBrewersOrEx:function(){var t=this;t._color.forEach(function(e){var n=t._chart.getSpec().scales[e],i=t._chart.getDataSources({excludeFilter:["legend"]}),a=t._chart.getScaleFactory(i).createScaleInfoByName(e).domain();if(!n.brewer||Array.isArray(n.brewer)){var o=n.brewer||r.range(20).map(function(t){return"color20-"+(1+t)});n.brewer=t._generateColorMap(a,o)}t._legendOrderState[e]=a.reduce(function(t,e,n){return t[e]=n,t},{})})}}}return t.api.plugins.add("legend",w),w}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("taucharts")):"function"==typeof define&&define.amd?define(["taucharts"],e):(t.Taucharts=t.Taucharts||{},t.Taucharts.ParallelBrushing=e(t.Taucharts))}(this,function(t){"use strict";var e=(t=t&&t.hasOwnProperty("default")?t.default:t).api.utils;function n(t){var n=e.defaults(t||{},{verbose:!1,forceBrush:{}}),i={init:function(t){n.verbose&&(this.panel=t.insertToRightSidebar(this.template())),t.traverseSpec(t.getSpec(),function(t){t&&"COORDS.PARALLEL"===t.type&&(t.guide=t.guide||{},t.guide.enableBrushing=!0)}),i.forceBrush=n.forceBrush||{}},onRender:function(t){var e=t.getSpec().scales,r=Object.keys(e).reduce(function(t,n){var r=e[n].dim;return i.forceBrush[r]&&(t[n]=i.forceBrush[r]),t},{}),a=t.select(function(t){return"PARALLEL/ELEMENT.LINE"===t.config.type});a.forEach(function(t,e){t.parentUnit.on("brush",function(r,a){i.forceBrush={};var o=a.map(function(t){var e=t.dim,n=t.func,r=t.args;i.forceBrush[e]=r;var a=function(){return!0};return"between"===n&&(a=function(t){return t[e]>=r[0]&&r[1]>=t[e]}),"inset"===n&&(a=function(t){return r.indexOf(t[e])>=0}),a}),s=0;if(t.fire("highlight",function(t){var e=o.every(function(e){return e(t)});return s+=e?1:0,e}),n.verbose){var u=i.panel.getElementsByClassName("i-"+e);if(0===u.length){var l=document.createElement("div");l.className="i-"+e,i.panel.appendChild(l),u[0]=l}u[0].innerHTML=a.reduce(function(t,e){return t+"<div>"+e.dim+": ["+e.args.join(",")+"]</div>"},"<div>Matched: "+s+"</div>")}})}),a.forEach(function(t){t.parentUnit.fire("force-brush",r)})},template:e.template('<div class="tau-chart__chart_brushing_panel"></div>')};return i}return t.api.plugins.add("parallel-brushing",n),n}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("taucharts")):"function"==typeof define&&define.amd?define(["taucharts"],e):(t.Taucharts=t.Taucharts||{},t.Taucharts.ParallelTooltip=e(t.Taucharts))}(this,function(t){"use strict";var e=(t=t&&t.hasOwnProperty("default")?t.default:t).api.utils;function n(t){e.defaults(t||{},{});return{init:function(t){this._cursor=null,this._chart=t,this._tooltip=t.addBalloon({spacing:3,auto:!0,effectClass:"fade"}),this._tooltip.content(this.template),this._tooltip.getElement().addEventListener("click",function(t){for(var e=t.target;e!==t.currentTarget&&null!==e;)e.classList.contains("i-role-exclude")&&n._exclude(),e=e.parentNode;n._tooltip.hide()},!1);var e,n=this;this.showTooltip=function(t){clearTimeout(e),n._cursor=t.data;var i=n._tooltip.getElement().querySelectorAll(".i-role-content");i[0]&&(i[0].innerHTML=Object.keys(t.data).map(function(e){return n.itemTemplate({label:e,value:t.data[e]})}).join("")),n._tooltip.show(t.event.pageX,t.event.pageY).updateSize()},this.hideTooltip=function(t){e=setTimeout(function(){n._tooltip.hide()},1e3)},this._tooltip.getElement().addEventListener("mouseover",function(t){clearTimeout(e)},!1),this._tooltip.getElement().addEventListener("mouseleave",function(t){n._tooltip.hide()},!1)},_exclude:function(){var t;this._chart.addFilter({tag:"exclude",predicate:(t=this._cursor,function(e){return JSON.stringify(e)!==JSON.stringify(t)})}),this._chart.refresh()},onRender:function(t){var e=this;t.select(function(t){return"PARALLEL/ELEMENT.LINE"===t.config.type}).forEach(function(t){t.on("mouseout",function(t,n){e.hideTooltip(n)}),t.on("mouseover",function(t,n){e.showTooltip(n)})})},template:['<div class="tau-chart__tooltip__buttons tau-chart__tooltip__clickable">','<div class="tau-chart__tooltip__button i-role-exclude">','<div class="tau-chart__tooltip__button__wrap">','<span class="tau-icon-close-gray"></span>',"Exclude","</div>","</div>","</div>",'<div class="i-role-content tau-chart__tooltip__content"></div>'].join(""),itemTemplate:e.template(['<div class="tau-chart__tooltip__list__item">','<div class="tau-chart__tooltip__list__elem"><%=label%></div>','<div class="tau-chart__tooltip__list__elem"><%=value%></div>',"</div>"].join(""))}}return t.api.plugins.add("parallel-tooltip",n),n}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("taucharts"),require("d3-array"),require("d3-brush"),require("d3-scale"),require("d3-selection"),require("d3-time-format")):"function"==typeof define&&define.amd?define(["taucharts","d3-array","d3-brush","d3-scale","d3-selection","d3-time-format"],e):(t.Taucharts=t.Taucharts||{},t.Taucharts.QuickFilter=e(t.Taucharts,t.d3,t.d3,t.d3,t.d3,t.d3))}(this,function(t,e,n,i,r,a){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var o=(Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t})({},e,n,i,r,a),s=t.api.utils,u=0;function l(t){return{init:function(e){this._chart=e,this._currentFilters={},this._data={},this._bounds={},this._filter={},this._container={},this._layout=this._chart.getLayout().layout;var n=this,i=this._chart.getSpec(),r=i.sources["/"],a=t&&t.fields||t;this._fields=Array.isArray(a)&&a.length>0?a:Object.keys(r.dims),this._applyImmediately=Boolean(t&&t.applyImmediately);var s=n._chart.getChartModelData();this._filtersContainer=n._chart.insertToRightSidebar(n._filtersContainer),this._filtersContainer.style.maxHeight="0px",n._fields.filter(function(t){var e="measure"===r.dims[t].type;return e||i.settings.log("The ["+t+"] isn't measure so Quick Filter plugin skipped it"),e}).forEach(function(t){n._data[t]=s.map(function(e){return e[t]}),n._bounds[t]=o.extent(n._data[t]),n._filter[t]=n._bounds[t],n._filtersContainer.insertAdjacentHTML("beforeend",n._filterWrapper({name:t})),n._container[t]=n._filtersContainer.lastChild,n._drawFilter(t)})},onRender:function(){this._filtersContainer.style.maxHeight="none"},_filtersContainer:'<div class="tau-chart__filter"></div>',_filterWrapper:s.template('<div class="tau-chart__filter__wrap"><div class="tau-chart__legend__title"><%=name%></div></div>'),_drawFilter:function(t){var e=this._data[t],n=this._bounds[t],i=this._filter[t],a=s.isDate(n[0])||s.isDate(n[1]),u=this,l=0,c=24,d=21,h=12,f=180-h-c,p=41-l-d-8,g=o.scaleLinear().domain(n).range([0,f]),m=o.brushX().extent([[0,0],[f,20]]).on("start",function(){u._layout.style["overflow-y"]="hidden"}).on("brush",this._applyImmediately?A:k).on("end",function(){u._layout.style["overflow-y"]="",A()}),y=o.select(this._container[t]).append("svg").attr("width",f+h+c).attr("height",p+l+d+4).append("g").attr("transform","translate("+h+","+l+")"),v=(y.append("g").selectAll("rect").data(e).enter().append("rect").attr("transform",function(t){return"translate("+g(t)+","+(l+4)+")"}).attr("height",p).attr("width",1),y.append("g").attr("class","brush").call(m));v.append("g").attr("class","resize e").attr("cursor","ew-resize").attr("pointer-events","none"),v.append("g").attr("class","resize w").attr("cursor","ew-resize").attr("pointer-events","none"),v.selectAll(".resize").append("line").attr("transform","translate(0, 0)").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",p+8),v.selectAll(".resize").append("text").attr("x",0).attr("y",2*(p+4)),v.selectAll("rect").attr("height",p+8);var x,_=y.append("text").attr("x",f/2).attr("y",2*(p+4)).attr("class","date-label"),b=(x=u._filter[t][1]-u._filter[t][0],Math.log(x)/Math.LN10),w=Math.round(3-b),S=Math.pow(10,w);var T,E;if(a){var M=(E=(E=(T=["%y","&thinsp;%b","%d","%H",":%M",":%S"]).findIndex(function(t){var e=o.timeFormat(t);return e(new Date(n[0]))!==e(new Date(n[1]))}))<0?T.length:E,{comm:T.slice(0,E),diff:T.slice(E)});M.comm.length<3?(M.diff.splice(-3),M.diff.reverse(),M.comm.reverse()):(M.comm.length<5&&M.diff.pop(),M.diff=M.comm.splice(3,M.comm.length-3).concat(M.diff),M.comm.reverse())}function k(){var e=r.event;if(e&&Array.isArray(e.selection)){var n=e.selection.map(g.invert);i=n,u._filter[t]=n}else i=u._filter[t];var s=a?new Date(i[0]).getTime():i[0],l=a?new Date(i[1]).getTime():i[1],c=Math.round(parseFloat(s)*S)/S,d=Math.round(parseFloat(l)*S)/S;v.select(".handle--w"),v.select(".handle--e");v.select(".resize.w").attr("transform","translate("+g(i[0])+",0)"),v.select(".resize.e").attr("transform","translate("+g(i[1])+",0)");var h=v.selectAll(".w text"),f=v.selectAll(".e text");if(a){var p=o.timeFormat(M.comm.join("")),m=o.timeFormat(M.diff.join(""));_.html(m(new Date(c))+"&thinsp;..&thinsp;"+m(new Date(d))+' <tspan class="common">'+p(new Date(d))+"</tspan>")}else h.text(c),f.text(d)}function A(){k(),u._applyFilter(t)}A(),m.move(v,i.map(g))},destroy:function(){var t=this._currentFilters,e=this._chart;Object.keys(t).forEach(function(n){return e.removeFilter(t[n])});var n;(n=this._filtersContainer)&&n.parentElement&&n.parentElement.removeChild(n)},_applyFilter:function(t){var e,n,i,r=this._currentFilters,a=this._filter[t][0],o=this._filter[t][1],s=(e=t,n=a,i=o,function(t){var r=t[e];return r<n||r>i}),l=r[t];delete r[t],this._chart.removeFilter(l),r[t]=this._chart.addFilter({tag:"quick-filter",predicate:function(t){return!s(t)}}),u<0?this._chart.refresh():(this._refreshRequestId&&clearTimeout(this._refreshRequestId),this._refreshRequestId=setTimeout(function(){this._refreshRequestId=null,this._chart.refresh()}.bind(this),u))}}}return t.api.plugins.add("quick-filter",l),l}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("taucharts")):"function"==typeof define&&define.amd?define(["taucharts"],e):(t.Taucharts=t.Taucharts||{},t.Taucharts.Settings=e(t.Taucharts))}(this,function(t){"use strict";var e=(t=t&&t.hasOwnProperty("default")?t.default:t).api.utils;function n(t){var n=e.defaults(t||{},{show:!0,modes:["normal","entire-view","fit-width","fit-height","minimal"]});return{init:function(t){n.show&&(n.selectedMode=t.getSpec().settings.fitModel,t.insertToHeader(this.template({modes:n.modes.map(function(t){return"<option "+(n.selectedMode===t?"selected":"")+' value="'+t+'">'+t+"</option>"})})).addEventListener("change",function(e){var i=e.target;i.classList.contains("i-role-fit-model")&&(n.selectedMode=i.value,t.getSpec().settings.fitModel=n.selectedMode,t.refresh())},!1))},template:e.template(['<div class="tau-chart__chartsettingspanel">',"<div>","<span>View Mode:&nbsp;</span>",'<select class="i-role-fit-model tau-chart__select">',"<%= modes %> />","</select>","</div>","</div>"].join(""))}}return t.api.plugins.add("settings",n),n}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("taucharts"),require("d3-selection")):"function"==typeof define&&define.amd?define(["taucharts","d3-selection"],e):(t.Taucharts=t.Taucharts||{},t.Taucharts.Tooltip=e(t.Taucharts,t.d3))}(this,function(t,e){"use strict";var n="tau-chart__tooltip";var i=(t=t&&t.hasOwnProperty("default")?t.default:t).api.utils,r=t.api.domUtils,a=t.api.pluginsSDK,o="tau-chart__tooltip",s=function(){function t(t){this.settings=i.defaults(t||{},{align:"bottom-right",clsClickable:o+"__clickable",clsStuck:"stuck",clsTarget:o+"-target",escapeHtml:!0,fields:null,formatters:{},getTemplate:null,spacing:24,winBound:12}),this.onRender=this._getRenderHandler()}return t.prototype.init=function(t){this._chart=t,this._tooltip=this._chart.addBalloon({spacing:this.settings.spacing,winBound:this.settings.winBound,auto:!0,effectClass:"fade"}),this._initDomEvents(),this.state={highlight:null,isStuck:!1},this.setState(this.state),this._template=this._getTemplate()},t.prototype._getTemplate=function(){var t,e=(t=this,this.settings,{render:function(t){return this.args=t,t=Object.assign({},t,{fields:this.filterFields(t.fields)}),this.rootTemplate(t)},rootTemplate:function(t){return['<div class="'+n+"__buttons "+n+'__clickable">',this.buttonsTemplate(),"</div>",'<div class="i-role-content '+n+'__content">',this.contentTemplate(t),"</div>"].join("\n")},contentTemplate:function(t){return this.fieldsTemplate(t)},filterFields:function(e){return e.filter(function(e){var n=e.split(".");return!(2===n.length&&t.skipInfo[n[0]])})},getLabel:function(e){return t.getFieldLabel(e)},getFormatter:function(e){return t.getFieldFormat(e)},fieldsTemplate:function(t){var e=this,n=t.data;return t.fields.map(function(t){return e.itemTemplate({data:n,field:t})}).join("\n")},itemTemplate:function(t){var e=t.data,i=t.field,r=this.getLabel(i),a=this.getFormatter(i)(e[i]);return['<div class="'+n+'__list__item">','  <div class="'+n+'__list__elem">'+r+"</div>",'  <div class="'+n+'__list__elem">'+a+"</div>","</div>"].join("\n")},buttonsTemplate:function(){return[this.buttonTemplate({cls:"i-role-exclude",text:"Exclude",icon:function(){return'<span class="tau-icon-close-gray"></span>'}})].join("\n")},buttonTemplate:function(t){var e=t.icon,i=t.text,r=t.cls;return['<div class="'+n+"__button "+r+'">','  <div class="'+n+'__button__wrap">',"    "+(e?e()+" ":"")+i,"  </div>","</div>"].join("\n")},didMount:function(){var e=t.getDomNode().querySelector(".i-role-exclude");e&&e.addEventListener("click",function(){t.excludeHighlightedElement(),t.setState({highlight:null,isStuck:!1})})}});return"function"==typeof this.settings.getTemplate?this.settings.getTemplate(e,this,this.settings):e},t.prototype._renderTemplate=function(t,e){return this._template.render({data:t,fields:e})},t.prototype._initDomEvents=function(){var t=this;this._scrollHandler=function(){t.setState({highlight:null,isStuck:!1})},window.addEventListener("scroll",this._scrollHandler,!0),this._outerClickHandler=function(e){var n=Array.from(document.querySelectorAll("."+t.settings.clsClickable)).concat(t.getDomNode()).map(function(t){return t.getBoundingClientRect()}),i=Math.min.apply(Math,n.map(function(t){return t.top})),r=Math.min.apply(Math,n.map(function(t){return t.left})),a=Math.max.apply(Math,n.map(function(t){return t.right})),o=Math.max.apply(Math,n.map(function(t){return t.bottom}));(e.clientX<r||e.clientX>a||e.clientY<i||e.clientY>o)&&t.setState({highlight:null,isStuck:!1})}},t.prototype.getDomNode=function(){return this._tooltip.getElement()},t.prototype.setState=function(t){var e=this,n=this.settings,i=this.state,a=this.state=Object.assign({},i,t);i.highlight=i.highlight||{data:null,cursor:null,unit:null},a.highlight=a.highlight||{data:null,cursor:null,unit:null},a.isStuck&&i.highlight.data&&(a.highlight=i.highlight),a.highlight.data!==i.highlight.data&&(a.highlight.data?(this._hideTooltip(),this._showTooltip(a.highlight.data,a.highlight.cursor),this._setTargetSvgClass(!0),requestAnimationFrame(function(){e._setTargetSvgClass(!0)})):a.isStuck||!i.highlight.data||a.highlight.data||(this._removeFocus(),this._hideTooltip(),this._setTargetSvgClass(!1))),!a.highlight.data||i.highlight.cursor&&a.highlight.cursor.x===i.highlight.cursor.x&&a.highlight.cursor.y===i.highlight.cursor.y||(this._tooltip.position(a.highlight.cursor.x,a.highlight.cursor.y),this._tooltip.updateSize());var o=this.getDomNode();a.isStuck!==i.isStuck&&(a.isStuck?(window.addEventListener("click",this._outerClickHandler,!0),o.classList.add(n.clsStuck),this._setTargetEventsEnabled(!1),this._accentFocus(a.highlight.data),this._tooltip.updateSize()):(window.removeEventListener("click",this._outerClickHandler,!0),o.classList.remove(n.clsStuck),requestAnimationFrame(function(){e._setTargetEventsEnabled(!0);var t=e._chart.getSVG();t&&r.dispatchMouseEvent(t,"mouseleave")})))},t.prototype._showTooltip=function(t,e){var n=this.settings,i=n.fields||"function"==typeof n.getFields&&n.getFields(this._chart)||Object.keys(t),r=this._renderTemplate(t,i);this._tooltip.content(r).position(e.x,e.y).place(n.align).show().updateSize(),this._template.didMount&&this._template.didMount()},t.prototype._hideTooltip=function(){window.removeEventListener("click",this._outerClickHandler,!0),this._template.willUnmount&&this._template.willUnmount(),this._tooltip.hide()},t.prototype.destroy=function(){window.removeEventListener("scroll",this._scrollHandler,!0),this._setTargetSvgClass(!1),this.setState({highlight:null,isStuck:!1}),this._tooltip.destroy()},t.prototype._subscribeToHover=function(){var t=this,e=["ELEMENT.LINE","ELEMENT.AREA","ELEMENT.PATH","ELEMENT.INTERVAL","ELEMENT.INTERVAL.STACKED","ELEMENT.POINT"];this._chart.select(function(t){return e.indexOf(t.config.type)>=0}).forEach(function(e){e.on("data-hover",function(e,n){var i=document.body.getBoundingClientRect();t.setState({highlight:n.data?{data:n.data,cursor:{x:n.event.clientX-i.left,y:n.event.clientY-i.top},unit:n.unit}:null})}),e.on("data-click",function(e,n){var i=document.body.getBoundingClientRect();t.setState(n.data?{highlight:{data:n.data,cursor:{x:n.event.clientX-i.left,y:n.event.clientY-i.top},unit:n.unit},isStuck:!0}:{highlight:null,isStuck:null})})})},t.prototype.getFieldFormat=function(t){var e=this._formatters[t]?this._formatters[t].format:function(t){return String(t)};return this.settings.escapeHtml?function(t){return i.escapeHtml(e(t))}:e},t.prototype.getFieldLabel=function(t){var e=this._formatters[t]?this._formatters[t].label:t;return this.settings.escapeHtml?i.escapeHtml(e):e},t.prototype._accentFocus=function(t){var e=function(e){return e===t};this._chart.select(function(){return!0}).forEach(function(t){t.fire("highlight",e)})},t.prototype._removeFocus=function(){var t=function(){return null};this._chart.select(function(){return!0}).forEach(function(e){e.fire("highlight",t),e.fire("highlight-data-points",t)})},t.prototype.excludeHighlightedElement=function(){var t=this.state.highlight.data;this._chart.addFilter({tag:"exclude",predicate:function(e){return e!==t}}),this._chart.refresh()},t.prototype._getRenderHandler=function(){return function(){this._formatters=a.getFieldFormatters(this._chart.getSpec(),this.settings.formatters),this._subscribeToHover(),this.setState({highlight:null,isStuck:!1})}},t.prototype._setTargetSvgClass=function(t){e.select(this._chart.getSVG()).classed(this.settings.clsTarget,t)},t.prototype._setTargetEventsEnabled=function(t){t?this._chart.enablePointerEvents():this._chart.disablePointerEvents()},t}();function u(t){return new s(t)}return t.api.plugins.add("tooltip",u),u}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("taucharts"),require("d3-selection")):"function"==typeof define&&define.amd?define(["taucharts","d3-selection"],e):(t.Taucharts=t.Taucharts||{},t.Taucharts.Trendline=e(t.Taucharts,t.d3))}(this,function(t,e){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var n,i=(n={linear:function(t){for(var e=[0,0,0,0,0],n=0,i=[];n<t.length;n++)t[n][1]&&(e[0]+=t[n][0],e[1]+=t[n][1],e[2]+=t[n][0]*t[n][0],e[3]+=t[n][0]*t[n][1],e[4]+=t[n][1]*t[n][1]);var r=(n*e[3]-e[0]*e[1])/(n*e[2]-e[0]*e[0]);r=isNaN(r)?0:r;for(var a=e[1]/n-r*e[0]/n,o=0,s=t.length;o<s;o++){var u=[t[o][0],t[o][0]*r+a];i.push(u)}return{equation:[r,a],points:i,string:"y = "+Math.round(100*r)/100+"x + "+Math.round(100*a)/100}},exponential:function(t){var e=[0,0,0,0,0,0],n=0,i=[];for(u=t.length;n<u;n++)t[n][1]&&(e[0]+=t[n][0],e[1]+=t[n][1],e[2]+=t[n][0]*t[n][0]*t[n][1],e[3]+=t[n][1]*Math.log(t[n][1]),e[4]+=t[n][0]*t[n][1]*Math.log(t[n][1]),e[5]+=t[n][0]*t[n][1]);for(var r=e[1]*e[2]-e[5]*e[5],a=Math.pow(Math.E,(e[2]*e[3]-e[5]*e[4])/r),o=(e[1]*e[4]-e[5]*e[3])/r,s=0,u=t.length;s<u;s++){var l=[t[s][0],a*Math.pow(Math.E,o*t[s][0])];i.push(l)}return{equation:[a,o],points:i,string:"y = "+Math.round(100*a)/100+"e^("+Math.round(100*o)/100+"x)"}},logarithmic:function(t){var e=[0,0,0,0],n=0,i=[];for(s=t.length;n<s;n++)t[n][1]&&(e[0]+=Math.log(t[n][0]),e[1]+=t[n][1]*Math.log(t[n][0]),e[2]+=t[n][1],e[3]+=Math.pow(Math.log(t[n][0]),2));for(var r=(n*e[1]-e[2]*e[0])/(n*e[3]-e[0]*e[0]),a=(e[2]-r*e[0])/n,o=0,s=t.length;o<s;o++){var u=[t[o][0],a+r*Math.log(t[o][0])];i.push(u)}return{equation:[a,r],points:i,string:"y = "+Math.round(100*a)/100+" + "+Math.round(100*r)/100+" ln(x)"}},power:function(t){var e=[0,0,0,0],n=0,i=[];for(s=t.length;n<s;n++)t[n][1]&&(e[0]+=Math.log(t[n][0]),e[1]+=Math.log(t[n][1])*Math.log(t[n][0]),e[2]+=Math.log(t[n][1]),e[3]+=Math.pow(Math.log(t[n][0]),2));for(var r=(n*e[1]-e[2]*e[0])/(n*e[3]-e[0]*e[0]),a=Math.pow(Math.E,(e[2]-r*e[0])/n),o=0,s=t.length;o<s;o++){var u=[t[o][0],a*Math.pow(t[o][0],r)];i.push(u)}return{equation:[a,r],points:i,string:"y = "+Math.round(100*a)/100+"x^"+Math.round(100*r)/100}},polynomial:function(t,e){void 0===e&&(e=2);for(var n=[],i=[],r=[],a=0,o=0,s=0,u=e+1;s<u;s++){for(var l=0,c=t.length;l<c;l++)t[l][1]&&(a+=Math.pow(t[l][0],s)*t[l][1]);n.push(a),a=0;for(var d=[],h=0;h<u;h++){for(l=0,c=t.length;l<c;l++)t[l][1]&&(o+=Math.pow(t[l][0],s+h));d.push(o),o=0}i.push(d)}i.push(n);var f=function(t,e){var n=0,i=0,r=0,a=0,o=0,s=t.length-1,u=new Array(e);for(n=0;n<s;n++){for(a=n,i=n+1;i<s;i++)Math.abs(t[n][i])>Math.abs(t[n][a])&&(a=i);for(r=n;r<s+1;r++)o=t[r][n],t[r][n]=t[r][a],t[r][a]=o;for(i=n+1;i<s;i++)for(r=s;r>=n;r--)t[r][i]-=t[r][n]*t[n][i]/t[n][n]}for(i=s-1;i>=0;i--){for(o=0,r=i+1;r<s;r++)o+=t[r][i]*u[r];u[i]=(t[s][i]-o)/t[i][i]}return u}(i,u);for(s=0,c=t.length;s<c;s++){for(var p=0,g=0;g<f.length;g++)p+=f[g]*Math.pow(t[s][0],g);r.push([t[s][0],p])}var m="y = ";for(s=f.length-1;s>=0;s--)m+=s>1?Math.round(100*f[s])/100+"x^"+s+" + ":1==s?Math.round(100*f[s])/100+"x + ":Math.round(100*f[s])/100;return{equation:f,points:r,string:m}},lastvalue:function(t){for(var e=[],n=null,i=0;i<t.length;i++)t[i][1]?(n=t[i][1],e.push([t[i][0],t[i][1]])):e.push([t[i][0],n]);return{equation:[n],points:e,string:""+n}},loess:function(t){return{equation:"loess",points:(e=t,n=.5,i=e.map(function(t){return t[0]}),r=function(t,e,n){for(var i=[],r=0,a=Math.floor(n*t.length)-1,o=0;o<t.length;o++){var s,u=t[o];o>0&&a<t.length-1&&t[a+1]-t[o]<t[o]-t[r]&&(r++,a++),s=t[o]-t[r]>t[a]-t[o]?r:a;for(var l=Math.abs(1/(t[s]-u)),c=0,d=0,h=0,f=0,p=0,g=r;g<=a;){var m=t[g],y=e[g],v=(k=1-(M=(g<o?u-m:m-u)*l)*M*M)*k*k,x=m*v;c+=v,d+=x,h+=m*x,f+=y*v,p+=y*x,g++}var _,b=d/c,w=f/c,S=p/c,T=h/c,E=w-(_=T==b*b?0:(S-b*w)/(T-b*b))*b;i[o]=_*u+E}var M,k;return i}(i,e.map(function(t){return t[1]}),n),i.map(function(t,e){return[t,r[e]]})),string:"loess"};var e,n,i,r}},function(t,e,i){if("string"==typeof t)return n[t](e,i)}),r=t.api.utils;function a(n){var a=r.defaults(n||{},{type:"linear",hideError:!1,showPanel:!0,showTrend:!0,models:["linear","exponential","logarithmic"]});return{init:function(t){if(this._chart=t,this._applicableElements=["ELEMENT.POINT","ELEMENT.LINE","ELEMENT.AREA","ELEMENT.INTERVAL"],this._isApplicable=this.checkIfApplicable(t),a.showPanel){this._container=t.insertToRightSidebar(this.containerTemplate);var e="applicable-true";this._isApplicable||(e="applicable-false",this._error=["Trend line can't be computed for categorical data.","Each axis should be either a measure or a date."].join(" ")),this._container.classList.add(e),a.hideError&&this._container.classList.add("hide-trendline-error"),this.uiChangeEventsDispatcher=function(t){var e=t.target,n=e.classList;n.contains("i-role-show-trend")&&(a.showTrend=e.checked),n.contains("i-role-change-model")&&(a.type=e.value),this._chart.refresh()}.bind(this),this._container.addEventListener("change",this.uiChangeEventsDispatcher,!1)}},checkIfApplicable:function(t){var e=this,n=t.getSpec(),i=!1;return t.traverseSpec(n,function(t,r){e.predicateIsApplicable(n,t,r)&&(i=!0)}),i},predicateIsApplicable:function(t,e,n){if(n&&"COORDS.RECT"!==n.type)return!1;if(n&&!n.units)return!1;if(-1===this._applicableElements.indexOf(e.type)||e.stack)return!1;var i=t.scales[e.x],r=t.scales[e.y];return!("ordinal"===i.type||"ordinal"===r.type)},onSpecReady:function(e,n){var o=this;if(a.showTrend){var s=t.api.tickPeriod,u=function(t){var e=s.get(t,{utc:n.settings.utcTime});return function(t){return e.cast(new Date(t))}};n.transformations=n.transformations||{},n.transformations.regression=function(t,e){var n=e.x.dim,a=e.y.dim,o=e.g.dim,s=Boolean(e.x.period),l=Boolean(e.y.period),c=s?u(e.x.period):function(t){return t},d=l?u(e.y.period):function(t){return t},h=t.map(function(t){return[r.isDate(t[n])?t[n].getTime():t[n],r.isDate(t[a])?t[a].getTime():t[a],t[o]]}),f=r.groupBy(h,function(t){return t[2]});return Object.keys(f).reduce(function(t,r){var u=f[r],h=i(e.type,u).points.filter(function(t){return null!==t[0]&&null!==t[1]}).sort(function(t,e){return t[0]-e[0]}).map(function(t){var e={};return e[n]=c(t[0]),e[a]=d(t[1]),o&&(e[o]=r),e});return h.length>1&&(s||l)&&(h=[h[0],h[h.length-1]]),t.concat(h.length>1?h:[])},[])},e.traverseSpec(n,function(t,e){if(o.predicateIsApplicable(n,t,e)){var i=n.scales[t.x],s=n.scales[t.y],u=n.scales[t.color]||{},l=JSON.parse(JSON.stringify(t));l.type="ELEMENT.LINE",l.size="size_null",l.namespace="trendline",l.transformation=l.transformation||[],l.transformation.push({type:"regression",args:{type:a.type,x:i,y:s,g:u}});l.guide=r.defaults({},l.guide||{}),l.guide.interpolate="linear",l.guide.showAnchors="never",l.guide.cssClass="tau-chart__trendline",l.guide.widthCssClass="tau-chart__line-width-1",l.guide.x=l.guide.x||{},l.guide.x.fillGaps=!1,delete l.guide.label,delete l.label,e.units.push(l)}})}},containerTemplate:'<div class="tau-chart__trendlinepanel"></div>',template:r.template(['<label class="tau-chart__trendlinepanel__title tau-chart__checkbox">','<input type="checkbox" class="tau-chart__checkbox__input i-role-show-trend" <%= showTrend %> />','<span class="tau-chart__checkbox__icon"></span>','<span class="tau-chart__checkbox__text">',"<%= title %>","</span>","</label>","<div>",'<select class="i-role-change-model tau-chart__select tau-chart__trendlinepanel__control">',"<%= models %>","</select>","</div>",'<div class="tau-chart__trendlinepanel__error-message"><%= error %></div>'].join("")),onRender:function(t){if(this._container){this._container.innerHTML=this.template({title:"Trend line",error:this._error,showTrend:a.showTrend&&this._isApplicable?"checked":"",models:a.models.map(function(t){return"<option "+(a.type===t?"selected":"")+' value="'+t+'">'+t+"</option>"})});var n=function(t){return function(){e.select(this).classed({active:t,"tau-chart__line-width-1":!t,"tau-chart__line-width-3":t})}};e.select(t.getSVG()).selectAll(".tau-chart__trendline").on("mouseenter",n(!0)).on("mouseleave",n(!1))}}}}return t.api.plugins.add("trendline",a),a});